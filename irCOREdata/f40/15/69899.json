{"doi":"10.1109\/DATE.2003.1253658","coreId":"69899","oai":"oai:eprints.lancs.ac.uk:20160","identifiers":["oai:eprints.lancs.ac.uk:20160","10.1109\/DATE.2003.1253658"],"title":"Techniques for automatic on chip closed loop transfer function monitoring for embedded charge pump phase locked loops.","authors":["Burbidge, Martin J.","Tijou, Jim","Richardson, Andrew M. D."],"enrichments":{"references":[{"id":16319043,"title":"A Richardson, A Lechner, \u201cTest Techniques for Embedded Charge Pump PLL\u2019s; Problems,","authors":[],"date":"2001","doi":"10.1109\/etw.2002.1029645","raw":"M. Burbidge, A Richardson, A Lechner, \u201cTest Techniques for Embedded Charge Pump PLL\u2019s; Problems, Current BIST Techniques, and Alternative Suggestions.\u201d 7 th IEEE International Mixed Signal est Workshop, June 13 th-15 th, 2001  Figure 11  Measured magnitude response results.  T","cites":null},{"id":16319048,"title":"An Effective Defect-Oriented BIST Architecture for High-Speed Phase-Locked Loops'","authors":[],"date":"2000","doi":"10.1109\/vtest.2000.843850","raw":"S.  Kim  &  M.  Soma,  'An  Effective  Defect-Oriented  BIST Architecture for High-Speed Phase-Locked Loops' ,IEEE VLSI Test Symposium, 30th. April - 4th May 2000, Montreal, Canada, pp 231-36  2","cites":null},{"id":16319045,"title":"BIST for Phase-Locked Loops in Digital Applications',","authors":[],"date":null,"doi":"10.1109\/test.1999.805777","raw":"S. Sunter & A. Roy: 'BIST for Phase-Locked Loops in Digital Applications',  IEEE  International  Test  Conference,  28-30th  Sept. 999, Atlantic City, NJ, USA, pp 532-540  1","cites":null},{"id":16319061,"title":"Monolithic Phase-Locked Loops and Clock Recovery Circuits; Theory and Design\u201d,","authors":[],"date":"1996","doi":"10.1109\/9780470545331","raw":"B Razavi (Editor), \u201cMonolithic Phase-Locked Loops and Clock Recovery Circuits; Theory and Design\u201d, IEEE Press 1996, ISBN","cites":null},{"id":16319051,"title":"On-Chip measurement of the jitter transfer function of charge pump phase locked loops\u201d","authors":[],"date":"1997","doi":"10.1109\/test.1997.639691","raw":"B.  R.  Veillette,  G.  W.  Roberts,  \u201cOn-Chip  measurement  of  the jitter transfer function of charge pump phase locked loops\u201d Proc. Int. est Conf, 1997, pp 776-85  T","cites":null},{"id":16319058,"title":"Phase lock Techniques\u201d; Second edition; Wiley nterscience;","authors":[],"date":"1979","doi":null,"raw":"F M Gardner, \u201cPhase lock Techniques\u201d; Second edition; Wiley nterscience; 1979.  I","cites":null},{"id":16319054,"title":"Phase Locked Loops, Design Simulation and pplications\u201d,","authors":[],"date":null,"doi":"10.1002\/9780470891179.ch19","raw":"R  Best,  \u201cPhase  Locked  Loops,  Design  Simulation  and pplications\u201d, 4 th Edition, Mc-Graw-Hill, ISBN 0071349030  A","cites":null}],"documentType":{"type":1}},"contributors":[],"datePublished":"2003-12-19","abstract":"Charge Pump Phase locked loops are used in a variety of applications, including on chip clock synthesis, symbol timing recovery for serial data streams, and generation of frequency agile high frequency carrier signals. In many applications PLLs are embedded into larger digital systems, in consequence, analogue test access is often limited. Test motivation is thus towards methods that can either aid digital only test of the PLL, or alternatively facilitate complete self testing of the PLL. One useful characterisation technique used by PLL designers is that of closed loop phase transfer function measurement. This test allows, an estimation of the PLL's natural frequency, damping, and 3 dB bandwidth to be made from the magnitude and phase response plots. These parameters relate directly to the time domain response of the PLL and will indicate errors in the PLL circuitry. This paper provides suggestions towards test methods that use a novel maximum frequency detection technique to aid automatic measurement of the closed loop phase transfer function. In addition, techniques presented have potential for full BIST applications","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/69899.pdf","fullTextIdentifier":"http:\/\/eprints.lancs.ac.uk\/20160\/1\/getPDF.pdf","pdfHashValue":"6424a7405e7928a4abdd71e649ae90d33f8f83dd","publisher":null,"rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:eprints.lancs.ac.uk:20160<\/identifier><datestamp>\n      2018-01-24T01:57:16Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      7375626A656374733D54:5441<\/setSpec><setSpec>\n      74797065733D626F6F6B5F73656374696F6E<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        Techniques for automatic on chip closed loop transfer function monitoring for embedded charge pump phase locked loops.<\/dc:title><dc:creator>\n        Burbidge, Martin J.<\/dc:creator><dc:creator>\n        Tijou, Jim<\/dc:creator><dc:creator>\n        Richardson, Andrew M. D.<\/dc:creator><dc:subject>\n        TA Engineering (General). Civil engineering (General)<\/dc:subject><dc:description>\n        Charge Pump Phase locked loops are used in a variety of applications, including on chip clock synthesis, symbol timing recovery for serial data streams, and generation of frequency agile high frequency carrier signals. In many applications PLLs are embedded into larger digital systems, in consequence, analogue test access is often limited. Test motivation is thus towards methods that can either aid digital only test of the PLL, or alternatively facilitate complete self testing of the PLL. One useful characterisation technique used by PLL designers is that of closed loop phase transfer function measurement. This test allows, an estimation of the PLL's natural frequency, damping, and 3 dB bandwidth to be made from the magnitude and phase response plots. These parameters relate directly to the time domain response of the PLL and will indicate errors in the PLL circuitry. This paper provides suggestions towards test methods that use a novel maximum frequency detection technique to aid automatic measurement of the closed loop phase transfer function. In addition, techniques presented have potential for full BIST applications.<\/dc:description><dc:date>\n        2003-12-19<\/dc:date><dc:type>\n        Contribution in Book\/Report\/Proceedings<\/dc:type><dc:type>\n        NonPeerReviewed<\/dc:type><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/eprints.lancs.ac.uk\/20160\/1\/getPDF.pdf<\/dc:identifier><dc:relation>\n        http:\/\/dx.doi.org\/10.1109\/DATE.2003.1253658<\/dc:relation><dc:identifier>\n        Burbidge, Martin J. and Tijou, Jim and Richardson, Andrew M. D. (2003) Techniques for automatic on chip closed loop transfer function monitoring for embedded charge pump phase locked loops. In: Design, Automation and Test in Europe Conference and Exhibition, 2003. , pp. 496-501. ISBN 0-7695-1870-2<\/dc:identifier><dc:relation>\n        http:\/\/eprints.lancs.ac.uk\/20160\/<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/dx.doi.org\/10.1109\/DATE.2003.1253658","http:\/\/eprints.lancs.ac.uk\/20160\/"],"year":2003,"topics":["TA Engineering (General). Civil engineering (General)"],"subject":["Contribution in Book\/Report\/Proceedings","NonPeerReviewed"],"fullText":"Techniques for Automatic On Chip Closed Loop Transfer Function Monitoring \nFor Embedded Charge Pump Phase Locked Loops  \nMartin John Burbidge\n1\n, Jim Tijou\n2\n, Andrew Richardson\n1\n \n1\n Lancaster University. UK. \n2 \nPhilips Semiconductors, Southampton UK \n \n \n \nAbstract \n Charge Pump Phase locked loops are used in a variety \nof applications, including on chip clock synthesis, \nsymbol timing recovery for serial data streams, and \ngeneration of frequency agile high frequency carrier \nsignals. In many applications PLL\u2019s are embedded into \nlarger digital systems, in consequence, analogue test \naccess is often limited. Test motivation is thus towards \nmethods that can either aid digital only test of the PLL, \nor alternatively facilitate complete self testing of the \nPLL. One useful characterisation technique used by \nPLL designers is that of closed loop phase transfer \nfunction measurement. This test allows, an estimation of \nthe PLL\u2019s natural frequency, damping, and 3dB \nbandwidth to be made from the magnitude and phase \nresponse plots. These parameters relate directly to the \ntime domain response of the PLL and will indicate \nerrors in the PLL circuitry. This paper provides \nsuggestions towards test methods that use a novel \nmaximum frequency detection technique to aid \nautomatic measurement of the closed loop phase \ntransfer function. In addition, techniques presented \nhave potential for full BIST applications. \n \nKeywords: PLL, CP-PLL, BIST, TEST, DfT. \n1. Introduction \nCP-PLL\u2019s (Charge Pump Phase locked loops) are \nused in a variety of applications including, on chip \nclock synthesis, bit and symbol timing recovery for \nserial data streams, and generation of frequency agile \nRF (Radio Frequency) carriers for use in FDMA \n(Frequency Division Multiple Access) based \ncommunications systems. \nIn many applications a CP-PLL is embedded into a \nlarge digital system on chip (SOC). It is also common \nfor the PLL to be the only mixed signal component \npresent on the SOC. In situations such as this, obviously \nthere is a desire to use digital only test methods. In \nmany classic tests analogue parameters are measured, \nthus requiring access to critical analogue nodes. This \ncan lead to problems for embedded PLLs, in terms of \nboth increased probability of noise injection into the \nloop, and limited availability of external analogue test \naccess [1]. For many applications these problems can be \neased by inclusion of on-chip test support hardware that \nallows conversion of the analogue PLL characteristics \ninto a digital only format. This process can also help to \nintegrate the PLL into a digital only design verification \nflow. Several recent papers [2][3][4] have investigated \nautomated PLL test techniques. \nThis paper presents hardware techniques that will \nallow on chip monitoring of a CP-PLL\u2019s transfer \nfunction, and also allow extraction of magnitude and \nphase information of the response, for subsequent post \nprocessing or comparison against on chip limits. In, \naddition the test approach includes a novel technique to \nallow automatic detection of the maximum PLL output \ndeviation. The paper is broken into the following \nsections: \nSection 2 provides basic information relating to the \nmeasurement of the magnitude and phase response plots \nof a PLL. Section 3 Investigates a simple method for \ngeneration of suitable input signal for a CP-PLL \ntransfer function test.  Section 4, Investigates suitable \nmethods for response capture and evaluation. Section 5, \nprovides experimental and simulated results. Finally \nsection 6, provides conclusions and indications of \nfurther work directions. Note, that throughout the paper \nit is assumed that the reader is familiar with aspects of \nCP-PLL operation.  Further details of PLL operation are \nprovided in [5] [6][7].  \n2. PLL phase transfer measurements. \nIn most applications a PLL system is designed to \nproduce a second order system response [6]. In \nconsequence, frequency response measurement plots of \nthe PLL output magnitude and phase against input \nsignal frequency are a commonly used analysis tool.   \n \nProceedings of the Design,Automation and Test in Europe Conference and Exhibition (DATE\u201903) \n1530-1591\/03 $17.00 \u00a9 2003 IEEE \nAuthorized licensed use limited to: Lancaster University Library. Downloaded on December 16, 2008 at 06:58 from IEEE Xplore.  Restrictions apply.\n  \n \n \n \n \n \n \n \u03b8\n \n \n \n \n \n \nFor reference, typical parameters of interest of a \nsecond order system frequency response are highlighted \non figure 1. These are now explained in context with a \nPLL system: \n0dB Asymptote:  For a unity gain system, as the \nfrequency of the excitation signal is reduced below \u03c9p, \nthe magnitude of the gain will tend to 1 (0dB) [8]. The \nslope of this decrease will be determined by the \ndamping of the system. In a similar manner the relative \nphase lag between the input and output of the system \nwill tend to 0\u00b0.  This fact can be used to aid test as it \nmeans that output magnitude measurements taken at a \nsufficiently low point below \u0226p can be approximated to \nunity gain. Additionally, the phase lag can be \napproximated to 0\u00b0. This means that all measurements \ntaken from the PLL output can be referenced to the first \nmeasurement.    \n\u03c9p: This is the frequency where the magnitude of the \nsystem response is at its maximum. It is directly \nanalogous to the natural frequency (\u03c9n) of the system. \nIn addition, the relative magnitude of the peak (above \nthe unity gain value can be used to determine the \ndamping factor (\u03b6) of the system. Relationships \nbetween \u03b6, the dB Magnitude and the normalised radian \nfrequency are available in many texts concerning \nControl or PLL theory [8] [9]. \n\u03c93dB: Following [6] this defines the one-sided loop \nbandwidth of the PLL. The PLL will generally be able \nto track frequency variations of the input signal that are \nwithin this bandwidth. This parameter can also be used \nto estimate the damping factor of the PLL [6]. \nIt must be noted that although second order systems \nare considered here and a 0dB asymptote assumption is \nmade, relative measurement of the transfer functions of \nhigher order PLL loops will also provide valuable \ninformation about system operation, and can be \nachieved with the proposed methods. \nExperimental extraction of the PLL transfer function \nusing conventional techniques: \nFor normally encountered second order systems i.e. \nones with a voltage, current or force inputs and \ncorresponding voltage, current or displacement outputs, \nthe frequency transfer plot is constructed by application \nof a sinusoidally varying input signal at different \nfrequencies. The output of the system is then compared \nto the input signal to produce magnitude and phase \nresponse information.   The differences encountered \nwith a PLL system are now explained with use of the \nfigure 2 and the associated equation (1): \n \nFrequency (rad\/sec)\n10 4 10 5\n-180 \n-160 \n-140 \n-120 \n-100 \n-80 \n-60 \n-40 \n-20 \nTo: \nY(1\n) \nClosed Loop Transfer Function \n-20 \n-15 \n-10 \n-5 \n0 \n5 \n10 \n15 \n20 \nFrom: U(1)\n0 \n0dB Asymptote \n\u03c9p \n\u03c93dB \nMagnitude \nPhase \nIncreasing input frequency \n20 \n  0 \n-20\n0\n-90\n-180\n|H(jw)| (dB) \n(jw) \n(degrees) \n \n  \n \n \n \n \n \nPhase  \nDetector\nKPD \n \nLoop \nFilter \nF(s) \n \nVCO \nKO\/s \n\u03b8o(s)\n\u03b8I(s)\n\u03b8e(s)\nKPD\nF(s) Ko\/s \nFin\nFout \n\u03b8FB(s)\nFigure 1 Phase and magnitude plots for a second order \nsystem. Figure 2 PLL block diagram  \nFor the PLL systems considered here the assumption is \nmade that the input and output signals are continuous \nsquare wave signals.  The PLL\u2019s function is to phase \nalign the input and output signals of the PLL system. \nTherefore with reference to figure 2 the Laplace domain \ntransfer function of the PLL is as follows. \n)(\n)(\n)(\n)(\n)(\nsFKKs\nsFKK\nsH\ns\ns\nOPD\nOPD\no\ni\n+\n==\n\u03b8\n\u03b8\n    (1) \nWhere: \u03b8i and \u03b8o represent the phase of the input and output signal \nrespectively.  KPD and KO are the transfer functions of the Phase \ndetector and the VCO (voltage controlled oscillator) respectively, and \nF(s) is the transfer function of the PLLs loop compensation filter. \nMeasurement of the PLL transfer function: \nIt can be seen from equation (1) and figure (2) that to \nexperimentally measure the PLL transfer function we \nneed to apply a sinusoidal variation of phase about the \nnominal phase of the input signal \u03b8i(t), i.e. we \nsinusoidally phase modulate the normal input signal.  \nThe frequency of the phase change is then increased \nand the output response is measured. Note that \nfollowing [5] it is possible to replace phase modulation \nby frequency modulation. The block diagram for an \nexperimental bench type test set-up is shown in figure \n3.   \n \nPhase modulated \ninput signal for one \nfrequency  \nPhase variation of \ninput signal \nPhase reference \nPhase variation of \noutput signal for one \nfrequency  \nThe output response can \nbe measured at the loop \nfilter node or the VCO \noutput. This will depend \non the equipment used \nPhase \nmodulation \nGenerator \n \nPFD \n \nLF \n \nVCO \n \nFigure 3 PLL transfer function measurement. \nFor the above test, the output response can be measured \nat the loop filter node or the VCO output. The output of \nthe loop filter node will be a sinusoidal varying voltage \nand the output of the VCO will be a frequency (or \nphase) modulated signal. It must be noted, however, \nthat for many systems direct access of the loop filter \nProceedings of the Design,Automation and Test in Europe Conference and Exhibition (DATE\u201903) \n1530-1591\/03 $17.00 \u00a9 2003 IEEE \nAuthorized licensed use limited to: Lancaster University Library. Downloaded on December 16, 2008 at 06:58 from IEEE Xplore.  Restrictions apply.\nnode is undesirable, in consequence the tests that are \nexplained in subsequent sections focus towards \nmethods that access the VCO (or divided VCO) output.  \n3. On chip input signal generation: \nWhen considering on chip signal generation the \nproblem becomes how to generate a sinusoidal phase or \nfrequency modulated input signal with the minimum of \nhardware overhead, and ideally using digital circuitry. \nThis seems difficult, but fortunately, due to the filtering \nfunction of the PLL (see figure 1), a smooth input \nmodulation is not required, and a discrete step form of \ninput modulation can be applied whilst still producing \nan excellent approximation to the ideal transfer \nfunction. This can be achieved due to the fact the PLL \nacts as a low pass filter on the input signal.  \nA convenient way to generate a discrete form of \nfrequency modulation is by use of a simple DCO \n(Digitally controlled oscillator). A DCO [5][6] can \nconsist of a digital ring counter that is used to \ndownscale a master clock signal to a set of lower \nfrequency signals. This method can be used to produce \nset of discrete signals centred on a nominal frequency. \nDigital FM is then produced by continuously \nmultiplexing between a set of frequencies. This method \nis represented in block diagram form below. \n \nMaster Osc \nOn chip or \nexternal \nreference   \n \n \n \n \nN Bit Digital \nRing \nCounter \n \n \n \nOutput \nDecode \nM \nU \nX \nF1 \nF10 \n \n \nMux \nSwitching \nControl \nPLL \nInput \nMux\nNormal \nPLL \nInput \nFref \n \nFigure 4 Discrete FM method for input signal generation. \nThe main problem with this method is related to the \nfrequency resolution that can be obtained. The \nresolution will be determined by: The master oscillator \nfrequency, the division ratio of the counter, and the \nnominal frequency of the input signal i.e. \nnomref\nnomref\nnomres\nFinF\nFinF\nFinF\n+\n\u22c5\n\u2212=\u2206    (2) \nWhere:  \u2206Fres is the required resolution, Fin is the nominal frequency \nof the input signal to the PLL, and Fref is the frequency of the master \nreference oscillator. \nIt can be seen from the above equation that the only \nway to increase the resolution is decrease Finnom or \nincrease Fref  .To illustrate this problem examples are \nprovided in table 1. \n \n \n \n \nFinnom  \n(Hz) \nFref  \n(Hz) \nApproximate \n\u2206Fmax \nrequired \n(Hz) \n\u2206Fres \n(Hz) \n10K 10M 1K 9.99 \n100K 10M 1K 990 \nTable 1 Relationship between Finnom Fref and \u2206Fres \nIn table 1 \u2206Fmax represents the maximum frequency deviation \nrequired from the nominal frequency.  \nIt can be seen from the table, that for the second case it \nwould not be possible to produce any quantisation of \nthe frequency modulation without increasing Fref. \nDespite this problem, for many applications this method \ncould be employed. Other methods relying on tapped \ndelay line techniques can be used for phase modulation \n[4][10]. However, these methods have their own \nspecific problems related to tone resolution and \nresponse capture complexity. Use of delay line \ntechniques in conjunction with the capture circuitry \ndescribed in this paper is under further investigation.  \n4. Techniques for response capture. \nThis section briefly outlines methods that can be \nused for response capture and evaluation. The main \npoint to mention with respect to response capture is that \nas long as it can be assured that the peak amplitude of \nthe input phase or frequency deviation does not exceed \na value that would cause the PLL components to enter a \nnon-linear region of operation [5], accurate knowledge \nof the absolute magnitude of the input signal is not \nessential. This condition follows on from the \nobservations made in section 2.  \nBefore further discussion, it is essential that a brief \ndescription of the PFD (Phase Frequency Detector) is \ngiven.  A CP-PLLs PFD operates only on the rising \nedges of its input signals. With reference to figure 2, \nfigure 5 and the PFD section of figure 7 the basic \noperation is explained below. \n (1) \u03b8FB(t) leads \u03b8i(t) => LF voltage falls and VCO \nfrequency falls to try and reduce the difference between \n\u03b8i(t) and \u03b8FB (t). \n(2) \u03b8i(t) leads \u03b8FB(t) => LF voltage rises and VCO \nfrequency rises to try and reduce the difference between \n\u03b8i(t) and \u03b8FB (t) \n(3) \u03b8i(t) coincident with \u03b8FB(t) => The PLL is locked \nand in its stable state. Note: The coincident dead zone \npulses of figure 5 occur due to the propagation delays in \nthe D-type latches and AND gate. \nThe third point has an important test implication \nbecause it means that if the PLLs feedback path is \nbroken and an identical signal is applied to \u03b8i(t) and \n\u03b8FB(t) simultaneously that the PLL output frequency can \nbe held at a constant level. As explained later, this \nmechanism can be used to aid response capture.  \nProceedings of the Design,Automation and Test in Europe Conference and Exhibition (DATE\u201903) \n1530-1591\/03 $17.00 \u00a9 2003 IEEE \nAuthorized licensed use limited to: Lancaster University Library. Downloaded on December 16, 2008 at 06:58 from IEEE Xplore.  Restrictions apply.\n  \n\u03b8i(t) \nLeads \n\u03b8i(t) \n\u03b8FB(t) \n\u03b8i(t) \nLags \n\u03b8i(t)= \u03b8FB(t) \nIncrease \nDecrease \nVCO output \nFrequency \nDead zone \npulses \n \nFigure 5 Graphical illustration of CP operation. \n4.1. Generalised Test Hardware: \nA block diagram illustrating the basic test hardware \nis provided in figure 6. \n \nPLL \nForward  \nPath \nFeedback \nPath \n1\/N\nTest \nSequencer \nEXTREF \nTest clock \nFrequency\nCounter  \nGate \nControl \nPLLREF\nPLLFB \nA \nB \nC \nD \nTEST \nInput \nModulator \n0 \n1 \nM1 M2 Phase \nCounter \nDivider \n \n \nD Q\nR\nD Q\nR\n1\n1\nPFDUP\nPFDDN\nPLLFB \nPLLREF\nD Q \nR \n0\nExisting or \nAdditional \nPFD \nMFREQ \nPLLREF \nleading \nPLLREF \nlagging \nFigure 6 Basic test hardware \nIn figure 6 the frequency counter is used to monitor the \noutput response. Depending on the application, the tap \npoint for frequency measurement could be placed on \nthe PLL output or the feedback input. The Input \nmodulation block contains the frequency multiplexer \nand control circuitry to determine the input modulation \nfrequency (see figure 4). Use of the blocks is explained \nin table 2. The explanation is given for a single input \nfrequency and assumes that the PLL is initially locked.  \nFigure 7 Sampling of output frequency \nTest Stage M1 M2 Comments \n(1) Ref set 0 A=C B=D Apply digital \nmodulation with \nfrequency FN Start \nPhase counter (counter \nreferenced to EXTREF) \n(2) Set Phase \ncounter \n0 A=C B=D Start phase counter at \npeak of input \nmodulation \n(2) Monitor \nPeak \n0 A=C B=D Monitor for peak output \nsignal frequency  \n(3) Peak \noccurred Lock \nPLL stop \nPhase counter \nX A=C A=D Holds the output \nfrequency constant. \n(4) Measure \nfrequency  \nand phase \nX A=C A=D Count output frequency \nand store. \nStore the result of the \nphase counter. \n(5) Increase Modulation Frequency FN and repeat steps 1 to 4 until \nall frequencies of interest have been monitored. \nTable 2 Basic test sequence. \n4.2. Output monitoring and response \nevaluation: \nTo measure the transfer function of the PLL we need to \nbe able to at the least. \n\u2022 Detect the peak of the output signal and its relative \nmagnitude with respect to a measurement made well \nwithin the loop bandwidth.  \n\u2022 Detect the time difference between the occurrence of \nthe peak of the output signal and that of the input \nsignal. \nThe above processes will facilitate measurement of the \nPLLs magnitude and phase response, respectively.  \nAn interesting and novel method for detecting the \npeak output frequency of the PLL is to use a peak \nfrequency detecting circuit that generates an output \npulse at the peak frequency of the PLL output \nwaveform. Then, to facilitate measurement of the peak \noutput frequency, the output pulse can be used to \ntrigger hold circuitry (see table 2 and figure 6).  For a \nsinusoidal variation in input frequency, the existing \nPFD in the PLL can, after undergoing slight \nmodification, be used to perform a peak detecting \nfunction. This is illustrated in figure 7. \n \nNote that in figure 7, the circuitry is set up so that \nwhen PFDDN is predominantly on (PLLREF lagging), \nthe sampling D-latch always sees a 0 on its input. This \nis achieved by use of the inverter, which delays and \ninverts the PFDDN signal, so that the glitch pulse will \nnot cause incorrect sampling. It can be seen that the \ncircuitry is clocked from the dead zone glitches during \npart of its cycle, which is not a generally recommended \ndesign practice, however, in the particular application \n(see section 5) the circuitry operates correctly. If \nclocking is a problem, the dead zone glitches can be \nwidened to usable signals by placing additional delay \nelements between the PFDUP and PFDDN outputs and \nthe AND gate inputs. Additionally, it must be noted that \nthe detection circuitry should be designed so that it does \nnot impair PLL operation. In consequence, the preferred \nmethod is to construct an additional PFD specifically \nfor the purpose of monitoring the feedback and \nreference signals (see figure 7 and section 5).  \nProceedings of the Design,Automation and Test in Europe Conference and Exhibition (DATE\u201903) \n1530-1591\/03 $17.00 \u00a9 2003 IEEE \nAuthorized licensed use limited to: Lancaster University Library. Downloaded on December 16, 2008 at 06:58 from IEEE Xplore.  Restrictions apply.\nThe output waveforms for the circuit taken from \nsimulations are shown in figure 8. \n \n +7.000\n+8.000\n +6.000\n \n+5.000\n \n+3.000\n+4.000\n +2.000\n +1.000\n \n0.0\n -2.000\n-1.000\n -3.000\n \n-4.000\n \n \nNote that in the waveforms depicted in figure 8, the \noutput variation was monitored at the loop filter node.  \n5. Experimental results. \nExperimental verification of the test was carried using \nan ATMEL AT40K20 FPGA in conjunction with a \n74HCT4046AN CP-PLL [11]. The feedback dividers, \nreference dividers and test circuitry were implemented \non the FPGA. The on chip test stimulus was created \nusing the DCO technique and the peak frequency was \ndetected using the modified PFD approach explained in \nsection 4. The PFD circuitry used for response capture \nwas constructed on the FPGA.  To minimise effects of \ndelays in the critical signal paths, where possible, \nadjacent macro cells and I\/O pins were used in the \nFPGA design [12].  The loop filter (F(s)) configuration \nused for the PLL is illustrated in figure 9. \n \n \n \n \n \n \n \n \n \n \n \n \nThe transfer function for the filter circuitry is \n)(1\n1\n)(\n21\n2\n\u03c4\u03c4\n\u03c4\n++\n+\n=\ns\ns\nsF      (3) \nWhere: \u03c41  = R1C1 and \u03c42  = R2C2 \nSubstituting (3) and the N divider ratio (see table 3) into \n(1) and rearranging yields. \n \nPDOPDO\nOPD\ni\no\nKKKsKNs\nsKNK\nsH\ns\ns\n++\n+\n==\n21\n2\n2 )1()(\n)(\n)(\n\u03c4\u03c4\n\u03c4\n\u03b8\n\u03b8  (4) \nThe calculated PLL parameters and other pertinent test \ninformation are provided in table 3. \n \nParameter  Value \nPLL reference nominal frequency 100KHz \nMaximum frequency deviation of \nreference signal. \n1KHz \nNumber of discrete FM steps used 10 \nFM reference frequency 100MHz \nKo -> VCO gain. 2  Mrad\/s\/v \n318.3 KHz\/v \nKpd -> Phase Detector gain. 0.4V\/rad \nN 25 \nR1 (see figure9) 2.2K\u2126 \nR2       \u201c\u201d 330\u2126 \nC1       \u201c\u201d 470nF \nNatural Frequency \u03c9n 5187.6 r\/s \n825.63 Hz \nDamping \u03b6 0.4023 TIME +1.001m vcapnorm -237.061m vupp +5.000 vdown +3.500 Peakdetect -1.000\nBSPLLRefDetect2.ckt-Transient-0 Time (s)\nTable 3 Parameters for the test set-up  \nWhere \u03c9n and \u03b6 were calculated using the following \nrelationships. \n)( 21 \u03c4\u03c4\n\u03c9\n+\n=\nN\nKK PDO\nn                        (r\/s) (5) \n2\n2\u03c4\u03c9\u03b6 n=        (6) \nThe theoretical plots for the PLL system based on \nequation 4 are shown in figure 10. \n \nFigure 10 Theoretical magnitude and phase plots. \nExperimental measurement of the real PLL system was \ncarried out in the following manner: \nThe magnitude response was calculated using the \nrelationship. \nmax\nmax\nlog20\nFref\nF\nAF \u2206\n\u2206\n=             (7) \n Where: Af is the gain measurement taken at a particular excitation \nfrequency, \u2206Fmax is the maximum deviation of the output signal, and \n\u2206Frefmax is the maximum frequency deviation of the output signal \nwithin the loop bandwidth (excluding the region around the Natural \nfrequency). \nThe frequency response was calculated by counting \npulses from the occurrence of the peak magnitude of the \ninput signal to the peak magnitude of the output signal, \nand then using the following relationship to give the \nphase delay in degrees. \n \nD(TIME) 0.0 D(vcapnorm) 0.0\n+1.000m +1.100m +1.200m +1.300m +1.400m +1.500m +1.600m +1.700m +1.800m +1.900m +2.000m +2.100m\nPFD UP\nPFD DN\nOutput frequency variation \nMax Freq Min Freq \nUp Pulses Up Glitches \nDown Pulses Down Glitches \nMFREQ \nFigure 8 Sampling of output frequency \nVCO INPUTPFD \nUP \nFigure 9 Loop filter configuration. \nDN \nR1 R2 \nC1 \nProceedings of the Design,Automation and Test in Europe Conference and Exhibition (DATE\u201903) \n1530-1591\/03 $17.00 \u00a9 2003 IEEE \nAuthorized licensed use limited to: Lancaster University Library. Downloaded on December 16, 2008 at 06:58 from IEEE Xplore.  Restrictions apply.\n       (degrees)             (8) PhaseDelay\n \nWhere: Tmod is the period of the modulation frequency, \u2206T is the \nperiod of the test clock, and N is the number of pulses that occur \nbetween the maximum input and output deviations. \nFigures 11 and 12 show the magnitude and phase \nresponse plots taken from measured results. \n \n \n \n \n \n \n | d\nB\n (jw\n)\n \n|H\n \n \n \n \n \n \n \n \n \n \n \n )\n gr\nee\ns\n e (\nde\n Ph\nas\n \n \n \n \n \nFor the plots shown in figures 11 and 12, measurements \nwere taken using pure sinusoidal frequency modulation \nand Multi tone FSK with ten steps about the nominal \nfrequency. In addition, a comparison is shown for a two \ntone FSK input signal. It can be seen from the response \nplots that the ideal sinusoidal FM plot closely \ncorresponds to the ten-step FSK plot. In addition, it can \nbe seen that the measured results match quite closely to \nthe theoretical results shown in figure 10. The \ndiscrepancy between theory and measured results can \nbe accounted primarily to the   non-linear operation of \nthe particular charge pump and loop filter \nconfiguration. \n6. Conclusion  \nThis paper has presented techniques that are \napplicable to automatic on-chip monitoring of the \nclosed loop transfer function of a CP-PLL. In addition, \na novel technique has been presented that allows the \npeak output frequency deviation of the PLL to be \ncaptured automatically. This technique has the potential \nto overcome problems encountered with estimation of \nthe peak output response.  Furthermore, the   tests \nrequire no access to critical PLL nodes. Output results \nfrom the test were shown and they compare closely to \nan ideal analytical response curve. The main draw back \nof the approach shown relates to the high reference \nfrequency required for the DCO input. Other techniques \nare available for generation of this signal and currently \nresearch is being carried out into development of hybrid \nDCO, Delay line and delay locked loop generation \ntechniques.  \n360\nmod\n\u22c5\n\u2206\n=\nTN\nT\nH(jw) dB Measured results\n-30\n-25\n-20\n-15\n-10\n-5\n0\n5\n10\n1 10 100 1000 10000\nFre que ncy (Hz)\nPure Sine\nTwo Tone\nFSK\nMulti Tone\nFSK\nH(jw) dB Measured results \nFn = 800KHz \nMag = 2dB \nMeasured Phase Response\n-200\n-180\n-160\n-140\n-120\n-100\n-80\n-60\n-40\n-20\n0\n20\n1 10 100 1000 10000\nFrequency (Hz)\nPure Sine\nFM\nTwo Tone\nFSK\nMulti Tone\nFSK\nPhase Response Measured Results \nFn = 800KHz \nPhase = -46\u00b0 \nAcknowledgement \nThis work has been supported by EPSRC through the \u201cATOM\u201d \nproject (Analogue and Mixed Signal Integrated Circuit Test Support \nfor High Quality, Low Cost Manufacture) - EPSRC GR\/M7553 and \nthrough EC Framework 4 program \u201cASTERIS\u201d ref: ESPRIT 26354 \nReferences \n[1] M. Burbidge, A Richardson, A Lechner, \u201cTest Techniques for \nEmbedded Charge Pump PLL\u2019s; Problems, Current BIST Techniques, \nand Alternative Suggestions.\u201d 7th IEEE International Mixed Signal \nest Workshop, June 13th-15th, 2001 Figure 11  Measured magnitude response results. T\n \n[2] S. Sunter & A. Roy: 'BIST for Phase-Locked Loops in Digital \nApplications', IEEE International Test Conference, 28-30th Sept. \n999, Atlantic City, NJ, USA, pp 532-540 1\n \n[3] S. Kim & M. Soma, 'An Effective Defect-Oriented BIST \nArchitecture for High-Speed Phase-Locked Loops' ,IEEE VLSI Test \nSymposium, 30th. April - 4th May 2000, Montreal, Canada, pp 231-\n36 2\n \n[4] B. R. Veillette, G. W. Roberts, \u201cOn-Chip measurement of the \njitter transfer function of charge pump phase locked loops\u201d Proc. Int. \nest Conf, 1997, pp 776-85 T\n \n[5] R Best, \u201cPhase Locked Loops, Design Simulation and \npplications\u201d, 4th Edition, Mc-Graw-Hill, ISBN 0071349030 A\n \n[6] F M Gardner, \u201cPhase lock Techniques\u201d; Second edition; Wiley \nnterscience; 1979. I\n \n[7] B Razavi (Editor), \u201cMonolithic Phase-Locked Loops and Clock \nRecovery Circuits; Theory and Design\u201d, IEEE Press 1996, ISBN \n780311493. Figure 12 Measured phase response results. 0\n \n[8] J Schwarzenbach, K.F. Gill, \u201cSystem Modeling and Control\u201d, \nhird edition, Edward Arnold, 1992, ISBN  034054379 T\n \n[9] Paul H Young; \u201cElectronic Communications Techniques\u201d; Third \ndition; 1994; pp 411-423. e\n \n[10] G A S Machado (Editor), \u201cLow Power HF Microelectronics a \nUnified Approach\u201d, IEE Circuits and Systems Press, 1996, ISBN \n0852968744 \n \n[11]  74HC\/HCT4046A Phase-locked loop with VCO, Philips \nemiconductors Data Sheet, November 1997. S\n \n[12] M J Burbidge, A. Richardson, F. Poullet, J. Tijou \u201cInvestigations \nFor Minimum Invasion Digital Only Built In \u201cRamp\u201d Based Test \nTechniques For Charge Pump PLL\u2019s\u201d, Proc 7th IEEE European Test \nWorkshop, May 26th-29th 2002. \nProceedings of the Design,Automation and Test in Europe Conference and Exhibition (DATE\u201903) \n1530-1591\/03 $17.00 \u00a9 2003 IEEE \nAuthorized licensed use limited to: Lancaster University Library. Downloaded on December 16, 2008 at 06:58 from IEEE Xplore.  Restrictions apply.\n"}