{"doi":"10.1137\/S0895480102410201","coreId":"65184","oai":"oai:dro.dur.ac.uk.OAI2:6673","identifiers":["oai:dro.dur.ac.uk.OAI2:6673","10.1137\/S0895480102410201"],"title":"Constraint satisfaction problems on intervals and lengths.","authors":["Krokhin,  A.","Jeavons,  P.","Jonsson,  P."],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2004-01-01","abstract":"We study interval-valued constraint satisfaction problems (CSPs), in which the aim is to find an assignment of intervals to a given set of variables subject to constraints on the relative positions of intervals. Many well-known problems such as INTERVAL GRAPH RECOGNITION and INTERVAL SATISFIABILITY can be considered as examples of such CSPs. One interesting question concerning such problems is to determine exactly how the complexity of an interval-valued CSP depends on the set of constraints allowed in instances. For the framework known as Allen's interval algebra this question was completely answered earlier by the authors, by giving a complete description of the tractable cases and showing that all remaining cases are NP-complete.\\ud\n\\ud\nHere we extend the qualitative framework of Allen's algebra with additional constraints on the lengths of intervals. We allow these length constraints to be expressed as Horn disjunctive linear relations, a well-known tractable and sufficiently expressive form of constraints. The class of problems we consider contains, in particular, problems that are very closely related to the previously studied UNIT INTERVAL GRAPH SANDWICH problem. We completely characterize sets of qualitative relations for which the CSP augmented with arbitrary length constraints of the above form is tractable. We also show that, again, all the remaining cases are NP-complete. \\u","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/65184.pdf","fullTextIdentifier":"http:\/\/dro.dur.ac.uk\/6673\/1\/6673.pdf","pdfHashValue":"6668abe26e403df24cfcfd9cb8b5a94b5d277faf","publisher":"Society for Industrial and Applied Mathematics","rawRecordXml":"<record><header><identifier>\n  \n    \n      oai:dro.dur.ac.uk.OAI2:6673<\/identifier><datestamp>\n      2011-12-14T09:52:56Z<\/datestamp><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        Constraint satisfaction problems on intervals and lengths.<\/dc:title><dc:creator>\n        Krokhin,  A.<\/dc:creator><dc:creator>\n        Jeavons,  P.<\/dc:creator><dc:creator>\n        Jonsson,  P.<\/dc:creator><dc:description>\n        We study interval-valued constraint satisfaction problems (CSPs), in which the aim is to find an assignment of intervals to a given set of variables subject to constraints on the relative positions of intervals. Many well-known problems such as INTERVAL GRAPH RECOGNITION and INTERVAL SATISFIABILITY can be considered as examples of such CSPs. One interesting question concerning such problems is to determine exactly how the complexity of an interval-valued CSP depends on the set of constraints allowed in instances. For the framework known as Allen's interval algebra this question was completely answered earlier by the authors, by giving a complete description of the tractable cases and showing that all remaining cases are NP-complete.\\ud\n\\ud\nHere we extend the qualitative framework of Allen's algebra with additional constraints on the lengths of intervals. We allow these length constraints to be expressed as Horn disjunctive linear relations, a well-known tractable and sufficiently expressive form of constraints. The class of problems we consider contains, in particular, problems that are very closely related to the previously studied UNIT INTERVAL GRAPH SANDWICH problem. We completely characterize sets of qualitative relations for which the CSP augmented with arbitrary length constraints of the above form is tractable. We also show that, again, all the remaining cases are NP-complete. \\ud\n<\/dc:description><dc:subject>\n        Allen's interval algebra<\/dc:subject><dc:subject>\n         Interval satisfiability<\/dc:subject><dc:subject>\n         Computational complexity<\/dc:subject><dc:subject>\n         Tractable cases<\/dc:subject><dc:subject>\n         Dichotomy theorem<\/dc:subject><dc:subject>\n         <\/dc:subject><dc:publisher>\n        Society for Industrial and Applied Mathematics<\/dc:publisher><dc:source>\n        SIAM journal on discrete mathematics, 2004, Vol.17(3), pp.453-477 [Peer Reviewed Journal]<\/dc:source><dc:date>\n        2004-01-01<\/dc:date><dc:type>\n        Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:identifier>\n        dro:6673<\/dc:identifier><dc:identifier>\n        issn:0895-4801<\/dc:identifier><dc:identifier>\n        issn: 1095-7146<\/dc:identifier><dc:identifier>\n        doi:10.1137\/S0895480102410201<\/dc:identifier><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/6673\/<\/dc:identifier><dc:identifier>\n        http:\/\/dx.doi.org\/10.1137\/S0895480102410201<\/dc:identifier><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/6673\/1\/6673.pdf<\/dc:identifier><dc:rights>\n        \u00a9 2004 Society for Industrial and Applied Mathematics<\/dc:rights><dc:accessRights>\n        info:en-repo\/semantics\/openAccess<\/dc:accessRights><\/oai_dc:dc><\/metadata><\/record>","journals":[{"title":null,"identifiers":["0895-4801"," 1095-7146","issn: 1095-7146","issn:0895-4801"]}],"language":{"code":"en","id":9,"name":"English"},"relations":[],"year":2004,"topics":["Allen's interval algebra","Interval satisfiability","Computational complexity","Tractable cases","Dichotomy theorem"],"subject":["Article","PeerReviewed"],"fullText":"Durham Research Online\nDeposited in DRO:\n06 April 2010\nVersion of attached file:\nPublished Version\nPeer-review status of attached file:\nPeer-reviewed\nCitation for published item:\nKrokhin, A. and Jeavons, P. and Jonsson, P. (2004) \u2019Constraint satisfaction problems on intervals and\nlengths.\u2019, SIAM journal on discrete mathematics., 17 (3). pp. 453-477.\nFurther information on publisher\u2019s website:\nhttp:\/\/dx.doi.org\/10.1137\/S0895480102410201\nPublisher\u2019s copyright statement:\n2004 Society for Industrial and Applied Mathematics\nAdditional information:\nUse policy\nThe full-text may be used and\/or reproduced, and given to third parties in any format or medium, without prior permission or charge, for\npersonal research or study, educational, or not-for-profit purposes provided that:\n\u2022 a full bibliographic reference is made to the original source\n\u2022 a link is made to the metadata record in DRO\n\u2022 the full-text is not changed in any way\nThe full-text must not be sold in any format or medium without the formal permission of the copyright holders.\nPlease consult the full DRO policy for further details.\nDurham University Library, Stockton Road, Durham DH1 3LY, United Kingdom\nTel : +44 (0)191 334 3042 \u2014 Fax : +44 (0)191 334 2971\nhttp:\/\/dro.dur.ac.uk\n  \n \nDurham Research Online \n \nDeposited in DRO: \n06 April 2010 \n \nPeer-review status: \nPeer-reviewed \n \nPublication status: \nPublished version \n \nCitation for published item: \nKrokhin, A. and Jeavons, P. and Jonsson, P. (2004) 'Constraint satisfaction problems on \nintervals and lengths.', SIAM journal on discrete mathematics., 17 (3). pp. 453-477. \n \nFurther information on publisher\u2019s website: \nhttp:\/\/dx.doi.org\/10.1137\/S0895480102410201 \n \nPublisher\u2019s copyright statement: \n\u00a9 2004 Society for Industrial and Applied Mathematics \n \n \n \n \n \n \n \n \n \n \n \n \nUse policy \n \nThe full-text may be used and\/or reproduced, and given to third parties in any format or medium, without prior \npermission or charge, for personal research or study, educational, or not-for-profit purposes provided that : \n \n\uf0a7 a full bibliographic reference is made to the original source \n\uf0a7 a link is made to the metadata record in DRO \n\uf0a7 the full-text is not changed in any way \n \nThe full-text must not be sold in any format or medium without the formal permission of the copyright holders. \n \nPlease consult the full DRO policy for further details. \n \nDurham University Library, Stockton Road, Durham DH1 3LY, United Kingdom \nTel : +44 (0)191 334 2975 | Fax : +44 (0)191 334 2971 \nhttp:\/\/dro.dur.ac.uk \nCONSTRAINT SATISFACTION PROBLEMS\nON INTERVALS AND LENGTHS\u2217\nANDREI KROKHIN\u2020 , PETER JEAVONS\u2021 , AND PETER JONSSON\u00a7\nSIAM J. DISCRETE MATH. c\u00a9 2004 Society for Industrial and Applied Mathematics\nVol. 17, No. 3, pp. 453\u2013477\nAbstract. We study interval-valued constraint satisfaction problems (CSPs), in which the\naim is to find an assignment of intervals to a given set of variables subject to constraints on the\nrelative positions of intervals. Many well-known problems such as Interval Graph Recognition\nand Interval Satisfiability can be considered as examples of such CSPs. One interesting question\nconcerning such problems is to determine exactly how the complexity of an interval-valued CSP\ndepends on the set of constraints allowed in instances. For the framework known as Allen\u2019s interval\nalgebra this question was completely answered earlier by the authors, by giving a complete description\nof the tractable cases and showing that all remaining cases are NP-complete.\nHere we extend the qualitative framework of Allen\u2019s algebra with additional constraints on the\nlengths of intervals. We allow these length constraints to be expressed as Horn disjunctive linear\nrelations, a well-known tractable and sufficiently expressive form of constraints. The class of problems\nwe consider contains, in particular, problems that are very closely related to the previously studied\nUnit Interval Graph Sandwich problem. We completely characterize sets of qualitative relations\nfor which the CSP augmented with arbitrary length constraints of the above form is tractable. We\nalso show that, again, all the remaining cases are NP-complete.\nKey words. Allen\u2019s interval algebra, interval satisfiability, computational complexity, tractable\ncases, dichotomy theorem\nAMS subject classifications. 68Q25, 68T20\nDOI. 10.1137\/S0895480102410201\n1. Introduction and summary of results. A wide range of combinatorial\nsearch problems encountered in computer science and artificial intelligence can be\nnaturally expressed as \u201cconstraint satisfaction problems\u201d [29], in which the aim is to\nfind an assignment of values to a given set of variables subject to specified constraints.\nFor example, the standard propositional Satisfiability problem [11] may be viewed\nas a constraint satisfaction problem (CSP) where the variables must be assigned\nBoolean values, and the constraints are specified by clauses. Further examples include\nGraph Colorability, Clique, and Bandwidth problems, scheduling problems,\nand many others (see [2, 19]).\nConstraints are usually specified by means of relations. Hence the general CSP\ncan be parameterized according to the relations allowed in an instance. For any set of\nrelations F , the class of CSP instances where the constraint relations are all members\nof F is denoted CSP (F). The most well-known examples of such parameterized\n\u2217Received by the editors June 28, 2002; accepted for publication (in revised form) July 30, 2003;\npublished electronically January 22, 2004. An earlier version of some parts of this paper was published\nin Proceedings of the 19th International Symposium on Theoretical Aspects of Computer Science,\nAntibes Juan-les-Pins, France, 2002.\nhttp:\/\/www.siam.org\/journals\/sidma\/17-3\/41020.html\n\u2020Department of Computer Science, University of Warwick, Coventry CV4 7AL, UK (Andrei.\nKrokhin@dcs.warwick.ac.uk). The work of this author was partially supported by the UK EPSRC\nunder grant GR\/R29598.\n\u2021Computing Laboratory, University of Oxford, Oxford OX1 3QD, UK (Peter.Jeavons@comlab.\nox.ac.uk). The work of this author was partially supported by the UK EPSRC under grant\nGR\/R29598.\n\u00a7Department of Computer and Information Science, Linko\u00a8ping University, S-581 83 Linko\u00a8ping,\nSweden (Peter.Jonsson@ida.liu.se). The work of this author was partially supported by the Swedish\nResearch Council for Engineering Sciences (TFR) under grant 2000-361.\n453\n454 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nproblems are Generalized Satisfiability [34], where the parameter is the set of\nallowed logical relations, and Graph H-coloring [17], where the parameter is the\nsingle graph H.\nIn studying CSPs over infinite sets of values, arguably the most important type of\nproblem is when the constraints are specified by binary relations and the set of possible\nvalues for the variables is the set of intervals on the real line. Such problems arise,\nfor example, in many forms of temporal reasoning [1, 16, 25, 30], where an event is\nidentified with the interval during which it occurs. They also arise in computational\nbiology, where various problems connected with physical mapping of DNA lead to\ninterval-valued constraints [4, 12, 13, 21]. Interval-valued CSPs can be naturally\naugmented with constraints on the lengths of the intervals, and the complexity of\nsuch extended problems will be our main interest in this paper.\nBefore we describe our new results, we first discuss four closely related families\nof problems involving intervals which have previously been studied.\nThe prototypical problem from the first family is the Interval Graph Recog-\nnition problem [18]. An interval graph is an undirected graph such that there is\nan assignment of intervals to the nodes with two nodes adjacent if and only if the\ntwo corresponding intervals intersect. Given an arbitrary graph G, the question of\ndeciding whether G is an interval graph is rarely viewed as a CSP, but in fact it is\neasily formulated as such a problem in the following way: every pair of adjacent nodes\nis constrained by the relation r =\u201cintersect\u201d over pairs of intervals, and every pair\nof nonadjacent nodes is constrained by the complementary relation r\u00af =\u201cdisjoint.\u201d\nThis fundamental Interval Graph Recognition problem is tractable, and it also\nremains tractable if we impose additional constraints on the lengths of the intervals\nwhich require all intervals to be of the same length (the Unit Interval Graph\nRecognition problem [5]). In contrast, it was shown in [32] that if we allow bound-\naries to be specified for the lengths of intervals, or even exact lengths (which are\nnot necessarily all equal), then the corresponding problems (called Bounded In-\nterval Graph Recognition and Measured Interval Graph Recognition,\nrespectively) are NP-complete.\nA number of other problems are closely related to the Interval Graph Recog-\nnition problem, including the Circle Graph Recognition problem and the Con-\ntainment Graph Recognition problem [10, 15]. These problems can also be for-\nmulated as CSPs in a similar way by simply using a different constraint relation.\nA typical problem from the second family is the Interval Graph Sandwich\nproblem [13, 16]. Given two graphsG1 = (V,E1) andG2 = (V,E2) such that E1 \u2286 E2,\nthe question is whether there is an interval graph G = (V,E) with E1 \u2286 E \u2286 E2.\nClearly, this is a generalization of the corresponding recognition problem (the case\nwhen E1 = E2). The Interval Graph Sandwich problem can be represented as\na CSP as follows: to any e \u2208 E1 assign the constraint r =\u201cintersect,\u201d to any e \u0004\u2208 E2\nassign the constraint r\u00af =\u201cdisjoint,\u201d and leave all pairs of variables corresponding to\nedges from E2 \\E1 unrelated. This problem was shown to be NP-complete along with\nthe Unit Interval Graph Sandwich problem, where all intervals are required to\nbe of the same length [13].\nGraph Sandwich problems for a variety of other graph properties have also\nbeen considered [14]. For example, the Circle Graph Sandwich problem is ob-\ntained from the Interval Graph Sandwich problem by changing \u201cinterval graph\nG\u201d to \u201ccircle graph G.\u201d This problem was shown to be NP-complete in [14]; it\ncan be formulated as a CSP in the same way as above using the constraint relation\nCONSTRAINTS ON INTERVALS AND LENGTHS 455\nr =\u201coverlap.\u201d\nThe third family of problems we mention is the so-called Interval Satisfiabil-\nity problems [16, 33, 35]. In these problems every pair of interval variables is again\nconstrained in some way, but the constraints this time are chosen from a given set F\nof relations. In [16, 33, 35] only a small number of possibilities for F are considered.\nIt is shown there that for some choices of F the resulting problem is tractable, while\nfor others it is NP-complete. The complexity of Interval Satisfiability with all\nintervals of the same length is also studied in [33].\nThe fourth type of problem we mention is the satisfiability problem for Allen\u2019s\ninterval algebra [1], denoted A-sat. Allen\u2019s algebra contains 13 basic relations (corre-\nsponding to the 13 ways two given intervals can be related from a \u201cqualitative\u201d point\nof view). The set A contains not just these basic relations but all 213 = 8192 possible\nunions of them. The problems A-sat(F) are similar to problems of the third type\nabove, except that not every pair of pair of variables has to be constrained. They can\nalso be represented as Interval Satisfiability with F being an arbitrary subset of\nA containing the total relation. The complexity of problems of the form A-sat(F) has\nbeen intensively studied in the artificial intelligence community (see, e.g., [7, 8, 30]),\nand a complete classification of the complexity of such problems was obtained in [25].\nIn that paper it is shown that there are exactly 18 maximal tractable fragments of A,\nand for any subset F not entirely contained in one of those the problem A-sat(F) is\nNP-complete.\nMany variants of A-sat(F) where additional constraints are allowed have been\nconsidered in the literature; cf. [3, 22, 28]. For instance, certain scheduling problems\ncan conveniently be expressed as A-sat(F) with additional constraints on the lengths\nof the intervals. Moreover, in [2] it was suggested that many important forms of\nconstraints on lengths can be expressed in the form of Horn disjunctive linear relations.\nThis class of relations is known to be tractable [20] and at the same time allows us\nto express all elementary constraints, such as fixing the length, bounding the length\nof an interval by a given number, or comparing the lengths of two intervals. It\nwas proved in [2] that only three out of the 18 maximal tractable fragments for A-\nsat(F) preserve tractability when extended with Horn disjunctive linear constraints\non lengths; the other 15 become NP-complete. In this paper we study how we need\nto further restrict those 15 fragments to obtain tractable cases. The main result is\na complete classification of complexity for A-sat(F) with additional constraints on\nlengths. We show that such problems are either tractable or strongly NP-complete.\nMoreover, we give a complete description of the tractable cases, which allows one to\neasily determine whether a given set F falls into one of the tractable cases.\nAs well as giving a complete classification, our result also establishes a new di-\nchotomy theorem for complexity. Dichotomy theorems are results concerning a class\nof related problems (with some parameter) which assert that, for some values of the\nparameter, the problems in the class are tractable while for all other values they are\nNP-complete. Such theorems are of interest because it is well known [26] that if\nP\u0004=NP, then, within NP, there are infinitely many pairwise inequivalent problems of\nintermediate complexity. Dichotomy results rule out such a possibility within certain\nclasses of problems.\nDichotomy theorems have previously been established for theGeneralized Sat-\nisfiability [34] and Graph H-coloring [17] problems mentioned above as well as\nthe Directed Subgraph Homeomorphism problem [9].\nCSPs have been a fruitful source of dichotomy results (see, e.g., [6, 23]). For\n456 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nTable 1\nThe 13 basic relations of Allen\u2019s interval algebra. (The endpoint relations x\u2212 < x+ and\ny\u2212 < y+ that are valid for all relations have been omitted.)\nBasic relation Example Endpoints\nx precedes y p xxx x+ < y\u2212\ny preceded by x p\u22121 yyy\nx meets y m xxxx x+ = y\u2212\ny met by x m\u22121 yyyy\nx overlaps y o xxxx x\u2212 < y\u2212 < x+,\ny overlapped by x o\u22121 yyyy x+ < y+\nx during y d xxx x\u2212 > y\u2212,\ny includes x d\u22121 yyyyyyy x+ < y+\nx starts y s xxx x\u2212 = y\u2212,\ny started by x s\u22121 yyyyyyy x+ < y+\nx finishes y f xxx x+ = y+,\ny finished by x f\u22121 yyyyyyy x\u2212 > y\u2212\nx equals y \u2261 xxxx x\u2212 = y\u2212,\nyyyy x+ = y+\nCSPs, the relevant parameter is usually the set of relations, F , specifying the allowed\nconstraints. This parameter usually runs over an infinite set of values. In the case of\nAllen\u2019s algebra, even though the number of different values for F is finite, it is astro-\nnomical (28192 \u2248 102466), which excludes the possibility of computer-aided exhaustive\ncase analysis.\nThe usual tool for proving dichotomy theorems is reducibility via expressibility.\nThis is done by showing that one set of relations expresses another so that one problem\ncan be reduced to the other. This is the method used in [6, 25, 34], and a similar\nmethod is used here. After identifying certain tractable fragments, we find some NP-\ncomplete fragments and then show how any subset not entirely contained in one of\nthe tractable sets can express some already known NP-complete fragment.\n2. Preliminaries and background. Allen\u2019s interval algebra [1], denoted A, is\na formalism for expressing qualitative binary relations between intervals on the real\nline. By \u201cqualitative\u201d we mean \u201cinvariant under all continuous injective monotone\ntransformations of the real line.\u201d An interval x is represented as a pair [x\u2212, x+] of\nreal numbers with x\u2212 < x+, denoting the left and right endpoints of the interval,\nrespectively. The qualitative relations between intervals are the 213 = 8192 possible\nunions of the 13 basic interval relations, which are shown in Table 1. It is easy to\nsee that the basic relations are jointly exhaustive and pairwise disjoint in the sense\nthat any two given intervals are related by exactly one basic relation. For the sake\nof brevity, relations between intervals will be written as collections of basic relations,\nomitting the sign of union. So, for instance, we write (pmf\u22121) instead of p \u222am \u222a f\u22121.\nThe problem of satisfiability (A-sat) in Allen\u2019s algebra is defined as follows.\nDefinition 2.1. Let F \u2286 A be a set of interval relations. An instance I of\nA-sat(F) over a set, V , of variables is a set of constraints of the form xry, where\nx, y \u2208 V and r \u2208 F . The question is whether I is satisfiable, i.e., whether there exists\na function, f , from V to the set of all intervals such that f(x) r f(y) holds for every\nconstraint xry in I. Any such function f is called a model of I.\nExample 2.1. The instance {x(m)y, y(m)z, x(m)z} is not satisfiable because the\nfirst two constraints imply that interval x must precede interval z, which contradicts\nthe third constraint.\nExample 2.2. The instance I = {x(mo)y, y(df\u22121)z, z(\u2261 pmod\u22121ss\u22121f\u22121)x} is\nCONSTRAINTS ON INTERVALS AND LENGTHS 457\nTable 2\nComposition table for the basic relations in Allen\u2019s algebra.\n\u25e6 \u2261 p p\u22121 m m\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\n\u2261 \u2261 p p\u22121 m m\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\np p p \u0003 p \u03c1 p \u03c1 \u03c1 p p p \u03c1 p\np\u22121 p\u22121 \u0003 p\u22121 \u03bb\u22121 p\u22121 \u03bb\u22121 p\u22121 \u03bb\u22121 p\u22121 \u03bb\u22121 p\u22121 p\u22121 p\u22121\nm m p \u03c1\u22121 p \u03b8 p \u03b2 \u03b2 p m m \u03b2 p\nm\u22121 m\u22121 \u03bb p\u22121 \u03c3 p\u22121 \u03b3\u22121 p\u22121 \u03b3\u22121 p\u22121 \u03b3\u22121 p\u22121 m\u22121 m\u22121\no o p \u03c1\u22121 p \u03b2\u22121 \u03b1 \u03bd \u03b2 \u03bb o \u03b3 \u03b2 \u03b1\no\u22121 o\u22121 \u03bb p\u22121 \u03b3 p\u22121 \u03bd \u03b1\u22121 \u03b3\u22121 \u03c1\u22121 \u03b3\u22121 \u03b1\u22121 o\u22121 \u03b2\u22121\nd d p p\u22121 p p\u22121 \u03c1 \u03bb\u22121 d \u0003 d \u03bb\u22121 d \u03c1\nd\u22121 d\u22121 \u03bb \u03c1\u22121 \u03b3 \u03b2\u22121 \u03b3 \u03b2\u22121 \u03bd d\u22121 \u03b3 d\u22121 \u03b2\u22121 d\u22121\ns s p p\u22121 p m\u22121 \u03b1 \u03b3\u22121 d \u03bb s \u03c3 d \u03b1\ns\u22121 s\u22121 \u03bb p\u22121 \u03b3 m\u22121 \u03b3 o\u22121 \u03b3\u22121 d\u22121 \u03c3 s\u22121 o\u22121 d\u22121\nf f p p\u22121 m p\u22121 \u03b2 \u03b1\u22121 d \u03c1\u22121 d \u03b1\u22121 f \u03b8\nf\u22121 f\u22121 p \u03c1\u22121 m \u03b2\u22121 o \u03b2\u22121 \u03b2 d\u22121 o d\u22121 \u03b8 f\u22121\n\u03b1 = (pmo) \u03b2 = (ods) \u03b3 = (od\u22121f\u22121) \u03c3 = (\u2261 ss\u22121) \u03b8 = (\u2261 ff\u22121)\n\u03c1 = (pmods) \u03bb = (pmod\u22121f\u22121) \u03bd = (\u2261 oo\u22121dd\u22121ss\u22121ff\u22121)\n\u0003 = (\u2261 pp\u22121mm\u22121oo\u22121dd\u22121ss\u22121ff\u22121)\nsatisfiable. The function f given by f(x) = [0, 2], f(y) = [1, 3], and f(z) = [0, 4] is a\nmodel of I.\nAn instance of A-sat(F) can also be represented, in an obvious way, as a labelled\ndigraph, where the nodes are the variables from V , and the labelled arcs correspond\nto the constraints. This way of representing instances is sometimes more transparent.\nAllen\u2019s interval algebra A consists of the 8192 possible relations between intervals\ntogether with three standard operations on binary relations: converse \u00b7\u22121, intersection\n\u2229, and composition \u25e6. It is easy to see that the converse of r = (b1 \u00b7 \u00b7 \u00b7 bn) is equal to\n(b\u221211 \u00b7 \u00b7 \u00b7 b\u22121n ). Using the definition of composition, it can be shown that\n(b1 \u00b7 \u00b7 \u00b7 bn) \u25e6 (b\u20321 \u00b7 \u00b7 \u00b7 b\u2032m) =\n\u22c3\n{bi \u25e6 b\u2032j | 1 \u2264 i \u2264 n, 1 \u2264 j \u2264 m}.\nHence the composition of two relations r1, r2 \u2208 A is determined by the compositions\nof the basic relations they contain. The compositions of all possible pairs of basic\nrelations are given in Table 2.\nSubsets of A that are closed under the operations of converse, intersection, and\ncomposition are said to be subalgebras. For a given subset F of A, the smallest\nsubalgebra containing F is called the subalgebra generated by F and is denoted by\n\u3008F\u3009. It is easy to see that \u3008F\u3009 is obtained from F by adding all relations that can be\nobtained from the relations in F by using the three operations of the algebra A.\nIt is known [30] and easy to prove that, for every F \u2286 A, the problem A-sat(\u3008F\u3009)\nis polynomially equivalent to A-sat(F). Therefore, to classify the complexity of A-\nsat(F) it is sufficient to consider subalgebras of A. Throughout the paper, S denotes\na subalgebra of A.\nIn the following we shall use the symbol \u00b1, which should be interpreted as follows.\nA condition involving \u00b1 means the conjunction of two conditions: one corresponding\n458 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nTable 3\nThe 18 maximal tractable subalgebras of Allen\u2019s algebra.\nSp = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (p)\u00b11 \u2286 r}\nSd = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (d\u22121)\u00b11 \u2286 r}\nSo = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (o)\u00b11 \u2286 r}\nA1 = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (s\u22121)\u00b11 \u2286 r}\nA2 = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (s)\u00b11 \u2286 r}\nA3 = {r | r \u2229 (pmodf)\u00b11 \b= \u2205 \u21d2 (s)\u00b11 \u2286 r}\nA4 = {r | r \u2229 (pmodf\u22121)\u00b11 \b= \u2205 \u21d2 (s)\u00b11 \u2286 r}\nEp = {r | r \u2229 (pmods)\u00b11 \b= \u2205 \u21d2 (p)\u00b11 \u2286 r}\nEd = {r | r \u2229 (pmods)\u00b11 \b= \u2205 \u21d2 (d)\u00b11 \u2286 r}\nEo = {r | r \u2229 (pmods)\u00b11 \b= \u2205 \u21d2 (o)\u00b11 \u2286 r}\nB1 = {r | r \u2229 (pmods)\u00b11 \b= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r}\nB2 = {r | r \u2229 (pmods)\u00b11 \b= \u2205 \u21d2 (f)\u00b11 \u2286 r}\nB3 = {r | r \u2229 (pmod\u22121s\u22121)\u00b11 \b= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r}\nB4 = {r | r \u2229 (pmod\u22121s)\u00b11 \b= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r}\nE\u2217 =\n{\nr\n\u2223\u2223\u2223\u2223 1) r \u2229 (pmods)\u00b11 \b= \u2205 \u21d2 (s)\u00b11 \u2286 r, and2) r \u2229 (ff\u22121) \b= \u2205 \u21d2 (\u2261) \u2286 r\n}\nS\u2217 =\n{\nr\n\u2223\u2223\u2223\u2223 1) r \u2229 (pmod\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r, and2) r \u2229 (ss\u22121) \b= \u2205 \u21d2 (\u2261) \u2286 r\n}\nH =\n\uf8f1\uf8f2\n\uf8f3r\n\u2223\u2223\u2223\u2223\u2223\u2223\n1) r \u2229 (os)\u00b11 \b= \u2205 & r \u2229 (o\u22121f)\u00b11 \b= \u2205 \u21d2 (d)\u00b11 \u2286 r, and\n2) r \u2229 (ds)\u00b11 \b= \u2205 & r \u2229 (d\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (o)\u00b11 \u2286 r, and\n3) r \u2229 (pm)\u00b11 \b= \u2205 & r \b\u2286 (pm)\u00b11 \u21d2 (o)\u00b11 \u2286 r\n\uf8fc\uf8fd\n\uf8fe\nA\u2261 = {r | r \b= \u2205 \u21d2 (\u2261) \u2286 r}\nto + and one corresponding to \u2212. For example, the condition\nr \u2229 (dsf)\u00b11 \u0004= \u2205 \u21d2 (d)\u00b11 \u2286 r\nmeans that both of the following conditions hold:\nr \u2229 (dsf) \u0004= \u2205 \u21d2 (d) \u2286 r,\nr \u2229 (d\u22121s\u22121f\u22121) \u0004= \u2205 \u21d2 (d\u22121) \u2286 r.\nThe main advantage of using the \u00b1 symbol is conciseness: in any subalgebra of A,\nthe \u201c+\u201d and the \u201c\u2212\u201d conditions are satisfied (or not satisfied) simultaneously, and\ntherefore only one of them needs to be verified.\nA complete classification of the complexity of problems of the form A-sat(F) was\nobtained in [25].\nTheorem 2.2 (see [25]). For any subset F of A, either A-sat(F) is NP-complete\nor F is included in S, where S is one of the 18 subalgebras listed in Table 3, for which\nA-sat(S) is tractable.\nIn this paper we present a complete complexity classification for a more general\nproblem, namely, for A-sat(F) extended with constraints on the lengths of intervals.\nNow we define the exact form of constraints on lengths we shall allow.\nCONSTRAINTS ON INTERVALS AND LENGTHS 459\nDefinition 2.3. Let V be a set of real-valued variables and \u03b1, \u03b2 linear polyno-\nmials over V with rational coefficients. A linear relation over V is an expression of\nthe form \u03b1R\u03b2, where R \u2208 {<,\u2264,=, \u0004=,\u2265, >}.\nA disjunctive linear relation (DLR) over V is a disjunction of a nonempty finite\nset of linear relations. A DLR is said to be Horn if and only if at most one of its\ndisjuncts is not of the form \u03b1 \u0004= \u03b2.\nExample 2.3. The expression\nx+ 2y \u2264 3z + 42.3\nis a linear relation,\n(x+ 2y \u2264 3z + 42.3) \u2228 (x+ z < 4y \u2212 8) \u2228\n(\nx >\n3\n12\n)\nis a disjunctive linear relation, and\n(x+ 2y \u2264 3z + 42.3) \u2228 (x+ z \u0004= 4y \u2212 8) \u2228\n(\nx \u0004= 3\n12\n)\nis a Horn disjunctive linear relation.\nDefinition 2.4. The problem of satisfiability for finite sets, D, of DLRs, denoted\nDLRsat, is that of checking whether there exists an assignment f from variables in\nV to real numbers such that all DLRs in D are satisfied. Such an f is said to be\na model of D. The satisfiability problem for finite sets of Horn DLRs is denoted\nhornDLRsat.\nTheorem 2.5 (see [20, 24]). The problem DLRsat is NP-complete, but the\nproblem hornDLRsat is solvable in polynomial time.\nWe are interested in how the complexity of a problem depends on the value of\nthe parameter F which, in our case, is a set of qualitative relations. Therefore we\nshall allow only those constraints on lengths which can be expressed by Horn DLRs\nand thus are tractable. This class of constraints subsumes all forms of constraints on\nlengths which have been considered in [32, 33].\nWe can now define the general interval satisfiability problem with constraints on\nlengths.\nDefinition 2.6. An instance of the problem of interval satisfiability with con-\nstraints on lengths for a set F \u2286 A, denoted Al-sat(F), is a pair Q = (I,D), where\n(i) I is an instance of A-sat(F) over a set V of variables and\n(ii) D is an instance of hornDLRsat over the set of variables {l(v) | v \u2208 V }.\nThe question is whether Q is satisfiable, i.e., whether there exists a model f of\nI such that the DLRs in D are satisfied with l(v) equal to the length of f(v) for all\nv \u2208 V .\nExample 2.4. Consider the instance Q = (I,D), where I = {x(mo)y, y(df\u22121)z,\nz(\u2261 pmod\u22121ss\u22121f\u22121)x}, as in Example 2.2, and D = {l(x) > l(y) + l(z)}. This\ninstance is not satisfiable: any set of intervals satisfying the constraints in I must\nhave z\u2212 \u2264 x\u2212 < x+ < y+ and y \u2229 z nonempty and thus cannot satisfy the length\nconstraint in D.\nProposition 2.7. Al-sat(F) \u2208 NP for every F \u2286 A.\nProof. Every instance of Al-sat(F) over a set of variables V can be translated in\na straightforward way into an instance of DLRsat over the set of variables {v\u2212, v+ |\nv \u2208 V }. Now the result follows from Theorem 2.5.\n460 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nExample 2.5. The instance Q = (I,D) defined in Example 2.4 corresponds to\nthe instance D\u2032 of DLRsat containing the following constraints:\n(x\u2212 < x+),\n(y\u2212 < y+),\n(z\u2212 < z+),\n(x+ = y\u2212) \u2228 (x\u2212 < y\u2212),\n(x+ = y\u2212) \u2228 (y\u2212 < x+),\n(x+ = y\u2212) \u2228 (x+ < y+),\n\uf8fc\uf8f4\uf8fd\n\uf8f4\uf8fe corresponding to x(mo)y\n(y\u2212 > z\u2212) \u2228 (y+ = z+),\n(y\u2212 > z\u2212) \u2228 (y\u2212 < z\u2212),\n(y+ \u2264 z+),\n(y+ < z+) \u2228 (y\u2212 < z\u2212),\n\uf8fc\uf8f4\uf8f4\uf8f4\uf8fd\n\uf8f4\uf8f4\uf8f4\uf8fe\ncorresponding to y(df\u22121)z\nz\u2212 \u2264 x\u2212,\n}\ncorresponding to z(\u2261 pmod\u22121ss\u22121f\u22121)x\n(x+ \u2212 x\u2212) > (y+ \u2212 y\u2212) + (z+ \u2212 z\u2212).\nThe complexity of Al-sat(S) has already been determined for each subalgebra S\nidentified in Theorem 2.2.\nProposition 2.8 (see [2]). The problem Al-sat(S) is tractable for S \u2208 {Sp, Ep,H}\nand is NP-complete for the other 15 subalgebras listed in Table 3.\nIn the next section, we determine the complexity of Al-sat(F) for every possible\nsubset F \u2286 A.\n3. Main result.\nTheorem 3.1. For any subset F of A, either Al-sat(F) is strongly NP-complete\nor F is included in S, where S is one of the 10 subalgebras listed in Table 4, for which\nAl-sat(S) is tractable.\nIn section 3.1, we discuss polynomial-time algorithms for the 10 subalgebras listed\nin Table 4, and in section 3.2 we give the NP-completeness results we need. (Strong\nNP-completeness of the NP-complete cases follows from the fact that the biggest\nnumber used in these NP-completeness proofs is 5.) Finally, in section 3.3, we give\nthe classification proof.\nThe following notation is used throughout the proofs: if f is a model of an instance\nover a set V of variables and v \u2208 V , then we denote the left and right endpoints of\nf(v) by f(v\u2212) and f(v+), respectively.\nWe shall say that a relation is nontrivial if it is not equal to the empty relation\nor the relation (\u2261). Given a relation r \u2208 A, we write r\u2217 to denote the relation\nr \u2229 r\u22121. Evidently, every subalgebra of A is closed under the operation \u00b7\u2217 (of taking\nthe symmetric part of a relation).\nNow we introduce the notion of derivation with lengths which will be used fre-\nquently in the proofs below. This notion is an extension of the notion of derivation\nin Allen\u2019s algebra used in [25].\nSuppose F \u2286 A and Q = (I,D) is an instance of Al-sat(F). Let variables\nx, y be involved in I. Suppose a relation r \u2208 A satisfies the following condition: Q\nis satisfiable if and only if xry. Then we say that r is derived (with lengths) from\nF . It can easily be checked that the problems Al-sat(F) and Al-sat(F \u222a {r}) are\npolynomially equivalent because, in any instance of the second problem, any constraint\nCONSTRAINTS ON INTERVALS AND LENGTHS 461\nTable 4\nThe 10 tractable cases of Al-sat.\nSp = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (p)\u00b11 \u2286 r}\nEp = {r | r \u2229 (pmods)\u00b11 \b= \u2205 \u21d2 (p)\u00b11 \u2286 r}\nH =\n\uf8f1\uf8f2\n\uf8f3r\n\u2223\u2223\u2223\u2223\u2223\u2223\n1) r \u2229 (os)\u00b11 \b= \u2205 & r \u2229 (o\u22121f)\u00b11 \b= \u2205 \u21d2 (d)\u00b11 \u2286 r, and\n2) r \u2229 (ds)\u00b11 \b= \u2205 & r \u2229 (d\u22121f\u22121)\u00b11 \b= \u2205 \u21d2 (o)\u00b11 \u2286 r, and\n3) r \u2229 (pm)\u00b11 \b= \u2205 & r \b\u2286 (pm)\u00b11 \u21d2 (o)\u00b11 \u2286 r\n\uf8fc\uf8fd\n\uf8fe\nCo = {r | r \b= \u2205 \u21d2 (oo\u22121) \u2286 r}\nCm =\n{\nr\n\u2223\u2223\u2223\u2223 1) r \b= \u2205 \u21d2 (mm\u22121ss\u22121ff\u22121) \u2286 r, and2) r \u2229 (pp\u22121oo\u22121) \b= \u2205 \u21d2 (\u2261) \u2286 r\n}\nDs =\n{\nr\n\u2223\u2223\u2223\u2223 1) r \u2229 (dsf)\u00b11 \b= \u2205 \u21d2 (s)\u00b11 \u2286 r, and2) r \u2229 (pp\u22121mm\u22121oo\u22121) \b= \u2205 \u21d2 (\u2261 ss\u22121) \u2286 r\n}\nDf =\n{\nr\n\u2223\u2223\u2223\u2223 1) r \u2229 (dsf)\u00b11 \b= \u2205 \u21d2 (f)\u00b11 \u2286 r, and2) r \u2229 (pp\u22121mm\u22121oo\u22121) \b= \u2205 \u21d2 (\u2261 ff\u22121) \u2286 r\n}\nDd =\n{\nr\n\u2223\u2223\u2223\u2223 1) r \u2229 (dsf)\u00b11 \b= \u2205 \u21d2 (d)\u00b11 \u2286 r, and2) r \u2229 (pp\u22121mm\u22121oo\u22121) \b= \u2205 \u21d2 (\u2261 dd\u22121) \u2286 r\n}\nD\u2032\nd\n=\n{\nr\n\u2223\u2223\u2223\u2223 1) r \u2229 (dsf)\u00b11 \b= \u2205 \u21d2 (d)\u00b11 \u2286 r, and2) r \u2229 (pmo)\u00b11 \b= \u2205 \u21d2 (odd\u22121)\u00b11 \u2286 r\n}\nD\u2032\u2032\nd\n=\n\uf8f1\uf8f2\n\uf8f3r\n\u2223\u2223\u2223\u2223\u2223\u2223\n1) r \u2229 (dsf)\u00b11 \b= \u2205 \u21d2 (d)\u00b11 \u2286 r, and\n2) r \u2229 (pp\u22121oo\u22121) \b= \u2205 \u21d2 (oo\u22121dd\u22121) \u2286 r, and\n3) r \u2229 (pp\u22121mm\u22121) \b= \u2205 \u21d2 (\u2261 dd\u22121) \u2286 r\n\uf8fc\uf8fd\n\uf8fe\ninvolving r can be replaced by the set of constraints in Q (introducing fresh variables\nas needed), and this can be done in polynomial time. It follows that it is sufficient to\nclassify the complexity of problems Al-sat(S), where S is a subalgebra of A closed\nunder derivations with lengths.\nNote that if we prove that the 10 sets shown in Table 4 are the only maximal sets\nF for which Al-sat(F) is tractable, then it will follow that they are all subalgebras\nclosed under derivation with lengths; that is, we do not have to give a separate proof\nof this fact.\nWe will also use the following principle of duality to reduce the number of cases\nto be considered in the forthcoming proofs. We make use of a function reverse which\nis defined on the basic relations of A by the following table:\nb \u2261 p p\u22121 m m\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\nreverse(b) \u2261 p\u22121 p m\u22121 m o\u22121 o d d\u22121 f f\u22121 s s\u22121\nIt is also defined for all other elements of A by setting reverse(r) = \u22c3b\u2286r reverse(b).\nLet Q = (I,D) be any instance of Al-sat with set of variables V , and let Q\u2032 =\n462 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\n(I \u2032, D) be the instance obtained from Q by replacing every r in I with reverse(r). It\nis easy to check that Q has a model f if and only if Q\u2032 has a model f \u2032 given by\nf \u2032(v) = [\u2212f(v+),\u2212f(v\u2212)] for all v \u2208 V.\nIn other words, f \u2032 is obtained from f by redirecting the real line and leaving all\nintervals (as geometric objects) in their places. This observation leads to the following\nlemma.\nLemma 3.2. Let F = {r1, . . . , rn} \u2286 A and F \u2032 = {r\u20321, . . . , r\u2032n} \u2286 A be such that,\nfor all 1 \u2264 k \u2264 n, r\u2032k = reverse(rk). Then Al-sat(F) is tractable (NP-complete) if\nand only if Al-sat(F \u2032) is tractable (NP-complete).\n3.1. Tractability results.\nProposition 3.3. The problem Al-sat(S) is tractable whenever S is one of Sp,\nEp, H, Co, Cm, Ds, Df, Dd, D\u2032d, or D\u2032\u2032d.\nPolynomial-time algorithms solving Al-sat(S) for S \u2208 {Sp, Ep,H} are given\nin [2]. The remaining cases are dealt with below.\nLemma 3.4. Let Q = (I,D) be an instance of Al-sat(Co). Then Q is satisfiable\nif and only if D is satisfiable.\nProof. Let V = {x1, . . . , xn}. If D is not satisfiable, then, obviously, the whole\ninstance Q is not satisfiable. Suppose D is satisfiable, and l(x1) = a1, . . . , l(xn) = an\nis a solution of D. Then reorder variables in V so that a1 \u2264 \u00b7 \u00b7 \u00b7 \u2264 an. Let ! = a1\/n,\nand let, for 1 \u2264 i \u2264 n, f(xi) = [! \u00b7 i, ! \u00b7 i+ ai]. It is easy to check that this f satisfies\nall constraints in Q.\nIt follows that the problem Al-sat(Co) has exactly the same complexity as the\nproblem hornDLRsat, and hence is tractable (see Theorem 2.5).\nAlgorithms for the remaining 6 subalgebras are given in Figure 1, and in the\nremainder of this subsection we prove that these algorithms are correct. (Checking\nthat they are polynomial-time is straightforward and is left to the reader.)\nAlgorithms Ai, 1 \u2264 i \u2264 4, and Procedure P take an instance Q = (I,D) over a\nset of variables V as input. We shall assume that D always contains all constraints\nof the form l(v) > 0, v \u2208 V . We will also assume that I does not contain a constraint\nvrw, where r = \u2205. This trivial necessary condition for satisfiability can obviously be\nchecked in polynomial time.\nThe following lemma from [7] is crucial in our proofs of correctness.\nLemma 3.5 (see [7]). Let D be a satisfiable set of Horn DLRs, and let x1, . . . , xn\nbe the variables used in D. If D\u02dc = {xi \u0004= xj | D\u222a{xi \u0004= xj} is satisfiable}, then D\u222aD\u02dc\nis satisfiable.\nUsing this lemma we can always divide the set of variables V into classes such\nthat, in every model of an instance, variables from the same class must be assigned\nintervals of the same length while any variables from different classes can be assigned\nintervals of different lengths all at the same time.\nLemma 3.6. Algorithm A1 correctly solves Al-sat(Cm).\nProof. Obviously, if A1 rejects in line 1, then Q is not satisfiable.\nSuppose A1 rejects in line 3. Then G contains a simple cycle of odd length,\nx1, . . . , x2t+1, x1. Then, in any model f of Q, all of the intervals f(x1), . . . , f(x2t+1)\nmust have the same length, and hence, by definition of Cm, for all 1 \u2264 i \u2264 2t we\nhave f(xi) (mm\n\u22121) f(xi+1). These conditions imply that f(x1) (\u2261 pp\u22121) f(x2t+1).\nTherefore, it is impossible that f(x1) (mm\n\u22121) f(x2t+1), so Q is not satisfiable.\nSuppose now that the algorithm accepts. We will show how to construct a\nmodel of Q. Note that in this case D is satisfiable. Let V = {x1, . . . , xn}, and let\nCONSTRAINTS ON INTERVALS AND LENGTHS 463\nInput: Instance Q = (I,D) of Al-sat(S) with set of variables V\nAlgorithm A1 for S = Cm\n(1) If D is not satisfiable, then reject;\n(2) Construct a graph G = (V,E), where (v, w) \u2208 E if and only if\n\u2013 D \u222a {l(v) \u0007= l(w)} is not satisfiable, and\n\u2013 vrw \u2208 I for some r such that (\u2261) \u0007\u2286 r;\n(3) If G is 2-colorable, then accept; else reject.\nProcedure P\n(1) Let D\u2032 = D;\n(2) For each vrw \u2208 I such that r \u2286 (dsf) or r \u2286 (d\u22121s\u22121f\u22121),\nadd the constraint l(v) < l(w) or l(v) > l(w), respectively, to D\u2032;\n(3) For each vrw \u2208 I such that (\u2261) \u2286 r \u2286 (\u2261 dsf) or (\u2261) \u2286 r \u2286 (\u2261 d\u22121s\u22121f\u22121),\nadd the constraint l(v) \u2264 l(w) or l(v) \u2265 l(w), respectively, to D\u2032;\n(4) If D\u2032 is not satisfiable, then reject.\nAlgorithm A2 for S \u2208 {Ds,Df,Dd}\n(1) Call procedure P ;\n(2) Accept.\nAlgorithm A3 for S = D\u2032d\n(1) Call procedure P ;\n(2) Construct a graph G = (V,E), where (v, w) \u2208 E if and only if\nD\u2032 \u222a {l(v) \u0007= l(w)} is not satisfiable;\n(3) Identify the connected components S1, . . . , Sk of G;\n(4) For each Sj , let Ij = I|Sj = {vrw \u2208 I | v, w \u2208 Sj}\nand I \u2032j = {v r \u2229 (\u2261 oo\u22121) w | vrw \u2208 Ij};\n(5) Solve I \u2032j , 1 \u2264 j \u2264 k, as instances of A-sat(So);\n(6) If every I \u2032j is satisfiable, then accept; else reject.\nAlgorithm A4 for S = D\u2032\u2032d\n(1) Call procedure P ;\n(2) Construct a graph G = (V,E), where (v, w) \u2208 E if and only if\n\u2013 D\u2032 \u222a {l(v) \u0007= l(w)} is not satisfiable, and\n\u2013 vrw \u2208 I for some r such that (\u2261) \u2286 r \u2229 (\u2261 pp\u22121oo\u22121mm\u22121) \u2286 (\u2261 mm\u22121);\n(3) Identify the connected components S1, . . . , Sk of G;\n(4) For each Sj , let Ij = I|Sj = {vrw \u2208 I | v, w \u2208 Sj}\nand I \u2032j = {v r w | vrw \u2208 Ij and (\u2261) \u0007\u2286 r};\n(5) If every I \u2032j is empty, then accept; else reject.\nFig. 1. Polynomial-time algorithms for the tractable cases of Al-sat.\nD\u02dc = {l(xi) \u0004= l(xj) | D \u222a {l(xi) \u0004= l(xj)} is satisfiable}. Then, by Lemma 3.5, D\u222aD\u02dc is\nsatisfiable. Let l(x1) = a1, . . . , l(xn) = an be a solution of D\u222aD\u02dc. We know that G can\nbe colored with two colors, say black and white. Now if xi is black let f(xi) = [0, ai];\notherwise let f(xi) = [\u2212ai, 0]. Obviously, this satisfies all constraints containing (\u2261)\nbecause all constraints in I already allow (mm\u22121ss\u22121ff\u22121). Suppose that xirxj \u2208 I for\nsome r such that (\u2261) \u0004\u2286 r. If (xi, xj) \u2208 E then xi and xj are of different colors, and\nwe have f(xi) (mm\n\u22121) f(xj). Otherwise we know, by Lemma 3.5, that the lengths\nof f(xi) and f(xj) are different, which means that f(xi) (mm\n\u22121ss\u22121ff\u22121) f(xj), as\nrequired.\nThe next three algorithms use preprocessing Procedure P (see Figure 1). This\nprocedure can obviously be performed in polynomial time. It is also easy to see that\nP does not change the set of solutions to an input.\n464 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nLemma 3.7. Algorithm A2 correctly solves problems Al-sat(S), where S \u2208\n{Ds,Df,Dd}.\nProof. Obviously, if the algorithm rejects (in P ), then the instance is not satisfi-\nable.\nSuppose now the algorithm accepts. Let l(x1) = a1, . . . , l(xn) = an be a solution\nof D\u2032 and order the variables in V so that a1 \u2264 \u00b7 \u00b7 \u00b7 \u2264 an.\nIf F = Ds, then let f(xi) = [0, ai] for all i. The constraints added to D during\npreprocessing P ensure that this f is a model of Q. Similarly, if F = Df, then the\nmapping given by f(xi) = [\u2212ai, 0] for all i satisfies all constraints in Q. Finally, if\nF = Dd, then the mapping f(xi) = [\u2212ai\/2, ai\/2] for all i satisfies all constraints in\nQ.\nLemma 3.8. Algorithm A3 correctly solves Al-sat(D\u2032d).\nProof. Suppose first that A3 accepts on an input Q. We construct a model\nof Q as follows. Let vj,l, 1 \u2264 l \u2264 |Sj |, be the members of Sj , 1 \u2264 j \u2264 k. Let\nD\u02dc = {l(v) \u0004= l(w) | D\u2032 \u222a {l(v) \u0004= l(w)} is satisfiable}. By Lemma 3.5, D\u2032 \u222a D\u02dc is\nsatisfiable.\nLet l(vj,l) = aj,l, where 1 \u2264 j \u2264 k and 1 \u2264 l \u2264 |Sj |, be a solution of D\u2032 \u222a D\u02dc. Note\nthat, for every 1 \u2264 j \u2264 |Sj |, we have aj,1 = \u00b7 \u00b7 \u00b7 = aj,|Sj |. Reorder the Sj \u2019s so that\na1,1 < a2,1 < \u00b7 \u00b7 \u00b7 < ak,1 holds. Let\n! =\n{\nmin{ai+1,1\u2212ai,13 | 1 \u2264 i < k} if k > 1,\n1 if k = 1.\nFor all 1 \u2264 j \u2264 k, let fj be a model of I \u2032j (and then of Ij as well) and assume without\nloss of generality that the variables in Ij are ordered so that fj(v\n\u2212\nj,1) \u2264 fj(v\u2212j,2) \u2264\n\u00b7 \u00b7 \u00b7 \u2264 fj(v\u2212j,|Sj |). By applying an appropriate translation and scaling, all models fj\ncan be chosen so that 0 < fj(v\n\u2212\nj,1) \u2264 \u00b7 \u00b7 \u00b7 \u2264 fj(v\u2212j,|Sj |) < !.\nNow we combine the models fj of Ij into one model f of Q = (I,D): let f(v\n\u2212\nj,l) =\n\u2212j \u00b7 !+ fj(v\u2212j,l) and f(v+j,l) = f(v\u2212j,l) + aj,l (see Figure 2).\nWe immediately see that f satisfies all length constraints and all constraints within\neach Ij . It is also easy to check that we have f(vi,l) (d) f(vi\u2032,l\u2032) whenever i < i\n\u2032. Due\nto the check in Procedure P , this satisfies all constraints between variables from\ndifferent Ij \u2019s.\nAssume now that algorithm A3 rejects. We will show that Q is not satisfiable.\nThe result holds trivially if A3 rejects on line 1 (that is, in P ). Assume to the contrary\nthat some I \u2032j is not satisfiable but Q is satisfiable. Clearly, if Q is satisfiable, then the\ninstance Ij has a model f with all intervals of the same length a. Then f is also a\nmodel of I \u2032\u2032j = {v r \u2229 (\u2261 pp\u22121mm\u22121oo\u22121) w |vrw \u2208 Ij}.\nReorder the variables in Ij so that f(v\n\u2212\nj,1) \u2264 f(v\u2212j,2) \u2264 \u00b7 \u00b7 \u00b7 \u2264 f(v\u2212j,|Sj |), and suppose\nthat {f(v\u2212j,l) | 1 \u2264 l \u2264 |Sj |} = {b1, . . . , bt}, where 1 \u2264 t \u2264 |Sj | and b1 < \u00b7 \u00b7 \u00b7 < bt.\nBy definition of D\u2032d, every constraint allowing (pm) allows (o) as well. Therefore\nthe function g defined by\ng(vj,l) = [a \u00b7 s\/|Sj |, a \u00b7 s\/|Sj |+ a] when f(v\u2212j,l) = bs\nis a model of Ij . Moreover, it is also a model of I\n\u2032\nj , a contradiction.\nLemma 3.9. Algorithm A4 correctly solves Al-sat(D\u2032\u2032d).\nProof. If A4 rejects in line 1 (that is, in P ), then Q is obviously not satisfiable.\nCONSTRAINTS ON INTERVALS AND LENGTHS 465\n0 \u03b5 2\u03b5 3\u03b5 4\u03b5\u22124\u03b5 \u22123\u03b5 \u22122\u03b5 \u2212\u03b5\nf(v1,1)\nf(v1,2)\nf(v1,3)\nf(v1,4)\nf(v2,1)\nf(v2,2)\nf(v3,1)\nf(v3,2)\nf(v3,3)\n0 \u03b5 2\u03b5 3\u03b5 4\u03b5\u22124\u03b5 \u22123\u03b5 \u22122\u03b5 \u2212\u03b5\nFig. 2. A combined model for an instance of Al-sat(D\u2032\nd\n) (Lemma 3.8).\nSuppose A4 rejects in line 6. It follows that there are variables x1, . . . , xq \u2208 V\nsuch that, in any model f of Q,\n(i) intervals f(x1), . . . , f(xq) have the same length, and\n(ii) f(xi) (\u2261 mm\u22121) f(xi+1) for all 1 \u2264 i \u2264 q \u2212 1, and\n(iii) (by definition I \u2032j and D\u2032\u2032d) the intervals f(x1) and f(xq) are related by\n(oo\u22121dd\u22121ss\u22121ff\u22121).\nIt is clear that these three conditions cannot be satisfied simultaneously. Therefore Q\nis not satisfiable.\nSuppose that the algorithm accepts. We will show how to construct a model of\nQ. Let vj,l, 1 \u2264 l \u2264 |Sj |, be the members of Sj , 1 \u2264 j \u2264 k. Let D\u02dc = {l(v) \u0004=\nl(w) | D\u2032 \u222a {l(v) \u0004= l(w)} is satisfiable}. By Lemma 3.5, D\u2032 \u222a D\u02dc is satisfiable.\nLet l(vj,l) = aj,l, where 1 \u2264 j \u2264 k and 1 \u2264 l \u2264 |Sj |, be a solution of D\u02dc. Note\nthat, for every 1 \u2264 j \u2264 |Sj |, we have aj,1 = \u00b7 \u00b7 \u00b7 = aj,|Sj |. Reorder the Sj \u2019s so that\na1,1 \u2264 a2,1 \u2264 \u00b7 \u00b7 \u00b7 \u2264 ak,1 holds (note that some of the aj,1\u2019s may coincide). Let\n{a1,1, . . . , ak,1} = {b1, . . . , bt}, where b1 < \u00b7 \u00b7 \u00b7 < bt, and let\n! =\n{\nmin{b1, bi+1\u2212bi3 | 1 \u2264 i < t} if t > 1,\n1 if t = 1.\nFurther, let f(v\u2212j,l) = \u2212s \u00b7 ! + j|V | \u00b7 !, where s is such that bs = aj,l, and let\nf(v+j,l) = f(v\n\u2212\nj,l) + aj,l (see Figure 3). We will show that f is a model of Q. By the\nchoice of aj,l, f satisfies all length constraints.\nSuppose vj,l r vj\u2032,l\u2032 \u2208 I and check that f(vj,l) r f(vj\u2032,l\u2032).\nCase 1. j = j\u2032.\nIf the variables are from the same connected component of G, then we have that\n(\u2261) \u2286 r. Indeed, we have f(vj,l) (\u2261) f(vj\u2032,l\u2032) by the definition of f .\nCase 2. j \u0004= j\u2032, but aj,l = aj\u2032,l\u2032 .\n466 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\n0 \u03b5 2\u03b5 3\u03b5 4\u03b5\u22124\u03b5 \u22123\u03b5 \u22122\u03b5 \u2212\u03b5\nf(v1,1)\nf(v3,1)\nf(v3,2)\nf(v3,3)\n0 \u03b5 2\u03b5 3\u03b5 4\u03b5\u22124\u03b5 \u22123\u03b5 \u22122\u03b5 \u2212\u03b5\nf(v1,2)\nf(v1,3)\nb1\nf(v2,1)\nf(v2,2)\nb1\nb2\nFig. 3. A combined model for an instance of Al-sat(D\u2032\u2032\nd\n) (Lemma 3.9).\nBy definition of G, we have either r \u2229 (pp\u22121oo\u22121) \u0004= \u2205 or (\u2261) \u0004\u2286 r. In the former\ncase we immediately get (oo\u22121) \u2286 r by the definition of D\u2032\u2032d. Suppose that (\u2261) \u0004\u2286 r.\nThen r\u2229(pp\u22121mm\u22121) = \u2205. Due to the check in P , the equality aj,l = aj\u2032,l\u2032 is necessary.\nIt follows from this fact and from the definition of D\u2032\u2032d that we have (oo\u22121) \u2286 r again.\nIndeed, it is easy to check that f(vj,l) (o) f(vj\u2032,l\u2032) if j < j\n\u2032, by the definition of f .\nCase 3. aj,l \u0004= aj\u2032,l\u2032 .\nAssume without loss of generality that aj,l < aj\u2032,l\u2032 . It follows from the definition\nof D\u2032\u2032d that either we have (dd\u22121) \u2286 r or (due to the check in P ) (d) \u2286 r \u2286 (dsf). It\nis not hard to verify that, indeed, f(vj,l) (d) f(vj\u2032,l\u2032), by the definition of f .\n3.2. NP-completeness results. First let us mention the obvious fact that, for\nany F \u2286 A, NP-completeness of A-sat(F) implies NP-completeness of Al-sat(F).\nLemma 3.10. Suppose that r1, . . . , rn \u2208 A are relations such that the problem\nA-sat({r1, . . . , rn}) is NP-complete.\n1. If, for every 1 \u2264 i \u2264 n, r\u2032i \u2208 {ri, ri \u222a (\u2261)}, then Al-sat({r\u20321, . . . , r\u2032n}) is\nNP-complete.\n2. If \u2205 \u0004= r1 \u2286 (pmo) and r\u20321 satisfies r1 \u2286 r\u20321 \u2286 r1 \u222a (\u2261 dsf), then the problem\nAl-sat({r\u20321, r2, . . . , rn}) is NP-complete.\nCONSTRAINTS ON INTERVALS AND LENGTHS 467\nProof.\n1. The proof is by polynomial-time reduction from A-sat({r1, . . . , rn}) to Al-\nsat({r\u20321, . . . , r\u2032n}). Let I be an instance of A-sat({r1, . . . , rn}) over a set V of vari-\nables. Construct an instance (I \u2032, D\u2032) of Al-sat({r\u20321, . . . , r\u2032n}) as follows:\n(i) for every constraint urv in I such that (\u2261) \u2286 r add urv to I \u2032;\n(ii) for every constraint urv in I such that (\u2261) \u0004\u2286 r add urv to I \u2032 and l(u) \u0004= l(v)\nto D\u2032.\nObviously, every solution to (I \u2032, D\u2032) is also a solution to I. Let f be a model of I,\nand let {x1, . . . , xm} be the set of all endpoints of intervals f(x), x \u2208 V . We may\nwithout loss of generality assume that 0 < x1 < \u00b7 \u00b7 \u00b7 < xm. Set x\u20321 = x1, x\u20322 = x2, and,\nfor every i > 2, set x\u2032i = 2x\n\u2032\ni\u22121 + 1. It is easy to check that the function f\n\u2032 such that\nf \u2032(v) = [x\u2032i, x\n\u2032\nj ] if f(v) = [xi, xj ] is a model of (I\n\u2032, D\u2032).\n2. Modify the previous construction as follows:\n(i) for every constraint ur1v in I add constraints ur\n\u2032\n1v to I\n\u2032 and l(u) > l(v) to\nD\u2032;\n(ii) for every constraint uriv, i > 1, in I add uriv to I\n\u2032.\nEvery solution to (I \u2032, D\u2032) is also a solution to I because ur\u20321v and l(u) > l(v) imply\nur1v. Let f be a model of I, and let {x1, . . . , xm} be the set of all endpoints of\nintervals f(x) for some x \u2208 V . We may without loss of generality assume that\nx1 < \u00b7 \u00b7 \u00b7 < xm < 0. Set x\u2032m = xm, x\u2032m\u22121 = xm\u22121, and, for every 1 \u2264 i < m \u2212 1, set\nx\u2032i = 2x\n\u2032\ni+1 \u2212 1. It is easy to check that the function f \u2032 such that f \u2032(v) = [x\u2032i, x\u2032j ] if\nf(v) = [xi, xj ] is a model of (I\n\u2032, D\u2032).\nExample 3.1. It follows from Theorem 2.2 thatA-sat({(mm\u22121)}) is NP-complete.\nUsing Lemma 3.10(1) we conclude that Al-sat({(\u2261 mm\u22121)}) is also NP-complete.\nLemma 3.11. Al-sat(F) is NP-complete if F is {(oo\u22121), (s)}, {(oss\u22121ff\u22121)}, or\n{(sf), (oo\u22121ss\u22121ff\u22121)}.\nProof. First let F = {(oo\u22121), (s)}. The constraints\n{x(oo\u22121)y, x(oo\u22121)z, y(s)z; l(z) > l(x) + l(y)}\nare satisfiable if and only if x(o)y. Further, the constraints {x(o)z, z(o)y; l(z) >\nl(x) + l(y)} are satisfiable if and only if x(p)y. It follows from Theorem 2.2 that\nA-sat({(oo\u22121), (p)}) is NP-complete. The above constructions show how to reduce\nA-sat({(oo\u22121), (p)}) to Al-sat({(oo\u22121), (s)}) in polynomial time.\nNow let F = {(oss\u22121ff\u22121)}. Note that in this case we can also make use of the\nrelation (ss\u22121ff\u22121), which is equal to (oss\u22121ff\u22121)\u2217.\nWe give a polynomial-time reduction from the NP-complete problemUnnegated\nOne-in-Three 3SAT (Problem [LO4] in [11]) toAl-sat({(oss\u22121ff\u22121)}); let (X,C) be\nan arbitrary instance of Unnegated One-in-Three 3SAT. Consider the following\nset of constraints over the variables a, b, c, c\u2032:\na(oss\u22121ff\u22121)b, l(a) = l(b) = 2,\nc(ss\u22121ff\u22121)a, c(ss\u22121ff\u22121)b, l(c) = 1,\nc\u2032(ss\u22121ff\u22121)a, c\u2032(ss\u22121ff\u22121)b, l(c\u2032) = 3.\nWe impose the constraints x(ss\u22121ff\u22121)a, x(ss\u22121ff\u22121)b on every x \u2208 X and note that\nthis implies l(x) \u2208 {1, 3}. To complete the reduction, we add the constraint l(x) +\nl(y) + l(z) = 5 for each {x, y, z} \u2208 C. It is easy to show that the resulting set of\nconstraints is satisfiable if and only if (X,C) has a solution.\nFinally, let F = {(sf), (oo\u22121ss\u22121ff\u22121)}. The constraints {x(sf)z, y(sf)z; l(z) >\nl(x)+ l(y)} are satisfiable if and only if x(\u2261 pp\u22121ss\u22121ff\u22121)y. Hence, we can obtain the\n468 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nrelation (ss\u22121ff\u22121) = (oo\u22121ss\u22121ff\u22121) \u2229 (\u2261 pp\u22121ss\u22121ff\u22121). To show NP-completeness,\nuse the same construction as above but replace (oss\u22121ff\u22121) with (oo\u22121ss\u22121ff\u22121).\nLemma 3.12. Al-sat({r}) is NP-complete whenever\n(mm\u22121) \u2286 r \u2286 (mm\u22121dd\u22121ss\u22121) or (mm\u22121) \u2286 r \u2286 (mm\u22121dd\u22121ff\u22121).\nProof. We consider only r with (mm\u22121) \u2286 r \u2286 (mm\u22121dd\u22121ss\u22121); the other case\nis dual. We may without loss of generality assume that r = r\u2217.\nCase 1. r = (mm\u22121).\nIt follows from Theorem 2.2 that A-sat({(mm\u22121)}) is NP-complete.\nCase 2. r = (mm\u22121dd\u22121).\nThe constraints\nx(dd\u22121mm\u22121)y, l(x) < l(y),\na(dd\u22121mm\u22121)x, l(a) < l(x),\na(dd\u22121mm\u22121)y, l(a) < l(y),\nare satisfiable if and only if x(d)y. Furthermore, the constraints\nu(mm\u22121dd\u22121)v, x(d)u, y(d)v, l(u) = l(v),\nare satisfiable if and only if x(pp\u22121)y. It follows from Theorem 2.2 that the prob-\nlem A-sat({(d), (pp\u22121)}) is NP-complete. We have derived (d) and (pp\u22121) from\n(mm\u22121dd\u22121), and hence Al-sat({(mm\u22121dd\u22121)}) is also NP-complete.\nCase 3. r = (mm\u22121ss\u22121).\nThe constraints\na(mm\u22121ss\u22121)x, a(mm\u22121ss\u22121)y, l(x) > l(a),\nb(mm\u22121ss\u22121)x, b(mm\u22121ss\u22121)y, l(y) > l(b),\nx(mm\u22121ss\u22121)y, l(x) = l(y),\nare satisfiable if and only if a(\u2261 ss\u22121)b, so we can derive the relation (\u2261 ss\u22121).\nFurthermore, the constraints\na(\u2261 ss\u22121)x, b(\u2261 ss\u22121)x, l(x) > l(a),\na(\u2261 ss\u22121)y, b(\u2261 ss\u22121)y, l(y) > l(b),\nx(mm\u22121ss\u22121)y, l(x) = l(y),\nare satisfiable if and only if a(pp\u22121)b. Now NP-completeness follows from Theo-\nrem 2.2.\nCase 4. r = (mm\u22121dd\u22121ss\u22121).\nReplace (mm\u22121ss\u22121) with (mm\u22121dd\u22121ss\u22121) in the previous case.\nLemma 3.13. Al-sat({r1, r2}) is NP-complete whenever (\u2261) \u0004\u2286 r2 and\nr1 \u2229 (\u2261 pp\u22121oo\u22121mm\u22121) = (mm\u22121) \u0001 r2 \u2229 (\u2261 pp\u22121oo\u22121mm\u22121).\nProof. Let us assume that all intervals have length one and prove that the problem\nAl-sat({r1, r2}) is NP-complete even under this assumption. This assumption reduces\nthe number of cases to be considered because, in this case, we have r1 = (mm\n\u22121) and\n(mm\u22121) \u2282 r2 \u2286 (pp\u22121mm\u22121oo\u22121). Moreover, we may without loss of generality\nassume that either r\u22172 = (mm\n\u22121) or r\u22172 = r2.\nCONSTRAINTS ON INTERVALS AND LENGTHS 469\nCase 1. {(mm\u22121), (pmm\u22121)}.\nLet G = (V,E) and H = (V \u2032, E\u2032) denote two directed graphs. A homomorphism\nfrom G to H is a function h : V \u2192 V \u2032 such that (v, w) \u2208 E implies (f(v), f(w)) \u2208 E\u2032.\nLet H be the graph (V \u2032, E\u2032) = ({0, 1, 2}, {(0, 1)(0, 2), (1, 0), (1, 2), (2, 1)}). De-\nciding whether there exists a homomorphism from an arbitrary graph to H is NP-\ncomplete, as follows from Theorem 4.4 in [27]. We denote this problem Graph\nHomomorphism(H).\nWe prove that {(mm\u22121), (pmm\u22121)} is NP-complete by a polynomial-time reduc-\ntion from Graph Homomorphism(H). Arbitrarily choose a directed graph G =\n(V,E).\nThe relations (pm) and (m) can be derived as follows. The constraints\n{x(mm\u22121)x\u2032, y(pmm\u22121)x, y(pmm\u22121)x\u2032}\nare satisfiable if and only if y(pm)x, and we have (m) = (pm) \u2229 (mm\u22121).\nIntroduce five fresh variables and the constraints a(m)b(m)c(m)d(m)e. For each\nnode v \u2208 V , add the constraints a(pm)v(pm)e. For each edge (v, w) \u2208 E, add the\nconstraint v(pmm\u22121)w.\nWe show that the resulting set I of constraints are satisfiable if and only if there\nexists a homomorphism from G to H.\nOnly-if: Assume without loss of generality that f is a model of I such that\nf(a) = [\u22121, 0]. Construct a function h : V \u2192 V \u2032 as follows: h(v) =  f(v\u2212)!. To see\nthat h is a homomorphism from G to H, arbitrarily choose an edge (v, w) \u2208 E. We\nconsider three cases:\n(i) h(v) = 0. This implies that 0 \u2264 f(v\u2212) < 1. Since v(pmm\u22121)w \u2208 I and\nf(w+) \u2264 3, we know that 1 \u2264 f(w\u2212) \u2264 2 and h(w) \u2208 {1, 2}. Hence, (h(v), h(w)) \u2208 E\u2032.\n(ii) h(v) = 1. Either 0 \u2264 f(w\u2212) < 1 (corresponding to v(m\u22121)w) or f(w\u2212) = 2\n(corresponding to v(m)w), so h(w) \u2208 {0, 2} and (h(v), h(w)) \u2208 E\u2032.\n(iii) h(v) = 2. Then f(w\u2212) = 1 (corresponding to v(m\u22121)w), h(w) = 1, and\n(h(v), h(w)) \u2208 E\u2032.\nIf: Assume h : V \u2192 V \u2032 is a homomorphism from G to H. Then f (as defined\nbelow) is a model of I:\nf(a) = [\u22121, 0], f(b) = [0, 1], f(c) = [1, 2], f(d) = [2, 3], f(e) = [3, 4],\nand for every v \u2208 V let f(v) = [h(v), h(v) + 1].\nCase 2. {(mm\u22121), (pp\u22121mm\u22121)}.\nThe proof is by polynomial-time reduction from the NP-complete problemGraph\n3-colorability (Problem [GT4] in [11]). Let G = (V,E) be an arbitrary instance.\nFix a fresh interval variable x. Introduce two interval variables v, v\u2032 for each v \u2208\nV together with the constraints v(mm\u22121)v\u2032(mm\u22121)x. Finally, add the constraint\nv(pp\u22121mm\u22121)w for every (v, w) \u2208 E. It is easy to check that the resulting set of\nconstraints is satisfiable if and only if G is 3-colorable. For example, if f(x) = [3, 4],\nthen constraints of the first type imply that f(v) \u2208 {[1, 2], [3, 4], [5, 6]} for any v \u2208 V ,\nwhile the constraints of the second type ensure that the values for \u201cadjacent\u201d variables\nare distinct.\nCase 3. {(mm\u22121), (pp\u22121mm\u22121oo\u22121)}.\nUse (pp\u22121mm\u22121oo\u22121) instead of (pp\u22121mm\u22121) in Case 2.\nCase 4. {(mm\u22121), (mm\u22121oo\u22121)}.\n470 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nThe proof is by polynomial-time reduction from the NP-complete problem Be-\ntweenness1 (Problem [MS1] in [11]), which is defined as follows:\nInstance: A finite set A, a collection T of ordered triples (a, b, c) of distinct\nelements from A.\nQuestion: Is there a total ordering < on A such that for each (a, b, c) \u2208 T we\nhave either a < b < c or c < b < a?\nLet (A, T ) be an arbitrary instance of Betweenness and note that the con-\nstraints {x(mm\u22121)x\u2032, y(mm\u22121oo\u22121)x, y(mm\u22121oo\u22121)x\u2032} are satisfiable if and only if\nx(oo\u22121)y. We construct an instance I over {(mm\u22121), (oo\u22121)} as follows:\n(i) for each pair of distinct elements a, b \u2208 A, add the constraint a(oo\u22121)b to I;\n(ii) for each triple (a, b, c) \u2208 T , introduce two fresh variables x, y and add the\nconstraints {x(mm\u22121)a, x(oo\u22121)b, x(oo\u22121)c, y(oo\u22121)a, y(oo\u22121)b, y(mm\u22121)c}.\nWe will henceforth refer to the variables in I that correspond to the set A as\n\u201cbasic\u201d variables and the other variables as \u201cauxiliary\u201d variables.\nAssume that I has a model f . Then, due to the constraints added in step (i), the\nintervals f(a), a \u2208 A, are pairwise distinct. Moreover, the relation (o) induces a total\norder on the set {f(a) | a \u2208 A}. Suppose that there is a triple (a, b, c) \u2208 T such that\nthe model f satisfies f(b) (o) f(a) (o) f(c) and consider the constraints over the auxil-\niary variables x and y introduced in step (ii) for the triple (a, b, c). The variable x has\nto satisfy x(mm\u22121)a, which implies that either x(p)c or x(p\u22121)b, a contradiction. We\ncan analogously rule out all orderings of f(a), f(b), f(c) except f(a) (o) f(b) (o) f(c)\nand f(c) (o) f(b) (o) f(a). Hence there is a solution to the instance (A, T ): for all\na, b \u2208 A, set a < b if and only if f(a) (o) f(b).\nConversely, assume that there exists a total order < on A that is a solution to the\ninstance (A, T ). We will show how to construct a model f of I. For all a, b \u2208 A, set\nf(a) (o) f(b) if and only if a < b. Clearly, this satisfies all constraints added in step (i).\nTo show that there exists consistent values for all auxiliary variables, arbitrarily pick\none triple (a, b, c) \u2208 T (corresponding to the auxiliary variables x and y) and assume\nwithout loss of generality that a < b < c. Let a(m)x, i.e., f(x) = [f(a\u2212), f(a\u2212) + 1]\nand y(m)c; i.e., f(y) = [f(c\u2212) \u2212 1, f(c\u2212)]. It is straightforward to verify that this\nconstruction satisfies all constraints.\nCase 5. {(mm\u22121), (mm\u22121o)}.\nThe constraints x(mm\u22121)x\u2032, y(omm\u22121)x, y(o\u22121mm\u22121)x\u2032 are satisfiable if and\nonly if x(o\u22121)y. The constraints x(o)x\u2032, y(o)x\u2032 are satisfiable if and only if x(\u2261 oo\u22121)y.\nThe constraints x(\u2261 oo\u22121)y, x\u2032(\u2261 oo\u22121)x, x\u2032(mm\u22121)y are satisfiable if and only if\nx(oo\u22121)y. Consequently, we can derive (mm\u22121) and (oo\u22121); continue as in Case 4.\nCase 6. {(mm\u22121), (pmm\u22121o)}.\nThe constraints x(mm\u22121)x\u2032, y(pmm\u22121o)x, y(p\u22121mm\u22121o\u22121)x\u2032 are satisfiable if\nand only if x(o\u22121)y. Continue as in Case 5.\nCase 7. {(mm\u22121), (pmm\u22121o\u22121)}.\nThe constraints x(mm\u22121)x\u2032, y(pmm\u22121o\u22121)x, y(pmm\u22121o\u22121)x\u2032 are satisfiable if\nand only if y(pm)x. The relation (m) = (pm) \u2229 (p\u22121mm\u22121o).\nThe constraints a(m)b(m)c(m)d, a(pm)x, y(pm)d are satisfiable if and only if\nx(\u2261 mm\u22121oo\u22121)y. Hence, we can derive the relation (pmm\u22121o\u22121)\u2229 (\u2261 mm\u22121oo\u22121) =\n(mm\u22121o\u22121), and NP-completeness follows from Case 5.\n3.3. Classification of complexity. The classification proof splits into 8 lem-\nmas. In each lemma, it is proved that if a subalgebra S which is closed under deriva-\n1This problem is also known as the Total ordering problem [31].\nCONSTRAINTS ON INTERVALS AND LENGTHS 471\ntions with lengths satisfies a certain condition, then either S is contained in one of\nthe 10 tractable subalgebras, or some lemma from section 3.2 can be applied to some\nsubset of S, or S satisfies the conditions of one of the previous lemmas. It is easy\nto verify that the assumptions of these 8 lemmas are exhaustive (note that, due to\nclosedness under derivations with lengths, a subalgebra containing r \u222a (\u2261), where\nr \u2286 (dsf), also contains r itself).\nWe can assume without loss of generality that each subalgebra S contains the total\nrelation (the union of all basic relations), since we always allow pairs of variables to\nbe unrelated. For each basic relation b of A, we will write rb to denote the least\nrelation r \u2208 S such that (b) \u2286 r, i.e., the intersection of all r \u2208 S with this property.\n(Obviously, the relations rb depend on S; however, S will always be clear from the\ncontext.)\nWe use the relations of the form rb in the algebraic proofs below to show that S\nis contained in one or another subalgebra. For example, suppose we know that the\nrelation (p) is contained in ro. Then any relation r \u2208 S such that (o) \u2286 r satisfies also\n(p) \u2286 r. To see this, note that if there is r1 \u2208 S such that (o) \u2286 r, but (p) \u0004\u2286 r, then\n(o) \u2286 r1\u2229ro and r1\u2229ro is strictly contained in ro, which contradicts the definition of\nro. By a similar argument, if we know that (p) is contained in all of rm, ro, rd, and\nrs, then we can conclude that, for every r \u2208 S, (p) \u2286 r whenever r \u2229 (pmods) \u0004= \u2205,\nwhich means that S \u2286 Ep.\nLemma 3.14. Suppose S contains a nontrivial relation r \u2286 (\u2261 pp\u22121mm\u22121oo\u22121).\nThen either S is contained in one of Co, Sp, Ep, and H or else Al-sat(S) is NP-\ncomplete.\nProof.\nCase 1. r \u2286 (\u2261 pp\u22121mm\u22121).\nIf S is contained in one of Sp, Ep, and H, then Al-sat(S) is tractable by Propo-\nsition 3.3. Otherwise let S = {r1, . . . , rn\u22121} and rn = r \\ (\u2261) and apply Theorem 2.2\nand Lemma 3.10(1) with r1, . . . , rn to obtain NP-completeness of Al-sat(S).\nCase 2. r \u2229 (oo\u22121) = (o).\nIf r\u2217 \u0004\u2286 (\u2261), then the previous case applies. Assume that r\u2217 \u2286 (\u2261). If r \u0004\u2286\n(\u2261 pmo), then using Lemma 3.10(1) one can show that Al-sat({r}) is NP-complete.\nIf (o) \u2286 r \u2286 (\u2261 pmo), then the constraints {xrz, zry; l(x)+ l(y) < l(z)} are satisfiable\nif and only if x(p)y. Therefore (p) \u2208 S, and we go back to the first case.\nCase 3. (oo\u22121) \u2286 r.\nWe may now assume that r is symmetric. We shall prove that either S is contained\nin one of Co, Sp, and Ep or else Al-sat(S) is NP-complete. Assume that S \u0004\u2286 Co; that\nis, there is r\u2032 \u2208 S such that (oo\u22121) \u0004\u2286 r\u2032. If r \u2229 r\u2032 \u0004\u2286 (\u2261), then we obtain the required\nresult by Cases 1 and 2. Therefore we may assume that r \u2229 r\u2032 is either \u2205 or (\u2261) for\nevery r\u2032 \u2208 S such that (oo\u22121) \u0004\u2286 r\u2032.\nIt now follows from Theorem 2.2 and Lemma 3.10(1) that if S is not contained in\none of So, Eo, Sp, and Ep, then Al-sat(S) is NP-complete. If S is contained in Sp or\nin Ep, then, by Proposition 3.3, Al-sat(S) is tractable. Suppose S is contained in So\nor in Eo but neither in Sp nor in Ep. Then S contains a nontrivial symmetric relation\nr\u2032\u2032 such that (oo\u22121) \u2286 r\u2032\u2032 \u2286 (\u2261 mm\u22121oo\u22121). Also, r\u2032 must be a nontrivial subrelation\nof (\u2261 ss\u22121) or of (\u2261 ff\u22121). We consider only the first case; the second is dual. Assume\nwithout loss of generality that (s) \u2286 r\u2032. Then the constraints {xr\u2032y; l(x) < l(y)} are\nsatisfiable if and only if x(s)y. Therefore (s) \u2208 S. Since (r\u2032\u2032 \u25e6 (s))\u2217 = (oo\u22121) \u2208 S, the\nproblem Al-sat(S) is NP-complete by Lemma 3.11.\nLemma 3.15. Suppose S contains a nontrivial relation r such that r\u2217 \u2286 (\u2261) and\n472 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nneither r nor r\u22121 is contained in (\u2261 dsf). Then either S is contained in one of Co,\nSp, Ep, and H or else Al-sat(S) is NP-complete.\nProof. If neither r \\ (\u2261) nor r\u22121 \\ (\u2261) is contained in one of (pmod\u22121sf\u22121),\n(pmod\u22121s\u22121f\u22121), (pmodsf), or (pmodsf\u22121), then A-sat({r \\ (\u2261)}) is NP-complete by\nTheorem 2.2, and we get the required result by Lemma 3.10(1).\nSuppose now that r \\ (\u2261) is contained in one of the four relations above. Then\n(taking r \u25e6 r \u25e6 r instead of r if needed) r can be chosen so that it satisfies one of the\nfollowing conditions:\n1. r \u2286 (\u2261 pmos);\n2. r \u2286 (\u2261 pmof\u22121);\n3. (pmosf\u22121) \u2286 r \u2286 (\u2261 pmosf\u22121);\n4. (pmods) \u2286 r;\n5. (pmod\u22121f\u22121) \u2286 r.\nNote that conditions 1 and 2 and conditions 4 and 5 are dual. Therefore it is\nsufficient to consider only conditions 1, 3, and 4.\nSuppose condition 1 holds. Then, by assumption, r \u0004\u2286 (\u2261 s). Now it can be\nchecked that the constraints {xrz, zry; l(x) > l(z)} are satisfiable if and only if xr\u2032y\nfor some nontrivial r\u2032 \u2208 A such that r\u2032 \u2286 (pmo). Then we apply Lemma 3.14.\nSuppose condition 3 holds. Then the constraints {xrz, zry; l(x) < l(z), l(z) >\nl(y)} are satisfiable if and only if x(pmo)y. Therefore we again apply Lemma 3.14.\nSuppose condition 4 holds. If (\u2261) \u2286 r, then the constraints {xrz, zry; l(x) > l(z)}\nare satisfiable if and only if x(\u2261 pmods)y. Similarly, if (\u2261) \u0004\u2286 r, then the constraints\n{xrz, zry; l(x) > l(z)} are satisfiable if and only if x(pmods)y. Therefore a relation\nr1 \u2208 A with (pmods) \u2286 r1 \u2286 (\u2261 pmods) belongs to S.\nIf S contains a nontrivial relation r2 \u2286 r1 such that (d) \u0004\u2286 r2, then either r2\nsatisfies condition 1 (and then we get the required result) or r2 is one of (s), (\u2261 s). In\nthe latter case the constraints {xr2y; l(x) < l(y)} are satisfiable if and only if x(s)y. So\nwe have (s) \u2208 S. Then the constraints {x(s)z, zr1y; l(x) + l(y) = l(z)} are satisfiable\nif and only if x(p)y. So we have (p) \u2208 S, and we can apply Lemma 3.14.\nFrom now on in this proof we assume that every nontrivial r2 \u2208 S such that\nr2 \u2286 r1 satisfies (d) \u2286 r2. It now follows that, for every r \u2208 S, r \u2229 (pmods)\u00b11 \u0004= \u2205\nimplies (d)\u00b11 \u2286 r. In other words, we have S \u2286 Ed.\nIf (p) \u2286 rd, then, for every r \u2208 S, r \u2229 (pmods)\u00b11 \u0004= \u2205 also implies (pd)\u00b11 \u2286 r,\nwhich means that S \u2286 Ep, and we get the required result. If (o) \u2286 rd, then, for every\nr \u2208 S, r \u2229 (pmods)\u00b11 \u0004= \u2205 also implies (od)\u00b11 \u2286 r, and then it is easy to check that\nS \u2286 H.\nAssume that rd \u2286 (\u2261 mds). If (m) \u2286 rd, then it can be checked that the\nconstraints {zrdx, zrdy; l(z) > l(y) > l(x)} are satisfiable if and only if x(s)y. It is\nproved above that, in the presence of r1 and (s), the required result holds.\nNow we may assume that (d) \u2286 rd \u2286 (\u2261 ds). Then rd is either (d) or (ds) because\n(\u2261) can be removed by adding the constraint l(x) < l(y).\nAssume now that S \u0004\u2286 H. It is easy to see that every relation in S satisfies\ncondition 1 of H. If there is r3 \u2208 S failing to satisfy condition 3 of H, then r4 = r3\u2229r1\nsatisfies r4 \u2286 (pmds) and r4 \u2229 (pm) \u0004= \u2205. Then the constraints {xrdz, zr4y; l(z) >\nl(y)} are satisfiable if and only if x(p)y. Hence we have (p) \u2208 S, and we can apply\nLemma 3.14.\nFinally, assume that every r \u2208 S satisfies conditions 1 and 3 of H, but some\nr5 \u2208 S fails to satisfy condition 2 of H. We can assume that r5 \u2229 (ds) \u0004= \u2205 and\nr5 \u2229 (d\u22121f\u22121) \u0004= \u2205, but (o) \u0004\u2286 r5. Let \u03bd = (\u2261 oo\u22121dd\u22121ss\u22121ff\u22121). Since \u03bd = r\u22121d \u25e6 rd\nCONSTRAINTS ON INTERVALS AND LENGTHS 473\nbelongs to S, we may assume that r5 \u2286 \u03bd; otherwise replace r5 by r5 \u2229 \u03bd. Note that\n(d) \u2286 r5.\nIf (o\u22121) \u2286 r5, then (d\u22121) \u2286 r5 because (d) \u2286 ro. Then the constraints in the set\n{xr\u22175y; l(x) \u0004= l(y)} are satisfiable if and only if xr6y, where r6 \u2208 A is a symmetric\nrelation such that (dd\u22121) \u2286 r6 \u2286 (dd\u22121ss\u22121ff\u22121). We have (pmods) = r1 \u25e6 rd \u2208 S. It\nfollows from Theorem 2.2 that A-sat({r6, (pmo)}) is NP-complete. Then Al-sat(S)\nis NP-complete by Lemma 3.10(2).\nLet (o\u22121) \u0004\u2286 r5. If (d\u22121) \u2286 r5, then the argument is as above. Otherwise we\nhave (df\u22121) \u2286 r5 \u2286 (\u2261 dsff\u22121) (note that (s\u22121) \u0004\u2286 r5 because S \u2286 Ed). Then the\nconstraints in the set {xr5y; l(x) > l(y)} are satisfiable if and only if x(f\u22121)y. We\nmay then assume that (f) \u2208 S. It follows that the relations (ods) = (f\u22121) \u25e6 rd and\n(\u2261 dff\u22121) = (f) \u25e6 r5 both belong to S, and therefore (d) = rd \u2229 (\u2261 dff\u22121) \u2208 S. It\nfollows from Theorem 2.2 that A-sat({(o), (d), (f), (\u2261 dff\u22121)}) is NP-complete. Since\n(ods) \u2208 S, we conclude that Al-sat(S) is NP-complete by Lemma 3.10(2).\nLemma 3.16. If S contains two nontrivial relations r1 and r2 such that r1\u2229 r2 \u2286\n(\u2261) and r1, r2 \u2286 (\u2261 dsf), then either S \u2286 H or else Al-sat(S) is NP-complete.\nProof. We may assume that (\u2261) \u0004\u2286 r1, r2 because it can be removed by adding the\nconstraint l(x) < l(y). If r1 = (d) and r2 = (sf), then A-sat({r1, r2}) is NP-complete\nby Theorem 2.2.\nIn all other cases r1\u25e6r\u221212 (or its converse) satisfies the assumptions of Lemma 3.15\nor Lemma 3.16. It remains to notice that {r1, r2} is not contained in one of Co, Sp,\nEp.\nLemma 3.17. If S contains two nontrivial symmetric relations r1 and r2 such\nthat r1 \u2229 r2 \u2286 (\u2261), then either S is contained in one of Sp, Ep, H or else Al-sat(S)\nis NP-complete.\nProof. We may assume that r1 and r2 are minimal (with respect to inclusion)\namong nontrivial symmetric relations.\nIt follows from Theorem 2.2 that if none of r1, r2 is contained in one of (\u2261 ss\u22121),\n(\u2261 ff\u22121), then A-sat(S) (and, consequently, Al-sat(S)) is NP-complete.\nWe shall consider only the case r1 \u2286 (\u2261 ss\u22121); the case r1 \u2286 (\u2261 ff\u22121) is dual.\nThen we may assume that (ss\u22121) \u2208 S and (s) \u2208 S because these constraints are\nequivalent to {xr1y; l(x) \u0004= l(y)} and {xr1y; l(x) < l(y)}, respectively. If r2 \u2286 (\u2261\ndd\u22121ff\u22121), then, by imposing the constraint l(x) < l(y), we can obtain a nonempty\nsubrelation of (df), and we can apply Lemma 3.16. We therefore may assume that\nr2\u2229(pp\u22121mm\u22121oo\u22121) \u0004= \u2205. Now it follows from minimality of r2 and from Theorem 2.2\nthat if A-sat(S) is not NP-complete, then either S \u2286 H or every relation r \u2208 S such\nthat r\u2217 \u0004\u2286 (\u2261 ss\u22121) satisfies r2 \u2286 r.\nIt can be easily checked that if (dd\u22121) \u0004\u2286 r2, then either r2 \u2286 (\u2261 mm\u22121) or\nr3 = ((s) \u25e6 r2)\u2217 is nonempty and satisfies r3 \u2286 (pp\u22121mm\u22121oo\u22121). In the former\ncase Al-sat({r2}) is NP-complete by Lemma 3.10(1). In the latter case we apply\nLemma 3.14.\nFurther, let (dd\u22121) \u2286 r2. Suppose some nontrivial relation r3 \u2208 S is strictly\ncontained in r2. Then, by the choice of r2, we have r\n\u2217\n3 \u2286 (\u2261), and, since S \u0004\u2286 Co, we\ncan apply Lemma 3.15 or Lemma 3.16.\nNow we may assume that, for every r \u2208 S such that r\u2229 r2 \u0004= \u2205, we have (dd\u22121) \u2286\nr2 \u2286 r.\nIt can now be checked using Theorem 2.2 that if A-sat(S) is not NP-complete,\nthen S is contained in one of Sp, Sd, and H. Suppose that S \u0004\u2286 Sp and S \u0004\u2286 H, since\notherwise there is nothing to prove. Then S \u2286 Sd, and for every relation r \u2208 S such\n474 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nthat r \u0004\u2286 (\u2261 ss\u22121), we have (dd\u22121) \u2286 r2 \u2286 r. If r2 contains (pp\u22121) or (oo\u22121), then S\nis contained in Sp or H, which contradicts the assumptions just made. Otherwise we\nhave (mm\u22121dd\u22121) \u2286 r2 \u2286 (\u2261 mm\u22121dd\u22121ff\u22121). Hence ((s) \u25e6 r2)\u2217 = (mm\u22121dd\u22121) \u2208 S.\nBy minimality, it follows that r2 = (mm\n\u22121dd\u22121). Then Al-sat(S) is NP-complete by\nLemma 3.12.\nLemma 3.18. If (s) \u2208 S or (f) \u2208 S then either S is contained in one of the 10\nsubalgebras listed in Theorem 3.1 or else Al-sat(S) is NP-complete.\nProof. We consider only the case (s) \u2208 S; the other case is dual.\nBy Lemmas 3.15 and 3.16, we may assume that, for every nontrivial r \u2208 S such\nthat r\u2217 \u2286 (\u2261), we have either (s) \u2286 r \u2286 (dsf) or (s) \u2286 r\u22121 \u2286 (dsf). We may\nalso assume that (ss\u22121) \u2208 S because the constraints {x(s)z, z(s)y; l(x) \u0004= l(y)} are\nsatisfiable if and only if x(ss\u22121)y.\nSuppose that S \u0004\u2286 Ds. Then there exists a relation r1 \u2208 S such that r1 \u2229\n(pp\u22121mm\u22121oo\u22121) \u0004= \u2205, but (\u2261 ss\u22121) \u0004\u2286 r1. If (\u2261) \u2286 r1, then we can apply ei-\nther Lemma 3.15 with r1 or Lemma 3.17 with {r\u22171 , (ss\u22121)}. So we may now as-\nsume that (\u2261) \u0004\u2286 r1. It can be checked that there is a nontrivial r2 \u2208 A such that\n{ur1v, u(s)x, v(s)y; l(u) = l(v)} is satisfiable if and only if xr2y. Then r2 \u2208 S. More-\nover, we have (\u2261 ss\u22121) \u2229 r2 = \u2205. If r2 satisfies r\u22172 \u2286 (\u2261), then we apply Lemma 3.15\nor Lemma 3.16. Otherwise {r\u22172 , (ss\u22121)} \u2286 S, and we get the required result by\nLemma 3.17.\nLemma 3.19. If (sf) \u2208 S, then either S \u2286 Ds or S \u2286 Df or else Al-sat(S) is\nNP-complete.\nProof. We have (dsf) = (sf) \u25e6 (sf) \u2208 S. We may assume that neither (s) nor\n(f) belong to S; otherwise we obtain the result by Lemma 3.18, since, out of the 10\nsubalgebras, (sf) is contained only in Ds and in Df. It now follows that (dsf)\u00b11\u2229r \u0004= \u2205\nimplies (sf)\u00b11 \u2286 r for any r \u2208 S.\nSuppose that S is not contained in Ds. Then there is r1 \u2208 S such that (\u2261 ss\u22121) \u0004\u2286\nr1 and r1 \u2229 (pp\u22121mm\u22121oo\u22121) \u0004= \u2205. Assume that (\u2261) \u2286 r1. If (ss\u22121)\u2229 r1 = \u2205, then, by\nthe previous paragraph, we have r1 \u2286 (\u2261 pp\u22121mm\u22121oo\u22121), and we apply Lemma 3.14.\nAssume now that (ss\u22121)\u2229 r1 = (s). Then r1 \u2286 (\u2261 pp\u22121mm\u22121oo\u22121dsf). Now we apply\nLemma 3.14 if r\u22171 \u0004\u2286 (\u2261) and Lemma 3.15 otherwise.\nNow assume that (\u2261) \u0004\u2286 r1 and r1 \u2229 (pp\u22121mm\u22121oo\u22121) \u0004= \u2205. If there is such\nan r1 with the additional property that r1 \u2229 (oo\u22121) = \u2205, then the set of constraints\n{x(sf)u, ur1v, y(sf)v; l(u) = l(v)} is satisfiable if and only if xr\u2032y, where r\u2032 \u2208 A is some\nnontrivial relation such that r\u2032 \u2286 (pp\u22121mm\u22121). Then we can apply Lemma 3.14.\nSuppose r1 \u2229 (oo\u22121) \u0004= \u2205. We have (\u2261 oo\u22121ss\u22121ff\u22121) = (s\u22121f\u22121) \u25e6 (sf) \u2208 S.\nConsider r2 = r1 \u2229 (\u2261 oo\u22121ss\u22121ff\u22121). If r2 \u2286 (oo\u22121), then A-sat({(sf), r2}) is NP-\ncomplete by Theorem 2.2. Otherwise (ss\u22121ff\u22121) \u2286 r2, and we have either r2 =\n(oss\u22121ff\u22121) or r2 = (oo\u22121ss\u22121ff\u22121). In both cases Al-sat({(sf), r2}) is NP-complete\nby Lemma 3.11.\nLemma 3.20. If there is r \u2208 S such that (d) \u2286 r \u2286 (dsf), then either S is\ncontained in one of the 10 subalgebras listed in Theorem 3.1 or else Al-sat(S) is\nNP-complete.\nProof. Note that \u03bd = (\u2261 oo\u22121dd\u22121ss\u22121ff\u22121) = r\u22121 \u25e6 r \u2208 S.\nWe may assume that every r \u2208 S such that r\u2217 \u2286 (\u2261) satisfies (d) \u2286 r \u2286 (\u2261 dsf)\nor (d) \u2286 r\u22121 \u2286 (\u2261 dsf); otherwise we apply Lemmas 3.15, 3.18, or 3.19. It follows, in\nparticular, that no nontrivial subrelation of (\u2261 ss\u22121ff\u22121) belongs to S.\nSuppose that there exists r1 \u2208 S such that r1 \u2229 (pp\u22121mm\u22121oo\u22121) \u0004= \u2205, but\n(dd\u22121) \u0004\u2286 r1. If r\u22171 \u2286 (\u2261), then we can apply Lemma 3.15 with r1. Otherwise r\u22171 is\nCONSTRAINTS ON INTERVALS AND LENGTHS 475\na symmetric nontrivial relation satisfying (dd\u22121) \u2229 r\u22171 = \u2205. If r1 \u2286 (\u2261 pp\u22121mm\u22121),\nthen we can apply Lemma 3.14. Otherwise the relation r2 = \u03bd \u2229 r\u22171 \u2208 S is nontrivial\nand satisfies r2 \u2286 (\u2261 oo\u22121ss\u22121ff\u22121). We have (oo\u22121) \u2286 r2 and r2 \u2229 r = \u2205, since\nno subrelation of (sf) belongs to S. Now it is easy to verify that A-sat({r2, r}) is\nNP-complete, by Theorem 2.2.\nFrom now on (in this proof) we may assume that, for every r \u2208 S, whenever\nr \u2229 (pp\u22121mm\u22121oo\u22121) \u0004= \u2205 we have (dd\u22121) \u2286 r. It now follows that condition 1 of Dd\nand D\u2032d is satisfied in S.\nSuppose there is r2 \u2208 S such that r2\u2229(pp\u22121mm\u22121) \u0004= \u2205, but r2\u2229(\u2261 oo\u22121) = \u2205. It\nis easy to check that there exists a nontrivial r3 \u2208 A with r3 \u2286 (pp\u22121mm\u22121) such that\n{ur2v, xru, yrv; l(u) = l(v)} is satisfiable if and only if xr3y (the relation r3 depends\non r and r2). Then r3 \u2208 S, and we can apply Lemma 3.14.\nFrom now on (in this proof) we may also assume that, for every r \u2208 S, r \u2229\n(pp\u22121mm\u22121) \u0004= \u2205 implies r \u2229 (\u2261 oo\u22121) \u0004= \u2205.\nWe know that ro \u2286 \u03bd. If (\u2261) \u2286 ro, then it is easy to check that S \u2286 Dd.\nSuppose ro \u2229 (\u2261 oo\u22121) = (o) and S \u0004\u2286 D\u2032d. Then there is r4 \u2208 S such that\nr4 \u2229 (pm) \u0004= \u2205, but (o) \u0004\u2286 r4. Then there exists a nontrivial r5 \u2208 A with r5 \u2286 (pm)\nsuch that the constraints\n{uroz, zrov, ur4v, xru, yrv; l(u) = l(z) = l(v)}\nare satisfiable if and only if xr5y. Then r5 \u2208 S, and we can apply Lemma 3.14.\nIt remains to consider the case ro \u2229 (\u2261 oo\u22121) = (oo\u22121). Then every r6 \u2208 S such\nthat r6 \u2229 (oo\u22121) = \u2205, but r6 \u2229 (pp\u22121mm\u22121) \u0004= \u2205 satisfies (\u2261) \u2286 r6.\nIf there is such r6 with r6\u2229 (pp\u22121) \u0004= \u2205, then there exists a nontrivial r7 \u2208 A with\nr7 \u2286 (pp\u22121mm\u22121) such that the constraints\n{uroz, zr6v, ur6v, xru, yrv; l(u) = l(z) = l(v)}\nare satisfiable if and only if xr7y. Then r7 \u2208 S, and we can apply Lemma 3.14.\nNow we may assume that every r \u2208 S with r\u2229(pp\u22121) \u0004= \u2205 also satisfies (oo\u22121) \u2286 r.\nSuppose S \u0004\u2286 D\u2032d. Then there is r8 \u2208 S such that (m) \u2286 r8 and r8 \u2229 (\u2261 pp\u22121oo\u22121) =\n(\u2261). Moreover, every r \u2208 S such that r\u2229(mm\u22121) \u0004= \u2205 satisfies (\u2261) \u2286 r, since otherwise\nwe can obtain a relation r9(= r \u2229 r8) such that r9 \u2229 (\u2261 pp\u22121mm\u22121oo\u22121) is nonempty\nand is contained in (mm\u22121), a contradiction.\nNow either S \u2286 D\u2032\u2032d or else there is r10 \u2208 S such that (poo\u22121) \u2286 r10 and (\u2261) \u0004\u2286 r10.\nIn the latter case, again, there exists a relation r11 \u2208 A with r11 \u2286 (pp\u22121mm\u22121) such\nthat the constraints\n{ur10z, zr\u221218 v, ur8v, xru, yrv; l(u) = l(z) = l(v)}\nare satisfiable if and only if xr11y. Then r11 \u2208 S and we can apply Lemma 3.14.\nLemma 3.21. If there is a symmetric nontrivial relation r\u2032 \u2208 S such that every\nnontrivial r \u2208 S satisfies r\u2032 \u2286 r, then either S is contained in one of the 10 subalgebras\nlisted in Theorem 3.1 or else Al-sat(S) is NP-complete.\nProof. If r\u2032 contains (pp\u22121), or (oo\u22121), or (\u2261 dd\u22121), or (\u2261 ss\u22121), or (\u2261 ff\u22121), then\nS is contained in Sp, or Co, or Dd, or Ds, or Df, respectively. If r\u2032 \u2286 (dd\u22121ss\u22121ff\u22121),\nthen we can obtain an asymmetric relation in S which contradicts the assumption of\nthis step. If r\u2032 = (\u2261 mm\u22121), then Al-sat({r\u2032}) is NP-complete by Example 3.1.\nFrom now on (in this proof) we assume that all nontrivial r \u2208 S satisfy the\ncondition that (mm\u22121ss\u22121ff\u22121) \u2286 r; otherwise one of the earlier cases applies. If every\n476 ANDREI KROKHIN, PETER JEAVONS, AND PETER JONSSON\nnontrivial r \u2208 S satisfies (\u2261 mm\u22121ss\u22121ff\u22121) \u2286 r, then S \u2286 Ds. Suppose that there\nis r1 \u2208 S such that (\u2261) \u0004\u2286 r1. Then r1 \u2229 (\u2261 pp\u22121mm\u22121oo\u22121) \u2286 (pp\u22121mm\u22121oo\u22121).\nIf, for all r \u2208 S, (pp\u22121) \u2286 r or, for all r \u2208 S, (oo\u22121) \u2286 r, then S \u2286 Sp or S \u2286 Co,\nrespectively. Else, we can choose r1 so that r1 \u2229 (\u2261 pp\u22121mm\u22121oo\u22121) = (mm\u22121). Now\nit is not hard to check that either S \u2286 Cm or else there is r2 \u2208 S such that the system\n{r1, r2} satisfies the conditions of Lemma 3.13.\nClassification is complete. Theorem 3.1 is proved.\n4. Conclusion. In this paper we have given a complete classification of the\ncomplexity of interval satisfiability problems with very general length restrictions.\nOur main result, Theorem 3.1, determines the complexity of Al-sat(F) for every\npossible subset F \u2286 A.\nTo conclude, we note that our NP-completeness proofs use only a very restricted\nsubset of the allowable length constraints. In fact, we use constraints on lengths only\nof the following forms:\n(i) comparing l(x) + l(y) with l(z),\n(ii) comparing l(x) and l(y),\n(iii) comparing l(x) with a given number.\nIt follows that the NP-complete fragments of Al-sat remain NP-complete even if we\nallow only these very limited forms of Horn DLRs to specify length constraints. This\nprompts us to make the following conjecture.\nConjecture 4.1. All NP-complete cases of Al-sat remain NP-complete if we\nallow fixing individual interval lengths as the only form of constraints on lengths.\nIn fact, we suggest that an even stronger result may be true: it may be that in\nall cases where imposing restrictions on interval lengths causes intractability, simply\nrequiring all intervals to have the same length will already be intractable.\nProblem 4.1. Do all NP-complete cases of Al-sat remain NP-complete if we\nsearch only for models with all intervals of the same length?\nREFERENCES\n[1] J. Allen, Maintaining knowledge about temporal intervals, Comm. ACM, 26 (1983), pp. 832\u2013\n843.\n[2] O. Angelsmark and P. Jonsson, Some observations on durations, scheduling and Allen\u2019s\nalgebra, in Proceedings of the 6th Conference on Constraint Programming (CP\u201900), Lecture\nNotes in Comput. Sci. 1894, Springer-Verlag, Berlin, 2000, pp. 484\u2013488.\n[3] F. Barber, Reasoning on interval and point-based disjunctive metric constraints in temporal\ncontexts, J. Artificial Intelligence Res., 12 (2000), pp. 35\u201386.\n[4] A. Carrano, Establishing the order of human chromosome-specific DNA fragments, in Biotech-\nnology and the Human Genome: Innovations and impact, Basic Life Sciences 46, A. Wood-\nhead and B. Barnhart, eds., Plenum Press, London, New York, 1988, pp. 37\u201350.\n[5] D. Corneil, H. Kim, S. Natarajan, S. Olariu, and A. Sprague, Simple linear time recog-\nnition of unit interval graphs, Inform. Process. Lett., 55 (1995), pp. 99\u2013104.\n[6] N. Creignou, S. Khanna, and M. Sudan, Complexity Classification of Boolean Constraint\nSatisfaction Problems, SIAM Monogr. Discrete Math. Appl. 7, SIAM, Philadelphia, 2001.\n[7] T. Drakengren and P. Jonsson, Eight maximal tractable subclasses of Allen\u2019s algebra with\nmetric time, J. Artificial Intelligence Res., 7 (1997), pp. 25\u201345.\n[8] T. Drakengren and P. Jonsson, A complete classification of tractability in Allen\u2019s algebra\nrelative to subsets of basic relations, Artificial Intelligence, 106 (1998), pp. 205\u2013219.\n[9] S. Fortune, J. Hopcroft, and J. Wyllie, The directed subgraph homeomorphism problem,\nTheoret. Comput. Sci., 10 (1980), pp. 111\u2013121.\n[10] C. Gabor, K. Supowit, and W. Hsu, Recognizing circle graphs in polynomial time, J. Assoc.\nComput. Mach., 36 (1989), pp. 435\u2013473.\n[11] M. Garey and D. Johnson, Computers and Intractability: A Guide to the Theory of NP-\nCompleteness, Freeman, New York, 1979.\nCONSTRAINTS ON INTERVALS AND LENGTHS 477\n[12] P. Goldberg, M. Golumbic, H. Kaplan, and R. Shamir, Four strikes against physical\nmapping of DNA, Journal of Computational Biology, 2 (1995), pp. 139\u2013152.\n[13] M. Golumbic, H. Kaplan, and R. Shamir, On the complexity of DNA physical mapping,\nAdv. Appl. Math., 15 (1994), pp. 251\u2013261.\n[14] M. Golumbic, H. Kaplan, and R. Shamir, Graph sandwich problems, J. Algorithms, 19\n(1995), pp. 449\u2013473.\n[15] M. Golumbic and E. Scheinerman, Containment graphs, posets and related classes of graphs,\nin Proceedings of the 3rd International Conference on Combinatorial Mathematics, Ann.\nNew York Acad. Sci. 555, New York Acad. Sci., New York, 1989, pp. 192\u2013204.\n[16] M. Golumbic and R. Shamir, Complexity and algorithms for reasoning about time: A graph-\ntheoretic approach, J. Assoc. Comput. Mach., 40 (1993), pp. 1108\u20131133.\n[17] P. Hell and J. Nes\u02c7etr\u02c7il, On the complexity of H-coloring, J. Combin. Theory Ser. B, 48\n(1990), pp. 92\u2013110.\n[18] W.-L. Hsu, A simple test for interval graphs, in Proceedings of the 18th International Workshop\non Graph-Theoretic Concepts in Computer Science, Lecture Notes in Comput. Sci. 657,\nW.-L. Hsu and R. Lee, eds., Springer-Verlag, Berlin, 1992, pp. 11\u201316.\n[19] P. Jeavons, On the algebraic structure of combinatorial problems, Theoret. Comput. Sci., 200\n(1998), pp. 185\u2013204.\n[20] P. Jonsson and C. Ba\u00a8ckstro\u00a8m, A unifying approach to temporal constraint reasoning, Arti-\nficial Intelligence, 102 (1998), pp. 143\u2013155.\n[21] R. Karp, Mapping the genome: Some combinatorial problems arising in molecular biology, in\nProceedings of the 25th Symposium on the Theory of Computing (STOC\u201993), San Diego,\nCA, 1993, ACM, New York, 1993, pp. 278\u2013285.\n[22] H. Kautz and P. Ladkin, Integrating metric and qualitative temporal reasoning, in Proceed-\nings of the Ninth National Conference on Artificial Intelligence (AAAI\u201991), Anaheim, CA,\n1991, pp. 241\u2013246.\n[23] L. Kirousis and P. Kolaitis, The complexity of minimal satisfiability problems, in Proceedings\nof the 18th Symposium on Theoretical Aspects of Computer Science (STACS 2001), Lecture\nNotes in Comput. Sci. 2010, Springer-Verlag, Berlin, 2001, pp. 407\u2013418.\n[24] M. Koubarakis, Tractable disjunctions of linear constraints: Basic results and applications\nto temporal reasoning, Theoret. Comput. Sci., 266 (2001), pp. 311\u2013339.\n[25] A. Krokhin, P. Jeavons, and P. Jonsson, Reasoning about temporal relations: The tractable\nsubalgebras of Allen\u2019s interval algebra, J. ACM, 50 (2003), pp. 591\u2013640.\n[26] R. Ladner, On the structure of polynomial time reducibility, J. Assoc. Comput. Mach., 22\n(1975), pp. 155\u2013171.\n[27] H. Maurer, J. Sudborough, and E. Welzl, On the complexity of the general coloring prob-\nlem, Inform. and Control, 51 (1981), pp. 128\u2013145.\n[28] I. Meiri, Combining qualitative and quantitative constraints in temporal reasoning, Artificial\nIntelligence, 87 (1996), pp. 343\u2013385.\n[29] U. Montanari, Networks of constraints: Fundamental properties and applications to picture\nprocessing, Information Sci., 7 (1974), pp. 95\u2013132.\n[30] B. Nebel and H.-J. Bu\u00a8rckert, Reasoning about temporal relations: A maximal tractable\nsubclass of Allen\u2019s interval algebra, J. Assoc. Comput. Mach., 42 (1995), pp. 43\u201366.\n[31] J. Opatrny, Total ordering problem, SIAM J. Comput., 8 (1979), pp. 111\u2013114.\n[32] I. Pe\u2019er and R. Shamir, Realizing interval graphs with size and distance constraints, SIAM\nJ. Discrete Math., 10 (1997), pp. 662\u2013687.\n[33] I. Pe\u2019er and R. Shamir, Satisfiability problems on intervals and unit intervals, Theoret. Com-\nput. Sci., 175 (1997), pp. 349\u2013372.\n[34] T. Schaefer, The complexity of satisfiability problems, in Proceedings of the 10th Symposium\non the Theory of Computing (STOC\u201978), San Diego, CA, 1978, ACM, New York, 1978,\npp. 216\u2013226.\n[35] A. Webber, Proof of the interval satisfiability conjecture, Ann. Math. Artificial Intelligence,\n15 (1995), pp. 231\u2013238.\n"}