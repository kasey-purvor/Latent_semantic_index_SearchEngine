{"doi":"10.1534\/genetics.107.071910","coreId":"71516","oai":"oai:eprints.lancs.ac.uk:790","identifiers":["oai:eprints.lancs.ac.uk:790","10.1534\/genetics.107.071910"],"title":"Postprocessing of Genealogical Trees.","authors":["Meligkotsidou, L","Fearnhead, P"],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2007-09","abstract":"We consider inference for demographic models and parameters based upon post-processing the output of an MCMC method that generates samples of genealogical trees (from the posterior distribution for a specific prior distribution of the genealogy). This approach has the advantage of taking account of the uncertainty in the inference for the tree when making inferences about the demographic model; and can be computationally efficient in terms of re-analysing data under a wide variety of models. We consider a (simulation consistent) estimate of the likelihood for variable population size models, which uses importance sampling, and propose two new approximate likelihoods, one for migration models and one for continuous spatial models","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/71516.pdf","fullTextIdentifier":"http:\/\/eprints.lancs.ac.uk\/790\/1\/PostProcess.pdf","pdfHashValue":"3d56c59cf69b77464d821cf8afa55fb43fb5c7d5","publisher":null,"rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:eprints.lancs.ac.uk:790<\/identifier><datestamp>\n      2018-01-24T03:16:46Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      74797065733D61727469636C65<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        Postprocessing of Genealogical Trees.<\/dc:title><dc:creator>\n        Meligkotsidou, L<\/dc:creator><dc:creator>\n        Fearnhead, P<\/dc:creator><dc:description>\n        We consider inference for demographic models and parameters based upon post-processing the output of an MCMC method that generates samples of genealogical trees (from the posterior distribution for a specific prior distribution of the genealogy). This approach has the advantage of taking account of the uncertainty in the inference for the tree when making inferences about the demographic model; and can be computationally efficient in terms of re-analysing data under a wide variety of models. We consider a (simulation consistent) estimate of the likelihood for variable population size models, which uses importance sampling, and propose two new approximate likelihoods, one for migration models and one for continuous spatial models.<\/dc:description><dc:date>\n        2007-09<\/dc:date><dc:type>\n        Journal Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/eprints.lancs.ac.uk\/790\/1\/PostProcess.pdf<\/dc:identifier><dc:relation>\n        http:\/\/dx.doi.org\/10.1534\/genetics.107.071910<\/dc:relation><dc:identifier>\n        Meligkotsidou, L and Fearnhead, P (2007) Postprocessing of Genealogical Trees. Genetics, 177. pp. 347-358. ISSN 1943-2631<\/dc:identifier><dc:relation>\n        http:\/\/eprints.lancs.ac.uk\/790\/<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/dx.doi.org\/10.1534\/genetics.107.071910","http:\/\/eprints.lancs.ac.uk\/790\/"],"year":2007,"topics":[],"subject":["Journal Article","PeerReviewed"],"fullText":"Post-processing of Genealogical Trees\nLoukia Meligkotsidou and Paul Fearnhead\nDepartment of Mathematics and Statistics\nLancaster University\nLancaster, United Kingdom\n1\nRunning Head: Post-processing of Genealogies\nKeywords Infinite sites model, Isolation by Distance, Migration Model, Variable Pop-\nulation size\nCorrespondence: Loukia Meligkotsidou\nDepartment of Mathematics and Statistics\nLancaster University\nLancaster LA1 4YF\nUnited Kingdom\nEmail: l.meligotsidou@lancaster.ac.uk\n2\nABSTRACT\nWe consider inference for demographic models and parameters based upon post-processing\nthe output of an MCMC method that generates samples of genealogical trees (from the\nposterior distribution for a specific prior distribution of the genealogy). This approach\nhas the advantage of taking account of the uncertainty in the inference for the tree when\nmaking inferences about the demographic model; and can be computationally efficient\nin terms of re-analysing data under a wide variety of models. We consider a (simulation\nconsistent) estimate of the likelihood for variable population size models, which uses\nimportance sampling, and propose two new approximate likelihoods, one for migration\nmodels and one for continuous spatial models.\nINTRODUCTION\nThere are two common approaches to analysing population genetic data. The first ap-\nproach involves (i) inferring a genealogical or phylogenetic tree for the data, and (ii)\nmaking inferences about demographic or other parameters conditional on this tree. Ex-\namples of this include inference of the demography (Underhill et al., 2001), nested clade\nanalysis (Templeton et al., 1987) and phylogeographic and spatial analysis (Emerson\nand Hewitt, 2005; French et al., 2005). Often this approach is applied informally, with\nthe qualitative features of the inferred tree being used to suggest plausible demographic\nhistories for the sample (Shen et al., 2000).\nThe second approach involves joint inference of the genealogical tree and the param-\neters. In many cases the genealogical tree is a nuisance parameter, and calculation of\nthe likelihood for the parameters involves integrating out the unknown tree. For ex-\nample, inference about various demographic models under a coalescent prior, including\nvariable population sizes (Griffiths and Tavare\u00b4, 1994a; Kuhner et al., 1998; Drummond\net al., 2005), and population structure (Beerli and Felsenstein, 1999; Bahlo and Grif-\nfiths, 1998); inference for selection (Coop and Griffiths, 2004); dispersal of a population\n(Brooks et al., 2007); and inference for recombination rates (Griffiths and Marjoram,\n1996; Kuhner et al., 2000; Fearnhead and Donnelly, 2002). (In the latter case the\ngenealogical information is contained in a graph, and not a tree.)\nThe advantage of the second approach is that, assuming the model for the genealogical\ntree is reasonable, the uncertainty in this genealogy is correctly incorporated into the\n3\ninference about the parameters of interest. This is particularly important for data where\nthere is considerable uncertainty in the genealogy (which is common for many datasets).\nThe first approach of conditioning on a single estimate of the genealogy can sometimes\nlead to biases in estimates and, more generally, underestimates of the uncertainty in the\nparameters. These problems often mean that analysis conditional on the tree is often\nused primarily to test hypotheses (Templeton et al., 1987; French et al., 2005), rather\nthan for estimating parameters of appropriate models.\nHowever, implementing the second approach is considerably more challenging, and gen-\nerally requires the use of modern computationally-intensive statistical methods (Stephens\nand Donnelly, 2000). In particular this often requires the development of customised\nprograms to analyse the data under the specific model or models of interest, and the\napplication of this approach can be limited by the availability of suitable software.\nIn this paper we consider a new approach, which lies between these two approaches.\nThe basic idea is (i) to perform inference for the genealogical\/phylogenetic tree using a\nsuitable Bayesian approach, obtaining a sample of trees from the posterior; (ii) perform\ninference on the parameters of interest using this sample of trees. The idea is that by\nusing a sample of trees in an appropriate way we can still take account of the uncertainty\nwithin the inference for the tree, but that this approach will be less computationally-\nintensive and more widely applicable than the second approach above.\nWe consider inference under three different demographic models: (a) variable popu-\nlation size; (b) migration between discrete subpopulations; and (c) continuous spatial\nstructure. For (a) we present a simple importance sampling approach that can re-weight\na sample of trees so that the resulting weighted sample approximates the posterior dis-\ntribution of the genealogy under any variable population size model. For (b) and (c)\nwe propose approximate likelihood functions based on specifying a probability model\nfor the population or spatial information of the sample given the genealogy.\nOur aim is to evaluate the potential for this approach of post-processing a sample\nof genealogical trees. As such we focus on the specific case of inference for a non-\nrecombining DNA region with infinite-sites data and known topology. The advantage\nof focussing on this special case is that there exists an algorithm for simulating directly\nfrom the posterior distribution of the coalescence times of the tree, under a specific prior\n(see METHODS). Thus we can focus on the computational and statistical efficiency of\nthe post-processing methods, without any need to take into account the possible effects\n4\nof any inaccuracies in the method for generating the sample of trees. However, in\ntheory the ideas of post-processing can be applied to the output of any MCMC or other\napproach for generating samples of trees from a known posterior distribution.\nMETHODS\nInfinite Sites Data and Phylogenetic Prior\nWe focus on analysing data from m chromosomes sampled from a population. We\nassume we have infinite-sites data from a non-recombining region of the genome, and\nthat the genealogy is known. The infinite-sites data means that we will know the number\nof mutations that have occurred on each branch of the genealogy. Our mutation model\nis that (for our chosen scaling of time) these mutations occur at a constant rate \u03b8\/2\nalong each branch of the genealogy.\nWe assume some labelling of the nodes in the genealogy, and denote by t = (t1, . . . , tm\u22121)\nthe coalescent times for these nodes. We also introduce the notation t\u2032 = (t\u20321, . . . , t\n\u2032\nm\u22121)\nto denote the ordered coalescent times (so t\u20321 < t\n\u2032\n2 < \u00b7 \u00b7 \u00b7 < t\n\u2032\nm\u22121). In the genealogy\nthere are 2(m \u2212 1) branches. The branch lengths, which will be denoted by b =\n(b1, . . . , b2(m\u22121)), and sequence data can be summarised by the number of mutations on\neach branch: n = (n1, . . . , n2(m\u22121)). The branch lengths, b, are uniquely determined\nby the coalescent times, t; and the likelihood of the data, n, can be written as:\np(n|t, \u03b8) =\n2(m\u22121)\u220f\ni=1\n(\n\u03b8\n2\n)ni\nbnii exp{\u2212bi\u03b8\/2}. (1)\nNow we use the pure birth process prior of Rannala and Yang (1996) for the coalescent\ntimes, which assumes that the length of each branch has an exponential distribution\nwith rate \u03c6,\npi1(t|\u03c6) \u221d\nm\u22121\u220f\ni=1\n(m + 1\u2212 i)\u03c6 exp\n{\n(m + 1\u2212 i)\u03c6(t\u2032i \u2212 t\n\u2032\ni\u22121)\n}\n. (2)\nUnder this prior the posterior distribution for t (given \u03c6 and \u03b8) is\np(t|n, \u03b8, \u03c6) \u221d \u03c6m\u22121\n2(m\u22121)\u220f\ni=1\n(\n\u03b8\n2\n)ni\nbnii exp{\u2212(\u03c6 + \u03b8\/2)bi}. (3)\nNote that setting \u03c6 = 0 produces a posterior that is proportional to the likelihood\nfunction.\n5\nBy introducing new variables s = (s1, . . . , sm\u22121), which satisfy si = (\u03c6 + \u03b8\/2)ti we\nobtain\np(s|n, \u03b8, \u03c6) \u221d\n(\n\u03c6\n\u03c6 + \u03b8\/2\n)m\u22121 2(m\u22121)\u220f\ni=1\n(\n\u03b8\/2\n\u03c6 + \u03b8\/2\n)ni\n(b\u2032i)\nni exp(\u2212b\u2032i), (4)\nwhere b\u2032i = (\u03c6 + \u03b8\/2)bi. Fearnhead and Meligkotsidou (2004) show how to draw inde-\npendent and identically distributed (iid) samples from this density, and hence (through\nrescaling) from the posterior (3). Furthermore this gives that the likelihood for \u03c6 is\nproportional to (\n\u03c6\n\u03c6 + \u03b8\/2\n)m\u22121( \u03b8\/2\n\u03c6 + \u03b8\/2\n)n\n, (5)\nwhere n is the total number of mutations.\nVariable Population Size\nConsider a panmictic population of current effective population size N chromosomes,\ntime measured in units of N generations, and let the effective population size at time t\nin the past be N\/\u03bb(t). The distribution for the coalescence times for a random sample\nof m chromosomes from such a population (Griffiths and Tavare\u00b4, 1994a) is\npi2(t|\u03bb(t)) =\nm\u22121\u220f\ni=1\n\uf8eb\n\uf8ed m + 1\u2212 i\n2\n\uf8f6\n\uf8f8\u03bb(t\u2032i) exp\n\uf8f1\uf8f2\n\uf8f3\n\uf8eb\n\uf8ed m + 1\u2212 i\n2\n\uf8f6\n\uf8f8(\u039b(t\u2032i)\u2212 \u039b(t\u2032i\u22121))\n\uf8fc\uf8fd\n\uf8fe , (6)\nwhere \u039b(s) =\n\u222b s\n0 \u03bb(u)du.\nInterest lies in generating samples from the posterior distribution of the coalescent times,\np(t|\u03bb(t), \u03b8,n) and for calculating the marginal likelihood p(n|\u03bb(t), \u03b8). The former allows\nus to perform inference for a given demographic model, and the latter is required for\nchoosing between different demographic models.\nBoth these can be achieved through an algorithm which generates samples of the coa-\nlescent times from (3) and then reweights these samples:\n(A) Generate an iid sample of size K from (3) using the method of Fearnhead and\nMeligkotsidou (2004). Denote the sample as t(1), . . . , t(K).\n(B) For k = 1, . . . .K assign t(k) a weight wk = pi2(t\n(k)|\u03bb(t))\/pi1(t\n(k)|\u03c6). Let C =\u2211K\nk=1 wk.\n(C) The weighted sample, t(1), . . . , t(K) with corresponding weights w1\/C, . . . , wK\/C,\napproximates the posterior p(t|\u03bb(t), \u03b8,n). Furthermore an estimate of the marginal\nlikelihood p(n|\u03bb(t), \u03b8) is given by C\/K.\n6\nThe advantage of this approach is that the costly, in terms of CPU time, step of gen-\nerating the sample of coalescent times in (A) is required only once. Calculating the\nimportance sampling weights in (B) has negligible CPU cost, and thus can be repeated\neasily for a wide-range of possible models for how the population size has varied through\ntime. For informative data, the hope is that (3), which is closely related to the likeli-\nhood, will be a good proposal density for a wide-range of \u03bb(t)s. However the efficiency\nof this method is likely to depend crucially on the sample size m, which affects the\ndimension of t.\nMigration Models\nWe now consider inference for a structured population model. We consider a model\nwith D demes, each with constant population sizes N1, . . . , ND respectively, and D \u00d7\nD backward migration matrix M = {Mij}. Under this model, backwards in time a\nchromosome currently in deme i will migrate to deme j with rate Mij\/2. The diagonal\nelements are defined so that rows of the matrix sum to zero,\n\u2211D\ni=1 Mij = 0. We will\nassume the population is at stationarity, so that the expected number of migrants leaving\na deme is equal to the expected number entering, which corresponds to\n\u2211D\ni=1 NiMij =\n0, and thus the model is parameterised by the migration matrix M , and the total\npopulation size N =\n\u2211D\ni=1 Ni.\nThe data now includes the deme in which each of the chromosomes was sampled. We\npropose an approximate likelihood approach to estimating the migration rates. We first\nintroduce an approximate likelihood function conditional on t, l\u02dc(M |t). To define this\nwe define \u03b3i = Ni\/N for i = 1, . . . , D, and introduce a forward migration matrix F\nwhose entries satisfy Fij = NjMji\/Ni, for i, j = 1, . . . , D. So that the probability of a\nchromosome in deme y having a specific descendant in deme x at a time t in the future\nis\npyx(t) = (exp{Ft})yx .\nWe introduce a vector x = (x1, . . . , x2m\u22121), where (x1, . . . , xm) denotes the deme of the\nm chromosomes in the sample, and (xm+1, . . . , x2m\u22121) are the demes of the internal\nnodes of the genealogy. We assume x2m\u22121 is the deme of the most recent common\nancestor. Finally for i = 1, . . . , 2m\u2212 2 we let bi be the branch length connecting node\ni to its parent, and yi the deme of the parent of node i. Then we define a joint density\np(x) = \u03b3x2m\u22121\n2m\u22122\u220f\ni=1\npyixi(bi).\n7\nFinally the likelihood conditional on t is\nl\u02dc(M |t) =\n\u2211\nxm+1\n\u00b7 \u00b7 \u00b7\n\u2211\nx2m\u22121\np(x). (7)\nNote that this likelihood is uninformative about the total population size N . Calculating\n(7) is possible using the peeling algorithm of Felsenstein (1981).\nOur approximate likelihood is then obtained by averaging l\u02dc(M |t) over samples of t from\n(3). So given a sample t(1), . . . , t(K) from (3), we get\nl\u02dc(M) =\n1\nK\nK\u2211\nk=1\nl\u02dc(M |t(k)).\nThe approximation here is due to averaging over the wrong distribution for t.\nContinuous Spatial Models\nFinally we consider inference for samples obtained across a continuous spatial habi-\ntat. We will assume that the data now includes a spatial location for each sampled\nchromosome. We will focus on inference under an isolation-by-distance model.\nFor simplicity we will first describe the model assuming a 1 dimensional location. We\nassume that the displacement of the location of a chromosome from the location of its\nancester at time t in the past has a univariate Gaussian distribution, with zero mean,\nand variance \u03c32t. First condition on the genealogy of the sample. Furthermore, let \u00b5\nbe the location of the most recent common ancestor (MRCA), T be the time to the\nMRCA, and tij be the time back to the first common ancestor of chromosomes i and\nj. Then, conditional on this, the spatial data X = (X1, . . . , Xm) has a multivariate\nnormal distribution with\nE(Xi) = \u00b5, and Cov(Xi, Xj) = \u03c3\n2(T \u2212 tij),\nfor all i, j = 1, . . . , m. The intuition here is that as dispersion is unbiased, the expected\nlocation of each sampled chromosome will be the location of the MRCA; whereas the\ncovariance between the locations of two chromosomes is proportional to the amount\nof shared ancestry they have back to the most recent common ancestor. This model\ntrivially extends to the case of 2 dimensional locations where the dispersion in each\ndirection is independent and identically distributed.\nTo perform inference we then introduce a prior distribution on the genelogy of the\nsample, and a prior distribution on \u00b5. We use (2) as the prior on the genealogy and\nwe choose an improper uniform prior on \u00b5. For this choice of prior on \u00b5 it possible to\n8\nanalytically integrate out \u00b5 conditional on the genealogy (Rue and Held, 2005). We\nwill write p(x|t, \u03c3) to be the resuting conditional probability of the data given just the\ngenealogy and \u03c3, and p(\u00b5|x, t, \u03c3) the corresponding conditional distribution for \u00b5.\nFor many spatial genetic studies, samples are generated by first choosing the locations,\nand then sampling chromosomes at those locations. Thus it makes sense to perform\ninference under a conditional likelihood, where we condition on the spatial location.\nMore generally, use of the conditional likelihood means the results should depend less on\nthe choice of prior on the genealogy (as in the limit as the data becomes less informative,\nthe conditional likelihood will also become uninformative about the parameters). If as\nbefore we denote the genetic data by n, and the spatial data by x then the conditonal\nlikelihood can be written as\nCL(\u03c3) = p(n|x, \u03c3) =\np(n,x|\u03c3)\np(x|\u03c3)\n.\nIf we use the prior (2), but rather than specifying a value of \u03c6 use the uninformative\nhyperprior pi(\u03c6) \u221d 1\/\u03c6, then the denominator is constant (see the Appendix), which\ngreatly simplifies the calculation of this conditional likelihood.\nWe calculate CL(\u03c3) by simulation as follows.\n(A) We simulate K iid samples of times, by repeatedly (i) simulating \u03c6 from its pos-\nterior, and (ii) simulating t from (3) conditional on that \u03c6. Denote the sample as\nt(1), . . . , t(K).\n(B) For k = 1, . . . , K assign t(k) a weight wk = p(x|t\n(k), \u03c3). Let C =\n\u2211K\nk=1 wk.\n(C) An estimate of CL(\u03c3) is C\/K, and the posterior distribution for \u00b5 is approximated\nby the mixture\nK\u2211\nk=1\nwk\nC\np(\u00b5|x, t(k), \u03c3).\nSimulation in part (i) of (A) is straightforward, as the posterior for \u03c6 is proportional to\n(\n\u03c6\n\u03c6 + \u03b8\/2\n)m\u22122( \u03b8\/2\n\u03c6 + \u03b8\/2\n)n\n,\nand can be related to a Beta distribution through the transformation \u03b3 = \u03c6\/(\u03c6 + \u03b8\/2).\nSimulation of Continuous Spatial Data\nSimulating data under an appropriate continuous spatial model is difficult. There ap-\npear to be two approaches, firstly those based on the isolation-by distance model of\n9\nWright (1943), which ignores any regulation of population density, and thus produces\npopulations with infinite density (Felsenstein, 1975). Secondly, is to use models which\nassume a constant population density (Wilkins and Wakeley, 2002; Wilkins, 2004), and\nrequire the population to live on some closed finite region.\nAs our inference model ignores any restriction on the location of chromosomes as re-\nquired for these latter models, we simulated data under a version of the isolation-by\ndistance model of Wright (1943). In particular, we simulated the genealogical tree for\nour data under a coalescent model with exponential population growth, and then condi-\ntional on this simulated the spread of the chromosomes from the model described above.\nThe idea is to model a situation where the effect of population density regulation is less:\nthat of a population growing in size to fill a new habitat. Note that we are simulating\nthe data under a different model to that which we are analysing it, as the distributions\non the genealogy differ.\nRESULTS\nVariable Population Size\nThe importance sampling approach we propose for analysing data under a range of\nvariable population size scenarios is simulation consistent. That is, as the number of\nsamples, K, of the coalescence times tends to infinity then the estimate of the likelihood\nof a given scenario, or the likelihood curve for a given set of parameters will converge to\nthe true likelihood or likelihood curve. Similar results hold for the posterior distribution\nof the coalescence times. Thus the practicability and efficiency of the approach relies\non the Monte Carlo error in these estimates, and how large K will need to be to obtain\ngood estimates.\nOne way of empirically testing the accuracy of these estimates is to use the effective\nsample size (ESS) of Liu (1996) (see also Fearnhead and Donnelly, 2001). The ESS is\ndefined as\n(\n\u2211K\nk=1 wk)\n2\u2211K\nk=1 w\n2\nk\n.\nThe ESS lies between 1 and K, and has the interpretation that if an importance sampling\nscheme has an ESS of E, then inference based on this scheme is roughly as accurate\nas inference based on E independent draws from the full posterior distribution. As a\nrough guide we would want E > 100 and preferably E > 1, 000 for the inferences to be\nreliable. (Increasing K by a factor should increase E by the same constant factor.)\n10\n10 15 20 25 30 35 40\n0\n1000\n2000\n3000\n4000\n5000\n6000\n7000\nm \nESS \n\u03b8=30 \n\u03b8=20 \n\u03b8=10 \nFigure 1: ESS for analysing data sets of size m = 10, 15, 20, 30, 40 simulated from the\nexponentially growing population size model with \u03b2 = 0.7 and \u03b8 = 10, 20, 30.\nWe investigated how the ESS of our method depends on the values of the mutation\nrate, \u03b8, and the sample size, m. We simulated data from the exponentially growing\npopulation size model with rate of exponential growth \u03b2 = 0.7 and various values of\n\u03b8, namely \u03b8 = 10, 20, 30. Figure 1 shows the ESS values for analysing data sets of size\nm = 10, 15, 20, 30, 40; using K = 10, 000 weighted samples sampled from (3). (Here and\nbelow we set \u03c6 to the value which minimises the likelihood in Eq. 5; though results are\ninsensitive to this choice.) It can be seen that the ESS decreases with m, but increases\nwith \u03b8. The results suggest that for \u03b8 = 10 analysing sample sizes of up to 20\u201340\nis reasonable, with slightly larger sample sizes possible for the larger \u03b8 values. The\nspeed of this approach means that analysis for larger values of m should be possible by\nincreasing K.\nTo demonstrate the potential usefulness of our method we consider analysing the data\nshown in Figure 2, under a variety of scenarios for the variable population size. We\nfix the parameters within our model (though our approach can equally be used to\ncalculate likelihood surfaces for parameters of a given model). Our reason for focussing\non different scenarios is that this is a situation where existing methods may not be able\nto be used (as existing software may only allow analysis for a certain class of models, or\nwould require being re-run for each model that is considered). Specifically, we consider\nthe following models.\n11\n(a) The constant population size model. For this model \u03bb(t) = t.\n(b) The exponentially growing population size model. For this model \u03bb(t) = e\u03b2t.\n(c) The constant population size followed by exponential growth model. For this\nmodel we assume\n\u03bb(t) =\n\uf8f1\uf8f2\n\uf8f3\nse\u2212\u03b2t, t < s\nse\u2212\u03b2s, t \u2265 s\n.\n(d) The bottleneck model. For this model we assume\n\u03bb(t) =\n\uf8f1\uf8f4\uf8f4\uf8f4\uf8f2\n\uf8f4\uf8f4\uf8f4\uf8f3\n1, t < s1\n\u03b1, s1 \u2264 t < s2\n2, t \u2265 s2\n.\nFor the analysis below we fixed (a) \u03b8 = 15, (b) \u03b8 = 15 and \u03b2 = 0.7, (c) \u03b8 = 15, s = 0.1\nand \u03b2 = \u221210 log(0.05), and (d) \u03b8 = 15, s1 = 0.165, s2 = 0.175 and \u03b1 = 10. We focus\non inferring the time to the most recent common ancestor (TMRCA); and in particular\nlooking at how robust these inferences are to the specific choice of model.\nWe simulated K = 10, 000 sets of coalescence times from (3), which took under 2\nminutes on a desktop PC. Reweighting this sets of times took around 1 second for each\nmodel. The resulting Histograms of the samples of the TMRCA for all models are shown\nin Figure 3, and the respective estimates of the marginal likelihood are (a) 0.4308, (b)\n0.6248, (c) 0.0362, and (d) 2.4191\u00d7 10\u22126. The ESS of the weights were between 1,000\nand 5,000 for models (a) \u2013 (c), and was 98 for (d). The histograms shows that the\nesimate of the TMRCA appears robust across these different models.\nNote that inference for the bottleneck model is more challenging than for the other mod-\nels as the importance sampling weights depend crucially on the number of coalescences\nthat lie within the period of the bottleneck; and thus can have a large variance (and\nhence small ESS). The effect of a bottleneck depends primarily on its severity, defined\nas the product \u03b1(s2 \u2212 s1). Having a bottleneck with similar severity but larger \u03b1 and\nsmaller (s2 \u2212 s1) will lead to a more poorly behaved importance sampler.\nMigration Models\nHere we examine the performance of our approach at analysing migration models. Note\nthat we can only estimate migration rates relative to our choice of units for time, which\nis defined by our specification of the mutation rate \u03b8. Therefore, we fix \u03b8 to its true\nvalue and look at estimates of the migration rates.\n12\nFigure 2: The coalescent tree for a sample of m = 10 chromosomes from the constant\npopulation size model. The mutations are depicted by black dots on the branches of\nthe tree.\n13\n0.5 1 1.5 2 2.5\n0\n0.5\n1\n1.5\n2\nx 104\n0.5 1 1.5 2 2.5\n0\n0.5\n1\n1.5\n2\nx 104\n0.5 1 1.5 2 2.5\n0\n0.5\n1\n1.5\n2\nx 104\n(a) (b) \n(c) (d) \n0.5 1 1.5 2 2.5\n0\n0.5\n1\n1.5\n2\nx 104\nFigure 3: Histograms of the samples of the TMRCA for the coalescent tree analysed\nunder the (a) constant population size model, (b) exponentially growing population size\nmodel, (c) constant population size followed by exponential growth model, and (d) the\nbottleneck model. The true value of the TMRCA is indicated in each plot by a circle.\n14\nOur approach for migration models is based on an approximate likelihood, and firstly\nwe need to check the validity of this approach. To do this we calculated the mean\nlog-likelihood over a set of independent data. The shape of the mean log-likelihood\ngoverns the asymptotic behaviour of the method, and in particular for an approximate\nlikelihood method to produce consistent esimates it is required that the mean log-\nlikelihood curve attains its maximum at the true value of the parameters (see Fearnhead,\n2003; Smith and Fearnhead, 2005, for further discussion). Thus an important property\nof an approximate likelihood method is that the mean log-likelihood curve attains its\nmaximum at a value close to the true value.\nWe simulated 100 coalescent trees with sample size of m = 10 from the migration model\nwith D = 2 demes, N1 = 3000, N2 = 7000, M12 = 1.2 and M21 = 2.8. The mutation\nrate used was \u03b8 = 30. For each data set we based inferences on 2, 000 sets of coalescence\ntimes simulated from (3), again with \u03c6 set to the value that maximises (5). We have\nestimated the mean log-likelihood at a grid of values of M12, M21. A contour plot of this\nlog-likelihood surface is shown in figure 4. The maximum of this curve is indeed close\nto the true parameter value (maximum at M12 = 1.02, M21 = 2.52). Similar results are\nobtained for a range of migration models (results not shown).\nIn Table 1 we present results on the performance of our approach, obtained from simu-\nlated data of size m = 10, 20 from the migration model with D = 2 demes for different\nvalues of the model parameters. We consider 2 sets of parameters; (a) N1 = N2 = 5000,\nM12 = M21 = 0.4, and (b) N1 = 3000, N2 = 7000, M12 = 1.2, M21 = 2.8. In each\ncase we report the average of the most likely parameter values across 100 data sets, the\nstandard errors of these estimates (in parentheses) and the associated coverage of the\n95% likelihood-based confidence intervals (CIs). The average CPU cost of analysing a\ndata set on a laptop PC is 30sec for the m = 10 case and 50sec for the m = 20 case.\nFor comparison we reanalysed the m = 10, M12 = M21 = 0.4 data sets using genetree\n(Griffiths and Tavare\u00b4, 1994b; Bahlo and Griffiths, 1998), which approximates the true\nlikelihood curve. To use a single run of genetree required that we fix the relative\npopulations sizes in the two populations. So we ran genetree and reran our approach\nassuming that both \u03b8 and the relative population sizes were known, and considered\nestimates of the single migration parameter. We ran genetree for 100,000 iterations,\nwhich took around an order of magnitude longer to run than our approach. The median\nof ESSs of the estimate of the likelihood at the true migration rate was 15 across the\n15\n0.4 0.8 1.2 1.6 2.0 2.4 2.8 3.2 3.6 4.0  \n0.2\n0.4\n0.6\n0.8\n1.0\n1.2\n1.4\n1.6\n1.8\n2.0\nM21 \nM12 \nFigure 4: Contour plot of the mean log-likelihood surface of M12, M21 obtained from 100\nsimulated coalescent trees under the migration model with D = 2 demes (each contour\ncorresponds to 0.05 units of log-likelihood). The true parameter values are M12 = 1.2\nand M21 = 2.8.\nCase (a) Case (b)\nm \u03b8 M\u02c612 coverage M\u02c621 coverage M\u02c612 coverage M\u02c621 coverage\n10 15 0.46 100% 0.48 100% 1.02 92% 2.50 89%\n(0.26) (0.26) (0.64) (1.30)\n10 30 0.42 100% 0.46 100% 1.08 95% 2.62 97%\n(0.22) (0.26) (0.62) (1.22)\n20 15 0.36 99% 0.38 99% 1.04 87% 2.42 82%\n(0.24) (0.24) (0.72) (1.46)\n20 30 0.38 97% 0.38 97% 1.06 90% 2.66 88%\n(0.30) (0.30) (0.70) (1.36)\nTable 1: Performance of our approximate likelihood approach for simulated data under\nthe migration model with D = 2 demes for different scenarios; (a) N1 = N2 = 5000,\nM12 = M21 = 0.4, and (b) N1 = 3000, N2 = 7000, M12 = 1.2, M21 = 2.8. In each case\nwe report the estimates of the parameters based on 100 data sets, the standard errors\n(in parentheses) and the associated coverage of the 95% CIs.\n16\n100 simulations (in comparison with an ESS of > 1, 000 for our method). The estimates\nfrom the two methods were highly correlated (correlation co-efficient 0.77). The root\nmean square error of our estimates was about 10% higher than that of genetree. This\nmaybe due to the extra statistical efficiency of the true mle, or it be partly due to our\nchoice of driving value (see discussion of Fearnhead and Donnelly, 2001); and rerunning\ngenetree with a driving value that is away from the truth (1.0 as opposed to 0.4) gives\nestimates with root mean square error that is 30% greater than our estimates.\nContinuous Spatial Models\nFinally we present results for the continuous spatial models. Again here we can only\nestimate the parameters of the spatial model relative to the mutation rate \u03b8. There-\nfore, we fix the parameters of the demographic model to their true values and look at\nestimates of the spatial parameters.\nFirstly we check the validity of the approximate likelihood through calculating the mean\nlog-likelihood for a range of parameters. For each set of parameters we simulated 100\ndata sets and then used our approximate approach with K = 5000 to estimate the like-\nlihood curve of \u03c3, the parameter governing the rate of spatial dispersion, and to obtain\nsamples from the posterior distribution of the location of the MRCA. Combining infor-\nmation from all of the 100 simulated trees we have estimated the average log-likelihood\nat a grid of values of \u03c3. Figure 5 shows the resulting mean log-likelihood curves for a\nrange of values of the sample size, m, the mutation rate, \u03b8, and the population growth\nparameter, \u03b2. In each case \u03c3 = 1. The accuracy of the method appears to be primarily\ndependent on m; with the asymptotic bias of the method increasing as m increases (as\nthe value of \u03c3 for which the maximum of the mean log-likelihood curve is attained gets\nfurther away from \u03c3 = 1 as m increases). For values of m up to 10 this bias appears\nsmall.\nIn Table 2 we present a summary of the estimates of \u03c3 across the 100 data sets for each\nset of parameter values; and in Table 3 we give the mean square error of the estimate\nof the position of the MRCA (these estimates had negligible bias); due to symmetry we\nshow only the mean square error for esimating one co-ordinate of the position.\nWe see that the estimates of \u03c3 are accurate for values of m up to 10; beyond this we\nnotice a bias in our estimates, and the root mean square error actually increases when\nwe move from m = 10 to m = 40. Coverage properties also appear good for values of\nm up to 10; but beyond this the confidence intervals are subtantially anti-conservative.\n17\n0.5 1 1.5 2\n\u221215\n\u221210\n\u22125\n0\n0.5 1 1.5 2\n\u221215\n\u221210\n\u22125\n0\nFigure 5: Plots of the log-likelihood surface of \u03c3 for a range of parameter values, each\nobtained from 100 simulated data sets. Left-hand plot: \u03b8 = 15, \u03b2 = 1 and m = 10\n(blue) m = 20 (red) and m = 40 (green); right-hand plot: m = 20 and \u03b8 = 30, \u03b2 = 1\n(black), \u03b8 = 30, \u03b2 = 2 (blue), \u03b8 = 15, \u03b2 = 1 (red), and \u03b8 = 15, \u03b2 = 2 (green).\nThe values of \u03b2 and \u03b8 appear to have had little effect on the results. These results are\nconsistent with those from Figure 5, with the bias of the estimator starting to dominate\nits performance for m = 20 and particularly m = 40.\nFor comparison with our estimate of the position of the MRCA, we also calculated a\nsimple unbiased estimate for each data set which is obtained by taking the average of\nthe locations of the sample. The mean square error of one co-ordinate of the position is\nalso shown in Table 3. Our approach is uniformly more accurate - with quite noticeable\nreduction in mean square error for m = 20 and m = 40. Note that the estimates are\nmore accurate for \u03b2 = 2 due to the tree being shorter, and thus the spatial spread of\nthe data less, than for \u03b2 = 1.\nTo demonstrate the advantage of post-processing a sample of genealogical trees, rather\nthan conditional analysis based on a single tree, we considered the alternative approach\nof inferring \u03c3 given a single estimate of the genelogy. Such an approach (i) obtains an\nestimate of the coalescent times t\u02c6; and (ii) bases inference on the conditional likelihood\np(x|\u02c6t, \u03c3). We used the maximum likelihood estimator of t\u02c6 (which for these models can\nbe calculated using the method of Meligkotsidou and Fearnhead, 2005).\nHere we present results for the m = 2 and m = 5 cases, though similar results are\n18\nobtained for larger values of m. One difficulty with using the maximum likelihood\nesimate of t is that this is 0 for identical sequences, which leads to an invalid conditional\nlikelihood (p(x|\u02c6t, \u03c3) = 0, for all x and \u03c3). Thus in our analysis below we simulate data\nconditional on a sample having no identical sequences.\nFigure 6 gives Probability-Probalitiy (PP) plots of the Likelihood Ratio statistics for\ntesting \u03c3 = 1 against draws from a chi-squared distribution with one degree of freedom.\nWe show this plot as this PP plot is related to the coverage properties of confidence\nintervals for the parameter, and if the Likelihood Ratio statistic is approximately dis-\ntributed as a chi-squared distribution with one degree of freedom, then it shows that\nthe likelihood method is correctly quantifying the uncertainty in the parameter. This\nanalysis is slightly complicated for the m = 2 case, as the sample size is too small for\nthe asymptotic limit of the Likelihood ratio statistic to be a very good approximation -\nthus we also show the PP plot for the Likelihood Ratio statistic conditional on knowing\nthe true coalescence time. For each value of \u03b8 we give PP plots for the new approx-\nimate likelihood method, the conditional analysis for the data sets with at least one\nsegregating site. For smaller values of \u03b8 the approach that conditions on the mle for\nthe coalescence time substantially under-estimates the uncertainty of the estimate for\n\u03c3. As \u03b8 increases the distribution of the LR statistics approaches the distribution of\nthe LR statistic for the likelihood of \u03c3 conditional on the true value of the coalescence\ntime.\nThe effect of conditioning on the mle of the times is less pronounced on the point\nestimates of \u03c3. For the m = 5 case, the two sets of mles are highly correlated (correlation\n0.96), and give almost identical root mean square error, though conditioning on the mle\nappears to give slight underestimates of \u03c3. A measure of the efficiency of this approach\ncan be seen by looking at the correlation of the esimates from our method with those\nconditional on the true coalescence times, this again is high (correlation 0.80).\nDISCUSSION\nWe have considered post-processing of samples of genealogies, in particular to learn\nabout the demographic parameters for a sample, and the robustness of inference to\nchanges in the demographic model. While in our applications we have considered\ninfinite-sites data from a non-recombining region of DNA, the ideas can be applied\nmuch more generally. (For example for the variable population size analysis, chang-\n19\n\u03b2 = 1 \u03b2 = 2\nm \u03b8 E(\u03c3\u02c6) RMSE coverage E(\u03c3\u02c6) RMSE coverage\n5 2 0.99 0.45 95% 1.00 0.42 96%\n5 5 1.09 0.46 93% 0.99 0.38 94%\n10 5 1.02 0.28 95% 1.04 0.29 95%\n10 15 1.05 0.24 94% 1.03 0.23 94%\n20 15 1.13 0.22 83% 1.18 0.26 79%\n20 30 1.14 0.27 79% 1.20 0.29 73%\n40 15 1.22 0.31 57% 1.23 0.30 51%\n40 30 1.22 0.30 45% 1.28 0.32 40%\nTable 2: Performance of our conditional likelihood approach at estimating \u03c3 for the\nspatial model. We report the mean of the estimates of \u03c3 (truth \u03c3 = 1), the root\nmean square error of the estimates, and the coverage probability of 95% approximate\nconfidence intervals. (The grid of \u03c3 values ranged from 0\u20134 for m = 5 and m = 10; and\n0\u20132 for m > 10.)\n\u03b2 = 1 \u03b2 = 2\nm \u03b8 CL SM CL SM\n5 2 0.39 0.53 0.23 0.27\n5 5 0.29 0.39 0.26 0.31\n10 5 0.45 0. 49 0.26 0.28\n10 15 0.43 0.44 0.30 0.31\n20 15 0.37 0.44 0.27 0.34\n20 30 0.31 0.38 0.27 0.35\n40 15 0.44 0.48 0.21 0.26\n40 30 0.46 0.51 0.30 0.39\nTable 3: Performance of our conditional likelihood (CL) method and the sample mean\n(SM) at estimating the position of the MRCA. Figures show mean square error for\ninferring a single co-ordinate of the position.\n20\n0.75 0.80 0.85 0.90 0.95 1.00\n0.\n75\n0.\n80\n0.\n85\n0.\n90\n0.\n95\n1.\n00\n(a)\n0.75 0.80 0.85 0.90 0.95 1.00\n0.\n75\n0.\n80\n0.\n85\n0.\n90\n0.\n95\n1.\n00\n(b)\n0.75 0.80 0.85 0.90 0.95 1.00\n0.\n75\n0.\n80\n0.\n85\n0.\n90\n0.\n95\n1.\n00\n(c)\n0.75 0.80 0.85 0.90 0.95 1.00\n0.\n75\n0.\n80\n0.\n85\n0.\n90\n0.\n95\n1.\n00\n(d)\nFigure 6: Probability-Probability (PP) plots of a \u03c721 distriution against the Likelihood\nRatio (LR) statistics for (red) our conditional likelihood method; (blue) analysis condi-\ntional on the maximum likelihood estimate of the coalescence times; and (green) analysis\nconditional on the true coalescence times. Plots (a)\u2013(c) are based on 1,000 data sets,\nwith m = 2, \u03b2 = 1 and (a) \u03b8 = 1, (b) \u03b8 = 2, (c) \u03b8 = 4; plot (d) is based on 100 data sets\nwith m = 5, \u03b8 = 2 and \u03b2 = 1. We simulated all data sets conditional on there being no\nidentical sequences in the data set.\n21\ning the method of simulating the data will only affect step (B) of the algorithm, with\nthe denominator of the importance sampling weights being the prior of the model un-\nder which the sample of genealogies was generated.) All that is required is that the\nthere is computational machinery (e.g. MCMC algorithms) that can produce samples\nof genealogies for the data. For example, analysis of more general mutation models\nis possible using the Bayesian phylogenetic packages such as MrBayes (Ronquist and\nHulsenbeck, 2000) and Bambe (Larget and Simon, 1999), while analysis of(recombining)\nbacterial MLST data is possible using ClonalFrame (Didelot and Falush, 2006).\nWe first considered inference for a variable population size, and robustness of inference\nof coalescence times to changes in the model for the population size. An importance\nsampling approach, which is \u201cexact\u201d in the limit as the computational cost increases,\nis possible here. In practice the efficiency of this method will depend on the sample\nsize and the mutation rate; efficiency decreasing as sample size increases or mutation\nrate decreases. Our results suggest that this approach is practicable for sample sizes\nof up to 50 chromosomes. The advantage of this post-processing is that it enables a\ndata set to be analysed quickly under a range of different models. As such we view\nthat this approach will be useful in terms of a preliminary analysis of a potentially\nlarge data set. We can first subsample an appropriate number of chromosomes (of the\norder of 10\u201350), and analyse these under a variety of models. This will help inform us\nas to what are the appropriate models for analysing the complete data (using a more\ndedicated\/computationally-intensive approach), and also give insights as to how robust\nthe results about the coalescence times of the tree will be.\nWe also considered inference in structured populations: both discrete subpopulations\nand continuous spatial models. There are similarities in the approximate likelihood\napproach we consider for both of these cases. We first simulate a sample of genealogies\nand then average over the conditional likelihood of the spatial data given the genealogy.\nThis approach is implicitly assuming a conditional independence structure to the data:\nthat the spatial and genetic data are conditionally independent given the genealogy.\nAs such our model assumes a prior for the genealogy and then conditional models\nfor the spatial\/genetic data given the genealogy. The prior for the genealogy is that\nassumed within our computational method for producing the sample of genealogies\n(in our case the phylogenetic prior described in METHODS). Under the conditional\nindependence assumption, this approximate likelihood approach should tend to the\ntrue likelihood as the mutation rate increases (as in this case the posterior distribution\n22\nof the genealogy will converge to a point mass on the true genealogy). In practice we\nobserve the approximate likelihood method performs well for relatively small sample\nsizes (up to 20 chromosomes). For larger sample sizes, the genealogical prior we use is\nnot correctly capturing the distribution of some of the coalescence times, and this then\nstarts to introduce biases into the method.\nHowever, our method can be applied to large data using a composite likelihood ap-\nproach. A large data set can be split into smaller subsamples (with the possibility\nof each chromosome appearing in many subsamples); the approximate log-likelihood\ncalculated for each subsample; and these approximate log-likelihood curves combined\nthrough adding them together. An estimate of the parameter(s) is given by the value(s)\nthat maximise this composite log-likelihood. The performance of such a method is\ngoverned by the shape of the mean of the log of the approximate likelihood, such as\nshown in Figures 5 (see Fearnhead, 2003). And these results suggest that the methods\nshould perform well is the composite likelihood is based upon analysisng subsamples of\nrelatively small size (with m up to 10).\nIn particular a pairwise likelihood approach is likely to be a simple method for analysing\ncontinuous spatial data sets (currently there are few methods for analysing such models).\nFor such a pairwise approach it is simple to allow for quite general models of the spatial\nspread of the population through time, all that is required is the specification of a family\nof densities, p(x1, x2; t), for the probability of two chromosomes which share a common\nancestor at time t in the past being located at positions x1 and x2.\n23\nReferences\nBahlo, M. and Griffiths, R. C. (1998). Inference from gene trees in a subdivided popu-\nlation. Theoretical Population Biology 57, 79\u201395.\nBeerli, P. and Felsenstein, J. (1999). Maximum-likelihood estimation of migration rates\nand effective population numbers in two populations using a coalescent approach.\nGenetics 152, 763\u2013773.\nBrooks, S. P., Manopoulou, I. and Emerson, B. C. (2007). Bayesian Statistics 8 , chap-\nter Assessing the affect of genetic mutation: A Bayesian framework for determining\npopulation history from DNA sequence data. Oxford University Press, Oxford.\nCoop, G. and Griffiths, R. C. (2004). Ancestral inference on gene trees under selection.\nTheoretical Population Biology 66, 219\u2013232.\nDidelot, X. and Falush, D. (2006). Inference of bacterial microevolution using multilocus\nsequence data. submitted .\nDrummond, A. J., Rambaut, A., Shapiro, B. and Pybus, O. G. (2005). Bayesian co-\nalescent inference of past population dynamics from molecular sequences. Molecular\nBiology and Evolution 22, 1185\u20131192.\nEmerson, B. C. and Hewitt, G. M. (2005). Phylogeography. Current Biology 15, 367\u2013\n371.\nFearnhead, P. (2003). Consistency of estimators of the population-scaled recombination\nrate. Theoretical Population Biology 64, 67\u201379.\nFearnhead, P. and Donnelly, P. (2001). Estimating recombination rates from population\ngenetic data. Genetics 159, 1299\u20131318.\nFearnhead, P. and Donnelly, P. (2002). Approximate likelihood methods for estimating\nlocal recombination rates (with discussion). Journal of the Royal Statistical Society,\nseries B 64, 657\u2013680.\nFearnhead, P. and Meligkotsidou, L. (2004). Exact filtering for partially-observed\ncontinuous-time Markov models. Journal of the Royal Statistical Society, series B\n66, 771\u2013789.\nFelsenstein, J. (1975). A pain in the torus: some difficulties with the model of isolation\nby distance. American Naturalist 109, 359\u2013368.\n24\nFelsenstein, J. (1981). Evolutionary trees from DNA sequences: a maximum likelihood\napproach. Journal of Molecular Evolution 17, 368\u2013376.\nFrench, N. P., Barrigas, M., Brown, P., Ribiero, P., Williams, N. J., Leatherbarrow, H.,\nBirtles, R., Bolton, E., Fearnhead, P. and Fox, A. (2005). Spatial epidemiology and\nnatural population structure of campylobacter jejuni colonising a farmland ecosystem.\nEnvironmental Microbiology 7, 1116\u20131126.\nGriffiths, R. C. and Marjoram, P. (1996). Ancestral inference from samples of DNA\nsequences with recombination. Journal of Computational Biology 3, 479\u2013502.\nGriffiths, R. C. and Tavare\u00b4, S. (1994a). Sampling theory for neutral alleles in a varying\nenvironment. Philosophical Transactions of the Royal Society of London. Series B\n344, 403\u2013410.\nGriffiths, R. C. and Tavare\u00b4, S. (1994b). Simulating probability distributions in the\ncoalescent. Theoretical Population Biology 46, 131\u2013159.\nKuhner, M. K., Yamato, J. and Felsenstein, J. (1998). Maximum likelihood estimation\nof population growth rates based on the coalescent. Genetics 149, 429\u2013434.\nKuhner, M. K., Yamato, J. and Felsenstein, J. (2000). Maximum likelihood estimation\nof recombination rates from population data. Genetics 156, 1393\u20131401.\nLarget, B. and Simon, D. L. (1999). Markov chain Monte Carlo algorithms for the\nBayesian analysis of phylogenetic trees. Molecular Biology and Evolution 16, 750\u2013\n759.\nLiu, J. S. (1996). Metropolised independent sampling with comparisons to rejection\nsampling and importance sampling. Statistics and Computing 6, 113\u2013119.\nMeligkotsidou, L. and Fearnhead, P. (2005). Maximum likelihood estimation of coales-\ncence times in genealogical trees. Genetics 171, to appear.\nRannala, B. and Yang, Z. (1996). Probability distribution of molecular evolutionary\ntrees: A new method of phylogenetic inference. Journal of Molecular Evolution 43,\n304\u2013311.\nRonquist, F. and Hulsenbeck, J. P. (2000). MrBayes3: Bayesian phylogenetic recon-\nstruction under mixed models. Bioinformatics 19, 1572\u20131574.\n25\nRue, H. and Held, L. (2005). Gaussian Markov Random Fields: Theory and Applica-\ntions. CRC Press\/Chapman and Hall.\nShen, P., Wang, F., Underhill, P. A., Franco, C., Yang, W., Roxas, A., Sung, R., Lin,\nA. A., Hyman, R. W., Vollrath, D., Davis, R. W., Carvalli-Sforza, L. and Oefner, P. J.\n(2000). Population genetic implications from sequence variation in four Y chromosome\ngenes. Proceedings of the National Academy of Science 97, 7354\u20137359.\nSmith, N. G. C. and Fearnhead, P. (2005). A comparison of three estimators of the\npopulation-scaled recombination rate: accuracy and robustness. Genetics 171, 2051\u2013\n62.\nStephens, M. and Donnelly, P. (2000). Inference in molecular population genetics (with\ndiscussion). Journal of the Royal Statistical Society, Series B 62, 605\u2013655.\nTempleton, A. R., Boerwinkle, E. and Sing, C. F. (1987). A Cladistic Analysis of\nPhenotypic Associations With Haplotypes Inferred From Restriction Endonuclease\nMapping. I. Basic Theory and an Analysis of Alcohol Dehydrogenase Activity in\nDrosophila. Genetics 117, 343\u2013351.\nUnderhill, P. A., Passarino, G., Lin, A. A., Shen, P., Lahr, M., Foley, R. A., Oefner,\nP. J. and Cavalli-Sforza, L. L. (2001). The phylogeography of Y chromosome binary\nhaplotypes and the origins of modern human populations. Annals of Human Genetics\n65, 43\u201362.\nWilkins, J. F. (2004). A separation-of-timescales approach to the coalescent in a con-\ntinuous population. Genetics 168, 2227\u20132244.\nWilkins, J. F. and Wakeley, J. (2002). The coalescent in a continuous, finite, linear\npopulation. Genetics 161, 873\u2013888.\nWright, S. (1943). Isolation by distance. Genetics 28, 114\u2013138.\n26\nAPPENDIX\nThe prior (2) can be obtained by simulating s from the prior with \u03c6 = 1, and then\nletting t = \u03c6s. Thus if we define S and sijs to satisfy T = \u03c6S and tij = \u03c6sij , so they\nare the respective times obtained from s, we get that\nCov(Xi, Xj) = \u03c3\n2\u03c6(S \u2212 sij).\nThus the intuition behind the result is that, as under the prior the data is solely infor-\nmative about the product \u03c32\u03c6, using the scale invariance prior for \u03c6 will result in no\ninformation about \u03c3.\nFormally we use the fact that\np(x|\u03c3) =\n\u222b \u222b\np(x|\u03c3, \u03c6, s)p(\u03c6)d\u03c6p(s)ds.\nWe consider the integral with respect to \u03c6, assuming a given s, and demonstrate that\nthis does not depend on \u03c3, from which the fact that p(x|\u03c3) does not depend on \u03c3 follows.\nFor notational simplicity we assume \u00b5 = 0 in the following.\nNow for our given s let \u03a3 be the covariance matrix obtained when \u03c3 = \u03c6 = 1, so\n\u03a3ij = (S \u2212 sij) for i, j = 1, . . . , m. Further let Q = \u03a3\n\u22121 and A = xT Qx\/2. Then\n\u222b\np(x|\u03c3, \u03c6, s)p(\u03c6)d\u03c6\n\u221d\n\u222b\n(\u03c32\u03c6)\u2212m\/2 exp{\u2212A\/(\u03c32\u03c6)}\u03c6\u22121d\u03c6.\n= \u03c3\u2212m\n\u222b\n\u03b3m\/2\u22121 exp{\u2212\u03b3A\/(\u03c32)}d\u03b3\n= \u03c3\u2212m\u0393(m\/2)(A\/\u03c32)\u2212m\/2.\nFor the second equality we have used the transformation \u03b3 = 1\/\u03c6. The final expression\ndoes not depend on \u03c3 as required.\n27\n"}