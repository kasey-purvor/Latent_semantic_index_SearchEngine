{"doi":"10.1117\/1.1636765","coreId":"140179","oai":"oai:dspace.lib.cranfield.ac.uk:1826\/5456","identifiers":["oai:dspace.lib.cranfield.ac.uk:1826\/5456","10.1117\/1.1636765"],"title":"Determination of view vectors from image warping mapping functions","authors":["Nobes, David S.","Wieneke, B.","Tatam, Ralph P."],"enrichments":{"references":[{"id":37970961,"title":"A \ufb02exible new technique for camera calibration,\u2019\u2019","authors":[],"date":"2000","doi":"10.1109\/34.888718","raw":"7. Z. Zhang, \u2018\u2018A \ufb02exible new technique for camera calibration,\u2019\u2019 IEEE Trans. Pattern Anal. Mach. Intell. 22~11!, 1330\u20131334 ~2000!.","cites":null},{"id":37970960,"title":"A versatile camera calibration technique for highaccuracy 3D machine vision metrology using off-the-shelf TV cameras and lenses,\u2019\u2019","authors":[],"date":"1987","doi":"10.1109\/jra.1987.1087109","raw":"6. R. Y. Tsai, \u2018\u2018A versatile camera calibration technique for highaccuracy 3D machine vision metrology using off-the-shelf TV cameras and lenses,\u2019\u2019 IEEE J. Robot. Automat. RA-3~4!, 323\u2013344 ~1987!.","cites":null},{"id":37970964,"title":"and Tatam: Determination of view vectors...","authors":[],"date":"2004","doi":"10.1117\/1.1636765","raw":"Nobes, Wieneke, and Tatam: Determination of view vectors... 414 Optical Engineering, Vol. 43 No. 2, February 2004 Downloaded from SPIE Digital Library on 27 May 2011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms","cites":null},{"id":37970962,"title":"Distortion compensation for generalized stereoscopic particle image velocimetry,\u2019\u2019","authors":[],"date":null,"doi":"10.1088\/0957-0233\/8\/12\/008","raw":"8. S. M. Soloff, R. J. Adrian, and Z. C. Liu, \u2018\u2018Distortion compensation for generalized stereoscopic particle image velocimetry,\u2019\u2019 Meas. Sci. Technol. 8, 1441\u20131454 ~1997!. 9. Rhinoceros \u2018\u2018NURBS modelling for windows,\u2019\u2019 http:\/\/ www.rhino3d.com\/.","cites":null},{"id":37970956,"title":"Doppler global velocimetry: a new way to look at velocity,\u2019\u2019","authors":[],"date":null,"doi":null,"raw":"1. J. F. Meyers and H. Komine, \u2018\u2018Doppler global velocimetry: a new way to look at velocity,\u2019\u2019 Laser Anemomet. 1, 289\u2013296 ~1991!. 2. D. S. Nobes, H. D. Ford, and R. P. Tatam, \u2018\u2018Three component planar Doppler velocimetry using imaging \ufb01bre bundles,\u2019\u2019 in Proc. 11th Int.","cites":null},{"id":37970959,"title":"Eds., in Calibration and Orientation of Cameras in Computer Vision,","authors":[],"date":"2001","doi":"10.1007\/978-3-662-04567-1","raw":"5. A. Gruen and T. S. Huang, Eds., in Calibration and Orientation of Cameras in Computer Vision, Springer-Verlag ~2001!.","cites":null},{"id":37970957,"title":"Holographic and Speckle Interferometry,","authors":[],"date":"1989","doi":"10.2307\/1575425","raw":"3. R. Jones and C. Wykes, Holographic and Speckle Interferometry, ~Cambridge University Press, Cambridge, 1989!.","cites":null},{"id":37970963,"title":"received his MS in astrophysics at Rice University,","authors":[],"date":"1989","doi":null,"raw":"Bernhard Wieneke received his MS in astrophysics at Rice University, Houston, Texas. Since 1989, he has been working with LaVision GmbH developing hardware and software for laser and CCD-based optical measurement systems. His special interests are advanced PIV algorithms.","cites":null},{"id":37970958,"title":"Shearography: a new optical method for strain measurement and nondestructive testing,\u2019\u2019","authors":[],"date":null,"doi":"10.1117\/12.7972920","raw":"4. Y. Y. Hung, \u2018\u2018Shearography: a new optical method for strain measurement and nondestructive testing,\u2019\u2019 Opt. Eng. 21~3!, 391\u2013395 ~1982!.","cites":null}],"documentType":{"type":1}},"contributors":[],"datePublished":"2004-02-28T00:00:00Z","abstract":"The measurands of several reported laser-based measurement techniques are\nsensitive to both the propagation direction of the laser and the viewing\ndirection from the region of interest to the detector. For such imaging\ntechniques, the view vector must be determined uniquely for each pixel in the\ndetector array. The bulk view vector is often physically measured and a simple\nmodel used to determine the view vector for each pixel. This, however, has\nlimitations where access is limited, the distances involved are small, or the\noptical system employed introduces errors. We describe a procedure to determine\nthe unique view vector from a planar region to the detector (CCD camera) for\neach element in a 2-D array based on a reference target aligned with the planar\nregion of interest. Determination of the view vector is based on the spatial\ndistribution of the mapping function used to dewarp the view. No physical\nmeasurement of the view vector is required. Good agreement is achieved when the\nprocedure is compared to a simple pin-hole camera model of the view using a\ncomputed test target. (C) 2004 Society of Photo-Optical Instrumentation\nEngineers","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/140179.pdf","fullTextIdentifier":"https:\/\/dspace.lib.cranfield.ac.uk\/bitstream\/1826\/5456\/1\/Determination%20of%20view%20vectors%20from%20image%20warping%20mapping%20functions.pdf","pdfHashValue":"6fafc320da5d352ec6fddcfeb789433b6e28208f","publisher":"Spie -- the Int Soc for Optical Engineering","rawRecordXml":"<record><header><identifier>\noai:dspace.lib.cranfield.ac.uk:1826\/5456<\/identifier><datestamp>2011-06-13T14:34:38Z<\/datestamp><setSpec>hdl_1826_19<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>Determination of view vectors from image warping mapping functions<\/dc:title><dc:creator>Nobes, David S.<\/dc:creator><dc:creator>Wieneke, B.<\/dc:creator><dc:creator>Tatam, Ralph P.<\/dc:creator><dc:subject>view angle determination image warping planar Doppler velocimetry machine vision three-component measurement camera calibration<\/dc:subject><dc:description>The measurands of several reported laser-based measurement techniques are\nsensitive to both the propagation direction of the laser and the viewing\ndirection from the region of interest to the detector. For such imaging\ntechniques, the view vector must be determined uniquely for each pixel in the\ndetector array. The bulk view vector is often physically measured and a simple\nmodel used to determine the view vector for each pixel. This, however, has\nlimitations where access is limited, the distances involved are small, or the\noptical system employed introduces errors. We describe a procedure to determine\nthe unique view vector from a planar region to the detector (CCD camera) for\neach element in a 2-D array based on a reference target aligned with the planar\nregion of interest. Determination of the view vector is based on the spatial\ndistribution of the mapping function used to dewarp the view. No physical\nmeasurement of the view vector is required. Good agreement is achieved when the\nprocedure is compared to a simple pin-hole camera model of the view using a\ncomputed test target. (C) 2004 Society of Photo-Optical Instrumentation\nEngineers.<\/dc:description><dc:publisher>Spie -- the Int Soc for Optical Engineering<\/dc:publisher><dc:date>2011-06-03T23:08:43Z<\/dc:date><dc:date>2011-06-03T23:08:43Z<\/dc:date><dc:date>2004-02-28T00:00:00Z<\/dc:date><dc:type>Article<\/dc:type><dc:identifier>D.S. Nobes, B. Wieneke, R.P. Tatam \"Determination David S. Nobes, Bernhard Wieneke and Ralph P. Tatam, \"Determination of view vectors from image warping mapping functions\", Optical Engineering 43, 407 (2004)<\/dc:identifier><dc:identifier>0091-3286<\/dc:identifier><dc:identifier>http:\/\/dx.doi.org\/10.1117\/1.1636765<\/dc:identifier><dc:identifier>http:\/\/dspace.lib.cranfield.ac.uk\/handle\/1826\/5456<\/dc:identifier><dc:language>en_UK<\/dc:language><dc:rights>Copyright 2004 Society of Photo-Optical Instrumentation Engineers. One print or electronic copy may be made for personal use only. Systematic reproduction and distribution, duplication of any material in this paper for a fee or for commercial purposes, or modification of the content of the paper are prohibited.<\/dc:rights><\/oai_dc:dc><\/metadata><\/record>","journals":[{"title":null,"identifiers":["issn:0091-3286","0091-3286"]}],"language":{"code":"en","id":9,"name":"English"},"relations":[],"year":2004,"topics":["view angle determination image warping planar Doppler velocimetry machine vision three-component measurement camera calibration"],"subject":["Article"],"fullText":"Determination of view vectors from image\nwarping mapping functions\nDavid S. Nobes\nCranfield University\nSchool of Engineering\nOptical Sensors Group\nCranfield, Bedfordshire, MK43 0AL, United\nKingdom\nBernhard Wieneke\nLaVision GmbH\nAnna-Vandenhoek-Ring 19\nD-37081 Go\u00a8ttingen, Germany\nRalph P. Tatam, MEMBER SPIE\nCranfield University\nSchool of Engineering\nOptical Sensors Group\nCranfield, Bedfordshire, MK43 0AL, United\nKingdom\nE-mail: r.p.tatam@cranfield.ac.uk\nAbstract. The measurands of several reported laser-based measure-\nment techniques are sensitive to both the propagation direction of the\nlaser and the viewing direction from the region of interest to the detector.\nFor such imaging techniques, the view vector must be determined\nuniquely for each pixel in the detector array. The bulk view vector is often\nphysically measured and a simple model used to determine the view\nvector for each pixel. This, however, has limitations where access is\nlimited, the distances involved are small, or the optical system employed\nintroduces errors. We describe a procedure to determine the unique view\nvector from a planar region to the detector (CCD camera) for each ele-\nment in a 2-D array based on a reference target aligned with the planar\nregion of interest. Determination of the view vector is based on the spa-\ntial distribution of the mapping function used to dewarp the view. No\nphysical measurement of the view vector is required. Good agreement is\nachieved when the procedure is compared to a simple pin-hole camera\nmodel of the view using a computed test target. \u00a9 2004 Society of Photo-\nOptical Instrumentation Engineers. [DOI: 10.1117\/1.1636765]\nSubject terms: view angle determination; image warping; planar Doppler veloci-\nmetry; machine vision; three-component measurement.\nPaper 020458 received Oct. 18, 2002; revised manuscript received Mar. 27,\n2003, and Jul. 25, 2003; accepted for publication Aug. 7, 2003.1 Introduction\nThere are several laser-based measurement systems where\nthe measurand is a function of the relative angle between\nthe incident laser illumination and the view vector from the\nmeasurement volume to the detector. Examples of these\ntechniques include planar Doppler velocimetry,1,2 ~PDV!\nelectronic speckle pattern interferometry,3 ~ESPI! and\nshearography.4 Accurate determination of this angle, or\nmore specifically the view vector, is important in achieving\naccurate measurements. This can be highlighted by consid-\nering the fundamental principle of the flow measurement\ntechnique, PDV. In this technique, the Doppler-shifted laser\nlight that is scattered off particles that have been seeded\ninto a flow is measured using a frequency-to-intensity con-\nverter. The laser used in the PDV technique is frequency\ntuned onto the side of a single absorption line of molecular\niodine, which is used as an absorption line filter to attenuate\nthe signal based on the frequency of the scattered light.\nOnce the Doppler shift, Dn is determined, the Doppler for-\nmula, Dn5l21( o\u02c62i\u02c6)\u0095V can be used to determine the ve-\nlocity of the particles and hence infer the velocity of the\nflow. Here, l is the wavelength of the illumination laser, o\u02c6\nis a unit vector describing the direction from the measure-\nment volume to the detector, i\u02c6 is the propagation direction\nunit vector of the laser, and V is the velocity of the scatter-\ning medium. The vector sum, ( o\u02c62i\u02c6) describes the direction\nof the component of V that the measurement is sensitive to\nand is termed the sensitivity vector of the measurement\nsystem. It is clear from the Doppler formula that multiple\ncomponents of the velocity can be determined by usingOpt. Eng. 43(2) 407\u2013414 (February 2004) 0091-3286\/2004\/$15.00\nDownloaded from SPIE Digital Library on 27 May 2multiple views of the same measurement volume. Determi-\nnation of o\u02c6 is thus important not only for the accuracy of\nthe measurement but also in the determination of multicom-\nponents.\nMeasurement of o\u02c6 can be determined by physically mea-\nsuring the vector from the measurement volume to the de-\ntector and then normalizing the vector. This is standard\npractice for most PDV systems reported in the literature.1\nHowever, this method has some limitations. The view vec-\ntor o\u02c6 , as shown in Fig. 1, is the bulk unit view vector for\nthe system and this is only true for the central pixel of the\n2-D array of a CCD camera. Each individual pixel (i , j) in\nthe array views a different region of the plane under inves-\ntigation and hence has a unique view vector o\u02c6 (i , j) . This\nview vector is a function of the area viewed, the physical\nsize of the array and the distance between the array and the\nviewed area. Accurate calculation of the view vector o\u02c6 (i , j)\nfor each individual pixel (i , j), in the camera array is an\nimportant part of the full data processing procedure. Con-\nsider a configuration where a camera, 1 m from a plane is\nviewing a region of 1003100 mm and is viewing perpen-\ndicularly. The variation in the view vector across the field is\n;66 deg. This would results in an error of ;5% in the\ncomputed velocity if there is no correction for view angle.\nDirect measurement of the bulk view vector is only suit-\nable for situations where the distances involved are large,\nso that any measurement error does not introduce a signifi-\ncant error in the vector direction. After o\u02c6 is determined, a\ncorrection to the view vector for each individual pixel can\nbe achieved by assuming a simple pin-hole camera model5407\u00a9 2004 Society of Photo-Optical Instrumentation Engineers\n011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\nNobes, Wieneke, and Tatam: Determination of view vectors . . .of the view and correcting accordingly. Direct measurement\nof the bulk view vector is also difficult and potentially error\nprone in situations of restricted physical access or where\nthe dimensions are small. Any error associated with the\nmeasurement of the bulk view vector will propagate\nthrough the calculation of all other view vectors. Use of the\npin-hole model of the view also limits the accuracy of the\nmeasurement of o\u02c6 (i , j) by assuming that there are minimal\noptics used in the collection of the image and that the op-\ntical train does not significantly alter the view vector,\nthrough distortion of the image.\nThere is therefore a need for an algorithm that can de-\ntermine o\u02c6 (i , j) for each individual pixel that does not rely on\nphysical measurement. Several techniques are presented in\nthe literature that have been developed for the calibration of\ncamera parameters. These camera calibration procedures\ndetermine the bulk camera intrinsic ~i.e., focal length! and\nextrinsic ~i.e., camera position! parameters and include\nmethods that use a single view of a target from a single\ncamera,6 multiple views of a target from a single camera,6,7\nand multiple views from a number of cameras.5 The proce-\ndures process images of test targets or images that have\nknow points located within the field of view. A limitation of\nthese techniques is that only bulk parameters are calculated,\nhence only the bulk view vector o\u02c6 is found. Individual cor-\nrection of each pixel for view angle is again needed after\nthe bulk parameters are derived.\nTechniques such as PDV are unique in that they measure\nover a plane defined by the propagation of the expanded\nlaser beam into a sheet. For multicomponent measurement,\nmultiple views of the region of interest ~ROI! are collected\nand mapped onto a single coordinate system oriented with\nthe experiment.1,2 This requires the dewarping of individual\nviews onto the predefined plane and enables the interpola-\ntion of different measured components onto the same spa-\ntial grid. A calibration procedure used to determine the\ndewarping mapping functions using a test target of coplanar\nlocation markers that are at a known spacing is often\nemployed.1,2 The dewarping procedure corrects the view\nfor image perspective distortion as well as radial distortion\nand aberrations introduced by optical components within\nthe imaging system. The mapping function therefore carries\nFig. 1 Relationship of the Cartesian coordinate system of the ex-\nperiment to the orthogonal coordinates system seen by the detector\nand the region of interest (ROI) viewed by the detector. The direc-\ntion of the Z8 axis is aligned with the bulk view vector o\u02c6.408 Optical Engineering, Vol. 43 No. 2, February 2004\nDownloaded from SPIE Digital Library on 27 May 2information about the bulk view vector to the target as well\nas for each pixel in the array and information about any\nlocal change in the view vector introduced by local distor-\ntion of the know target image.\nIn the remainder of this paper a procedure is developed\nto determine the view vector o\u02c6 (i , j) for individual pixels\nfrom the mapping function determined in a dewarping pro-\ncedure and the derived scaling information from a test tar-\nget. The procedure is then tested against a computer-\ngenerated test target, where the view is at a known angle to\nthe target plane.\n2 Dewarping Images of the ROI\nThe ROI investigated by planar techniques is a region de-\nfined by the expansion of the laser beam into a sheet. A\ntarget, overlaying the laser sheet, consisting of a regular\narray of location marks is used to define the field of view\nand allow collection of a calibration image used to dewarp\nthe view. The ROI imaged by the camera is a plane over-\nlapping the X-Y plane of a Cartesian coordinate system that\nis oriented to the experiment, as shown in Fig. 1. The posi-\ntive Z axis of this coordinate system is oriented toward the\ncamera so that the location of the camera is in positive Z\nspace. If the camera were viewing perpendicular to the ROI\nwith its optical axis pointing at the origin, the camera\u2019s\noptical axis, and hence it\u2019s bulk view vector o\u02c6 would coin-\ncide with the Z axis. For any viewing angle away from the\nnormal, the captured image would be a perspective view of\nthe ROI. A second orthogonal coordinate system\n(X8,Y 8,Z8) is aligned with the view direction of the cam-\nera such that the Z8 axis is always aligned with the optical\naxis of the camera. In this scenario, the bulk unit view\nvector o\u02c6 of the camera aligns with the Z8 axis.\nA computed mapping function can define the transfor-\nmation from the ideal rectilinear \u2018\u2018corrected\u2019\u2019 plane to the\ndistorted plane as recorded by the camera using\nx85M x~x ,y !, ~1!\ny85M y~x ,y !, ~2!\nwhere the true \u2018\u2018corrected\u2019\u2019 coordinates are given by x and\ny, while the coordinates in the observed distorted image\nplane are given by x8 and y8, and M x and M y are the\nmapping functions that are determined by a dewarping al-\ngorithm. To enable mapping onto a predefined grid size and\nscaling, the mapping of x8 to x is achieved via an interme-\ndiary coordinate system (s ,t), which enables the mapping\nof several views onto the same grid size and subsequent\nscaling. This is a linear mapping of s(x) and t(y) to obtain\nscaling information. The mapping can thus be reexpressed\nas\nx85x1M x~s ,t !, ~3!\ny85y1M y~s ,t !. ~4!\nIn the procedure used here a third-order polynomial is fitted\nto the mapping functions resulting8 in 20 coefficients in s\nand t. This order polynomial is sufficient to remove even\nsevere distortions.011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\nNobes, Wieneke, and Tatam: Determination of view vectors . . .3 View Angle Determination\nThe true (X ,Y ,Z) coordinate system aligned with the ROI\nand experiment can be represented by unit vectors u\n5(1,0,0), v5(0,1,0), and w5(0,0,1). In the observed\nimage these unit vectors are transformed to a camera coor-\ndinate system, as shown in Fig. 2, defined by\nu85~ux ,uy ,uz!,\nv85~vx ,vy ,vz!, ~5!\nw85~wx ,wy ,wz!.\nIn the ideal case of looking perpendicular to the X-Y plane,\nu85(1,0,0), v85(0,1,0), and w85(0,0,1). The observed\nFig. 2 Relationship of the experiment coordinate system (X,Y,Z)\nand the view coordinate system (X8,Y8,Z8).Downloaded from SPIE Digital Library on 27 May 2components ux , uy , vx , and vy are directly related to the\nlocal spatial derivatives of the mapping function via\nux5ExxF , ~6!\nuy5EyxF , ~7!\nvx5ExyF , ~8!\nvy5EyyF , ~9!\nwhere F is a magnification factor, and\nExx5dM x~x ,y !\/dx , ~10!\nEyx5dM y~x ,y !\/dx , ~11!\nExy5dM x~x ,y !\/dy , ~12!\nEyy5dM y~x ,y !\/dy . ~13!\nThe following definitions of a unit vector and the mapping\nof one orthogonal vector onto another are also valid:\nux\n21uy\n21uz\n251, ~14!\nvx\n21vy\n21vz\n251, ~15!\nuxvx1uyvy1uzvz50. ~16!\nThe optical axis of the camera is aligned with the Z8 axis\nand passes through the central pixel of the camera array and\nis described by the unit vector o\u02c6 . The vector to be deter-\nmined for each pixel (i , j) in the array is then the vector\no\u02c6 (i , j) , where the coordinate system has been translated so\nthat Z8 is originated at the pixel (i , j). This new view vec-Fig. 3 Derivation of the components of o\u02c6(i, j) to the camera frame of reference (X8,Y8,Z8) and the\nexperiment frame of reference (X,Y,Z): (a) the z and x components and (b) the y and z components.409Optical Engineering, Vol. 43 No. 2, February 2004\n011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\nNobes, Wieneke, and Tatam: Determination of view vectors . . .tor o\u02c6 (i , j) is described in Fig. 3 and can be determined from\nthe cross-product of the unit vectors describing the X8 and\nY 8 axes at point (i , j);\no\u02c6 ~ i , j !5@w ~ i , j !x,w ~ i , j !y,w ~ i , j !z#\n5@u ~ i , j !x,u ~ i , j !y,u ~ i , j !z#3@v ~ i , j !x,v ~ i , j !y,v ~ i , j !z# . ~17!\nThe direction cosines of o\u02c6 (i , j) are @w (i , j)x,w (i , j)y,w (i , j)z# .\nThree angles shown in Figs. 2 and 3 can now be defined to\ndescribe the view direction of an individual pixel located at\n(i , j) in the CCD array by\nax5arccos~wx!, ~18!\nay5arccos~wy!, ~19!\naz5arccos~wz!, ~20!\n3.1 Solving the Equations\nEquations ~6! to ~9! and ~14! to ~16! are a set of seven\nequations for the seven unknowns ux , uy , uz , vx , vy , vz ,\nand F. Eliminating F via\nF5vy \/Eyy , ~21!\ngives\nux5avy , ~22!\nuy5bvy , ~23!\nvx5cvy , ~24!\nwith\na5Exx \/Eyy , ~25!\nb5Eyx \/Eyy , ~26!\nc5Exy \/Eyy . ~27!\nFor only slight distortions Exx , Eyy , and a are around 1,\nwhile the shear terms b and c are very small. For the sake\nof simplicity we can also assume that Exx and Eyy are posi-\ntive and nonzero ~x and y axis are not inverted and not\nrotated through 90 deg!.\nSolving the equations leads to\nuz\n250.5d6~e10.25d2!1\/2, ~28!\nvy\n25~12uz\n2!\/~a21b2!, ~29!\nvz\n2512~c211 !vy\n2\n, ~30!\nwz5uxvy2uyvx , ~31!\nwith410 Optical Engineering, Vol. 43 No. 2, February 2004\nDownloaded from SPIE Digital Library on 27 May 2d5@~a2bc !22~ac1b !22~a21b2!2#\/~a2bc !2\n512e2~a21b2!2\/~a2bc !2, ~32!\nand\ne5~ac1b !2\/~a2bc !2. ~33!\n3.2 Restrictions and Simplifications\nA unique choice needs to be made for the model to decide\nthe direction sign of uz derived from Eq. ~28! to be either\npositive or negative. The same is true for vy and vz from\nEqs. ~29! and ~30!. This choice relates to the two possibili-\nties whether the top surface of the image is tilted into the\nnegative or positive Z space. There is no way to decide\nbased on the local derivatives of the mapping function what\nsign the angle a should take.\nFor example, consider the camera viewing the image\nplane perpendicular, which is only true for some point in\nthe middle of the image. Dividing the image into top and\nbottom halves, in the upper half of the image, the camera is\nviewing the plane with some\u2014let us say, by definition\u2014\npositive angle (1ay) toward the Y axis. From the perspec-\ntive distortion, the image appears to be tilted away from the\nCCD. Similarly, the bottom part of the image appears also\nto tilt away from the CCD with however a negative angle\nay . The top half of the image has positive ay and the\nbottom half a negative ay . Theoretically one could think of\na saddle-like distortion, for which ay is zero in the middle\nof the image and being positive ~or negative! on one side\nwith the surface being tilted in the same direction. In this\ncase, the magnification factor would increase monotoni-\ncally from the top to the middle of the image, and then\ndecrease toward the bottom of the image.\nTo derive a solution, different potential outcomes need\nto be considered in solving for the unknowns. This particu-\nlarly relates to Eq. ~28!, where there are several solutions\nthat have different interpretations. Here, imaginary solu-\ntions are not considered.\n3.2.1 Case 1: e50\nIn Eq. ~28!, if e50, both the positive and the negative\nsquare-root solution can be considered. If e.0 only the\npositive sign is allowed. Consider first the case e50. This\nmeans that\nac1b50, ~34!\nwhich corresponds to\nExxExy1EyyEyx50. ~35!\nThis corresponds to a simple Z axis rotation of the recorded\nimage plane together with either a rotation around the X\naxis or around the Y axis. For the simplest case,\nb5Eyx \/Eyy50 and c5Exy \/Eyy50\u2192e50. ~36!\nEither the X axis or the Y axis is compressed corresponding\nto a rotation around the Y axis or the X axis, respectively.011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\nNobes, Wieneke, and Tatam: Determination of view vectors . . .3.2.2 Simplified case 1-A: b5c5e50, positive\nsquare-root solution to Eq. (28)\nThe positive square-root solution in Eq. ~28! is\nuz\n25d512a2, ~37!\nwhich requires\na5Exx \/Eyy,1, ~38!\nand the unity vectors are given by\nu85@a ,0,~12a2!1\/2# , ~39!\nv85~0,1,0 !. ~40!\nThis corresponds to a simple rotation around the Y axis,\ncompressing the X axis (a,1).\n3.2.3 Simplified case 1-B: b5c5e50, negative\nsquare-root solution to Eq. (28)\nSimilarly, this case leads to\nu85~1,0,0 ! ~41!\nv85@0,1\/a ,~121\/a2!1\/2# , ~42!\nand\na5Exx \/Eyy.1. ~43!\nThis corresponds to a simple rotation around the X axis,\ncompressing the Y axis (a.1).\n3.2.4 General case 1\nThe general case e50 with Eyx\u00de0 and Exy\u00de0 means that\nthe image plane is rotated in-plane around the Z axis and\nthe positive and negative square-root solution corresponds\nto an additional rotation around the X or Y axis, correspond-\ningly.Downloaded from SPIE Digital Library on 27 May 23.2.5 Case 2: e\u00de0\nAs derived, only the positive square-root solution is valid:\nuz\n250.5d1~e10.25d2!1\/2. ~44!\nAll other quantities are derived as given by Eqs. ~29! to\n~33!. This is the most general case with a rotation in-plane\nand a rotation around the X axis as well as the Y axis.\n3.3 Determination of the Sign of the View Angle\nUsing the definitions given in Eqs. ~18! to ~20! the view\nvector and hence the view angle calculation procedure will\nnot determine the sign of the view angle. If, however, only\nthe derived direction cosines are considered and some\nsimple rules are applied, then direction definitions can be\ngenerated. The rules in this case are derived from the view\nvector that is of interest. The vector direction is from a\npoint on the target towards the camera in a coordinate sys-\ntem that is based on the target at the point of interest. At the\norigin of the target the view vector o\u02c6 (0,0)\n5@ o\u02c6x(0,0) , o\u02c6 y(0,0) , o\u02c6 z(0,0)# is aligned with the Z8 axis and is\ndescribed by (wx ,wy ,wz). At a point of interest in the im-\nage the vector pointing to the camera can be defined as,\no\u02c6 (i , j) , where the direction cosines are\n@ o\u02c6x(i , j) , o\u02c6 y(i , j) , o\u02c6 z(i , j)# .\nA conceptual picture of how the direction cosines would\nvary across an image can be developed. Consider a pure\npositive rotation about the X axis. An image of the values of\ncomponent o\u02c6x covering the ROI would have zero magni-\ntude along the Y axis, i.e., o\u02c6x(0,j)50. For the positive region\nof the X axis, o\u02c6x(1i , j) would increase in magnitude and\nhave a negative direction, as depicted in Fig. 3~a!, where\nthe Y axis is out of plane. For the negative region of the X\naxis, o\u02c6x(2i , j) would also increase in magnitude and have a\npositive direction. For a large angle of rotation about the X\naxis, the magnitude of the vertical component o\u02c6 y would\nincrease from the top to the bottom of the image and its\nsign would be constantly positive over the whole image, as\nshown in Fig. 3~b!.\nA method to determine the sign has been developed\nbased on determining the local partial derivative of theFig. 4 Computer-generated image of a target of coplanar location markers viewed with a 30-deg\nrotation about the X axis: (a) the raw image and (b) the dewarped and scaled image.411Optical Engineering, Vol. 43 No. 2, February 2004\n011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\nNobes, Wieneke, and Tatam: Determination of view vectors . . .\n412 Optical EngiFig. 5 Distribution of the magnitude (gray scale) of the direction cosines: (a) o\u02c6(i, j)x , (b) o\u02c6(i, j)y , and (c)\no\u02c6(i, j)z . (Axes in arbitrary length units.)magnitude of the local direction vector component. Using\nthe conceptual picture of the direction vectors for a pure\nrotation about the X axis, the X direction vector would go\nfrom positive to negative for the left-to-right regions of the\nimage. This would match the sign of the local partial direc-\ntive in the horizontal direction. The local partial derivative\ncan be determined using a horizontal Sobel filter on the\nimage. The sign of this derivative can then be used to de-\nfine the sign of the direction vector. A similar procedure can\nbe developed for the vertical component. Since the Z axis\nhas been defined earlier as pointing toward the camera, the\nwz component of the local view vector will always have a\npositive direction.\n4 Results and Discussion\nTo test the procedure an image of a test target consisting of\na regular array of coplanar crosses was generated using a\n3-D drawing package.9 This allowed manipulation of the\nview of the target to a know angle. Camera parameters,\nincluding the position of the camera and camera view ori-\nentation can be explicitly included into the target model.\nThe package also enabled lens modeling of the view to\ngenerate perspective distortion using a pin-hole camera\nmodel. An image of the target with crosses spaced at a\nknown regular interval is shown in Fig. 4~a!. For this im-\nage, the target has been rotated about the X axis by 30 deg\nwith the top of the target tilted toward the camera. To gen-\nerate the target, dimensionless length units in a ratio that\nmight be typical of an experiment where used. Arbitrary\nunits are used as length scales. The camera is located at\nPcam5(0,0,1000) in the reference frame of the experiment\nand views a region 1003100 units. The view is generated\nby modeling a lens with a focal length of 250 units. The\ncrosses are at a regular spacing in the X and Y directions of\n10 units and have a line aspect ratio of 6:1. A significantneering, Vol. 43 No. 2, February 2004\nDownloaded from SPIE Digital Library on 27 May 2advantage of computer generating the image is that there is\nno noise in the image and the image is in perfect focus.\nFigure 4~a! shows an image of the perspective view of\nthe target. In Fig. 4~b! the image has been dewarped and\nspatially scaled using the information derived from the\ndewarping mapping functions. The image has increased in\nsize ~total number of pixels! to accommodate all of the\noriginal data that was captured and shown in Fig. 4~a!. At\nlocations outside the original data the image has been pad-\nded with intensities of zero value. The image in Fig. 4~b!\nshows that the dewarping algorithm has effectively\nstretched the image in the Y direction.\nUsing the technique outlined earlier the spatial variation\nin the mapping function has been used to determine the\ndirection cosines of the vector o\u02c6 (i , j) at each pixel location\n(i , j) in the image. Maps, the same size ~number of pixels!\nas the dewarped image, of the magnitude of the compo-\nnents of the direction cosines are shown in Fig. 5. The\nderivation of the direction cosines based on the spatial gra-\ndient of the mapping function does not determine the sign\nof the individual components, only the magnitude, so only\nthe absolute values are shown in Fig. 5. Using the rules\ndiscussed earlier, the sign of the components can be deter-\nmined and are shown in Fig. 6. We can see in Fig. 6 that for\nthe case of a pure rotation about the X axis only, the sign\ndirection of the o\u02c6x(i , j) component is altered.\nWith the sign and magnitude of the direction cosines\ndetermined it is a simple process to calculate the related\nangles. Maps of these angles, as defined in Figs. 2 and 3,\nare shown in Fig. 7. The conceptual picture of the variation\nin view direction angle discussed earlier can be seen in Fig.\n7. The component o\u02c6x(i , j) , expressed as the angle ax in Fig.\n7~a!, shows that at i50 the view angle, in the X direction,\nis perpendicular to the plane of the target. Away from this\npoint o\u02c6x(i , j) increases in magnitude and at the extent of theFig. 6 Distribution of the magnitude (gray scale) of the signed direction cosines: (a) o\u02c6(i, j)x , (b) o\u02c6(i, j)y ,\nand (c) o\u02c6(i, j)z . (Axes in arbitrary length units.)011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\nNobes, Wieneke, and Tatam: Determination of view vectors . . .Fig. 7 Distribution of the related angles of the direction cosines: (a) ax , (b) ay , and (c) az . (Axes in\narbitrary length units.)view a variation in the view angle of ;6 deg. The angles\nay and az , as shown in the Figs. 7~b! and 7~c!, are\nuniquely related on the Y axis by ax590 deg2az . Angle\naz shows directly the magnitude the rotation applied to the\ntest target. At the center of the image the rotation is mea-\nsured as 30 deg, equal to the bulk view angle used to gen-\nerate the target model. Away from the center of the image\nin the X direction there is variation of the angle due to the\nbulk rotation applied and to perspective distortion. At the\nlimits of the image the variation in the measured rotation of\nthe test target is ;6 deg.\nA simple pin-hole camera model7 of the view of the\ntarget can be used to investigate the accuracy of the deter-\nmined view angle along the major axes of the image. Using\nthe definitions shown in Fig. 3, the depicted angles can be\ncalculated along the major axis using the following:\nax~ i ,0!5tan\n21S fi D , ~45!\nay~0,j !5tan\n21S f cos~u!f sin~u!2 j D , ~46!\naz~0,j !5tan\n21S f sin~u!2 jf cos~u! D . ~47!\nHere, the bulk view angle u is the angle of rotation about\nthe X axis and is equivelent to the angle that is made with\nthe Z axis az . Several values of u in steps of 10 deg were\nused in this test from u50 deg, which is a perpendicular\nview of the target, to u560 deg, which is near the practical\nextent of what would be used in an experiment. The varia-\ntion of ax , ay , and az in degrees along the major axes is\nshown in Fig. 8 for these test cases. The procedure to de-\ntermine the view shows excellent agreement with the\nsimple pin-hole camera model of view angle components\nfor a few bulk angles in the range 10 to 60 deg. There is\nsome variation in the gradient seen in the plot, however, the\nerror in the difference between the two results is less than\n0.75%. The technique breaks down for bulk view angles\nthat are below 10 deg, which are views that are close to a\nperpendicular view. This is particularly highlighted in Fig.\n8~a! where the measured angle for all cases except for u50\ndeg is similar. In the experiment, the views used in PDV\nare often away from the perpendicular in the range 20 to 50\ndeg. Hence in practical use, the technique will resolve the\nview angle for each individual pixel in the view.Downloaded from SPIE Digital Library on 27 May 2Fig. 8 Distribution of the calculated view angle (s) compared to the\nangle determined using a pin-hole camera model (-): (a) angle ax\nalong the X axis, (b) angle ay along the Y axis, and (c) angle az\nalong the Z axis. (Abscissa in arbitrary length units.)413Optical Engineering, Vol. 43 No. 2, February 2004\n011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\nNobes, Wieneke, and Tatam: Determination of view vectors . . .The technique relies on the accurate determination of the\nmapping functions used to map the warped image onto a\nregular grid. Any degradation of the target image by noise,\nblurring of the image, or poor contrast will affect the per-\nformance of the dewarping technique in accurately deter-\nmining the location of the markers. This will lead to an\nerror in the mapping function and hence to an error in the\ndetermination of the view angle.\n5 Conclusions\nA procedure for determining the view vector of each indi-\nvidual pixel in a CCD array from a known planar target was\ndeveloped. The procedure uses the spatial gradient in the\nmapping functions used to dewarp the image to determine\nthe direction cosines from the viewed region to the indi-\nvidual capture pixel in the camera array. The procedure\nrequires that a known target of coplanar location markers is\nused to enable determination of both the mapping functions\nas well as scaling parameters of the image. The known\nscaling of the location markers is all that the procedure\nrequires to determine view direction cosines. No other\nphysical measurement is necessary. This procedure is\nshown to give results that enable correction for individual\npixel view vectors, while determining the bulk view angle\nto the test target. This procedure shows that accurate deter-\nmination of view vector can be achieved without physical\nin situ measurement making the procedure useful for situ-\nations of confined access or where the range of the view is\nsmall.\nAcknowledgments\nThe work was funded by the Engineering and Physical Sci-\nences Research Council ~EPSRC!, United Kingdom.\nReferences\n1. J. F. Meyers and H. Komine, \u2018\u2018Doppler global velocimetry: a new way\nto look at velocity,\u2019\u2019 Laser Anemomet. 1, 289\u2013296 ~1991!.\n2. D. S. Nobes, H. D. Ford, and R. P. Tatam, \u2018\u2018Three component planar\nDoppler velocimetry using imaging fibre bundles,\u2019\u2019 in Proc. 11th Int.\nSymp. on Applications of Lasers Techniques to Fluid Mechanics, Lis-\nbon, Portugal paper 9-5 ~2002!.\n3. R. Jones and C. Wykes, Holographic and Speckle Interferometry,\n~Cambridge University Press, Cambridge, 1989!.\n4. Y. Y. Hung, \u2018\u2018Shearography: a new optical method for strain measure-\nment and nondestructive testing,\u2019\u2019 Opt. Eng. 21~3!, 391\u2013395 ~1982!.\n5. A. Gruen and T. S. Huang, Eds., in Calibration and Orientation of\nCameras in Computer Vision, Springer-Verlag ~2001!.\n6. R. Y. Tsai, \u2018\u2018A versatile camera calibration technique for high-\naccuracy 3D machine vision metrology using off-the-shelf TV cam-\neras and lenses,\u2019\u2019 IEEE J. Robot. Automat. RA-3~4!, 323\u2013344 ~1987!.414 Optical Engineering, Vol. 43 No. 2, February 2004\nDownloaded from SPIE Digital Library on 27 May 27. Z. Zhang, \u2018\u2018A flexible new technique for camera calibration,\u2019\u2019 IEEE\nTrans. Pattern Anal. Mach. Intell. 22~11!, 1330\u20131334 ~2000!.\n8. S. M. Soloff, R. J. Adrian, and Z. C. Liu, \u2018\u2018Distortion compensation\nfor generalized stereoscopic particle image velocimetry,\u2019\u2019 Meas. Sci.\nTechnol. 8, 1441\u20131454 ~1997!.\n9. Rhinoceros \u2018\u2018NURBS modelling for windows,\u2019\u2019 http:\/\/\nwww.rhino3d.com\/.\nDavid S. Nobes joined the School of Engi-\nneering at Cranfield University, United\nKingdom, in 1999. Previously, he was with\nthe Department of Mechanical Engineering\nat the University of Adelaide, Australia,\nwhere he worked on the fluid dynamic and\ncombustion problems of industrial scale\ngas burners. He was also involved in in-\ndustrial scale burner trials at the Interna-\ntional Flame Research Foundation (The\nNetherlands) and burner commissioning\nwithin cement kilns. Dr. Nobes was part of the research team that\ndeveloped the Olympic relay torch for the Sydney 2000 Olympic,\nGames and conducted the initial development trials on the burner\nused for the stadium. At Cranfield University, he has been working\non the development of planar Doppler velocimetry instrumentation\nfor flow measurement applications within gas turbine compressors\nand wind tunnels.\nBernhard Wieneke received his MS in as-\ntrophysics at Rice University, Houston,\nTexas. Since 1989, he has been working\nwith LaVision GmbH developing hardware\nand software for laser and CCD-based op-\ntical measurement systems. His special in-\nterests are advanced PIV algorithms.\nRalph P. Tatam is a professor of engineer-\ning photonics in the School of Engineering\nat Cranfield University, United Kingdom,\nand heads the Optical Sensors Group. He\nhas been active in optical and optical fiber\nbased instrumentation and sensing for\nnearly 20 years. His current research inter-\nests include optical flow measurement,\nspeckle interferometry, and optical fiber\nsensors. He graduated with a BSc in phys-\nics and chemistry from Exeter University,\nUnited Kingdom, in 1981, and received a PhD in physics Council for\nNational Academic Awards in 1986. Following four years at the\nPhysics Laboratory at the University of Kent he moved to Cranfield\nUniversity. He has published more than 250 papers and has been\ninvolved with numerous national and international conferences.011 to 138.250.86.167. Terms of Use:  http:\/\/spiedl.org\/terms\n"}