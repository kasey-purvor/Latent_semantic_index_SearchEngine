{"doi":"10.1046\/j.1365-8711.2003.06503.x","coreId":"65733","oai":"oai:dro.dur.ac.uk.OAI2:4963","identifiers":["oai:dro.dur.ac.uk.OAI2:4963","10.1046\/j.1365-8711.2003.06503.x"],"title":"Stable clustering, the halo model and non-linear cosmological power spectra.","authors":["Smith,  R. E.","Peacock,  J. A.","Jenkins,  A. R.","White,  S. D. M.","Frenk,  C. S.","Pearce,  F. R.","Thomas,  P. A.","Efstathiou,  G.","Couchman,  H. M. P."],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2003-06-01","abstract":"We present the results of a large library of cosmological N-body simulations, using power-law initial spectra. The non-linear evolution of the matter power spectra is compared with the predictions of existing analytic scaling formulae based on the work of Hamilton et al. The scaling approach has assumed that highly non-linear structures obey 'stable clustering' and are frozen in proper coordinates. Our results show that, when transformed under the self-similarity scaling, the scale-free spectra define a non-linear locus that is clearly shallower than would be required under stable clustering. Furthermore, the small-scale non-linear power increases as both the power spectrum index n and the density parameter \u03a9 decrease, and this evolution is not well accounted for by the previous scaling formulae. This breakdown of stable clustering can be understood as resulting from the modification of dark matter haloes by continuing mergers. These effects are naturally included in the analytic 'halo model' for non-linear structure; we use this approach to fit both our scale-free results and also our previous cold dark matter data. This method is more accurate than the commonly used Peacock\u2013Dodds formula and should be applicable to more general power spectra. Code to evaluate non-linear power spectra using this method is available from http:\/\/as1.chem.nottingham.ac.uk\/~res\/software.html. Following publication, we will make the power-law simulation data publically available through the Virgo website http:\/\/www.mpa-garching.mpg.de\/Virgo\/","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/65733.pdf","fullTextIdentifier":"http:\/\/dro.dur.ac.uk\/4963\/1\/4963.pdf","pdfHashValue":"d44cb0111bafde056e49302ae2ef4fa796be2e8a","publisher":"Blackwell","rawRecordXml":"<record><header><identifier>\n  \n    \n      oai:dro.dur.ac.uk.OAI2:4963<\/identifier><datestamp>\n      2015-06-02T14:18:50Z<\/datestamp><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        Stable clustering, the halo model and non-linear cosmological power spectra. <\/dc:title><dc:creator>\n        Smith,  R. E.<\/dc:creator><dc:creator>\n        Peacock,  J. A.<\/dc:creator><dc:creator>\n        Jenkins,  A. R.<\/dc:creator><dc:creator>\n        White,  S. D. M.<\/dc:creator><dc:creator>\n        Frenk,  C. S.<\/dc:creator><dc:creator>\n        Pearce,  F. R.<\/dc:creator><dc:creator>\n        Thomas,  P. A.<\/dc:creator><dc:creator>\n        Efstathiou,  G.<\/dc:creator><dc:creator>\n        Couchman,  H. M. P.<\/dc:creator><dc:description>\n        We present the results of a large library of cosmological N-body simulations, using power-law initial spectra. The non-linear evolution of the matter power spectra is compared with the predictions of existing analytic scaling formulae based on the work of Hamilton et al. The scaling approach has assumed that highly non-linear structures obey 'stable clustering' and are frozen in proper coordinates. Our results show that, when transformed under the self-similarity scaling, the scale-free spectra define a non-linear locus that is clearly shallower than would be required under stable clustering. Furthermore, the small-scale non-linear power increases as both the power spectrum index n and the density parameter \u03a9 decrease, and this evolution is not well accounted for by the previous scaling formulae. This breakdown of stable clustering can be understood as resulting from the modification of dark matter haloes by continuing mergers. These effects are naturally included in the analytic 'halo model' for non-linear structure; we use this approach to fit both our scale-free results and also our previous cold dark matter data. This method is more accurate than the commonly used Peacock\u2013Dodds formula and should be applicable to more general power spectra. Code to evaluate non-linear power spectra using this method is available from http:\/\/as1.chem.nottingham.ac.uk\/~res\/software.html. Following publication, we will make the power-law simulation data publically available through the Virgo website http:\/\/www.mpa-garching.mpg.de\/Virgo\/.<\/dc:description><dc:publisher>\n        Blackwell<\/dc:publisher><dc:source>\n        Monthly notices of the Royal Astronomical Society, 2003, Vol.341(4), pp.1311-1332 [Peer Reviewed Journal]<\/dc:source><dc:date>\n        2003-06-01<\/dc:date><dc:type>\n        Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:identifier>\n        dro:4963<\/dc:identifier><dc:identifier>\n        issn:0035-8711<\/dc:identifier><dc:identifier>\n        issn: 1365-2966<\/dc:identifier><dc:identifier>\n        doi:10.1046\/j.1365-8711.2003.06503.x<\/dc:identifier><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/4963\/<\/dc:identifier><dc:identifier>\n        http:\/\/dx.doi.org\/10.1046\/j.1365-8711.2003.06503.x<\/dc:identifier><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/4963\/1\/4963.pdf<\/dc:identifier><dc:rights>\n        The definitive version is available at www.blackwell-synergy.com<\/dc:rights><dc:accessRights>\n        info:en-repo\/semantics\/openAccess<\/dc:accessRights><\/oai_dc:dc><\/metadata><\/record>","journals":[{"title":null,"identifiers":["issn: 1365-2966"," 1365-2966","0035-8711","issn:0035-8711"]}],"language":{"code":"en","id":9,"name":"English"},"relations":[],"year":2003,"topics":[],"subject":["Article","PeerReviewed"],"fullText":"Durham Research Online\nDeposited in DRO:\n29 April 2008\nVersion of attached file:\nOther\nPeer-review status of attached file:\nPeer-reviewed\nCitation for published item:\nSmith, R. E. and Peacock, J. A. and Jenkins, A. and White, S. D. M. and Frenk, C. S. and Pearce, F. R. and\nThomas, P. A. and Efstathiou, G. and Couchman, H. M. P. (2003) \u2019Stable clustering, the halo model and\nnon-linear cosmological power spectra.\u2019, Monthly notices of the Royal Astronomical Society., 341 (4). pp.\n1311-1332.\nFurther information on publisher\u2019s website:\nhttp:\/\/dx.doi.org\/10.1046\/j.1365-8711.2003.06503.x\nPublisher\u2019s copyright statement:\nThe definitive version is available at www.blackwell-synergy.com\nAdditional information:\nUse policy\nThe full-text may be used and\/or reproduced, and given to third parties in any format or medium, without prior permission or charge, for\npersonal research or study, educational, or not-for-profit purposes provided that:\n\u2022 a full bibliographic reference is made to the original source\n\u2022 a link is made to the metadata record in DRO\n\u2022 the full-text is not changed in any way\nThe full-text must not be sold in any format or medium without the formal permission of the copyright holders.\nPlease consult the full DRO policy for further details.\nDurham University Library, Stockton Road, Durham DH1 3LY, United Kingdom\nTel : +44 (0)191 334 3042 \u2014 Fax : +44 (0)191 334 2971\nhttp:\/\/dro.dur.ac.uk\n Use policy \n \nThe full-text may be used and\/or reproduced, and given to third parties in any format or medium, without \nprior permission or charge, for personal research or study, educational, or not-for-profit purposes \nprovided that : \n \n\u0083 a full bibliographic reference is made to the original source \n\u0083 a link is made to the metadata record in DRO \n\u0083 the full-text is not changed in any way \n \nThe full-text must not be sold in any format or medium without the formal permission of the copyright \nholders.  \n \nDurham University Library, Stockton Road, Durham DH1 3LY, United Kingdom \nTel : +44 (0)191 334 3042 | Fax : +44 (0)191 334 2971 \nhttp:\/\/dro.dur.ac.uk \nDurham Research Online 25 April 2008 \n \nCitation for item:  \nSmith, R. E. and Peacock, J. A. and Jenkins, A. and White, S. D. M. and Frenk, C. S. \nand Pearce, F. R. and Thomas, P. A. and Efstathiou, G. and Couchman, H. M. P. \n(2003) 'Stable clustering, the halo model and non-linear cosmological power spectra. ' , \nMonthly notices of the Royal Astronomical Society., 341 (4), pp. 1311-1332. \n \nDefinitive version available at:  \nhttp:\/\/dx.doi.org\/10.1046\/j.1365-8711.2003.06503.x \nar\nX\niv\n:a\nstr\no-\nph\n\/0\n20\n76\n64\nv1\n  3\n1 \nJu\nl 2\n00\n2\nMon. Not. R. Astron. Soc. 000, 000\u2013000 (0000) Printed 18 April 2008 (MN LATEX style file v1.4)\nStable clustering, the halo model and nonlinear\ncosmological power spectra\nR. E. Smith1,2\n\u22c6\n, J. A. Peacock1, A. Jenkins3, S. D. M. White4, C. S. Frenk3,\nF. R. Pearce2, P. A. Thomas5, G. Efstathiou6 and H. M. P. Couchman7\n(The Virgo Consortium)\n1 Institute for Astronomy, University of Edinburgh, Royal Observatory, Blackford Hill, Edinburgh EH9 3HJ, U.K.\n2 School of Physics and Astronomy, University of Nottingham, University Park, Nottingham NG7 2RD, U.K.\n3 Department of Physics, University of Durham, South Road, Durham DH1 3LE, U.K.\n4 Max-Planck-Institut fu\u00a8r Astrophysik, Garching, D-85740 Mu\u00a8nchen, Germany\n5 Astronomy Centre, CPES, University of Sussex, Falmer, Brighton BN1 9QH, U.K.\n6 Institute of Astronomy, Madingley Road, Cambridge CB3 0HA, U.K.\n7 Department of Physics and Astronomy, McMaster University, Hamilton, Ontario L8S 4M1, Canada\n18 April 2008\nABSTRACT\nWe present the results of a large library of cosmological N -body simulations, us-\ning power-law initial spectra. The nonlinear evolution of the matter power spectra\nis compared with the predictions of existing analytic scaling formulae based on the\nwork of Hamilton et al. The scaling approach has assumed that highly nonlinear\nstructures obey \u2018stable clustering\u2019 and are frozen in proper coordinates. Our results\nshow that, when transformed under the self-similarity scaling, the scale-free spectra\ndefine a nonlinear locus that is clearly shallower than would be required under sta-\nble clustering. Furthermore, the small-scale nonlinear power increases as both the\npower-spectrum index n and the density parameter \u2126 decrease, and this evolution\nis not well accounted for by the previous scaling formulae. This breakdown of sta-\nble clustering can be understood as resulting from the modification of dark-matter\nhaloes by continuing mergers. These effects are naturally included in the analytic\n\u2018halo model\u2019 for nonlinear structure; we use this approach to fit both our scale-free\nresults and also our previous CDM data. This method is more accurate than the\ncommonly-used Peacock\u2013Dodds formula and should be applicable to more general\npower spectra. Code to evaluate nonlinear power spectra using this method is available\nfrom http:\/\/as1.chem.nottingham.ac.uk\/\u223cres\/software.html. Following publi-\ncation, we will make the power-law simulation data available through the Virgo website\nhttp:\/\/www.mpa-garching.mpg.de\/Virgo\/.\nKey words: Cosmology: theory \u2013 large scale structure of Universe \u2013 Galaxies: grav-\nitational clustering\n1 INTRODUCTION\nIn the current cosmological paradigm, structures grow\nthrough the gravitational instability of collisionless dark\nmatter fluctuations. This occurs in a hierarchical way, with\nsmall-scale perturbations collapsing first and large-scale per-\nturbations later. One of the most direct manifestations of\nthis nonlinear process is the evolution of the power spectrum\nof the mass, P (k), where k is the wavenumber of a given\n\u22c6 E-mail: robert.e.smith@nottingham.ac.uk\nFourier mode. Understanding this evolution of the power\nspectrum is one of the key problems in structure formation,\nbeing directly related to the abundance and clustering of\ngalaxy systems as a function of mass and redshift. If the\nprocesses that contribute to the evolution can be captured\nin an accurate analytic model, this opens the way to us-\ning observations of the nonlinear mass distribution (from\nlarge-scale galaxy clustering or weak gravitational lensing)\nin order to recover the primordial spectrum of fluctuations.\nOne of the most influential attempts at such an analytic\ndescription of clustering evolution was the \u2018scaling ansatz\u2019\nc\u00a9 0000 RAS\n2 Smith et al.\nof Hamilton et al. (1991; HKLM), which is described in Sec-\ntion 2. This scaling procedure was generalized to models\nwith \u2126 6= 1 and given a more accurate N-body calibration\nby Peacock & Dodds (1996; PD96). HKLM assumed that a\nnonlinear collapsed object would decouple from the global\nexpansion of the Universe to form an isolated system in virial\nequilibrium \u2013 the \u2018stable clustering\u2019 hypothesis of Davis &\nPeebles (1977). This assumption has been widely adopted,\nand yet it appears somewhat inconsistent wich hierarchical\nmodels \u2013 in which objects are continuously accreting mass\nand growing through mergers. Indeed, the validity of stable\nclustering has been increasingly questioned in recent years\n(e.g. Yano & Gouda 2000; Caldwell et al. 2001). One of our\naims in this paper is thus to establish whether stable clus-\ntering is relevant for understanding the small-scale evolution\nof the power spectrum.\nWe therefore explore the gravitational instability of\ndark matter fluctuations through a series of large N-body\nsimulations of clustering from power-law initial conditions,\nwith\nP (k) \u221d kn. (1)\nWe consider both \u2126 = 1 models, in which the evolution\ncan obey a similarity solution, and also low-density models\nwith and without a cosmological constant. We demonstrate\nthat the resolution of the simulations is sufficient to mea-\nsure the power well into the regime at which the HKLM\nprocedure predicts a well-defined slope for the power spec-\ntrum determined by stable clustering. In practice, we find\nthat the power spectra are generally shallower than would\nbe required for clustering to be stable on small scales. Fur-\nthermore, as both n and \u2126 decrease, the amplitude of the\nsmall-scale spectrum increases in a manner that is not well\ndescribed by any of the previous fitting formulae. In light of\nthese results, a new method for predicting nonlinear spectra\nis proposed. This method is based on the \u2018halo model\u2019 (e.g.\nSeljak 2000; Peacock & Smith 2000), which does not assume\nstable clustering. This allows us to fit our data and also the\ncold dark matter (CDM) data of Jenkins et al. (1998; J98)\nwith a high degree of accuracy.\nThe paper is structured as follows. In Section 2 we pro-\nvide a brief overview of the theoretical understanding of\nnonlinear evolution. In particular, a description of the stable\nclustering hypothesis, the nonlinear HKLM scaling relations\nand the halo model are given, as these ideas are central to\nthis paper. We also discuss the scale-free models and their\nself-similarity properties. In Section 3 we describe the nu-\nmerical simulations and we provide a visual comparison of\nthe growth of structure in the different scale-free models.\nIn Section 4 we describe an improved method for measur-\ning power spectra and in Section 5 we present the power\nspectra data and contrast them with the current nonlinear\nfitting formulae. In Section 6 we describe a new approach\nto fitting power spectra and its generalization to CDM, and\nthen compare our new globally optimized formula with the\nresults from Section 5 and also the CDM data. Finally, in\nSection 7 we draw our conclusions and discuss our findings\nin a wider context.\n2 DESCRIPTION OF NONLINEAR\nEVOLUTION\n2.1 From linear theory to stable clustering\nThe mass density field, at comoving position x and time t,\nis defined as\n\u03c1(x, t) = \u03c1\u00af(t) [1 + \u03b4(x, t)] , (2)\nwhere \u03b4 is the density fluctuation about the homogeneous\nbackground \u03c1\u00af. The 2-point auto-correlation function of the\ndensity field is\n\u03be(r) = \u3008\u03b4(x)\u03b4(x+ r)\u3009 , (3)\nwhich in three dimensions is related to the dimensionless\npower spectrum \u22062(k) through the integral relation\n\u03be(r) =\n\u222b\n\u22062(k)\nsin kr\nkr\ndk\nk\n, (4)\nwhere we have assumed that the field is isotropic and ho-\nmogeneous. \u22062 is the contribution to the fractional density\nvariance per unit ln k. In the convention of Peebles (1980),\nthis is\n\u22062(k) \u2261\nd\u03c32\nd ln k\n=\nV\n(2\u03c0)3\n4\u03c0k3P (k) , (5)\nV being a normalization volume.\nWhen \u03b4(x, t)\u226a 1 the temporal evolution of the fluctu-\nation is separable and the field scales as\n\u03b4(x, t) =\nD(t)\nD(t0)\n\u03b4(x, t0) , (6)\nwhereD(t) is a growth factor whose exact form can be deter-\nmined from linear theory. As \u03b4(x, t)\u2192 1, increasingly higher\norders of perturbation theory are required (see Bernardeau\net al. 2001 for a thorough review). Eventually, perturbation\ntheory fails and numerical methods must be applied. Even\nso, it was proposed (Peebles 1974a; Davis & Peebles 1977;\nPeebles 1980) that clustering in the very nonlinear regime\nmight be understood by assuming that regions of high den-\nsity contrast undergo virialization and subsequently main-\ntain a fixed proper density. The correlation function for a\npopulation of such systems would then simply evolve ac-\ncording to \u03be(r, t) \u221d 1\/\u03c1\u00af \u221d a3, where r is a proper distance.\nThis evolution was termed \u2018stable clustering\u2019. Peebles went\non to show that if the initial power spectrum was a pure\npower-law in k with spectral index n, P (k) \u221d kn, then under\nthe stable clustering hypothesis, the slope of the nonlinear\ncorrelation function would be directly related to the spectral\nindex through the relation\n\u03be(r, t) \u221d r\u2212\u03b3 ; \u03b3 =\n3(3 + n)\n5 + n\n. (7)\nHence, if stable clustering applies, then the nonlinear density\nfield retains some memory of its initial configuration, and in\nprinciple can be used to measure the primordial spectrum\nof fluctuations.\n2.2 The HKLM scaling relations\nHKLM developed a method for interpolating between linear\ntheory on large scales and the nonlinear predictions of the\nstable clustering hypothesis on small scales. They showed\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 3\nthat the nonlinear volume averaged two-point correlation\nfunction,\n\u03be\u00af(x) \u2261\n3\nx3\n\u222b x\n0\ny2\u03be(y) dy , (8)\nmeasured from the scale-free simulations of Efstathiou et al.\n(1988), could be parameterized by a simple function of the\nlinear correlation function, provided that nonlinear evolu-\ntion were to induce a change of scale.\nThe transformation of scales follows from an intuitive\ncontinuity argument, based upon the \u2018spherical top-hat\u2019\nmodel. Let the mass enclosed within a spherical overden-\nsity in the initial stages of evolution be m0 (< \u2113) and its\nmass at some later time be m (< x). As each shell evolves,\nit will reach a maximum expansion point, turn around and\ncollapse. If there is no shell crossing, then mass is conserved\nand\nm0 (< \u2113) =\n4\n3\n\u03c0\u03c1 (< \u2113) \u21133 =\n4\n3\n\u03c0\u03c1 (< x) x3 = m (< x)) . (9)\nThe argument now identifies 1 + \u03be\u00af as the factor by which\nthe density is enhanced relative to the mean (Peebles 1980).\nProvided \u03be\u00afL \u226a 1, this implies the scaling\nx3\n[\n1 + \u03be\u00afNL(x, t)\n]\n= \u21133 , (10)\nwhere x represents a nonlinear scale and \u2113 a Lagrangian\nscale.\nFinally, after this rescaling, the nonlinear correlations\nare taken to be a universal function of the linear ones:\n\u03be\u00afNL(x, t) = f\n[\n\u03be\u00afL(\u2113, t)\n]\n. (11)\nHKLM then assumed that the functional form of f(y) could\nbe determined analytically in two regimes: in the linear\nregime, where \u03be\u00afL \u226a 1, f(y) = y ; when \u03be\u00afL \u226b 1, galaxy\ngroups would exhibit \u2018stable clustering\u2019, for which \u22062NL \u221d a\n3\nand since \u22062L \u221d a\n2, this implied that f(y) \u221d y3\/2. The\ninterpolation between these two regimes, where y \u223c 1,\nwas determined empirically by HKLM, by comparison with\nnumerical simulation. However, Padmanabhan (1996) pro-\nposed that the quasilinear regime could also be understood\nanalytically. He considered the point at which a spheri-\ncal perturbation would reach its maximum radius, which\nis xmax = l\/\u03b4L \u221d l\/\u03be\u00afL, according to the spherical model.\nPadmanabhan thus conjectured that\n\u03be\u00afQ \u221d \u03c1(< xmax) \u221d\nm\nx3max\n\u221d\nm0\nx3max\n\u221d\nl3\nl3\/\u03be\u00af3L\n\u221d \u03be\u00af3L (12)\n(in effect rediscovering the argument of Gott & Rees 1975).\nAlthough useful heuristically in explaining why the quasilin-\near regime of fNL should be steeper than either the linear or\nnonlinear regime, it is not clear that this expression matches\nthe observed quasilinear slope very well (Padmanabhan et\nal. 1996; Jain1997). We investigate this further in Section 5.\nHKLM\u2019s nonlinear scaling argument was further devel-\noped by Peacock & Dodds (1994; PD94), who proposed that\nthe scaling ansatz could be used for predicting power spectra\nby simply replacing \u03be\u00af \u2192 \u22062 and letting the linear and non-\nlinear scales represent linear and nonlinear wavenumbers:\n\u2113 = k\u22121L and x = k\n\u22121\nNL. This suggested the formalism\n\u22062NL(kNL) = fNL\n[\n\u22062L(kL)\n]\n;\nkNL =\n[\n1 +\u22062NL(kNL)\n]1\/3\nkL. (13)\nThe accuracy of the HKLM and PD94 scaling formulae\nwas tested by Jain, Mo & White (1995; JMW95). They per-\nformed a series of simulations with 1003 particles as opposed\nto the previous 323, and discovered that the nonlinear lo-\ncus described by the data exhibited a strong n-dependence.\nThe HKLM and PD94 functions underestimated the mea-\nsured correlation functions and power spectra, the fits being\nworse for more negative n. JMW95 then showed that this\nn-dependence could be removed by a simple scaling of the\nvariables in the log \u03be\u00afNL(x, t)\u2212 log \u03be\u00afL(\u2113, t) plane. In order for\nthe model to be applied to curved spectra, such as the CDM\nmodel, an effective spectral index neff was required. JMW95\nproposed that the appropriate n should be given by\nneff =\nd lnP (k)\nd ln k\n\u2223\u2223\u2223\u2223\nk=1\/Rc\n, (14)\nwhere Rc is the scale on which the variance of the density\nfield is unity. This showed the right response with scale, and\ndescribed their data to a precision of 15 \u2212 20%, which was\nadequate given the scatter within the simulations.\nFurther refinements were again made by Peacock &\nDodds (1996; PD96), who used a large ensemble of 803 par-\nticle simulations to investigate the n-dependence and the\nresponse of the clustering to low density universes: \u2126 < 1\nand \u2126 + \u039b = 1, where \u2126 and \u039b are the densities associated\nwith matter and the cosmological constant, relative to the\nEinstein-de Sitter universe. PD96 concluded that nonlinear\neffects tend to increase the power on small scales for spectra\nwith more negative spectral indices and for lower densities.\nPD96 also produced a fitting formula which modelled their\ndata, and also CDM-like spectra through defining an effec-\ntive spectral index that changed with each wavenumber\nneff(kL) =\nd lnP\nd ln k\n(k = kL\/2) . (15)\nSubsequently, high resolution numerical simulations of\nCDM-like universes have shown that the PD96 formulae\nmatch the observed nonlinear power spectra closely (Mo,\nJing & Bo\u00a8rner 1997; J98; Smith et al. 1998), but with some\nsignificant deviations. Jain & Bertschinger (1998) found a\nlarger discrepancy in their 2563 P3M simulation of cluster-\ning from an n = \u22122 power spectrum, with both the for-\nmula of JMW95 and PD96 underestimating the quasi-linear\npower. They also claimed that their results for highly non-\nlinear clustering were in accordance with stable clustering,\nalthough finite volume effects have drawn their results into\nquestion (Ma & Fry 2000a; Scoccimarro et al. 2001). We\ndiscuss this issue in further detail in Section 3.3. Recent\nattempts to constrain cosmological parameters from weak\ngravitational lensing studies, that require as input the non-\nlinear matter power spectrum, have also uncovered deficien-\ncies in the PD96 formula, with the poorest performance for\nthe \u2126 = 1 \u03c4CDM model (Van Waerbeke et al. 2001).\n2.3 A dark matter halo approach\nMore recently an entirely different analytical model for non-\nlinear gravitational clustering has emerged: the \u2018halo model\u2019.\nIn this model, the density field is decomposed into a distri-\nbution of clumps of matter with some density profile. This\nbasic idea goes back to Neyman & Scott (1952), and recurs\nin more modern form in (Scherrer & Bertschinger 1991).\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n4 Smith et al.\nFollowing the realization that galaxy bias was strongly in-\nfluenced by the number of galaxies in a halo (Benson et al.\n2000), a number of authors (Seljak 2000; Peacock & Smith\n2000; Ma & Fry 2000a; Scoccimarro et al. 2001) resurrected\nthe Neyman\u2013Scott model with a modern mass function for\ndark haloes (Press & Schechter 1974; Sheth & Tormen 1999;\nJenkins et al. 2001), plus realistic density profiles (Navarro,\nFrenk & White 1996; Navarro, Frenk & White 1997; Moore\net al. 1999), and a mass-dependent galaxy \u2018occupation num-\nber\u2019. The inclusion of bias is an attractive aspect of the halo\nmodel, but we will not be concerned with this here.\nIn the halo model, the large-scale clustering of the mass\narises through the correlations between different haloes. Pre-\nscriptions for this clustering were given by Mo & White\n(1996); Mo, Jing & White (1997); Sheth & Lemson (1999);\nSheth & Tormen (1999); Sheth, Mo & Tormen (2000), and\na recent example of their effectiveness is shown clearly in\nColberg et al. (2000). On small scales, the correlations are\nderived purely from the convolution of the density profile of\nthe halo with itself (Peebles 1974b; McClelland & Silk 1977;\nSheth & Jain 1997). This model thus makes strong predic-\ntions about the clustering on small scales. Unless the den-\nsity profile and mass function obey a specific relationship,\nthe merger-driven evolution of the mass function means that\nstable clustering approximation does not hold true (Yano &\nGouda 2000; Ma & Fry 2000b).\n2.4 Scale-free models\nAn elegant way to study nonlinear evolution is to simulate\n\u2018scale free\u2019 universes that have no inbuilt characteristic phys-\nical length scales. We follow Efstathiou et al. (1988) and\nrequire two conditions to be satisfied:\n(1) The initial power spectrum of fluctuations is a power\nlaw:\nP (k) = Akn; 1 < n < \u22123. (16)\n(2) The evolution of the scale factor for the cosmological\nmodel power law in time:\na(t) \u221d t\u03b1 . (17)\nThe most interesting cosmological model that satisfies these\nconstraints is the Einstein-de Sitter model: \u03b1 = 2\/3, \u2126 = 1\nand \u039b = 0, so that the linear-theory growth of the power\nspectrum is P (k) \u221d a2.\nIn this case, the only natural way to define a charac-\nteristic length is through the scale at which the fluctuations\nbecome nonlinear. The variance of the linear density field,\nsmoothed on some comoving length scale x, is\n\u03c32(x, a) =\n\u222b\n\u22062L(k, a) |W (kx)|\n2 dk\nk\n, (18)\nwhere W is the filter function. If we assume \u22062(a, k) \u221d\na2k3+n, and that the filter causes a cut-off at some high\nspatial frequency kc \u223c 1\/x, we find\n\u03c32(kc, a) \u221d\n\u222b kc\n0\na2kn+2dk \u221d a2x\u2212(3+n)c . (19)\nWe now define a nonlinear wavenumber, kNL such that\n\u03c32(kNL, a) = 1, so that\nkNL(a) \u221d a\n\u22122\/(3+n). (20)\nUnder this transformation, it is plausible that the statistics\nof gravitational clustering will be expressible as a similarity\nsolution:\nP (k, a) = P\u02dc (k\/kNL) (21)\n(Davis & Peebles 1977; Peebles 1980; Efstathiou et al. 1988;\nJain & Berchinger 1998). No formal proof of the similarity\nsolution exists, and this conjecture is something that must\nbe tested empirically via simulation.\nIn practice, we present good evidence in this paper that\nthe power spectrum does scale in this way for 0 \u2265 n \u2265 \u22122.\nSpectra outside this range are harder to simulate and so\nnot yet tested. We may however anticipate that only cer-\ntain initial spectra will evolve in a self-similar fashion. For\nn \u2265 1, the amplitude of gravitational potential fluctuations\ndiverges on small scales, so one might question the idea\nof a hierarchy that grows via the merger and disruption\nof small systems. However, this argument is not definitive,\nsince the similarity solutions generally depart from P \u221d kn\nfor k > kNL. We seek a function which is of this power-\nlaw form for k < kNL and some unknown form at larger k,\nand which evolves in a self similar fashion. In practice, this\nfunction is found by starting with exact power-law initial\nconditions, and hoping that the simulation will relax into\nthe desired self-similar form as it evolves. The existence of\na self-similar solution with n > 1 on large scales therefore\nremains an open question. On large scales, the peculiar ve-\nlocity field diverges if n \u2264 \u22121, so more negative indices may\nseem problematic. This does not seem to be a problem in\npractice, probably for the reasons discussed by Bernardeau\net al. (2001): the divergent modes of very long wavelength re-\nally just cause a translation, and Galilean invariance means\nthat the statistics of smaller-scale clustering are unaffected.\nCertainly, well-defined results can be obtained from pertur-\nbation theory for n more negative than \u22121, so the only clear\nlimit is n \u2264 \u22123, for which the whole idea of asymptotic ho-\nmogeneity breaks down.\nIf we can find initial spectra for which self-similarity ap-\nplies, this is an extremely useful means of assessing the reli-\nability of N-body results. Also, over limited ranges of mass,\nthe scale-free models correspond directly to more physically\nmotivated models such as CDM, whose spectral index is a\nslow function of scale. As we shall show, an analytic de-\nscription of nonlinear evolution in the scale-free case leads\nquite directly to a method that can also give an accurate\ndescription of nonlinear evolution in CDM models.\n3 THE NUMERICAL SIMULATIONS\nWe have produced a large ensemble of N-body simulations\nwith N = 2563 particles. We considered Einstein\u2013de Sitter\n(\u2126 = 1) models, and also low-density open and flat \u039b ge-\nometries. The spectral indices that have been simulated are\nn = \u22122, \u22121.5, \u22121 and 0. The simulations were executed\non either 128 or 64 processors of the Edinburgh Cray T3E\nsupercomputer, using the parallelized P3M \u2018shmem\u2019 version\nof HYDRA (Macfarland et al. 1998; Couchman, Thomas &\nPearce 1995; Pearce & Couchman 1997), in purely collision-\nless dark matter mode.\nThe large-scale force calculation in HYDRA used a 5123\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 5\nTable 1. Parameters of the 2563 particle, scale-free simulations. The r1 simulations represent glass initial conditions and r2 simulations\nare grid starts.\nsimulation \u01eb\/L \u22062(kb, a = 1) ainitial afinal timesteps energy error (%) output values of a\nn = \u22122 r1 0.00025 0.133 0.025 0.62 831 0.04 0.025, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.62\nn = \u22122 r2 0.00025 0.133 0.025 0.55 904 0.04 0.025, 0.1, 0.2, 0.3, 0.4, 0.5, 0.55\nn = \u22121.5 r1 0.00023 0.046 0.010 0.96 991 0.16 0.01, 0.25, 0.315, 0.4, 0.5, 0.63, 0.794, 0.96\nn = \u22121.5 r2 0.00023 0.046 0.010 1.00 915 0.16 0.01, 0.25, 0.315, 0.4, 0.5, 0.63, 0.794, 1.0\nn = \u22121 r1 0.00023 0.017 0.010 0.83 991 0.31 0.01, 0.25, 0.315, 0.4, 0.5, 0.63, 0.794, 0.83\nn = \u22121 r2 0.00023 0.017 0.010 1.00 815 0.31 0.01, 0.25, 0.315, 0.4, 0.5, 0.63, 0.794, 1.0\nn = 0 r1 0.00025 0.003 0.025 0.66 1443 0.50 0.025, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.66\nn = 0 r2 0.00025 0.003 0.025 0.50 1239 0.50 0.025, 0.1, 0.2, 0.3, 0.4, 0.5\nFourier mesh, supplemented by direct summation of close\npairs to achieve the desire total interparticle force. As usual,\nthis is softened on small scales in order to suppress two-body\nencounters. In HYDRA, the transition from pure Newtonian\nto constant force is achieved using a \u2018spline-kernel softening\u2019;\nwith this method, the interparticle forces become precisely\nNewtonian after 2.34 times the softening length. In all cases,\nwe adopted a comoving softening length that is simply a\nfraction f of the interparticle spacing\n\u01eb = fL\/N1\/3 , (22)\nwhere L is the side of the simulation box. We used f \u2243 0.064,\nwhich is slightly smaller than the late-time value used by\nEfstathiou et al. (1988) and the small-box calculations of\nJ98 who used f \u2243 0.1. However, it is slightly larger than\nthe values used by Jain & Bertschinger (1998) who used an\neffective value of f = 0.05, and also the value chosen by\nJ98 for their big-box simulations, f \u2243 0.038. We ran a few\ntest simulations in which f was varied, and we believe that\nthe results quoted here are not sensitive to the exact value\nadopted.\nFor the initial particle load, a combination of \u2018quiet\u2019\nstarts and \u2018glass\u2019 configurations was used. The quiet starts\nwere produced by simply placing particles onto a uniform\ngrid with spacing L\/N1\/3. This method gives no contribu-\ntion to the power spectrum from particle placement except\non scales of the order half a mesh spacing (See Section 4).\nHowever, grid initial conditions may lead to non-physical\nfeatures on very small scales at late times. An example of\nthis occurs in the Warm Dark Matter simulations of Bode,\nOstriker & Turok (2001), where the population of \u2018secondary\nobjects\u2019 which they find to form by fragmentation of sheets\nand filaments may actually be a numerical artefact induced\nby the grid. An alternative approach is the glass-like dis-\ntribution that is obtained when a random distribution of\nparticles is evolved with the signs of the N-body accelera-\ntions reversed (White 1993; Baugh, Gaztanaga & Efstathiou\n1995). The resultant particle distribution displays no regu-\nlar pattern, but is sub-random. By construction, the glass\ninitial conditions are non-evolving in the absence of pertur-\nbations. The glass load was generated once, but can be used\nin many different simulations by adding in the appropri-\nate displacement field. This was generated from the initial\ndensity field using the approximation of Zeldovich (1970).\nThe Fourier modes of the density field were a Gaussian re-\nalization, with random phases and amplitudes chosen from\na Rayleigh distribution.\nFor both the grid and glass methods, particle discrete-\nness on the smallest scales leads to a spectrum that is com-\nparable to that of the shot-noise distribution on that scale.\nNumerical evolution should proceed until the scales of in-\nterest are well above this noise. For most spectra, memory\nof the initial small-scale discreteness is only truly lost after\nexpansion by roughly a factor of 10 (see Section 4.2).\n3.1 Self-similar simulations\nThe normalization of the scale-free power spectra is most\nsimply specified in terms of the power on the box scale at\nthe epoch when the expansion factor a is unity,\n\u22062L(k) = \u2206\n2(kb)\n(\nk\nkb\n)n+3\n(23)\nwhere kb = 2\u03c0\/L. The benefit of normalizing the spectrum\nin this way is that the box-scale power is directly related to\nthe error induced through omitting modes with wavelength\nabove L, and so the effects can be monitored (see Section\n3.3).\nTable 1 displays all relevant simulation parameters\nfor the scale-free runs. A large degree of nonlinearity was\nachieved for all of the simulations and the n = \u22121 and \u22121.5\ncalculations were completed to the specified level of normal-\nization. The n = 0 calculations were halted after the cube\nhad expanded by roughly a factor of 25, due to the intense\ndemands on the cpu time from performing the PP part of\nthe calculation. Also, the n = \u22122 calculations were halted\nafter a similar factor of growth; this was due to the problems\nof finite volume effects, which we discuss in detail in Section\n3.3.\nFigs 1 and 2 provide a visual account of the growth of\nstructure in the four models. We show three epochs from the\nfour different models: the initial conditions; an intermediate\nepoch; the final output epoch. The n = \u22122 simulations dis-\nplay a number of large-scale fluctuations which collapse to\nform large filaments and groups, whereas the n = 0 simula-\ntions are characterized by a large number of tightly bound\nobjects and a paucity of large-scale filamentary features, in\naccordance with the results of Efstathiou et al. (1988). Fig.\n1 also compares the glass start to the grid starts. In the glass\nstart no features other than the prescribed fluctuations are\nobserved, whereas the grid start shows faint lattice patterns\nwhich are still observable in the voids at the final epoch.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n6 Smith et al.\nFigure 1. Slices showing the growth of structure in the glass n = \u22122 simulation (left column) and \u2018grid-start\u2019 n = \u22121.5 simulation (right\ncolumn). All of the slices are of thickness L\/10. From the n = \u22122 simulation we show expansion factors a = 0.2, 0.45 and 0.55, and from\nthe n = \u22121.5 simulation we show epochs a = 0.25, 0.63 and 1.0. The normalization of the final states in the n = \u22122 and n = \u22121.5 runs\nwere \u22062(2\u03c0\/L, a = 1.0) = 0.133 and 0.046, respectively.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 7\nFigure 2. Same as Fig. 1, but this time showing the comoving projection of particles in the glass n = \u22121 simulation (left column) and\nglass n = 0 simulation (right column). From the n = \u22121.0 simulation we show epochs a = 0.25, 0.63 and 0.83, and from the n = 0\nsimulation we show expansion factors a = 0.1, 0.3 and 0.5. The normalization of the final states in the n = \u22121 and n = 0 runs were\n\u22062(2\u03c0\/L, a = 1.0) = 0.017 and 0.003, respectively.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n8 Smith et al.\nTable 2. Parameters of the 2563 particle, power-law \u039b and open simulations. Epochs include a = 0.025, 0.05, 0.1, 0.2, 0.25, 0.3, 0.4, 0.5,\n0.6, 0.7, 0.8, 0.9, 1.0\nsimulation \u01eb\/L \u22062(kb) \u2126 \u039b ainitial afinal timesteps energy error (%)\nn = \u22122 0.00025 0.0479 0.26 0.74 0.025 1.0 1065 0.05\nn = \u22122 0.00025 0.0479 0.2 0.0 0.025 1.0 965 0.09\nn = \u22121.5 0.00025 0.0240 0.26 0.74 0.025 1.0 971 0.13\nn = \u22121.5 0.00025 0.0240 0.2 0.0 0.025 1.0 965 0.13\nn = \u22121 0.00025 0.0101 0.26 0.74 0.025 1.0 1342 0.28\nn = \u22121 0.00025 0.0101 0.2 0.0 0.025 1.0 965 0.87\nn = 0 0.00025 0.0003 0.26 0.74 0.025 1.0 1020 0.86\nn = 0 0.00025 0.0003 0.2 0.0 0.025 1.0 967 1.86\n3.2 Power-law open and flat simulations\nAt late times the amplitude of the nonlinear power spectrum\nis very sensitive to the density of the universe, and strongly\nmodulates the amplitude of the nonlinear clustering signal.\nThis effect is important to quantify if one wishes to con-\nstruct general models for evolving nonlinear power spectra.\nWe investigated this density dependence by performing a\nfurther series of high resolution, 2563 particle, simulations\nfor open universes where \u2126 = 0.2 at the final epoch and\nfor flat universes where \u2126 = 0.26 and \u039b = 0.74 at the final\nepoch. The values for the density parameter were selected\nso that each full integration would span a large dynamic\nrange in \u2126. The amplitude of the final box-scale mode was\nset slightly lower than in the \u2126 = 1 simulations, because\nof the greater small-scale nonlinearities that are generated\nin low-density models. For all of these simulations we have\nused the glass initial particle load. Table 2 displays all of the\nrelevant simulation parameters.\n3.3 The challenge of n\u2192 \u22123\nOn small scales, the slope of the CDM power spectrum ap-\nproaches n \u2243 \u22123, so it is important to understand how such\nspectra evolve in the nonlinear regime. However, highly neg-\native spectral indices have proven difficult to simulate (Efs-\ntathiou et al. 1988; Jain, Mo & White 1995; PD96; Jain &\nBertschinger 1998), and this can be attributed to two main\neffects.\nFirst, the number of particles must be high enough to\nsimulate virialized clusters convincingly. Second, the finite\nsize of the simulation volume means that the longest wave-\nlength fluctuations that are present are \u03bbb = L ; kb = 2\u03c0\/L.\nThe absence of modes beyond the box scale induces an error\nin the nonlinear spectrum, since nonlinearity couples Fourier\nmodes together and power leaks from large to small scales;\nthe importance of this effect increases for increasingly neg-\native spectral indices and dominates as n approaches \u22123.\nThe error in the power spectrum due to these missing\nmodes can be estimated from the linear power spectrum. We\ncan quantify the missing variance as follows:\n\u03c32miss =\n\u222b\n\u221e\n0\n\u22062L(k)\ndk\nk\n\u2212\n\u2211 1\n4\u03c0\n\u22062L(k\n\u2032)\n(\u21132 +m2 + n2)3\/2\n, (24)\nwhere the sum is over all integer triples (\u2113,m,n) except\n(0, 0, 0) and the wavenumber k\u2032 = kb(\u2113\n2 + m2 + n2)1\/2.\nStrictly speaking, both terms on the rhs are divergent for\npower-law spectra with n \u2265 \u22123. Nonetheless, if one imposes\na sufficiently smooth cut-off at kcut in the power spectrum,\nthen the difference is well defined in the limit of kcut \u2192\u221e.\nWe have estimated \u03c32miss numerically in this way for\nscale-free power spectra as a function of n. To about 1%\naccuracy the result is given by:\n\u03c32miss =\n\u22062L(kb)\n3 + n\nF (3 + n), (25)\nwhere F (y) = 1\u22120.31y+0.015y2+0.00133y3 and this expres-\nsion is valid for \u22123 \u2264 n \u2264 1. One can check the numerical\nresult, not only by confirming it is insensitive to the precise\nvalue of kcut, but also for the special case n = 0 where it is\neasy to see from geometric considerations that the value of\nF (3) is 3\/4\u03c0. In the limit of n\u2192 \u22123 the missing variance is\nwell approximated by the quantity \u03c32err defined as:\n\u03c32err =\n\u22062L(kb)\n3 + n\n. (26)\nSo as to ensure that the missing variance does not become\nsignificant for our simulations, we have chosen to adopt the\ncriterion\n\u03c32err \u2264 0.04 , (27)\nfor which the large-scale missing modes are safely linear.\nIt is for these reasons that the relatively low resolution\n(compared to modern standards) 323 particle, n = \u22122 simu-\nlation of Efstathiou et al. (1988) could only reproduce the ex-\nact similarity solution for the power spectrum over a narrow\nrange of expansion. Also, for the more recent high-resolution\n2563 particle, n = \u22122 simulation of Jain & Bertschinger\n(1998), the box-scale power for their last three outputs vi-\nolates the condition (27), rising to \u03c32err \u2243 0.4 for the last\nepoch.\n3.4 Simulation error and Layzer-Irvine energy\nA test for the global accuracy of the integration of the equa-\ntions of motion is to measure how well the Layzer-Irvine\nenergy equation (Peebles 1980, equation 24.7) is obeyed (Ef-\nstathiou et al. 1985). One way to characterize this is through\nthe change in the Layzer-Irvine integral, I , divided by the\ntotal potential energy W (Couchman et al 1995):\nI = K +W +\n\u222b\n[2K +W ]\nda\na\n, (28)\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 9\nFigure 3. The upper segment of each panel shows the evolution of the total kinetic energy K (solid lines) and the total potential energy\n|W | (dashed lines) in the scale-free models, in units of the final kinetic energy Kf . The lower segment of each panel shows their ratio.\nDuring the linear phase of growth K and |W | should be in the ratio 2 : 3, as in equation (29); this is denoted by the dashed line. During\nself-similar growth K and W should be in the ratio 1 : 4\/(n + 7), as in equation (30); this is denoted by the dotted line.\nwhere K is the total kinetic energy. In Tables 1 and 2 we\npresent the percentage error in each of the simulations. The\naccuracy of the integration decreases as the spectral index\nsteepens and as \u2126 decreases, the least accurate integration\nbeing that of the open n = 0 simulation, for which the global\nerror at the final epoch was of the order 1.8%.\nOne can go further than this and examine the evolu-\ntion of W and K in detail. According to linear perturbation\ntheory (Peebles 1980, equation 24.14), K and W are related\nvia\nK =\n2\n3\nf(\u2126)2\n\u2126\n|W | , (29)\nwhere f(\u2126) = d lnD\/d ln a, a good approximation for which\nis (Lahav et al. 1991) f(\u2126) \u2243 \u21260.6 + \u039b\/70 [1 + \u2126\/2]. In the\nself-similar regime, the ratio changes to\nK =\n4\nn+ 7\n|W | (30)\n(Davis & Peebles 1977; Peebles 1980, equation 74.6). This\napplies for all n < 1, but the derivation is complicated by the\ndivergence of long-wavelength linear velocities for n \u2264 \u22121.\nFor the models with \u2126 < 1, the asymptotic behaviour at late\ntimes follows the classical virial theorem in non-expanding\ncoordinates and\nK\/|W | \u2192 1\/2. (31)\nIn Figs 3 and 4 we show how the quantities K and\n|W | and their ratios evolve, where Kf and |Wf | are the\nenergies at the final epoch. For both K and W there is an\ninitial transient signal, but this is negligible by the time the\nsimulation has expanded by a factor of about 5. Considering\nFig 3, for the n = \u22122 and n = \u22121.5 models, the initial ratio\nof K\/|W | is in good agreement with the predictions of linear\ntheory (29). For the steeper spectra n = \u22121 and 0, the initial\nratio is approximately as expected. As the structures become\nsignificantly quasi\/nonlinear the energies should scale self-\nsimilarly. Thus we see the ratio ofK\/W rising for the n = \u22122\ncase and dropping for the n = 0 case. However, in general\nthe nonlinear ratio of 4\/(n + 7) is not precisely reached.\nGiven the accuracy to which energy is conserved overall,\nthis plausibly reflects the fact that the particle energies are\nactually a mixture of linear and nonlinear contributions.\nFig 4 shows the evolution of K and W in the open and\nflat models. Again, in the initial stages there is a transient\nsignal as was mentioned above. After these have faded the\nenergies agree with the linear theory prediction equation\n(29). As time evolves the energies become depressed away\nfrom the linear evolution and approach the asymptotic pre-\ndiction of equation (31).\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n10 Smith et al.\nFigure 4. Similar to Fig. 3. However, this time for the \u2126 < 1 power-law simulations. In the upper segment of each panel, thick lines\nrepresent flat models and thin lines represent open models. In the lower segment of each panel, solid lines represent the measured ratio,\ndashed lines denote the linear theory prediction according to equation (29) and dotted lines denote the \u2126 = 1 ratio of 1 : 4\/(n+7) (upper\ndotted), and the classical virial theorem ratio of 1\/2 which becomes asymptotically valid (lower dotted). Again, thick lines represent flat\nand thin lines represent open universes.\n4 MEASURING THE POWER SPECTRUM\nThe Fourier modes of the particle distribution can be deter-\nmined exactly using the expression (Peebles 1980)\n\u03b4k =\n1\nN\nN\u2211\ni=1\neik\u00b7xi . (32)\nOwing to the periodic boundary conditions, wavenumbers\nare restricted to be integer multiples of the fundamental\nmode, with an upper limit imposed by the finite sampling\nof the mesh: the Nyquist frequency,\nkNy =\n\u03c0\n\u2206x\n, (33)\nwhere \u2206x = L\/Nm is the mesh spacing and Nm is the dimen-\nsion of the mesh. The power spectrum can then be estimated\nthrough averaging over all of the modes in a thin shell in k\nspace:\nP\u02c6 (k) \u2261\n\u2329\n|\u03b4k|\n2\n\u232a\n=\n1\nm\nm\u2211\ni=1\n|\u03b4ki |\n2 . (34)\nwhere m is the number of modes to be averaged. This\nmethod is computationally inefficient, with the required cpu\ntime scaling as MN for M modes. A faster method is to\ndistribute particles onto a cubical mesh and perform a Fast\nFourier Transform (FFT). However, the assignment of mass\nto grid cells introduces some systematic effects which must\nbe corrected; these issues will be discussed in detail in Sec-\ntion 4.2.\nIn the case of a 3D particle distribution, the task soon\nbecomes memory limited, a 5123 FFT requiring roughly\n0.5 Gbyte for a \u2018real-real\u2019 transform and 1 Gbyte for a\n\u2018complex-complex\u2019 transform. A solution to this problem\nwas proposed by J98; we now detail this method, since it\nis critical for the present paper.\n4.1 Chaining the power\nConsider a 1D discrete density field \u03b4(x), which is periodic\nover a length scale L and which has a discrete Fourier trans-\nform given by equation (32). If we partition the density field\nusing a coarse mesh with M grid cells, then the density at\nthe point x can be described by the relation\n\u03b4(x) = \u03b4\n(\nx\u2032 + jL\/M\n)\n, (35)\nwhere x\u2032 is the position of the particle in its grid cell and j\nlabels the cell. If we now map all of the grid cells into one\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 11\ncell, then the reduced density field, which is now periodic on\nthe scale L\/M , is\n\u03b4r(x\u2032) =\nM\u22121\u2211\nj=0\n\u03b4(x\u2032 + jL\/M) . (36)\nThe discrete Fourier transform of this reduced density field\nis then,\n\u03b4rk =\n1\nN\nN\u2211\ni=1\nexp(ikx\u2032i) =\n1\nN\nN\u2211\ni=1\nexp[ik(xi \u2212 jL\/M)] . (37)\nProvided that the k-modes are integer multiples of the new\nfundamental mode, k = \u21132\u03c0\/(L\/M), then the last term in\nthe exponential is a multiple of 2\u03c0, so the modes of the\nreduced field are equivalent to the modes of the true field.\nThere is, however, a reduction in the number of available\nmodes, since the smaller volume of the coarse mesh gives a\nlower density of states.\n4.2 Numerical effects on the power\nThere are three important numerical effects which can mod-\nify the \u2018observed\u2019 power spectrum from the true nonlinear\nsignal: discreteness effects, charge assignment and force soft-\nening.\n4.2.1 Discreteness effects\nFor a random distribution of particles with no imposed clus-\ntering, the power does not vanish. This result can be deduced\nby splitting 3D space into a large number of cubical cells, so\nthat the occupation number of each cell is either ni = 0 or 1\n(Peebles 1980). On computing the expectation of the power\nspectrum, we obtain the shot-noise spectrum\u2329\n|\u03b4k|\n2\n\u232a\n=\n1\nN\n(38)\nwhich in dimensionless form is written\n\u22062shot =\n4\u03c0\nN\n[\nk\nkb\n]3\n. (39)\nThis leads us to write the true power spectrum, in the limit\nof large N (Peacock & Nicholson 1991)\n\u22062true(k) = \u2206\n2\nobs(k)\u2212\u2206\n2\nshot, (40)\nwhere \u22062obs is the observed power from equation (34).\nHowever, this correction is invalid for the glass and grid\nstarts discussed in section 3. To determine the appropriate\ncorrection for these schemes we directly computed the power\nspectrum of the initial conditions and then used these empir-\nical spectra to construct a simple correction model. In Fig. 5\n(bottom) we show the raw power spectrum of the glass parti-\ncle load for the initial conditions and two subsequent epochs\nfrom the n = \u22122 simulation. The glass power spectrum is\ncharacterized by a two-power-law spectrum: on intermedi-\nate scales the spectrum is steep, roughly the n = 4 \u2018minimal\nslope\u2019 (see section 28 of Peebles 1980) and at smaller scales\nthis breaks to a shot noise spectrum. Furthermore, the bot-\ntom panel of Fig. 5 shows that the discreteness spectrum\ndoes not appear to evolve; we can therefore use the initial\nconditions to determine a discreteness correction that can\nbe applied to correct the observed power at all subsequent\nFigure 5. (Top) The glass-discreteness corrected (squares) and\nuncorrected power spectrum (stars) of the glass n = \u22122 simula-\ntion at an epoch a = 0.55. We show the linear fluctuation spec-\ntrum (dashed line), which demonstrates that the box scale mode\nis still linear, the nonlinear spectrum according to the scaling\nformula of PD96 (thin solid line), a shot noise spectrum (dot-\ndashed line) and our two power-law discreteness model outlined\nin the text (thick solid line). (Bottom) Three epochs from the\nearly stages of the same n = \u22122 simulation. From bottom to top\nepochs are a = 0.025 (squares), 0.1 (circles) and 0.3 (stars). This\ndemonstrates that the discreteness spectrum does not evolve and\nalso that the linear spectrum has been correctly established early\non. Again, the lines are as in the top panel, with the thick solid\nline representing our fit to the discreteness spectrum.\nepochs. This correction can be modelled as a transition be-\ntween shot noise on small scales and the almost minimal\nspectrum on intermediate scales:\n\u22062glass =\n[(\n\u22062shot\n)\n\u22121\/\u03b1\n+\n(\n\u22062min\n)\n\u22121\/\u03b1\n]\n\u2212\u03b1\n, (41)\nwhere \u03b1 = 0.3 and \u22062min = (Ak\/kb)\n\u03b2 , with best fitting\nvalues A = 0.0062 and \u03b2 = 6.8.\nFor the grid, or \u2018quiet\u2019 start, the issue of a discreteness\ncorrection is fairly subtle, since there is initially no power\nadded to the distribution by particle placement except on\nthe scales of the Nyquist frequency of the mesh. However,\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n12 Smith et al.\nas the simulation evolves under gravity, the sparseness of\nparticles on small scales forms a power spectrum similar to\na shot noise term on those scales. At late times this can\nbe remedied by subtracting the Poisson spectrum from the\nraw power, since the large- and intermediate-scale modes in\nthe evolved distribution are of higher amplitude than the\nshot-noise spectrum. At early times, when the true power is\nof relatively low amplitude, this approach is incorrect. We\navoid the problem by excluding points whose amplitudes are\nbelow the Poisson spectrum on the equivalent scale.\nFig. 6 (top) compares the uncorrected power spectra\nfor the glass and grid starts measured from the n = \u22122\nsimulations at two epochs a = 0.4 and a = 0.55. We observe\nthat the nonlinear loci defined by the data for these two\nsimulations are consistent and show no memory of the initial\nparticle load. The only noticeable discrepancy between the\ntwo simulations is the difference in large-scale power; this\narises because the simulations are independent realizations.\nFig. 6 (bottom) contrasts the discreteness-corrected spectra;\nthis shows that consistent final results are obtained through\nsimulating with grid or glass initial conditions.\n4.2.2 Mass assignment\nThe assignment of mass onto the FFT mesh produces a fi-\nnite sampling error of the true density field. This problem\nwas investigated for power spectra by Baugh & Efstathiou\n(1994), who proposed that equation (40) for the true field\nshould be modified to\n\u22062true(k) =\n\u22062obs(k)\u2212\u2206\n2\ndisc(k)\nw(y)\n; y = k\/km , (42)\nwhere w(y) is the Fourier transform of the mass assignment\nwindow function, \u22062disc(k) is the appropriate discreteness\ncorrection and km = 2\u03c0\/\u2206x is the wave number associated\nwith the inter-mesh spacing \u2206x. However, we believe that\nthere is a small flaw in their method. Any discreteness cor-\nrection should be made subsequent to the correction due to\nmass assignment, since the discreteness correction accounts\nfor the representation of a continuous field with a point-like\ndistribution. We therefore implement the correction as\n\u22062true(k) =\n\u22062obs(k)\nw(y)\n\u2212\u22062disc(k) ; y = k\/km, . (43)\nSeveral schemes exist for transferring mass onto the\nFourier mesh. The simplest scheme is nearest grid point\n(NGP), which assigns all of the mass to the closest mesh\npoint. More sophisticated methods such as cloud-in-cell\n(CIC) and triangular-shaped-cloud (TSC) attempt to smear\nthe mass across a number of mesh points. We have adopted\nthe TSC scheme to assign particles to the mesh. How-\never, the detailed correction is unimportant when using the\nchained-power method of J98. Results at high k can be ob-\ntained either by making substantial binning corrections to\nthe main FFT mesh, or by moving to a sub-mesh of higher\nresolution. In practice, we make this transition before the\ncorrections from binning become significant. Finally, Baugh\n& Efstathiou showed that, even after correcting for the win-\ndow function, the power is affected by aliasing close to the\nNyquist frequency. Again, when following the method de-\nscribed in Section 4.1, aliasing errors can be avoided by only\nFigure 6. (Top) Comparison of discreteness uncorrected power\nspectra measured from the quiet start (squares) and glass start\n(stars) n = \u22122 simulations at epochs a = 0.4 and 0.55. Line styles\nare as in Fig. 5. (Bottom) Comparison of discreteness corrected\npower spectra for the same outputs from the two simulations.\nusing modes that are a safe distance from the Nyquist fre-\nquency of a given (sub)mesh (a factor of 2, in practice).\n4.2.3 Force softening\nThe softening of the Newtonian force in the PP part of the\nN-body calculation (described in Section 3) induces an error\nin the integration of particle trajectories for close pairs. By\nconsidering the fractional error in the softened force from the\ntrue Newtonian force, we can impose some constraints on the\nsmall-scale cutoff, below which numerical effects dominate\nthe clustering in our simulations. For our spline-kernel force\nsoftening, we expect numerical effects to suppress the true\npower on scales of a few times the softening length. This\ncorresponds to k\/kb \u223c 1700.\nThe simplest way to discriminate between the true non-\nlinear solution and numerical artefacts is to use the self-\nsimilar evolution of the scale-free simulations. Since the nu-\nmerical features are of fixed comoving length, the true den-\nsity field will scale under the transformations that were de-\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 13\nFigure 7. Nonlinear power plotted against linear power (points)\nfor the four scale-free simulations. For clarity, the data have been\nseparated from each other by one order of magnitude in the y-\ndirection, with the n = 0 data untranslated. To determine the\nlinear power given a nonlinear data point, the appropriate lin-\near scale is required. In the HKLM method, this is found using\nthe transformation kL = [1 + \u22062NL(kNL)]\n\u22121\/3kNL. The solid line\nrepresents the fitting formula for the Einstein-de Sitter models\npresented in Appendix B; the dashed line represents the PD96\nfitting formula; the dotted lines are the fits using the formula of\nJMW95.\nscribed in Section (2.4), whereas the numerical effects do\nnot. We provide evidence for this in section 5.\n5 NUMERICAL RESULTS\n5.1 Similarity solution\nFig. 7 shows the data for the four scale-free models in the\nHKLM form: nonlinear power on the nonlinear scale plotted\nas a function of the linear power on the linear scale. For\nclarity, the data have been separated from each other by\none order of magnitude in the y-direction, with the n = 0\ndata untranslated. In order to determine the linear scale and\npower that correspond to a given nonlinear data point, we\nuse the nonlinear scaling relation (13). Explicitly, given a\nnonlinear data point kiNL,\u2206\n2\niNL, its linear counterpart is\nkiL = (1 + \u2206\n2\niNL)\n\u22121\/3kiNL ; \u2206\n2\niL =\n(\nkiL\nk0\n)3+n\n, (44)\nwhere k0 is a time-dependent normalization wavenumber de-\nfined by \u22062(k0) \u2261 1 and we have assumed an initial power-\nlaw power spectrum for this example.\nWhen plotted in this form the scaling nature of these\nmodels is apparent. The power spectra measured from mul-\ntiple epochs of the simulations precisely overlay to define a\nFigure 8. (Top) HKLM plot for the open models. (Bottom)\nHKLM plot for the flat low-density models with a cosmological\nconstant. Again, for clarity, the data have been separated from\neach other by one order of magnitude in the y-direction, with\nthe n = 0 data untranslated. For each model five epochs are\nshown, these are: a = 0.6, 0.7, 0.8, 0.9, 1.0, with the lowest locus\nfor each model corresponding to the a = 0.6 epoch. In terms of the\nmass density parameter of the universe, these epochs correspond\nto: \u2126 = 0.294, 0.263, 0.238, 0.217, 0.200 for the open models and\n\u2126 = 0.619, 0.505, 0.407, 0.325, 0.260 for the \u039b models. As in Fig.\n7 the solid lines represent the fitting formula for the Einstein-de\nSitter models presented in Appendix B; the dashed lines represent\nfits from the PD96 function.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n14 Smith et al.\nsingle locus for each of the spectral models considered. We\nconfirm the observation of JMW95 and PD96 that differ-\nent spectral models produce different amounts of nonlinear\ngrowth and that the more negative the spectral index the\nsteeper the locus in this plane. Fig. 7 also shows that the\nn = \u22122 simulations have produced a single, tightly defined\nlocus. This was not observed in previous studies (see Fig. 1 of\nJain 1997, Fig. 1 of PD96 and Fig. 7 of Jain & Bertschinger\n1998). This failure of scaling in earlier n = \u22122 results was\nprobably attributable to saturation of the box-scale mode.\nThe evolution in the data can be roughly broken down\ninto three regimes, the linear, the quasi-linear and the non-\nlinear. General observations made about these regimes are:\n(1) Linear: \u22062NL < 1: the \u2018nonlinear\u2019 power for all of the\nmodels converges to the linear power.\n(2) Quasi-linear: 2 < \u22062Q < 30: the slope of the fNL curves\nare steep. Modelling the data in this regime with a single\npower-law of the form, \u22062Q \u221d\n[\n\u22062L\n]\u03b1\n, we find for n = \u22122,\n\u22121.5, \u22121 and 0, that the spectral slopes are \u03b1 = 3.62\u00b10.03,\n3.38\u00b10.05, 3.12\u00b10.06 and 2.96\u00b10.1. This is reasonably close\nto the suggestion of Padmanabhan (1996) that \u22062Q \u221d [\u2206\n2\nL]\n3,\nalthough there is a clear trend with n that is not expected\nin Padmanabhan\u2019s argument.\n(3) Nonlinear: \u22062NL > 30: the fNL curves break away\nfrom the steep evolution which characterized the quasi-linear\ngrowth to form loci that are much shallower. Again, we have\nperformed a simple power-law fit to the data of each locus.\nWe find that for \u22062NL > 50 the n = \u22122 data have a nonlinear\nslope \u03b1 = 1.05\u00b1 0.09, and for \u22062NL > 100 the n = \u22121.5, \u22121\nand 0 data have nonlinear asymptotes of \u03b1 = 0.87 \u00b1 0.04,\n\u03b1 = 1.08\u00b10.04 and \u03b1 = 0.99\u00b10.04. This result is interesting\nfor two reasons. Firstly, within the scatter in the simulations\nthere appears to be little dependence on the initial spectrum\nfor the nonlinear slope. Secondly, it is in clear contradiction\nto stable clustering, which predicts that \u03b1 = 3\/2.\nThe shallow slope at high k may be interpreted in terms\nof the halo model. Ma & Fry (2000b) derived the following\nasymptotic limit for the power spectrum:\n\u22062(k) \u221d k\u03b3 ; \u03b3 =\n18\u03b2 \u2212 \u03b1(n+ 3)\n2(3\u03b2 + 1)\n, (45)\nwhere \u03b2 \u2243 0.8\u03b20 is the power-law that governs the mass\ndependence of halo concentrations: c = rv\/rs = (M\/M\u2217)\n\u03b20 ;\nrv and rs being the virial and characteristic radius; and \u03b1\nis the power-law index that governs the low-mass tail of the\nmass function: dn\/dM \u221d \u03bd\u03b1; \u03bd \u221d 1\/\u03c3(M). Realistic values\nfor \u03b1 and \u03b20 are 0.4 \u2264 \u03b1 \u2264 1.0 and 0.0 \u2264 \u03b20 \u2264 0.5. This is\nillustrated in Fig. 9, which shows the results of a power-law\nfit to the scale-free data with k\/k\u03c3 > 10. Comparing these\nmeasured values against the two predictions from equation\n(7) and (45). We see that \u03b3 increases with the steepness of\nthe spectrum, but that the data fall below the stable clus-\ntering prediction. In terms of the halo model, if one assumes\n\u03b1 = 0.4 in accord with Sheth & Tormen (1999), then a\nstrong dependence of \u03b20 on n is required in order to match\nthe measured data. On the other hand, if one adopts a value\n\u03b20 = 0.25 in the middle of the current measured values, then\nit is impossible to match the measured data with any value\nof \u03b1 in the plausible range 0.4 to 1.0. In summary, equation\n(45) seems unable to predict the observed trend of \u03b3(n) in a\nnatural manner. This is puzzling, since we will show below\nFigure 9. Nonlinear slope of the power-spectrum [\u22062(k) \u221d k\u03b3 ]\nversus spectral index. Points are measured from the scale-free\nsimulation power-spectra. The solid line represents the stable-\nclustering prediction. The dot-dash lines correspond to the pre-\ndictions of the halo model (Ma & Fry 2000b), with an assumed\n\u03b1 = 0.4 and 0.0 \u2264 \u03b20 \u2264 1.0. The dotted lines correspond to the\nhalo model prediction with \u03b20 = 0.25 and 0.4 \u2264 \u03b1 \u2264 1.0.\nthat the general ideas of the halo model work very well in\ndescribing our data. One possibility is that equation (45) is\nvalid only on scales smaller than those probed by current\nsimulations.\nAlso, in Fig. 7 we contrast our data with the fitting\nformula of JMW95 and PD96 (see Appendix A1 and A2\nfor these formulae). Both models work reasonably well in\nthe quasi-linear regime, but with significant discrepancies.\nThe n = \u22122 results are poorly fit by both models, with\nthe power being in general underestimated; PD96 gives the\npoorer fit, and underestimates the power by up to a factor 2.\nThe n = \u22121.5 locus is fairly well characterized by the JMW\nfunction, but underestimated by PD96. The n = \u22121 results\nare fairly well fit by both models, except around the break\nbetween linear and quasi-linear slopes, where the functions\noverestimate the power. Finally, the n = 0 locus is slightly\noverestimated at the linear to quasi-linear break by PD96\nand underestimated by JMW95. We have produced a new\nHKLM fitting formula that accurately fits the individual\nEinstein-de Sitter models, the results of which are shown\nin Fig. 7 as the thin solid line. The formula is described in\nAppendix B.\n5.2 Low-density power-law models\nIn Fig. 8 we show how the nonlinear behaviour of the power-\nlaw models deviates from the scale-free solutions (solid lines)\nas the background density is lowered. Again, for clarity, the\ndata have been separated from each other by one order of\nmagnitude in the y-direction, with the n = 0 data untrans-\nlated. In the linear regime, we again find that the nonlin-\near data follow the linear power. In the quasi-linear regime,\n2 < \u22062NL < 80, as \u2126 decreases, the locus defined by the\ndata increases in amplitude relative to the scale-free models\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 15\nand the power-law slope steepens. This density-dependent\nevolution of fNL in the quasi-linear regime was not appar-\nent in previous studies (see PD96). The quasi-linear slope\nsteepens as both n and \u2126 decrease. In the nonlinear regime,\n\u22062NL > 80, we again observe that the slope of fNL is lower\nthan the 3\/2 value that is required by stable clustering.\nIn Fig. 8, we also compare the data with the density\ndependent fitting formula of PD96. Again, the formula un-\nderestimates the shallow spectra and slightly overestimates\nthe steeper spectra. However, the more striking discrepancy\nis that the formula suppresses the onset of density depen-\ndent growth until evolution is far into the nonlinear regime,\nand then tends to overestimate the highly nonlinear power.\nThese discrepancies can in fact be seen in the comparison\nwith the simulation data used by PD96. However, this li-\nbrary of small (N = 803) simulations was in most cases\nunable to probe beyond \u22062NL \u2243 200, and so the deviations\nnever became substantial.\nThe failure of the JMW95 and PD96 functions to ac-\ncurately model the Einstein-de Sitter data and account for\nthe density dependence of nonlinear growth has clearly been\nshown. On attempting to fit this data set using the stan-\ndard HKLM-PD96 procedure we were able to produce an\nimproved formula with an rms precision of 12%. However,\non attempting to integrate the CDM models into the for-\nmulation, we could not find a satisfactory way to assign an\neffective spectral index to the models. We therefore decided\nto pursue an alternative approach to the problem of general\nnonlinear fitting functions, which proved to be more accu-\nrate.\n6 THE HALO MODEL FITTING FUNCTION\nIn this Section, we attempt to describe the above nonlin-\near results by means of concepts abstracted from the \u2018halo\nmodel\u2019 (Peacock & Smith 2000; Seljak 2000; Ma & Fry\n2000a). The basic approach suggested by the halo model is\nto decompose the density field into a distribution of isolated\nhaloes. Correlations in the field then arise on large scales\nthrough the clustering of haloes with respect to each other\nand on small scales through the clustering of dark matter\nparticles within the same halo. This then leads to a total\nnonlinear power spectrum\nPNL(k) = PQ(k) + PH(k), (46)\nwhere PQ(k) is the quasi-linear term that represents the\npower generated by the large-scale placement of haloes and\nwhere PH(k) describes the power that results from the self-\ncorrelation of haloes.\nIt is remarkable that such a simple decomposition ap-\npears to work very well in describing the two-point correla-\ntions of the cosmological mass density, even though it knows\nnothing of details such as the filamentary distribution of\nmatter (which are included implicitly in PQ). Indeed this\ndeficiency was addressed by Scoccimarro & Sheth (2002),\nwho attempted to remedy this through using 2nd Order La-\ngrangian perturbation theory to evolve the large scale prop-\nerties of the density field. However, in the above papers, cal-\nculation of PQ and PH involves numerical integrals over the\nhalo mass function and halo density profiles. This is com-\nputationally slow, and the result does not always match the\n\u2018exact\u2019 N-body data perfectly. Our aim will therefore be to\nproduce a simple fitting formula of higher accuracy that is\nbased on the above decomposition of the power spectrum.\n6.1 The quasi-linear term\nConsider the quasi-linear part first. Seljak (2000), Ma &\nFry (2000a) and Scoccimarro et al. (2001) assumed that\none should use linear theory filtered by the effective window\ncorresponding to the distribution of halo masses, convolved\nwith their density profiles and a prescription for their bias\nwith respect to the underlying mass field:\nPQ(k) = PL(k)\n[\n1\n\u03c1\u00af\n\u222b\ndM b(M)n(M) \u03c1\u02dc(k,M)\n]2\n, (47)\nwhere n (M) dM is the mass function, \u03c1\u02dc (k,M) is the Fourier\ntransform of the density profile and b(M) is the bias field of\ndark matter halo seeds. Peacock & Smith (2000) made the\nsimpler assumption that the quasilinear term corresponded\nto pure linear theory:\nPQ(k) = PL(k). (48)\nThis is equivalent to equation (47) on large scales, since in\nthis limit the filtering effect of haloes is negligible, and we\nmust have\n1\n\u03c1\u00af\n\u222b\ndM b(M)M n(M) = 1 . (49)\nNeither of these approaches is really satisfactory, since\nPH comes to dominate only at scales where linear theory\nmust break down to some extent (\u22062lin(k) \u223c 1). Quasi-linear\neffects must modify the relative correlations of haloes away\nfrom linear theory, irrespective of whatever allowance may\nbe made for the finite sizes of haloes. One way of seeing this\nis via the scaling part of the HKLM procedure:\n\u22062NL(kNL) = fNL[\u2206\n2\nL(kL)] ;\nkL = [1 + \u2206\n2\nNL(kNL)]\n\u22121\/3kNL.\nThis shift of scales from gravitational collapse causes a sig-\nnificant change in power at wavenumbers where \u22062L is of\norder unity \u2013 which is just the point where the filtering ef-\nfects of the largest haloes will also start to be important.\nAn alternative point of view is provided by perturbation\ntheory, which suggests that quasilinear effects should tend\nto suppress power for n > \u22121.4, but enhance power for\nmore negative indices (e.g. section 4.2.2 of Bernardeau et al.\n2001). Again, such effects cannot be cleanly separated from\nthe convolving effects of halo profiles. We therefore take an\nempirical approach, allowing the quasilinear effects to de-\npend on n. Since the philosophy of the halo model is that\n\u22062Q should be negligible on small scales, we also build in a\ntruncation at high k:\n\u22062Q(k) = \u2206\n2\nL(k)\n[\n1 + \u22062L(k)\n]\u03b2n\n1 + \u03b1n\u22062L(k)\nexp\u2212f(y); y \u2261 k\/k\u03c3. (50)\nwhere k\u03c3 is a nonlinear wavenumber, defined below in Sec-\ntion 6.3 \u03b1n and \u03b2n are spectral dependent coefficients and\nf(y) is the polynomial y\/4 + y2\/8 that governs the decay\nrate. We adopt this expression for all spectra.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n16 Smith et al.\n6.2 The halo term\nIn the halo model the self-halo term is (Seljak 2000; Peacock\n& Smith 2000; Ma & Fry 2000a; Scoccimarro et al. 2001)\nPH(k) =\n1\n\u03c1\u00af2 (2\u03c0)3\n\u222b\ndM n(M) |\u03c1\u02dc (k,M)|2 . (51)\nIn order to model this we want something that looks like\na shot-noise spectrum on large scales, but is progressively\nreduced on small scales by the filtering effects of halo profiles\nand the mass function. In terms of the dimensionless power\nspectrum, a candidate form for this is\n\u22062 \u2032H (k) =\nan y\n3\n1 + bn y + cn y3\u2212\u03b3n\n; y \u2261 k\/k\u03c3 , (52)\nwhere (an, bn, cn, \u03b3n) are dimensionless numbers that de-\npend on the spectrum. However, with PH defined in this\nway, the formalism defined by equation (46) breaks down\nfor steep spectra. The self-halo power clearly dominates at\nsmall k for any spectrum that is asymptotically n > 0 (e.g.\nall CDM models). The halo model thus fails to respect low-\norder perturbation theory in such cases, and this is a clear\ndefect of the model.\nIn order to solve this problem, the self-halo power must\nbecome steeper than Poisson on the largest scales. This\nmakes sense if we think of the halo model as a two-stage\nprocess: (i) fragment a uniform mass distribution into a set\nof haloes; (ii) move these haloes according to a superimposed\nlarge-scale displacement field. Since the first stage conserves\nmass, the large-scale power spectrum must approach a \u2018min-\nimal\u2019 form with n = 2 (e.g. section 28 of Peebles 1980). If one\nconserves momentum also, the minimal spectrum becomes\neven steeper: n = 4. It is a moot point which of these is the\nappropriate asymptote for this problem, since the two-stage\nview of the halo model is only a heuristic argument. Since\nwe will never wish to consider spectra that are asymptoti-\ncally much steeper than n = 1, it will suffice to force the\nn = 0 self-halo term to approach n = 2 on sufficiently large\nscales. This can be achieved if equation (52) is modified as\nfollows\n\u22062H(k) =\n\u22062 \u2032H (k)\n1 + \u00b5ny\u22121 + \u03bdny\u22122\n; y \u2261 k\/k\u03c3 (53)\nwhere we have introduced a term in k4 in order to soften the\ntransition to the k5 slope. Again, the parameters \u00b5n and \u03bdn\nare spectral dependent coefficients.\n6.3 The nonlinear scale\nIn order to implement these arguments, we need an appro-\npriate general definition of the nonlinear scale (see Section\n2.4), which should be related to the characteristic mass in\nthe halo mass function. As studies over many years have\nshown with increasing accuracy (Press & Schechter 1974;\nSheth & Tormen 1999; Jenkins et al. 2001), the halo mass\nfunction appears to depend only on the dimensionless fluc-\ntuation amplitude\n\u03bd \u2261 \u03b4c\/\u03c3(R, t), (54)\nwhere \u03b4c is a constant of order unity, usually identified with\nthe linear over-density for collapse in the spherical model\nand R is the effective filter radius. The multiplicity function\nTable 3. The cosmological parameters of the N = 2563 CDM\nsimulations from J98. For these CDM models \u0393 \u2261 \u2126h is the shape\nparameter of the spectrum, \u03c38 is the rms fluctuation in spheres\nof 8h\u22121Mpc and h is the Hubble parameter\nModel \u0393 \u03c38 \u2126 \u039b h L\/h\u22121Mpc\nSCDM 0.50 0.51 1.0 0.0 0.5 239.5\nSCDM 0.50 0.6 1.0 0.0 0.5 84.55\n\u03c4CDM 0.21 0.51 1.0 0.0 0.5 239.5\n\u03c4CDM 0.21 0.6 1.0 0.0 0.5 84.55\n\u039bCDM 0.21 0.90 0.3 0.7 0.7 239.5\n\u039bCDM 0.21 0.90 0.3 0.7 0.7 141.3\nOCDM 0.21 0.85 0.3 0.0 0.7 239.5\nOCDM 0.21 0.85 0.3 0.0 0.7 141.3\nfor haloes, which is defined as the fraction of mass carried by\nhaloes with mass in a logarithmic interval, peaks for systems\nwhere \u03c3(R, t) is of order unity, and we can therefore choose\nto define the nonlinear scale in this way:\n\u03c3(k\u22121\u03c3 , t) \u2261 1 . (55)\nThis definition of scale depends on the functional form cho-\nsen to filter the spectrum, but the main effects of changes in\nthis choice can be absorbed into the fitting coefficients. We\ntherefore take the convenient choice of a Gaussian filter:\n\u03c32(RG, t) \u2261\n\u222b\n\u22062L(k, t) exp(\u2212k\n2R2G) d ln k. (56)\nWith this choice of filter, scale-free spectra have\n\u22062L(k, t) =\n(\nk\nk0(t)\n)3+n\n\u21d2\nk\u03c3\nk0(t)\n=\n(\n[(1 + n)\/2]!\n2\n)\n\u22121\/(3+n)\n.\n(57)\n6.4 Application to CDM\nWe have generalized our formula to fit the Virgo and GIF\nCDM simulations from J98, which comprise four models:\nSCDM; \u03c4CDM; \u039bCDM; OCDM. Table 3 lists the cosmo-\nlogical parameters for these models. The data are publicly\navailable from http:\/\/www.mpa-garching.mpg.de\/Virgo\/.\nWe have re-measured the power spectrum for the epochs\nz = 0.0, 0.5 1.0 2.0 and 3.0 for both the Virgo and GIF\ndata, the results are presented in Figs. 15 and 16.\nIn order to model these more general curved spectra,\nwe define an effective spectral index via\n3 + neff \u2261 \u2212\nd ln \u03c32(R, t)\nd lnR\n\u2223\u2223\u2223\u2223\n\u03c3=1\n. (58)\nSince the mass function should depend mainly on the Tay-\nlor expansion of \u03c3 about the nonlinear scale, we also allow\ndependence on the spectral curvature:\nC \u2261 \u2212\nd2 ln \u03c32(R, t)\nd lnR2\n\u2223\u2223\u2223\u2223\n\u03c3=1\n. (59)\nFor the case of a Gaussian filter these expressions have the\nexplicit forms,\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 17\nFigure 10. Variation of effective spectral index (top panel) and\ncurvature (bottom panel) as a function of the rms fluctuation in\nGaussian spheres of radius RG, for the four cosmological models\nconsidered. Note the lower \u03c38 values that corresponded to the\nbig-box simulations has been assumed for the SCDM and \u03c4CDM\nmodels.\n3 + neff =\n2\n\u03c32\n\u222b\nd ln k \u22062L(k, t) y\n2 exp\n(\n\u2212y2\n)\u2223\u2223\u2223\u2223\n\u03c3=1\n(60)\nand\nC = (3 + neff)\n2 +\n4\n\u03c3(R)2\n\u00d7\u222b\nd ln k \u22062L(k, t)\n(\ny2 \u2212 y4\n)\nexp\n(\n\u2212y2\n)\u2223\u2223\u2223\u2223\n\u03c3=1\n, (61)\nwhere y = kRG and where the explicit time dependence of\nthe power spectrum has been kept to indicate the redshift\ndependence of the effective quantities. In Table 4 we list\nthe nonlinear wavenumber, effective spectral index and cur-\nvature of the spectrum on the nonlinear scale for the four\nVirgo (big-box) CDM models, generated according to the\nabove prescription.\nFigure 11. Dependence of the nonlinear wave-number k\u03c3 (top\npanel), effective spectral index neff (middle panel) and curvature\nparameter C (bottom panel) on the shape parameter \u0393 and nor-\nmalization \u03c38 of the linear power spectrum. The parameters neff\nand C are degenerate under \u0393 and \u03c38. This degeneracy is, how-\never, broken by the nonlinear wavenumber.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n18 Smith et al.\nTable 4. The nonlinear wavenumber k\u03c3 in units of hMpc\u22121, the\neffective spectral index neff and curvature C of the spectrum on\nthe nonlinear scale, for the four CDM models listed in the text.\nModel k\u03c3 neff C\nSCDM 0.574 \u22121.455 0.411\n\u03c4CDM 0.735 \u22121.850 0.305\n\u039bCDM 0.306 \u22121.550 0.384\nOCDM 0.332 \u22121.581 0.375\nFig. 10 shows the variation of the effective spectral in-\ndex (top panel) and curvature (bottom panel) for the four\nVirgo CDM models with the rms fluctuation measured in\nGaussian spheres of effective radius RG. The effective spec-\ntral index is quite sensitive to whether it is defined at \u03c3 = 1\nor at some other value. However, including the curvature\n(which depends much more weakly on \u03c3), means that this\nuncertainty is automatically allowed for. With the nonlin-\near scale and effective spectral index and curvature as de-\nfined through equations (55-59), we find that we can accu-\nrately model CDM spectra. As expected, Fig. 10 shows that\nthe OCDM and \u039bCDM models are almost indistinguish-\nable: both possess nearly identical linear power spectra, with\nonly a slight difference in normalization. The \u03c4CDM model\nhas the shallowest effective spectral index, almost approach-\ning n = \u22122 and the SCDM model has the steepest, with\nn = \u22121.4. The power-law models that we have simulated\nencompass this range of neff . Thus, we are confident that\nthe new fitting function will be constrained by the appro-\npriate range of spectral models, with the notable exception\nof the z > 3 \u03c4CDM data for which neff < \u22122. These mod-\nels are the sole basis for the fitting formulae in the n < \u22122\nregime.\nFig. 11 shows the dependence of k\u03c3 (top panel), neff\n(middle panel) and C (bottom panel) on the shape param-\neter and normalization of the linear power spectrum for\n(0.1 \u2264 \u0393 \u2264 0.8) and (0.4 \u2264 \u03c38 \u2264 1.2). In all of the models\ndark contrast represents a higher value. The parameters neff\nand C are degenerate under \u0393 and \u03c38. This degeneracy is,\nhowever, broken by including the nonlinear wavenumber.\n6.5 Parameter optimization\nWe now give the best-fitting coefficients, including depen-\ndence on cosmology. These coefficients were obtained by op-\ntimizing the formula to fit the scale-free and \u2126 < 1 power-\nlaw simulations described here; the CDM simulations of J98;\nand on large scales (k < 0.15 hMpc\u22121), the results of 2nd-\norder perturbation theory (calculated using the formulae of\n Lokas et al. 1996). Owing to the fact that numerical simula-\ntions are susceptible to sample variance on large scales, ana-\nlytic perturbation theory results were preferred. In the halo\nmodel the cosmology dependence arises in a subtle way. To\nthe extent that the mass function depends only on \u03bd (when\nexpressed as a function of R) and that \u03b4c has no strong\ncosmology dependence, the mass function for a given spec-\ntrum is also independent of cosmology. Therefore, the only\neffect on the halo power spectrum should be through the\nsizes of haloes; these depend on cosmology because haloes\nFigure 12. (Top) nonlinear power ratioed to the linear power as\na function of wavenumber scaled in terms of the normalization\nwavenumber k0: where \u22062(k0) = 1. The data points are for the\nscale-free simulations; the solid lines represent the fits from the\nnew halo based formula in Section 6.5; the dotted lines are PD96\nfits. (Bottom) The goodness of the new fit. The y axis represents\nthe ratio of observed nonlinear power to nonlinear power pre-\ndicted by the halo based fitting function. The x axis is observed\nnonlinear power.\nthat collapse at high redshift are smaller. Collapse redshift\nis a function of mass and cosmology (see e.g. Appendix C\nof Peacock & Smith 2000). High-mass haloes always have\nzc \u2243 0; these thus filter the large-scale part of the spec-\ntrum in a cosmology-independent way. Conversely, low-mass\nhaloes are important at high k, and these do depend on cos-\nmology \u2013 which alters the effective scale at which filtering\noccurs. However, there appears to be no simple way to im-\nplement such a complicated dependence into the fitting pro-\ncedure. We therefore insert empirical functions of \u2126 into the\nprocedure. Also, motivated by the findings of Section 5, we\nallowed the power-law indices that govern the quasi-linear\nregime to be density dependent.\nThe prescription that was found to work best is given\nin Appendix C. Code to evaluate the fitting function can\nbe downloaded from the web address listed in the abstract.\nNote that the above coefficients were obtained by fitting the\ndata over a restricted range of scales. The scale-free data\nwere constrained to have k\/k\u03c3 > 0.3. The open and \u039b data\nwere constrained to lie in the range: (4.0 < \u22062L < 15.0) for\nn = \u22122; (0.3 < \u22062L < 15.0) for n = \u22121.5; (0.3 < \u2206\n2\nL < 20.0)\nfor n = \u22121; (0.3 < \u22062L < 25.0) for n = 0. The CDM data\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 19\nFigure 13. Top and bottom panels are similar to Fig. 12, but this\ntime points represent open model data. Five epochs are shown;\nthese are a = 0.6, 0.7, 0.8, 0.9, 1.0. In terms of \u2126, these epochs cor-\nrespond to: \u2126 = 0.294, 0.263, 0.238, 0.217, 0.200. The thick solid\nline represents the new halo-model based fitting to the scale-free\ndata.\nwere fit under the constraints: k > 0.3 for the big box data\nand to k > 0.5 hMpc\u22121 for the higher resolution small box\ncalculations; the nonlinear power must be 10% greater than\nthe discreteness correction, equation (41). On larger scales\nk < 0.15 hMpc\u22121, the formula was calibrated to the results\nof 2nd-order perturbation theory.\nIn Fig. 12 we compare our new halo-based fitting func-\ntion with the scale-free simulations. The new model clearly\nreproduces the data to a high degree of accuracy. Also, it\nis important to note that when the data are plotted in this\nway the scaling nature is again apparent and the departure\nfrom stable clustering, which is indicated by the deviation\naway from PD96 for k\/k0 > 10, is pronounced.\nIn Figs 13 and 14 we compare the new halo based model\nwith the power-law data for \u2126 < 1 and \u2126 + \u039b = 1. For\nall of the models the inclusion of the functions f1, f2 and\nf3, seems to well reproduce the observed density-dependent\ngrowth. The only significant discrepancy is for the n = \u22122\nopen data, where the power is underpredicted in the quasi-\nlinear regime.\nIn Figs 15 and 16 we compare the model with the CDM\ndata. Again, the model does exceptionally well at repro-\nducing all of the data over the range of scales where we are\nconfident that numerical effects are unimportant. In particu-\nFigure 14. Top and bottom panels are similar to Fig. 12, but\nthis time points represent \u039b model data. Four epochs are shown;\nthese are a = 0.7, 0.8, 0.9, 1.0. In terms of \u2126, these epochs cor-\nrespond to: \u2126 = 0.505, 0.407, 0.325, 0.260. Again, the thick solid\nline represents the fit to the scale-free data.\nlar, the OCDM and \u03c4CDM predictions are very significantly\nimproved using the new prescription.\nHaving demonstrated the success of the halo fitting\nfunction on small scales, we next consider the large scales.\nWe assess this using the predictions derived from 2nd order\nperturbation theory (see Baugh & Efstathiou 1994). Fig. 17\nshows the ratio of nonlinear to linear power for four CDM\nmodels. The current models match perturbation theory for\nk < 0.1 hMpc\u22121, but deviations exist at higher k. These\nplausibly reflect a genuine breakdown of perturbation the-\nory, since the model was required to match perturbation\ntheory as well as possible for k < 0.15 hMpc\u22121, and yet the\nfit is breaking down slightly before this upper limit. Both\nthe halo fitting function and PD96 agree well in this range.\n7 CONCLUSIONS AND DISCUSSION\nIn this paper we have presented a set of high-resolution, 2563\nparticle, scale-free N-body simulations, designed to investi-\ngate self-similar gravitational clustering and in particular\nthe effects of nonlinear evolution. We have also performed a\nfurther series of numerical simulations, with the same res-\nolution, to explore how the evolution of clustering depends\nupon the background density of the universe. Together, these\nsimulations represent the best calculations that exist to date\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n20 Smith et al.\nFigure 15. Power spectra for the four Virgo CDM simulations (J98) in large cosmological volumes, L = 239.5h\u22121Mpc. Each panel\nshows the evolution of structure with redshift. The data points correspond, from low to high, to epochs z = 0, 0.5, 1.0, 2.0 and 3.0. Note\nthat only those points with a measured power above the discreteness spectrum are plotted. The solid line represents the new halo-model\nbased fitting procedure, with dotted lines representing the decomposition into the self-halo and halo-halo terms; the dashed line is the\nPD96 fit.\nfor the set of models explored, with a factor 512 improve-\nment in mass resolution over the ground-breaking work of\nEfstathiou et al. (1988).\nWe verified that the final output power spectra were ro-\nbust by considering grid and glass particle loads. However,\nat early times the problem of discreteness correction is sim-\npler to handle if a glass start is applied; we have described\na detailed method for correcting the clustering signal in this\ncase. We have implemented the power spectrum estimation\ntechnique of J98, which allowed us to probe high spatial\nfrequencies without aliasing effects or errors due to mass as-\nsignment to the Fourier mesh. The simulation results may\nbe summarized as follows:\n(1) Scale-free simulations with 0 < n < \u22122 show self-\nsimilarity under the scaling k0(a) \u221d a\n\u22122\/(n+3). This conclu-\nsion is in agreement with the results of Efstathiou (1988)\nand Jain & Bertschinger (1998).\n(2) In the quasi-linear regime, the power spectrum is\ncharacterized by a steep power law. The exact slope depends\nupon the spectral index n of the input spectrum and the\nvalue of \u2126, the slope steepening as n becomes more negative\nand as \u2126 is reduced.\n(3) The observed nonlinear asymptote of the Einstein-\nde Sitter simulations was found to be inconsistent with the\n\u22062NL \u221d [\u2206\n2\nL]\n3\/2 prediction of stable clustering. A shallower\nslope with \u22062NL \u221d [\u2206\n2\nL]\n1 is preferred. This result makes\nsense in terms of the halo model: calculations using the ex-\ntended Press-Schechter apparatus show that haloes will tend\nto merge with systems of similar mass to their own (Lacey &\nCole 1993). Mergers of this kind will disrupt the virial equi-\nlibrium of the system, violating the basic assumption that\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 21\nFigure 16. Same as for Fig. 15, but this time for the smaller box GIF simulations.\nunderlies stable clustering. However, if this process were rare\nthen stable clustering could be upheld in a statistical sense.\n(4) The nonlinear fitting formulae of PD96 and JMW95\nfailed to reproduce the n = \u22122 results and were only\nmarginally successful at reproducing the steeper spectra.\nThe low-density power-law data were poorly fit by PD96.\nIn the second part of this paper, we proposed an im-\nproved fitting function for mass power spectra to replace\nthe much-used PD96 formula. We have adopted a new ap-\nproach to fitting power spectra, based upon a fusion of the\nhalo model and a HKLM scaling. The method was gen-\neralized to fit more realistic curved spectra, by introduc-\ning two new parameters, neff the effective spectral index\non the nonlinear scale, and the spectral curvature, C. We\nfound that the halo model as previously envisaged in the\nliterature fails to approach linear theory on large scales\nfor n \u2265 0. We have argued that this should be cured by\nchanging the self-halo power from n = 0 to n = 2 on large\nenough scales, and we have shown empirically that this ap-\nproach allows an accurate description of a very wide range of\npower-spectrum data. Our new fitting formula reproduced\nthe scale-free power-spectrum data and also the CDM re-\nsults of J98 with an rms error better than 7%. This is to be\npreferred to the widely-used PD96 prescription, and should\nbe useful for a variety of cosmological investigations. In par-\nticular, the present formalism should cope naturally with\nspectra containing a realistic degree of baryonic features\n(e.g. Meiksin, White & Peacock 1999).\nThe halo model provides a novel way to view structure\nformation, and has yielded useful insights into the origin of\nnonlinear aspects of galaxy clustering. This work has con-\ncentrated on the low-order statistics of the density field, but\nit is also possible to consider higher-order statistics such as\nthe bispectrum. This three-point function in Fourier space\nprobes the shapes of large-scale structures that are gener-\nated by gravitational clustering. No shape information is\nincluded in the current formalism, so it will be interest-\ning to see how well the model can account for higher-order\nstatistics. Initial results in this direction (Scoccimarro et al.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n22 Smith et al.\nFigure 17. Comparison to perturbation theory. The top panel\nshows the ratio of the evolved power to the linear power for two\nCDM models with \u0393 = 0.2, but with different normalizations.\nThe model with \u03c38 = 1. has been translated by a factor of 0.5\nin the y-direction. The points represent perturbation theory; the\nthick solid line is this work; the dashed line represents PD96. The\nbottom panel is the same as the top, but with \u0393 = 0.5.\n2001) seem to be promising. In general, the important ques-\ntion is the extent to which the halo model can encapsu-\nlate the phase information in the density field, since fields\nwith identical power spectra can possess completely differ-\nent real-space distributions (e.g. Chiang & Coles 2000). The\nhalo model will inevitably fail to encompass these details of\nthe density field in full, although it may still offer useful in-\nsights. However, at the two-point level, we have shown that\nthe model is far more than an educational device, and it\ncan be used as a tool for a high-precision description of the\nevolution of the dark-matter power spectrum.\nACKNOWLEDGEMENTS\nRES thanks Bhuvnesh Jain, Peter Watts and Andy Tay-\nlor for helpful discussions during this work. The simula-\ntions in this paper were carried out as part of the pro-\ngramme of the Virgo Consortium for cosmological sim-\nulation (http:\/\/www.mpa-garching.mpg.de\/Virgo) using\ncomputers based at the Computing Centre of the Max-\nPlanck Society in Garching and at the Edinburgh Paral-\nlel Computing Centre. RES acknowledges a PPARC re-\nsearch studentship and a PPARC postdoctoral research as-\nsistantship.\nREFERENCES\nBaugh C.M., Efstathiou G., 1994. MNRAS, 270, 183.\nBaugh C.M., Gaztanaga E., Efstathiou G., 1995. MNRAS, 274,\n1049.\nBenson A., Cole S., Baugh C.M., Frenk C., 2000. MNRAS, 311,\n793.\nBernardeau F., Colombi S., Gaztanaga E., Scoccimarro R.,2001.\nastro-ph\/0112551.\nBode P., Ostriker J., Turok N., 2001. ApJ, 556, 93.\nCaldwell R.R., Juskiewicz R., Steinhardt P.J., Bouchet F.R.,\n2001. ApJ, 547, L93.\nCarroll S.M., Press W.H., Turner E.L., 1992. ARAA, 30, 499.\nCouchman H.M.P., Thomas P.A., Pearce F.R., 1995. ApJ, 452,\n797.\nColberg J. M., White S. D. M., Yoshida N., MacFarland T. J.,\nJenkins A., Frenk C. S., Pearce F. R., Evrard A. E., Couch-\nman H. M. P., Efstathiou G., Peacock J. A., Thomas P. A.,\nThe Virgo Consortium, 2000. ApJ, 452, 797.\nChiang L., Coles P., 2000. MNRAS, 311, 809.\nDavis M., Peebles P.J.E., 1977. ApJ Suppl., 34, 425.\nEfstathiou G., Davis M., White S.D.M., Frenk C.S., 1985. ApJ\nSuppl., 57, 241.\nEfstathiou G., Frenk C.S., White S.D.M., Davis M., 1988. MN-\nRAS, 235, 715.\nGott J.R. III, Rees M.J., 1974. A&A, 45, 365.\nHamilton A.J.S., Kumar P., Lu E., Matthews A., 1991. ApJ Lett.,\n374, L1. (HKLM).\nHockney R.W., Eastwood J.W., 1981. Computer Simulation Us-\ning Particles, McGraw-Hill, New York.\nJain B., 1997. MNRAS, 287, 687.\nJain B., Bertschinger E., 1998. ApJ, 509, 517.\nJain B., Mo H.J., White S.D.M., 1995. MNRAS, 276, L25.\n(JMW95).\nJenkins A., Frenk C.S., Pearce F.R., Thomas P.A., Colberg J.M.,\nWhite S.D.M., Couchman H.M.P., Peacock J.A., Efstathiou\nG., Nelson A.H., 1998. ApJ, 499, 20. (J98).\nJenkins A., Frenk C.S., White S.D., Colberg J.M., Cole S., Evrard\nA.E., Yoshida N., 2001. MNRAS, 321, 372.\nLacey C., Cole S., 1993. MNRAS, 262, 627. Lahav, Ofer; Rees,\nMartin J.; Lilje, Per B.; Primack, Joel R.\nLahav O., Rees M.J., Lilje P., Primack J. R., 1991. MNRAS, 251,\n128L.\n Lokas E.L., Juskiewicz R., Bouchet F.R., Hivon E., 1996. ApJ,\n467, 1.\nMacfarland T., Couchman H. M. P., Pearce F. R., Pichlmeier J.,\n1998. New Astronomy, 3, 687.\nMa C., Fry J.N., 2000a. ApJ, 543, 503.\nMa C., Fry J.N., 2000b. ApJ Lett., 538, L107.\nMcClelland J., Silk J., 1977. ApJ, 216, 665.\nMeiksin A., White M., Peacock J.A., 1999. MNRAS, 304, 851\nMo H.J., White S.D.M., 1996. MNRAS, 282, 347.\nMo H.J., Jing Y.P., Bo\u00a8rner G., 1997. MNRAS, 286, 979.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\nStable clustering, the halo model and nonlinear cosmological power spectra 23\nMo H.J., Jing Y.P., White S.D.M., 1997. MNRAS, 284, 189.\nMoore B., Ghigna S., Governato F., Lake G., Quinn T., Stadel\nJ., Tozzi P., 1999. ApJ Lett., 524, L19.\nNavarro J.F., Frenk C.S., White S.D.M., 1996. ApJ, 462, 563.\nNavarro J.F., Frenk C.S., White S.D.M., 1997. ApJ, 490, 493.\nNeyman J., Scott E.L., 1952. ApJ, 116, 144.\nPadmanabhan, T. Cen, R. Ostriker, J. P. Summers, F. J., 1996.\nApJ, 466, 604.\nPadmanabhan T., 1996. MNRAS, 278, L29.\nPeacock J.A., Dodds S.J., 1994. MNRAS, 267, 1020. (PD94).\nPeacock J.A., Dodds S.J., 1996. MNRAS, 280, L19. (PD96).\nPeacock J.A., Nicholson D., 1991. MNRAS, 253, 307.\nPeacock J.A., Smith R.E., 2000. MNRAS, 318, 1144.\nPearce F.R., Couchman H.M.P., 1997. New Astronomy, 2, 411.\nPeebles P.J.E., 1974a. ApJ Lett., 189, L51.\nPeebles P.J.E., 1974b. Astron. Astrophys., 32, 197.\nPeebles P.J.E., 1980. \u201dThe large-scale structure of the universe\u201d,\nPrinceton University Press, Princeton N.J.\nPress W.H., Schechter P., 1974. ApJ, 187, 425.\nScherrer R.J., Bertschinger E., 1991. ApJ, 381, 349.\nScoccimarro R., Couchman H., 2001. MNRAS, 325, 1312.\nScoccimarro R., Sheth R.K., Hui L., Jain B., 2001. ApJ, 546, 20.\nScoccimarro R., Sheth R.K., 2002. MNRAS, 329, 629S.\nSeljak U., 2000. MNRAS, 318, 203.\nSheth R.K., Jain B., 1997. MNRAS, 285, 231.\nSheth R.K., Lemson G., 1999. MNRAS, 304, 767.\nSheth R.K., Tormen G., 1999. MNRAS, 308, 119.\nSheth R.K., Mo H-J., Tormen G., 2000. MNRAS, 323, 1.\nSmith C.C., Klypin A., Gross M.A.K., Primack J.R., Holtzman\nJ., 1998. MNRAS, 297, 910.\nVan Waerbeke, L. Mellier Y.,Radovich M., Bertin E., Dantel-Fort\nM., McCracken H. J., Le Fe`vre O., Foucaud S., Cuillandre J.-\nC., Erben T., Jain B., Schneider P., Bernardeau F., Fort B.,\n2001. A&A, 374, 757.\nWhite S.D.M., 1993. In: Cosmology and Large Scale Structure,\nLes Houches Session LX, 77.\nYano T., Gouda N., 2000. ApJ, 539, 493.\nZeldovich Y.B., 1970. A&A, 5, 84.\nAPPENDIX A: HKLM FITTING FUNCTIONS\nA1 The JMW95 function\nThe JMW95 function was designed to model the n-\ndependence of the nonlinear evolution of scale-free power\nspectra. The formula was also used to model \u2126 = 1, CDM-\nlike models through the adoption of an effective spectral\nindex; see equation (14). JMW\u2019s formula described their nu-\nmerical data with an rms accuracy of 15-20%, but for our\nhigher resolution scale-free data the fit is much worse, hav-\ning an rms error of 56%. Their formula is\n\u22062NL(kNL)\nB(n)\n= fJMW\n[\n\u22062L(kL)\nB(n)\n]\n, (A1)\nwhere B(n) is a constant which depends upon the spectral\nindex n and where fJMW(y) remains independent of n. The\nexplicit forms are:\nB(n) =\n(\n3 + n\n3\n)1.3\n(A2)\nand\nfJMW(y) = y\n[\n1 + 0.6y + y2 \u2212 0.2y3 \u2212 1.5y3.5 + y4\n1 + 0.0037y3\n]0.5\n(A3)\nwhere y \u2261 \u22062L(kL)\/B(n) .\nA2 The PD96 function\nPD96 performed a similar study to JMW95, but extended\nthe set of cosmological models to include \u2126 < 1 open and\nflat universes. They also improved on JMW95 by including\nCDM data in the optimization procedure and by proposing\nthat the effective spectral index would vary continuously\nwith scale: equation (15). They reported that their fitting\nformula described their simulation data to an accuracy of\nabout 14%, but it describes our complete data set with an\nrms error of 54%. The PD96 fitting formula is\nfPD(y) = y\n[\n1 +B\u03b2y + [Ay]\u03b1\u03b2\n1 + ([Ay]\u03b1g3(\u2126,\u039b)\/[V y1\/2])\u03b2\n]1\/\u03b2\n, (A4)\nwhere y \u2261 \u22062L(kL). B describes a second order deviation\nfrom linear growth; A and \u03b1 parameterize the power law\nthat dominates the function in the quasi-linear regime; V\nis the virialization parameter that gives the amplitude of\nthe fNL \u221d y\n3\/2 asymptote; \u03b2 softens the transition between\nthese regions; g(\u2126) is the density dependent growth factor\nof (Carroll, Press & Turner 1992), which is the ratio of the\nlinear growth factor to the expansion factor. This has the\nfunctional form\ng(\u2126) =\nD(a)\na\n=\n5\n2\n\u2126\n[\n\u21264\/7 \u2212 \u039b+ (1 + \u2126\/2)(1 + \u039b\/70)\n]\u22121\n.\n(A5)\nThe best-fitting parameters were\nA = 0.482 (1 + n\/3)\u22120.947\nB = 0.226 (1 + n\/3)\u22121.778\n\u03b1 = 3.310 (1 + n\/3)\u22120.244\n\u03b2 = 0.862 (1 + n\/3)\u22120.287\nV = 11.55 (1 + n\/3)\u22120.423 . (A6)\nAPPENDIX B: NEW HKLM FITS TO THE\nPRESENT DATA\nWe have performed a nonlinear least squares fitting to the\nindividual scale-free loci (see Fig. 7) using a single formula.\nThe individual fitting functions are accurate to \u2243 9%. The\nformula is\nfEdS(y) = y\n[\n1 + y\/a+ (y\/b)2 + (y\/c)\u03b1\u22121\n1 + (y\/d)(\u03b1\u2212\u03b2)\u03b3\n]1\/\u03b3\n, (B1)\nwhere y \u2261 \u22062L(kL) and the relevant parameters for each n\nare presented below\nn a b c d \u03b1 \u03b2 \u03b3\n\u22122 3.138 0.358 0.527 0.940 8.247 0.508 0.330\n\u22121.5 2.710 0.710 0.919 1.852 0.707 0.647 0.332\n\u22121 10.37 1.115 1.403 2.873 6.655 0.697 0.366\n0 29.26 1.394 1.941 3.753 6.547 0.847 0.351\nAPPENDIX C: THE HALO MODEL FITTING\nFUNCTION\nThe halo model decomposes the power into a sum of two\ncontributions:\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n24 Smith et al.\n\u22062NL(k) = \u2206\n2\nQ(k) + \u2206\n2\nH(k). (C1)\nThese are given separately by\n\u22062Q(k) = \u2206\n2\nL(k)\n[\n(1 + \u22062L(k))\n\u03b2n\n1 + \u03b1n\u22062L(k)\n]\nexp [\u2212f(y)]; (C2)\nwhere y \u2261 k\/k\u03c3 and f(y) = y\/4 + y\n2\/8; and\n\u22062H(k) =\n\u22062 \u2032H (k)\n1 + \u00b5ny\u22121 + \u03bdny\u22122\n, (C3)\nwhere\n\u22062 \u2032H (k) =\nan y\n3f1(\u2126)\n1 + bnyf2(\u2126) + [cnf3(\u2126) y]\n3\u2212\u03b3n\n(C4)\nand y \u2261 k\/k\u03c3.\nThe parameters of the spectrum are defined via Gaus-\nsian filtering:\n\u03c32(RG) \u2261\n\u222b\n\u22062L(k) exp(\u2212k\n2R2G) d ln k. (C5)\nIn these terms,\n\u03c3(k\u22121\u03c3 ) \u2261 1. (C6)\nThe effective index is\n3 + neff \u2261 \u2212\nd ln \u03c32(R)\nd lnR\n\u2223\u2223\u2223\u2223\n\u03c3=1\n, (C7)\nand the spectral curvature is\nC \u2261 \u2212\nd2 ln \u03c32(R)\nd lnR2\n\u2223\u2223\u2223\u2223\n\u03c3=1\n. (C8)\nAllowing (an, bn, cn, \u03b3n, \u03b1n, \u03b2n, \u00b5n, \u03bdn) to vary as a function\nof spectral properties, the following coefficients fit our sim-\nulation data and the CDM simulations of J98 to an rms\nprecision of 8.6% (very much better than PD96). In partic-\nular, the model describes the \u039bCDM data of J98 extremely\nwell. For redshifts z < 3, the deviation in power between\nmodel and the average of the large-box and small-box data\nfrom J98 is always less than 3% for k < 10 hMpc\u22121. This\nrepresents a perfect fit with present knowledge, since the two\ndatasets themselves can differ by at least this much. Note\nthe use of terms up to n4 in the fit for an; these are required\nin order to describe the rapid rise in amplitude of the halo\nterm for n < \u22122. For less negative n, the higher-order terms\nare unimportant. The coefficients are:\nlog10 an = 1.4861 + 1.8369 n+ 1.6762 n\n2 + 0.7940 n3\n+ 0.1670 n4 \u2212 0.6206 C ; (C9)\nlog10 bn = 0.9463 + 0.9466 n+ 0.3084 n\n2 \u2212 0.9400 C ;(C10)\nlog10 cn = \u22120.2807+0.6669 n+0.3214 n\n2 \u22120.0793 C ;(C11)\n\u03b3n = 0.8649 + 0.2989 n+ 0.1631 C ; (C12)\n\u03b1n = 1.3884 + 0.3700 n\u2212 0.1452 n\n2 ; (C13)\n\u03b2n = 0.8291 + 0.9854 n+ 0.3401 n\n2 ; (C14)\nlog10 \u00b5n = \u22123.5442 + 0.1908 n ; (C15)\nlog10 \u03bdn = 0.9589 + 1.2857 n ; (C16)\nand the \u2126 dependent functions are:\nf1a(\u2126) = \u2126\n\u22120.0732\nf2a(\u2126) = \u2126\n\u22120.1423\nf3a(\u2126) = \u2126\n0.0725\n}\n\u2126 \u2264 1 (C17)\nf1b(\u2126) = \u2126\n\u22120.0307\nf2b(\u2126) = \u2126\n\u22120.0585\nf3b(\u2126) = \u2126\n0.0743\n}\n\u2126+ \u039b = 1 (C18)\nFor models in which \u039b is neither zero nor 1\u2212\u2126, we suggest\ninterpolating the functions f1 etc. linearly in \u039b between the\nopen and flat cases. Code to implement this method is avail-\nable from\nhttp:\/\/as1.chem.nottingham.ac.uk\/scale-free.\nc\u00a9 0000 RAS, MNRAS 000, 000\u2013000\n"}