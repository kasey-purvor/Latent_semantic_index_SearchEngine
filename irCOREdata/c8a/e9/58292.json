{"doi":"10.1029\/2009GL039927","coreId":"58292","oai":"oai:nora.nerc.ac.uk:9158","identifiers":["oai:nora.nerc.ac.uk:9158","10.1029\/2009GL039927"],"title":"Forecasting change of the magnetic field using core surface flows and ensemble Kalman filtering","authors":["Beggan, C.D.","Whaler, K.A."],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2009","abstract":"Accurate forecasting of the change of the Earth's internal magnetic field over short intervals of time (e.g., less than five years) has many applications for government, academic and commercial users. Forecasting can be achieved by making a number of reasonable assumptions about how the main field interacts with the flow in the liquid outer core. In particular, the magnetic field can be considered to be entrained in the large scale flow along the core\u2010mantle boundary surface over short time periods, giving rise to measurable change at the Earth's surface. The observed change (or secular variation) at or above the surface of the Earth can thus be inverted to produce flow models; these can be used to propagate fluid parcels threaded by the field forwards in time to forecast the non\u2010linear change of the magnetic field. In addition to prediction of field change by flow models, it would be advantageous to include observations of the field from satellite measurements or ground\u2010based observatories. We therefore present a method using Ensemble Kalman Filtering (EnKF) to produce an optimal assimilation between magnetic field change as forecast from core flow models and direct observations of the field. We show, by assuming a steady flow and assimilating field observations annually, it is possible to produce a forecast over five years with less than 30nT root mean square difference from the \u2018true\u2019 field \u2013 within an assumed error budget. The EnKF method also allows sensitivity analysis of the field models to noise and uncertainty within the physical representation","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/58292.pdf","fullTextIdentifier":"http:\/\/nora.nerc.ac.uk\/9158\/1\/EnKF_paper.pdf","pdfHashValue":"99cc41368c4ab4d4358cb38b54e510cef9d2f846","publisher":"American Geophysical Union","rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:nora.nerc.ac.uk:9158<\/identifier><datestamp>\n      2012-11-22T12:07:40Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      74797065733D61727469636C65<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:relation>\n    \n      \n        http:\/\/nora.nerc.ac.uk\/id\/eprint\/9158\/<\/dc:relation><dc:title>\n        Forecasting change of the magnetic field using core surface flows and ensemble Kalman filtering<\/dc:title><dc:creator>\n        Beggan, C.D.<\/dc:creator><dc:creator>\n        Whaler, K.A.<\/dc:creator><dc:description>\n        Accurate forecasting of the change of the Earth's internal magnetic field over short intervals of time (e.g., less than five years) has many applications for government, academic and commercial users. Forecasting can be achieved by making a number of reasonable assumptions about how the main field interacts with the flow in the liquid outer core. In particular, the magnetic field can be considered to be entrained in the large scale flow along the core\u2010mantle boundary surface over short time periods, giving rise to measurable change at the Earth's surface. The observed change (or secular variation) at or above the surface of the Earth can thus be inverted to produce flow models; these can be used to propagate fluid parcels threaded by the field forwards in time to forecast the non\u2010linear change of the magnetic field. In addition to prediction of field change by flow models, it would be advantageous to include observations of the field from satellite measurements or ground\u2010based observatories. We therefore present a method using Ensemble Kalman Filtering (EnKF) to produce an optimal assimilation between magnetic field change as forecast from core flow models and direct observations of the field. We show, by assuming a steady flow and assimilating field observations annually, it is possible to produce a forecast over five years with less than 30nT root mean square difference from the \u2018true\u2019 field \u2013 within an assumed error budget. The EnKF method also allows sensitivity analysis of the field models to noise and uncertainty within the physical representation.<\/dc:description><dc:publisher>\n        American Geophysical Union<\/dc:publisher><dc:date>\n        2009<\/dc:date><dc:type>\n        Publication - Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:format>\n        text<\/dc:format><dc:language>\n        en<\/dc:language><dc:identifier>\n        http:\/\/nora.nerc.ac.uk\/id\/eprint\/9158\/1\/EnKF_paper.pdf<\/dc:identifier><dc:identifier>\n         \n\n  Beggan, C.D.; Whaler, K.A..  2009  Forecasting change of the magnetic field using core surface flows and ensemble Kalman filtering.   Geophysical Research Letters, 36 (18), L18303.   https:\/\/doi.org\/10.1029\/2009GL039927 <https:\/\/doi.org\/10.1029\/2009GL039927>     \n <\/dc:identifier><dc:relation>\n        http:\/\/www.agu.org\/journals\/gl\/<\/dc:relation><dc:relation>\n        10.1029\/2009GL039927<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/nora.nerc.ac.uk\/id\/eprint\/9158\/","http:\/\/www.agu.org\/journals\/gl\/","10.1029\/2009GL039927"],"year":2009,"topics":[],"subject":["Publication - Article","PeerReviewed"],"fullText":"GEOPHYSICAL RESEARCH LETTERS, VOL. ???, XXXX, DOI:10.1029\/,\nForecasting Change of the Magnetic Field using Core1\nSurface Flows and Ensemble Kalman Filtering2\nC. D. Beggan*\nSchool of GeoSciences, University of Edinburgh, Edinburgh, UK3\nK. A. Whaler\nSchool of GeoSciences, University of Edinburgh, Edinburgh, UK4\nC. D. Beggan, School of GeoSciences, University of Edinburgh, King\u2019s Buildings, West Mains\nRoad, Edinburgh, UK, EH9 3JW. *now at the British Geological Survey (ciar@bgs.ac.uk)\nK. A. Whaler, School of GeoSciences, University of Edinburgh, King\u2019s Buildings, West Mains\nRoad, Edinburgh, UK, EH9 3JW. (kathy.whaler@ed.ac.uk)\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 2 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\nAccurate forecasting of the change of the Earth\u2019s internal magnetic field5\nover short intervals of time (e.g. less than five years) has many applications6\nfor government, academic and commercial users. Forecasting can be achieved7\nby making a number of reasonable assumptions about how the main field in-8\nteracts with the flow in the liquid outer core. In particular, the magnetic field9\ncan be considered to be entrained in the large scale flow along the core-mantle10\nboundary surface over short time periods, giving rise to measurable change11\nof the field at the Earth\u2019s surface. The observed change (or secular variation)12\nat or above the surface of the Earth can thus be inverted to produce flow13\nmodels; these can be used to propagate fluid parcels threaded by the field14\nforwards in time to forecast the non-linear change of the magnetic field. In15\naddition to prediction of field change by flow models, it would be advanta-16\ngeous to include observations of the field from satellite measurements or ground-17\nbased observatories. We therefore present a method using Ensemble Kalman18\nFiltering (EnKF) to produce an optimal assimilation between magnetic field19\nchange as forecast from core flow models and direct observations of the field.20\nWe show, by assuming a steady flow and assimilating field observations an-21\nnually, it is possible to produce a forecast over five years with less than 30nT22\nroot mean square difference from the \u2018true\u2019 field \u2013 within an assumed error23\nbudget. The EnKF method also allows sensitivity analysis of the field mod-24\nels to noise and uncertainty within the physical representation.25\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 3\n1. Introduction\nThe slow temporal variation of the Earth\u2019s magnetic field is termed \u2018secular variation\u201926\n(SV) and is related to advection and diffusion of the field within the liquid outer core.27\nForecasting the short term change of the field in an accurate and timely fashion is of great28\nbenefit to commercial users in areas such as mining, underground drilling and naviga-29\ntion, as well as for academic and civilian users, e.g. where access to real-time data may30\nnot be available. The International Geomagnetic Reference Field (IGRF) model enjoys31\nwidespread use for this purpose. The model is revised and updated every five years and32\nforecasts secular variation for the future five year period [Macmillan and Maus, 2005].33\nMethods for forecasting the magnetic field change have previously relied upon extrapola-34\ntion of ground-based observatory data and the forecasts can often be quite in error at the35\nend of their desired lifetime.36\nRecently, high resolution magnetic field models such as GRIMM [Lesur et al., 2008],37\nPOMME [Maus et al., 2006] and xCHAOS [Olsen and Mandea, 2008] have been developed38\nusing data from the CHAMP, \u00d8rsted and SAC-C satellite missions. These provide an39\nexcellent description of the field, SV and secular acceleration (SA) over the period 1999\u201340\n2009. Detailed models of the large-scale surface core flows generating the observed SV41\nhave been developed by a number of researchers [e.g. Hulot et al., 2002; Holme and Olsen,42\n2006]. If it is assumed on short time scales that advection by core flow of the magnetic43\nfield dominates diffusion then, in a manner analogous to weather forecasting, the evolution44\nof the field can be forecast by propagation of the flow forwards in time.45\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 4 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\nUsing this approach, Maus et al. [2008] generated SV from a series of flow models with46\ndiffering physical constraints to investigate how well the field could be hindcast compared47\nto the CM4 magnetic field model [Sabaka et al., 2004]. They found the misfit between the48\nhindcast field from core flow models and the CM4 model to be less than 100nT root mean49\nsquare (RMS) difference after five years and up to 300nT after ten years. We improve50\nupon this result by using a different flow model inversion technique and employing an51\nEnsemble Kalman Filter.52\nThe Ensemble Kalman Filter (EnKF) is a Monte-Carlo method for optimally combining53\nmodels of and observational information about a physical process by statistical represen-54\ntation of the associated uncertainties [Evensen, 1994]. It is extensively used in weather55\nand ocean dynamics forecasting to improve the accuracy of forecasts and to explore the56\nsensitivity of systems to minor perturbations [Evensen et al., 2007]. Data assimilation in57\ngeomagnetism is still in its infancy but has recently been investigated [Fournier et al.,58\n2007; Kuang et al., 2008]. In this paper, we adapt the EnKF for magnetic field prediction59\nusing a simple steady flow model and assuming a relatively noisy field model from lim-60\nited satellite coverage and ground-based magnetic observations is available. This scenario61\nmight occur at some point in the future where continuous satellite monitoring has ceased.62\n2. Methods\nIn the following we describe the methods used to derive a steady flow model that is used63\nfor forecasting, the implementation of an EnKF model and the resulting improvements of64\nthe field forecast using EnKF with assimilation compared to the forecast. We choose a65\nsteady flow as experiments by Maus et al. [2008] found that hindcasts from a steady flow66\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 5\nmodel produced the best average long term fit to the CM4 field model and because it is67\nthe simplest assumption to make for a flow model. More complex flows (e.g. time-varying68\nor different physical hypotheses) can be used if neccesary.69\n2.1. Flow Modelling and Forecasting\nMagnetic main field models are typically represented as a vector of spherical harmonic70\nGauss coefficients (g = [gml ; h\nm\nl ]). Secular variation of the field can be inverted for toroidal71\nand poloidal flow using the linear relationship between SV and flow spherical harmonic72\ncoefficients. The relation is through the Gaunt\/Elsasser matrix (H) whose elements de-73\npend on the main field coefficients [Whaler , 1986] which change with time. In this study,74\nthe main field, SV and flow coefficients are truncated at degree and order lmax = 14, thus75\nwe have assumed that only large scale flows are responsible for the large scale SV. Note76\nthat we invert SV data directly (as explained below) rather than using spherical harmonic77\nmodels (g\u02d9) of SV.78\nWith knowledge of the data covariance, we seek the flow (m\u02c6) which can be obtained79\nfrom the SV using the standard L2 least-squares minimisation norm. We then apply an80\nadditional step using an iterative L1 norm minimisation technique as described in Beggan81\net al. [2009]. The L1 norm technique improves the fit of the flow to the SV data by82\niterative reweighting of the residual differences. The flow is regularized by imposition of83\nthe so-called \u2018strong\u2019 norm a priori conditions [Bloxham, 1988], with a damping parameter84\ncontrolling fit to the data versus flow smoothness.85\nIn our first experiment, a series of 25 monthly SV data sets, over the period 2001.9\u201386\n2004.0, were generated from CHAMP satellite data using the \u2018Virtual Observatory\u201987\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 6 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\nmethod of Mandea and Olsen [2006]. The SV data were inverted for a steady flow model88\n[Voorhies and Backus, 1985], with a tangentially geostrophic flow constraint. This pro-89\nduces a set of flow coefficents (m\u02c6SF ) representing an \u2018average\u2019 flow over the period. The90\nsteady flow model was used to forecast the change of the magnetic field over the five91\nyear period from 2004.0 to 2009.0 and compared to the GRIMM, POMME and xCHAOS92\nsatellite field models.93\nThe Gauss coefficients from the xCHAOS model for 2004.0 were used as the starting\nfield model. The field was advected forward over successive months (k) for five years using\nthe equation:\ngk+1 = gk + (Hkm\u02c6SF )\/12 (1)\nwith the Hk matrix updated at every timestep using the main field coefficients forecast\nfrom the previous timestep, making the system non-linear. To evaluate the validity of\nthis forecast, the RMS difference (or misfit) metric (\n\u221a\ndP ) to a satellite field model is\ncalculated by:\ndP =\nlmax\u2211\nl=1\nl\u2211\nm=0\n(l + 1)[(gml )field \u2212 (gml )forecast]2 (2)\nFigure 1 shows the misfit of the forecast from the flow model to the GRIMM, POMME94\nand xCHAOS satellite field models. Note the GRIMM model spline coefficients extend to95\n2006.5, while the POMME model is extrapolated beyond 2007.5 using constant SV.96\nWe now show how to improve upon these results by employing an Ensemble Kalman97\nFilter to assimilate field observations into forecasts from core flow models.98\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 7\n2.2. Data Assimilation in Ensemble Kalman Filtering\nIn an EnKF, the state of a dynamic process at any particular time can be represented99\nas a vector in n-dimensional space, where n is the number of parameters in the system.100\nThe uncertainty of the process is represented by perturbing the inputs randomly by a101\nknown variance (with zero-mean) to produce an \u2018ensemble\u2019 of states \u2013 conceptually imag-102\nined as a \u2018cloud\u2019 of points in n-dimensional space. The evolution of the states though103\ntime is controlled by propagating the ensemble forward using model equations of the sys-104\ntem behavior. When an observation is available, it can be optimally assimilated into the105\nensemble by applying the standard Kalman Filter equations [Kalman, 1960]. With a suf-106\nficiently large ensemble (determined through experimentation), the mean state represents107\nthe most likely value for the process at the time. The evolution of the ensemble can be108\nexplored by examining the \u2018spread\u2019 of the states about the mean.109\nA traditional Kalman Filter is implemented in two steps: (1) prediction of the evolution\nof the model state by dynamic equations believed to adequately represent the system and\n(2) assimilation of a measurement to correct any accumulated error from the model. At\ntime k, the optimal blending of a forecast state (xfk) and measurement (zk) to generate\nthe assimilated state vector, xak, is through the so-called Kalman gain matrix (Kk):\nxak = x\nf\nk +Kk(zk \u2212 xfk) (3)\nwith\nKk = P\nf\nk(P\nf\nk +Q)\n\u22121. (4)\nwhere Pfk is the covariance of the model and Q is the covariance of the data measurement.\nThe balance between the error of the model and measurement controls the assimilation\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 8 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\nstep. When the Kalman gain matrix has been calculated, the covariance of the assimilated\nstate vector is calculated as:\nPak = (I\u2212Kk)Pfk . (5)\nIn the EnKF, xfk is a model forecast with noise w\nf\nk , and zk is a measurement with some\nassociated measurement noise uk. The forecast, measurement and the newly assimilated\nestimate, xak, are related to the true state of the system, x\nt\nk, by:\nx\nf\nk = x\nt\nk +w\nf\nk ; x\na\nk = x\nt\nk +w\na\nk; zk = x\nt\nk + uk (6)\nwith expectations (i.e. the mean of) wfk = w\na\nk = uk = 0, given a large enough ensemble.110\nIf we consider the covariance of an assimilated ensemble, it can be shown [Evensen, 1994]:111\nPa = (wa)2 = (xa \u2212 xt)2\n=\n(\nI\u2212 P\nf\nPf +Q\n)\nPf\n+2\nPf\nPf +Q\n(\nI\u2212 P\nf\nPf +Q\n)\nwfu. (7)\nThis leads to the key result of the EnKF: when the expectation wfu = 0, Equation 7 is112\nequivalent to Equation 5. This occurs when a suitably large number of ensemble states113\nare employed.114\n2.3. Practical Implementation\nThere are three stages required to implement the EnKF for this problem: (1) generation115\nof the initial ensemble, (2) forecasting the change of the field by driving the field model116\nwith SV predicted by core flow models and (3) assimilation of measurements e.g. from a117\n\u2018true\u2019 field model. Each of these stages is explained in detail below.118\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 9\nInitiating the Ensemble\nThe ensemble is initiated by generating a perturbed set of Gauss coefficients. The119\nmean value of the initial ensemble is equal to the input coefficients of the field. This is120\nimplemented as follows:121\n1. An initial state vector, at time k = 1, is set to be a vector of Gauss coefficients from122\na field model (e.g. xCHAOS).123\n2. If a time series of flow models are available, rather than a single steady flow, the124\nvariability of the the flow model coefficients can be used as additional information. To125\ngenerate the perturbation to the gml field coefficients, the standard deviation for each126\ncoefficient over the entire set of flow models is calculated (from the variability in each127\nflow coefficient of m\u02c6). However, with a single steady flow an alternative estimate of the128\nvariance must be made.129\n3. A matrix of normally distributed random numbers N(0, 1) with size [lmax(lmax+2)\u00d7130\nnensembles] is created, where nensembles is the number of ensemble states.131\n4. The matrix of random numbers is multiplied by the standard deviation of the flow132\ncoefficients to give a perturbed flow coefficient matrix.133\n5. The perturbed flow coefficient matrix is pre-multiplied by the H matrix to produce134\na matrix of perturbed SV coefficients, correctly scaled to reflect the uncertainty in the135\nflow models.136\n6. The perturbed SV coefficient matrix is then added to the initial state vector to137\nproduce an ensemble matrix (Ensemble1).138\nOnce the initial ensemble has been created, forecasting and assimilation can take place.139\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 10 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\nDriving the Ensemble Forecasts\nThe forecast (prediction) of the field is driven forwards by the summation of (1) the field140\ncoefficients and (2) the monthly SV coefficients from the flow model which are perturbed141\nby a random matrix with zero mean and standard deviation computed from the variance142\nof the flow over time. In addition, at each timestep, model noise is added to simulate the143\nvariance of the ensemble, forcing it to grow at each forecast iteration. The model noise is144\ncontrolled by the size of the time-step (\u2206t), the standard deviation of the SV coefficients145\nfrom the previous iteration, and a parameter \u03c1, which can be used to control the time146\ncorrelation of the noise, if required [Evensen et al., 2007].147\n1. The SV coefficients generated by the flow model for month k are calculated by148\nmultiplying the flow model coefficients by the H matrix.149\n2. The monthly SV coefficients are perturbed by the standard deviation of the flow150\nconverted into an equivalent SV.151\n3. Model noise is simulated by multiplication of a matrix of random zero-mean152\nnormally-distribution numbers (of size [lmax(lmax + 2)\u00d7 nensembles]) with the square-root153\nof the timestep\n\u221a\n\u2206t and \u03c1.154\n4. The matrix of perturbed SV coefficients and model noise are added to the ensemble155\nfrom the previous timestep (Ensemblek\u22121) to produce the forecast for the current ensemble156\n(Ensemblek).157\nThese four steps are repeated until a measurement becomes available for assimilation158\ninto the ensemble.159\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 11\nAssimilation of Measurements into the Ensemble\nOver time, the forecast field will begin to diverge from the actual field. To improve160\nthe forecast, data can be input into the ensemble to update (correct) it. The data have161\nassociated errors which are used to generate a perturbed data ensemble. These perturbed162\ndata are assimilated into the overall ensemble using the Kalman Filter algorithm.163\n1. Data, for example a set of Gauss coefficients (zk), are available with a certain (esti-164\nmated or known) error for each coefficient.165\n2. A matrix of zero-mean Gaussian random numbers is generated and scaled with the166\ndata error.167\n3. The data are added to the matrix of scaled random numbers to produce a matrix of168\n\u2018perturbed data\u2019, with mean equal to that of the data themselves.169\n4. Using Equation 3 the data perturbation matrix and the perturbed SV coefficients170\nare optimally assimilated into the ensemble at this timestep.171\nThe covariance matrices can be estimated from the ensemble and measurement errors172\n[Evensen, 1994]. Note it is also possible to use non-synoptic (i.e. partial) measurements173\nof the field in the assimilation step with an appropriate \u2018observation\u2019 operator. Evensen174\net al. [2007] outlines and demonstrates how to efficiently code and compute the matrix175\noperations for the EnKF. The number of ensemble states was set to 1000 after experimen-176\ntation, though it was found that any more than 500 is adequate. Typically, a measurement177\n(i.e. Gauss coefficients from a field model) is assimilated every twelve months.178\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 12 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\n3. Applying the Ensemble Kalman Filter to Forecasting\nIn Figure 1, the steady flow model prediction slowly diverges from the main field mod-179\nels over the time period. Assimilating actual field measurements would be expected to180\nimprove the fit of the predicted field to the \u2018true\u2019 field. Any improvement is dependent181\non the errors of the input measurement. For example, a poor measurement allocated an182\nassociated small estimated error will increase the RMS misfit of the \u2018nowcast\u2019. However,183\nit is often difficult to correctly estimate the errors associated with each Gauss coefficient184\nin a field model given that we do not have full knowledge of the field [Langel et al., 1989].185\nThe results of the forecast with data assimilation for the GRIMM and POMME (both186\nextrapolated beyond 2006.5) and xCHAOS field models are shown in Figure 2. Each187\nensemble was initiated using the xCHAOS field model. Assimiliations of noisy measur-188\nments from the relevant field model are indicated by jumps in the curves. The solid black189\nline represents the misfit (Equation 2) of the mean Gauss coefficients of the ensemble to190\nthe satellite field models, while the dashed lines are misfits of the Gauss coefficients one191\nstandard deviation above or below the mean. The middle and lower panels show that the192\nmean ensemble (solid line) fits to better than 25nT for both the POMME and xCHAOS193\nmodels over the entire period. Most of the misfit is from the difference between forecast194\nand model at degrees l = 1\u2212 4.195\nFrom Equation 4 it should be clear that the calculation of the EnKF is sensitive to196\nthe estimates of input errors. Analysis of the factors affecting the forecast fidelity shows197\nthat the error associated with the assimilated Gauss coefficients is the major contributor.198\nThe error associated with the steady flow model coefficients is a secondary effect. In our199\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 13\nexample, after experimentation, the error on each of the field model coefficients was set200\nto z\/(2 \u00b7 103). For the largest coefficient (g01) this is a relative error of 15nT, equivalent to201\napproximately two years of SV. Larger errors than this produce forecasts that are worse202\nthan predictions from steady flow alone. In this case, increasing the size of the error203\nestimate of the measurement by two approximately doubles the size of the misfit. A ten-204\nfold increase in the measurement error results in a poor input field estimate causing a205\nlarge divergence from the \u2018true\u2019 field (the misfit after five years rises to over 400nT).206\n4. Discussion and Conclusion\nThe EnKF allows exploration of the system under consideration through examination207\nof the \u2018spread\u2019 of the ensemble. In Figure 2, the ensemble models \u22121\u03c3 away from the208\nmean are a poorer match to the \u2018true\u2019 model, though the +1\u03c3 model is usually better than209\nthe mean for the GRIMM and POMME comparisons. Another note-worthy point is that210\ncertain measurement assimilations have little or no effect. For example, for POMME at211\n2008.0, the measurement assimilation barely alters the mean but does reduce the spread212\nof the ensemble (the \u00b11\u03c3 states become close to the mean).213\nWith a steady flow model and annual data assimilations, the RMS difference between214\nthe forecast model and the \u2018true\u2019 field can be maintained at less than 30nT from 2004.0\u2013215\n2009.0 within assumed errors. This can result in a many-fold improvement e.g. compare216\nthe misfit of the forecast to xCHAOS in Figure 1 with the misfit of the mean forecast in217\nFigure 2 (lower panel).218\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 14 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\nThe use of the EnKF for this particular example is, perhaps, unneccesarily complicated.219\nHowever, the method can be readily adapted for more complex flow regimes models and220\ndifferent data types.221\nIn conclusion, we have demonstrated that forecasting of secular variation using a steady222\ncore flow model can achieve an acceptable match to the actual field. We have adapted223\nthe Ensemble Kalman Filter to improve forecasts and characterise their uncertainty by224\npropagating a large number of possible field models forward in time using core flow models225\nto control the evolution of the individual states. Optimal assimilation of measured data226\ninto the ensemble produces an improvement in the fit of the forecast to the actual field.227\nOur approach thus offers a method to improve operational forecasting of the magnetic228\nfield.229\nAcknowledgments. We would like to acknowledge Susan Macmillan and Stefan Maus230\nfor their valuable advice and discussion on modelling and forecasting. We thank the two231\nanonymous reviewers for their constructive suggestions for improving the manuscript. The232\nCHAMP data used in this study were supplied by GFZ Potsdam. This research is part233\nof the NERC GEOSPACE programme, funded under grant NER\/O\/S\/2003\/00674. CDB234\nwas funded under NERC studentship award NER\/S\/J\/2005\/13496.235\nReferences\nBeggan, C., K. Whaler, and S. Macmillan (2009), Temporally varying residuals of core236\nflow models from satellite-derived \u2018virtual observatories\u2019, Geophys. J. Int., 177, 463\u2013475.237\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 15\nBloxham, J. (1988), The determination of fluid flow at the core surface from geomagnetic238\nobservations, vol. Mathematical Geophysics, chap. 9, pp. 189\u2013208, D. Reidel Publishing239\nCompany.240\nEvensen, G. (1994), Sequential data assimilation with a nonlinear quasi-geostrophic241\nmodel using Monte Carlo methods to forecast error statistics, J. Geophys. Res., 99,242\n10,14310,162.243\nEvensen, G., J. Hove, H. Meisingset, E. Reiso, K. Seim, and \u00d8. Espelid (2007), Using the244\nEnKF for assisted history matching of a North Sea reservoir model, in SPE 106184.245\nFournier, A., C. Eymin, and T. Alboussiere (2007), A case for variational geomagnetic246\ndata assimilation: insights from a one-dimensional, nonlinear, and sparsely observed247\nMHD system, Nonlin. Processes Geophys.,, 14, 163\u2013180.248\nHolme, R., and N. Olsen (2006), Core surface flow modelling from high-resolution secular249\nvariation, Geophys. J. Int., 166, 518\u2013528.250\nHulot, G., C. Eymin, B. Langlais, M. Mandea, and N. Olsen (2002), Small-scale structure251\nof the geodynamo inferred from Oersted and Magsat satellite data, Nature, 416, 620\u2013252\n623.253\nKalman, R. (1960), A new approach to linear filtering and prediction problems, Transac-254\ntions of the ASME Journal of Basic Engineering, 82, 35\u201345.255\nKuang, W., A. Tangborn, W. Jiang, D. Lui, Z. Sun, J. Bloxham, and Z. Wei (2008),256\nMoSST DAS: The first generation geomagnetic data assimilation framework, Commu-257\nnications in Computational Physics, 3, 85\u2013108.258\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 16 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\nLangel, R., R. Estes, and T. Sabaka (1989), Uncertainty estimates in geomagnetic field259\nmodeling, J. Geophys. Res., 94, 12,281\u201312,299.260\nLesur, V., I. Wardinski, M. Rother, and M. Mandea (2008), GRIMM: the GFZ Reference261\nInternal Magnetic Model based on vector satellite and observatory data, Geophys. J.262\nInt., 173, 382\u2013394, doi:10.1111\/j.1365-246X.2008.03724.x.263\nMacmillan, S., and S. Maus (2005), International Geomagnetic Reference Field: the tenth264\ngeneration, Earth Planets Space, 57, 1135\u20131140.265\nMandea, M., and N. Olsen (2006), A new approach to directly determine the secular266\nvariation from magnetic satellite observations, Geophys. Res. Lett., 33 (15), L15,306,267\ndoi:10.1029\/2006GL026616.268\nMaus, S., M. Rother, C. Stolle, W. Mai, S. Choi, H. Lu\u00a8hr, D. Cooke, and C. Roth (2006),269\nThird generation of the Potsdam Magnetic Model of the Earth (POMME), Geochem.270\nGeophys. Geosyst., 7, Q07,008, doi:10.1029\/2006GC001269.271\nMaus, S., L. Silva, and G. Hulot (2008), Can core-surface flow models be used to improve272\nthe forecast of the Earth\u2019s main magnetic field?, J. Geophys. Res., 113, B08,102, doi:273\n10.1029\/2007JB005199.274\nOlsen, N., and M. Mandea (2008), Rapidly changing flows in the Earth\u2019s core, Nature275\nGeoscience, 1, 390\u2013394.276\nSabaka, T., N. Olsen, and M. Purucker (2004), Extending comprehensive models of the277\nEarth\u2019s magnetic field with Oersted and CHAMP data, Geophys. J. Int., 159, 521\u2013547.278\nVoorhies, C., and G. Backus (1985), Steady flows at the top of the core from geomagnetic279\nfield models: The steady motion theorem, Geophys. Astrophys. Fluid Dynam., 32, 163\u2013280\nD R A F T July 3, 2009, 5:12pm D R A F T\nBEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING X - 17\n2004  2005  2006  2007  2008  2009  \n0\n20\n40\n60\n80\n100\nYear\nM\nis\nfit\n (n\nT)\nSteady Flow: 2001.9\u22122004.0\n \n \nGRIMM\nxCHAOS\nPOMME\nFigure 1. RMS difference (in nT) between the forecast field from a steady flow model generated\nfrom data over the period 2001.9\u20132004.0 and the GRIMM, POMME and xCHAOS satellite field\nmodels.\n173.281\nWhaler, K. A. (1986), Geomagnetic evidence for fluid upwelling at the core-mantle bound-282\nary, Geophys. J. R. Astr. Soc., 86, 563\u2013588.283\nD R A F T July 3, 2009, 5:12pm D R A F T\nX - 18 BEGGAN & WHALER: FORECASTING WITH ENSEMBLE KALMAN FILTERING\n2004 2005 2006 2007 2008 2009\n0\n20\n40\n60\nM\nis\nfit\n (n\nT)\nGRIMM\n \n \nMean\n+1 Std\n\u22121 Std\n2004 2005 2006 2007 2008 2009\n0\n20\n40\n60\nM\nis\nfit\n (n\nT)\nPOMME\n \n \nMean\n+1 Std\n\u22121 Std\n2004 2005 2006 2007 2008 2009\n0\n20\n40\n60\nYear\nM\nis\nfit\n (n\nT)\nxCHAOS\n \n \nMean\n+1 Std\n\u22121 Std\nFigure 2. RMS difference (in nT) between a EnKF field forecast with annual assimilation\nderived from SV generated by a steady flow model from CHAMP satellite data over the period\n2001.9\u20132004.0 and the GRIMM (top panel), POMME (middle panel) and xCHAOS (bottom\npanel) field models.\nD R A F T July 3, 2009, 5:12pm D R A F T\n"}