{"doi":"10.1145\/876638.876639","coreId":"66652","oai":"oai:dro.dur.ac.uk.OAI2:618","identifiers":["oai:dro.dur.ac.uk.OAI2:618","10.1145\/876638.876639"],"title":"Reasoning about temporal relations : the maximal tractable subalgebras of Allen's interval algebra.","authors":["Krokhin,  A.","Jeavons,  P.","Jonsson,  P."],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2003-09","abstract":"Allen's interval algebra is one of the best established formalisms for temporal reasoning. This article provides the final step in the classification of complexity for satisfiability problems over constraints expressed in this algebra. When the constraints are chosen from the full Allen's algebra, this form of satisfiability problem is known to be NP-complete. However, eighteen tractable subalgebras have previously been identified; we show here that these subalgebras include all possible tractable subsets of Allen's algebra. In other words, we show that this algebra contains exactly eighteen maximal tractable subalgebras, and reasoning in any fragment not entirely contained in one of these subalgebras is NP-complete. We obtain this dichotomy result by giving a new uniform description of the known maximal tractable subalgebras, and then systematically using a general algebraic technique for identifying maximal subalgebras with a given property. \\ud\n\\u","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/66652.pdf","fullTextIdentifier":"http:\/\/dro.dur.ac.uk\/618\/1\/618.pdf","pdfHashValue":"7f99d3f0c4f0e94c8123c66a320881ea1e57dbf9","publisher":"Association for Computing Machinery","rawRecordXml":"<record><header><identifier>\n  \n    \n      oai:dro.dur.ac.uk.OAI2:618<\/identifier><datestamp>\n      2010-09-08T14:38:02Z<\/datestamp><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        Reasoning about temporal relations : the maximal tractable subalgebras of Allen's interval algebra.<\/dc:title><dc:creator>\n        Krokhin,  A.<\/dc:creator><dc:creator>\n        Jeavons,  P.<\/dc:creator><dc:creator>\n        Jonsson,  P.<\/dc:creator><dc:description>\n        Allen's interval algebra is one of the best established formalisms for temporal reasoning. This article provides the final step in the classification of complexity for satisfiability problems over constraints expressed in this algebra. When the constraints are chosen from the full Allen's algebra, this form of satisfiability problem is known to be NP-complete. However, eighteen tractable subalgebras have previously been identified; we show here that these subalgebras include all possible tractable subsets of Allen's algebra. In other words, we show that this algebra contains exactly eighteen maximal tractable subalgebras, and reasoning in any fragment not entirely contained in one of these subalgebras is NP-complete. We obtain this dichotomy result by giving a new uniform description of the known maximal tractable subalgebras, and then systematically using a general algebraic technique for identifying maximal subalgebras with a given property. \\ud\n\\ud\n<\/dc:description><dc:subject>\n        Algorithms<\/dc:subject><dc:subject>\n         Theory<\/dc:subject><dc:subject>\n         Complexity<\/dc:subject><dc:subject>\n         Dichotomy theorem<\/dc:subject><dc:subject>\n         NPcompleteness.<\/dc:subject><dc:publisher>\n        Association for Computing Machinery<\/dc:publisher><dc:source>\n        Journal of the ACM, 2003, Vol.50(5), pp.591-640 [Peer Reviewed Journal]<\/dc:source><dc:date>\n        2003-09<\/dc:date><dc:type>\n        Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:identifier>\n        dro:618<\/dc:identifier><dc:identifier>\n        issn:0004-5411<\/dc:identifier><dc:identifier>\n        doi:10.1145\/876638.876639<\/dc:identifier><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/618\/<\/dc:identifier><dc:identifier>\n        http:\/\/dx.doi.org\/10.1145\/876638.876639<\/dc:identifier><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/618\/1\/618.pdf<\/dc:identifier><dc:rights>\n        \u00a9 ACM, 2003. This is the author's version of the work. It is posted here by permission of ACM for your personal use. Not for redistribution. The definitive version was published in Journal of the ACM, Reasoning about temporal relations: The tractable subalgebras of Allen's interval algebra, 2003, http:\/\/doi.acm.org\/10.1145\/380752.380868.\\ud\n<\/dc:rights><dc:accessRights>\n        info:en-repo\/semantics\/openAccess<\/dc:accessRights><\/oai_dc:dc><\/metadata><\/record>","journals":[{"title":null,"identifiers":["issn:0004-5411","0004-5411"]}],"language":{"code":"en","id":9,"name":"English"},"relations":[],"year":2003,"topics":["Algorithms","Theory","Complexity","Dichotomy theorem","NPcompleteness."],"subject":["Article","PeerReviewed"],"fullText":"Durham Research Online\nDeposited in DRO:\n08 September 2010\nVersion of attached file:\nAccepted Version\nPeer-review status of attached file:\nPeer-reviewed\nCitation for published item:\nKrokhin, A. and Jeavons, P. and Jonsson, P. (2003) \u2019Reasoning about temporal relations : the maximal\ntractable subalgebras of Allen\u2019s interval algebra.\u2019, Journal of the ACM., 50 (5). pp. 591-640.\nFurther information on publisher\u2019s website:\nhttp:\/\/dx.doi.org\/10.1145\/876638.876639\nPublisher\u2019s copyright statement:\nACM, 2003. This is the author\u2019s version of the work. It is posted here by permission of ACM for your personal use.\nNot for redistribution. The definitive version was published in Journal of the ACM, Reasoning about temporal\nrelations: The tractable subalgebras of Allen\u2019s interval algebra, 2003, http:\/\/doi.acm.org\/10.1145\/380752.380868.\nAdditional information:\nUse policy\nThe full-text may be used and\/or reproduced, and given to third parties in any format or medium, without prior permission or charge, for\npersonal research or study, educational, or not-for-profit purposes provided that:\n\u2022 a full bibliographic reference is made to the original source\n\u2022 a link is made to the metadata record in DRO\n\u2022 the full-text is not changed in any way\nThe full-text must not be sold in any format or medium without the formal permission of the copyright holders.\nPlease consult the full DRO policy for further details.\nDurham University Library, Stockton Road, Durham DH1 3LY, United Kingdom\nTel : +44 (0)191 334 3042 \u2014 Fax : +44 (0)191 334 2971\nhttp:\/\/dro.dur.ac.uk\nReasoning About Temporal Relations:\nThe Tractable Subalgebras\nof Allen\u2019s Interval Algebra\nAndrei Krokhin\nDepartment of Computer Science\nUniversity of Warwick, UK\ne-mail: Andrei.Krokhin@dcs.warwick.ac.uk\nPeter Jeavons\nComputing Laboratory\nUniversity of Oxford, UK\ne-mail: Peter.Jeavons@comlab.ox.ac.uk\nPeter Jonsson\nDepartment of Computer and Information Science\nLinko\u00a8ping University, Sweden\ne-mail: Peter.Jonsson@ida.liu.se\nSeptember 6, 2010\nAbstract\nAllen\u2019s interval algebra is one of the best established formalisms for temporal reasoning.\nThis paper is the final step in the classification of complexity in Allen\u2019s algebra. We show\nthat the current knowledge about tractability in the interval algebra is complete, that is,\nthis algebra contains exactly eighteen maximal tractable subalgebras, and reasoning in any\nfragment not entirely contained in one of these subalgebras is NP-complete. We obtain this\nresult by giving a new uniform description of the known maximal tractable subalgebras and\nthen systematically using an algebraic technique for identifying maximal subalgebras with a\ngiven property.\n1 Introduction\nReasoning about temporal constraints is an important task in many areas of computer science\nand elsewhere, including scheduling [43], natural language processing [47], planning [2], database\ntheory [31], technical diagnosis [41], circuit design [56], archaeology [29, 21], and behavioral psy-\nchology [11]; similar problems have been studied in genetics [7]. Several frameworks for formalizing\nthis type of problem have been suggested (see [46] for a survey); for instance, the point algebra [52]\n(for expressing relations between time points), the point-interval algebra [54] (for expressing rela-\ntions between time points and intervals) and the famous Allen\u2019s interval algebra [1] for expressing\nrelations between time intervals.\nAllen\u2019s algebra has also become the kernel of some other formalisms [3, 4, 13, 37], where it\nis extended with different types of metric or qualitative constraints. This algebra and some of\nits extensions are closely related to a number of interval-based temporal logics used for real-time\nsystem specification (see [6]). Reasoning within certain restricted fragments of Allen\u2019s algebra\n1\n(with additional restriction on the overall structure of problems) is equivalent to some well-known\nproblems such as the interval graph recognition problem and the interval order recognition problem\n(see [44]) which play an important role in molecular biology [19, 28], namely in the construction\nof a physical mapping of DNA.\nThroughout the paper we assume that P 6=NP. The basic satisfiability problem in Allen\u2019s\nalgebra is NP-complete [55], so it is unlikely that efficient algorithms exist for reasoning in the\nfull algebra. This computational difficulty has motivated the study of algorithms and complexity\nin fragments of the algebra, e.g., [5, 13, 14, 15, 18, 21, 35, 36, 37, 40, 44, 51, 52, 55]1, and the\nsubsequent search for effective heuristics based on tractable fragments, e.g. [34, 39, 53]. In [40],\nNebel and Bu\u00a8rckert presented the \u2018ORD-Horn\u2019 algebra, the first example of a maximal (assuming\nthat P 6=NP) tractable subclass of Allen\u2019s algebra. Since then, research in this direction has\nfocused on identifying maximal tractable fragments, i.e., fragments which cannot be extended\nwithout losing tractability. So far, eighteen maximal tractable fragments of the algebra have been\nidentified [13, 14, 36, 40]. In this paper we complete the analysis of complexity within Allen\u2019s\nalgebra by showing that these eighteen are the only forms of tractability in the algebra.\nA complete classification of complexity within a certain large part of Allen\u2019s algebra was\npreviously obtained in [15]. This result (as well as most similar results, e.g. [26, 27]) was achieved\nby computer-assisted exhaustive search. However, it was noted in [15] that, for further progress,\ntheoretical studies of the structure of Allen\u2019s algebra are necessary, since using the method from\nthat paper for a complete analysis of complexity would require dealing with more than 1050\nindividual cases, which is clearly not feasible. There have been some theoretical investigations of\nthe structure of Allen\u2019s algebra, (see, e.g., [23, 24, 33]); however they consider relation algebras\nin the sense defined by Tarski [50], that is, they generally allow more operations on relations\nthan originally used in [1], which makes them inappropriate for classifying complexity within the\ninterval algebra. In fact, none of the maximal tractable subalgebras of the interval algebra is a\nTarski relation algebra. In this paper we systematically use algebraic methods that are similar to\nthe approach taken in [36].\nThe first novel element in our approach is a new uniform description for all of the maximal\ntractable subalgebras of Allen\u2019s algebra which have already been identified (Table 3). Then, we\nfully exploit the algebraic properties of Allen\u2019s algebra by importing a technique from general\nalgebra. This technique has been used in many other contexts to obtain a description of maximal\nsubalgebras of a given algebra with a given property (e.g., [49, 58]). Here, for the first time,\nwe systematically apply this technique to Allen\u2019s algebra to obtain a complete classification of\ncomplexity in this algebra. Our main result (Theorem 1) shows that Allen\u2019s algebra contains\neighteen maximal tractable subalgebras and that reasoning within any subset not included in one\nof these is NP-complete.\nIn complexity theory, it is well known that if P 6=NP then there exist infinitely many complexity\nclasses between P and NP. In view of this, there has been a considerable interest in the so-called\ndichotomy theorems which state that one or another important NP-complete problem has only\ntractable and NP-complete natural subproblems (see, e.g., [12, ?, 22, 45] 2). Thus, the main result\nobtained in this paper can also be considered as a new example of a dichotomy theorem.\nThe paper is organized as follows: in Section 2 we give the basic definitions of Allen\u2019s algebra,\npresent the known maximal tractable subalgebras in the new form, and state our main result.\nIn Section 3 we apply this result to classify the complexity in Allen\u2019s algebra extended with\nsome metric information. In Section 4 we discuss the algebraic technique we use for obtaining\nresults of this type and compare it with the computer-aided method used for a similar purpose\nin [15]. Sections 5 and 6 contain the proof of the new classification result\u2014Section 5 considers\nthe subalgebras of Allen\u2019s algebra that contain non-trivial basic relations and Section 6 contains\nthe proof for all other subalgebras. A number of NP-completeness results used in Section 6 are\ncollected in the Appendix.\n1In [5, 21, 44], some additional restriction on the overall structure of problems is assumed.\n2The problem of satisfiability from propositional logic [12, 45] should not be confused with the problem of\nsatisfiability of temporal constraints.\n2\nBasic relation Example Endpoints\nx precedes y p xxx x+ < y\u2212\ny preceded by x p\u22121 yyy\nx meets y m xxxx x+ = y\u2212\ny met-by x m\u22121 yyyy\nx overlaps y o xxxx x\u2212 < y\u2212 < x+,\ny overl.-by x o\u22121 yyyy x+ < y+\nx during y d xxx x\u2212 > y\u2212,\ny includes x d\u22121 yyyyyyy x+ < y+\nx starts y s xxx x\u2212 = y\u2212,\ny started by x s\u22121 yyyyyyy x+ < y+\nx finishes y f xxx x+ = y+,\ny finished by x f\u22121 yyyyyyy x\u2212 > y\u2212\nx equals y \u2261 xxxx x\u2212 = y\u2212,\nyyyy x+ = y+\nTable 1: The thirteen basic relations. The endpoint relations x\u2212 < x+ and y\u2212 < y+ that are valid\nfor all relations have been omitted.\n2 Allen\u2019s Interval Algebra\nAllen\u2019s interval algebra [1] is based on the notion of relations between intervals. An interval x is\nrepresented as a pair [x\u2212, x+] of real numbers with x\u2212 < x+, denoting the left and right endpoints\nof the interval, respectively. The relations between intervals are the 213 = 8192 possible unions3\nof the 13 basic interval relations, which are shown in Table 1. Note that the basic relations are\njointly exhausitive and pairwise disjoint in the sense that any two given intervals are related by\nexactly one basic relation. For the sake of brevity, relations between intervals will be written as\ncollections of basic relations. So, for instance, we write (pmf\u22121) instead of p \u222a m \u222a f\u22121. Allen\u2019s\nalgebra A consists of the 8192 possible relations between intervals together with the operations\nconverse \u00b7\u22121, intersection \u2229 and composition \u25e6 which are defined as follows:\n\u2200x, y : xr\u22121y \u21d4 yrx\n\u2200x, y : x(r \u2229 s)y \u21d4 xry & xsy\n\u2200x, y : x(r \u25e6 s)y \u21d4 \u2203z : (xrz & zsy)\nIt follows that the converse of r = (b1 . . . bn) is equal to (b\u221211 . . . b\n\u22121\nn ). The intersection of two\nrelations can be expressed as the usual set-theoretic intersection. Since the basic relations are\npairwise disjoint, the intersection of two relations r1, r2 \u2208 A consists of the basic relations that\nare present in both r1 and r2. Using the definition of composition, it can be shown that\n(b1 . . . bn) \u25e6 (b\u20321 . . . b\u2032m) =\n\u22c3\n{bi \u25e6 b\u2032j | 1 \u2264 i \u2264 n, 1 \u2264 j \u2264 m}.\nHence the composition of two relations r1, r2 \u2208 A is determined by the compositions of the basic\nrelations they contain. The compositions of all possible pairs of basic relations are given in Table 2,\nand by using this table one can verify all the algebraic calculations in the forthcoming sections.\nThe problem of satisfiability (A-sat) for a set of interval variables with specified relations\nbetween them is that of deciding whether there exists an assignment of intervals on the real line\nfor the interval variables, such that all of the relations between the intervals are satisfied. This is\ndefined as follows.\nDefinition 1 Let X \u2286 A be a set of interval relations. An instance I of A-sat(X) is a set, V ,\nof variables and a set of constraints of the form xry where x, y \u2208 V and r \u2208 X. The question is\n3Including the empty relation.\n3\n\u25e6 \u2261 p p\u22121 m m\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\n\u2261 \u2261 p p\u22121 m m\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\np p p > p \u03c1 p \u03c1 \u03c1 p p p \u03c1 p\np\u22121 p\u22121 > p\u22121 \u03bb\u22121 p\u22121 \u03bb\u22121 p\u22121 \u03bb\u22121 p\u22121 \u03bb\u22121 p\u22121 p\u22121 p\u22121\nm m p \u03c1\u22121 p \u03b8 p \u03b2 \u03b2 p m m \u03b2 p\nm\u22121 m\u22121 \u03bb p\u22121 \u03c3 p\u22121 \u03b3\u22121 p\u22121 \u03b3\u22121 p\u22121 \u03b3\u22121 p\u22121 m\u22121 m\u22121\no o p \u03c1\u22121 p \u03b2\u22121 \u03b1 \u03bd \u03b2 \u03bb o \u03b3 \u03b2 \u03b1\no\u22121 o\u22121 \u03bb p\u22121 \u03b3 p\u22121 \u03bd \u03b1\u22121 \u03b3\u22121 \u03c1\u22121 \u03b3\u22121 \u03b1\u22121 o\u22121 \u03b2\u22121\nd d p p\u22121 p p\u22121 \u03c1 \u03bb\u22121 d > d \u03bb\u22121 d \u03c1\nd\u22121 d\u22121 \u03bb \u03c1\u22121 \u03b3 \u03b2\u22121 \u03b3 \u03b2\u22121 \u03bd d\u22121 \u03b3 d\u22121 \u03b2\u22121 d\u22121\ns s p p\u22121 p m\u22121 \u03b1 \u03b3\u22121 d \u03bb s \u03c3 d \u03b1\ns\u22121 s\u22121 \u03bb p\u22121 \u03b3 m\u22121 \u03b3 o\u22121 \u03b3\u22121 d\u22121 \u03c3 s\u22121 o\u22121 d\u22121\nf f p p\u22121 m p\u22121 \u03b2 \u03b1\u22121 d \u03c1\u22121 d \u03b1\u22121 f \u03b8\nf\u22121 f\u22121 p \u03c1\u22121 m \u03b2\u22121 o \u03b2\u22121 \u03b2 d\u22121 o d\u22121 \u03b8 f\u22121\n\u03b1 = (pmo) \u03b2 = (ods) \u03b3 = (od\u22121f\u22121) \u03c3 = (\u2261 ss\u22121) \u03b8 = (\u2261 ff\u22121)\n\u03c1 = (pmods) \u03bb = (pmod\u22121f\u22121) \u03bd = (\u2261 oo\u22121dd\u22121ss\u22121ff\u22121)\n> = (\u2261 pp\u22121mm\u22121oo\u22121dd\u22121ss\u22121ff\u22121)\nTable 2: Composition table for the basic relations in Allen\u2019s algebra\n4\nwhether I is satisfiable, i.e., whether there exists a function, f , from V to the set of all intervals\nsuch that f(x) r f(y) holds for every constraint xry in I. Any such function f is called a model\nof I.\nExample 1 1) The instance {x(m)y, y(m)z, x(m)z} is not satisfiable because the first two con-\nstraints imply that interval x must precede interval z which contradicts the third constraint.\n2) The instance I = {x(mo)y, y(df\u22121)z, x(m\u22121s)z} is satisfiable. The function f given by\nf(x) = [0, 2], f(y) = [1, 3], and f(z) = [0, 4] is a model of I.\nAn instance of A-sat(X) can also be represented, in an obvious way, as a labelled digraph,\nwhere the nodes are the variables from V , and the labelled arcs correspond to the constraints.\nThis way of representing instances can sometimes be more transparent.\nIf there exists a polynomial-time algorithm solving all instances of A-sat(X) then we say\nthat X is tractable. On the other hand, if A-sat(X) is NP-complete then we say that X is NP-\ncomplete. Since the problem A-sat(A) is NP-complete [55], there arises the question of identifying\nthe tractable subsets of Allen\u2019s algebra.\nSubsets of A that are closed under the operations of intersection, converse and composition\nare said to be subalgebras. For a given subset X of A, the smallest subalgebra containing X is\ncalled the subalgebra generated by X and is denoted by \u3008X\u3009. It is easy to see that \u3008X\u3009 is obtained\nfrom X by adding all relations that can be obtained from the relations in X by using the three\noperations of A.\nIt is known [40], and easy to prove, that, for every X \u2286 A, the problem A-sat(\u3008X\u3009) is\npolynomially equivalent to A-sat(X). Therefore, to classify the complexity of all subsets of A\nit is only necessary to consider subalgebras of A. Obviously, adding relations to a subalgebra\ncan only increase the complexity of the corresponding satisfiability problem. Thus, since A is\nfinite, the problem of describing tractability in A can be reduced to the problem of describing the\nmaximal tractable subalgebras in A, that is, subalgebras that cannot be extended without losing\ntractability.\nThe known maximal tractable subalgebras [13, 14, 40] are presented in Table 3. In this table,\nand in our proofs below, we use the symbol \u00b1, which should be interpreted as follows. A condition\ninvolving \u00b1 means the conjunction of two conditions: one corresponding to + and one correspond-\ning to \u2212. For example, condition (o)\u00b11 \u2286 r \u21d4 (d)\u00b11 \u2286 r means that both (o) \u2286 r \u21d4 (d) \u2286 r and\n(o\u22121) \u2286 r \u21d4 (d\u22121) \u2286 r hold. The main advantage of using the \u00b1 symbol is conciseness: in any\nsubalgebra of A, the \u2018+\u2019 and the \u2018\u2212\u2019 conditions are satisfied (or not satisfied) simultaneously, and,\ntherefore only one of them needs to be verified.\nIn order to improve readability, the names of some of the subalgebras in Table 3 are changed\nfrom those used in earlier presentations, in the following way. Let r1 = (p\u22121m\u22121o\u22121dsf), r2 =\n(pmod\u22121sf\u22121), r3 = (pmodsf), and r4 = (pmodsf\u22121). Then, the subalgebras Ai, 1 \u2264 i \u2264 4, from\nTable 3 correspond to the algebras A(ri, s), 1 \u2264 i \u2264 4, introduced in [14], while the subalgebras\nBi, 1 \u2264 i \u2264 4, from Table 3 correspond to A(r\u221214 , f), A(r3, f), A(r1, f), and A(r\u221212 , f) [14].\nIn previous papers, the subalgebras from Table 3 were defined in other ways. However, in all\ncases except for H, it is very straightforward to verify that our definitions are equivalent to the\noriginal ones. The subalgebra H was originally defined as the \u2018ORD-Horn algebra\u2019 [40], but has\nalso been characterized as the algebra of \u2018pre-convex\u2019 relations [36]. Using the latter description\nit is not hard to show that our definition of H is equivalent.\nWe are now ready to state our main theorem.\nTheorem 1 Any subset of Allen\u2019s algebra is either NP-complete or included in one of the eighteen\ntractable subalgebras in Table 3.\nThe proof of this theorem is given in Sections 5 and 6.\nAs one interesting consequence of Theorem 1, it follows that reasoning with a single relation r,\nthat is, the problem A-sat({r}), is NP-complete if and only if r either satisfies r\u2229r\u22121 = (mm\u22121) or\nis a relation with r\u2229 r\u22121 = \u2205 and such that neither r nor r\u22121 is contained in one of (pmod\u22121sf\u22121),\n(pmod\u22121s\u22121f\u22121), (pmodsf) and (pmodsf\u22121). Using this characterisation it is easy to check that\nthere are precisely 667 individual temporal relations r such that A-sat({r}) is NP-complete.\n5\nSp = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 6= \u2205 \u21d2 (p)\u00b11 \u2286 r}\nSd = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 6= \u2205 \u21d2 (d\u22121)\u00b11 \u2286 r}\nSo = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 6= \u2205 \u21d2 (o)\u00b11 \u2286 r}\nA1 = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 6= \u2205 \u21d2 (s\u22121)\u00b11 \u2286 r}\nA2 = {r | r \u2229 (pmod\u22121f\u22121)\u00b11 6= \u2205 \u21d2 (s)\u00b11 \u2286 r}\nA3 = {r | r \u2229 (pmodf)\u00b11 6= \u2205 \u21d2 (s)\u00b11 \u2286 r}\nA4 = {r | r \u2229 (pmodf\u22121)\u00b11 6= \u2205 \u21d2 (s)\u00b11 \u2286 r}\nEp = {r | r \u2229 (pmods)\u00b11 6= \u2205 \u21d2 (p)\u00b11 \u2286 r}\nEd = {r | r \u2229 (pmods)\u00b11 6= \u2205 \u21d2 (d)\u00b11 \u2286 r}\nEo = {r | r \u2229 (pmods)\u00b11 6= \u2205 \u21d2 (o)\u00b11 \u2286 r}\nB1 = {r | r \u2229 (pmods)\u00b11 6= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r}\nB2 = {r | r \u2229 (pmods)\u00b11 6= \u2205 \u21d2 (f)\u00b11 \u2286 r}\nB3 = {r | r \u2229 (pmod\u22121s\u22121)\u00b11 6= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r}\nB4 = {r | r \u2229 (pmod\u22121s)\u00b11 6= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r}\nE\u2217 =\n{\nr\n\u2223\u2223\u2223\u2223\u2223 1) r \u2229 (pmod)\u00b11 6= \u2205 \u21d2 (s)\u00b11 \u2286 r, and2) r \u2229 (ff\u22121) 6= \u2205 \u21d2 (\u2261) \u2286 r\n}\nS\u2217 =\n{\nr\n\u2223\u2223\u2223\u2223\u2223 1) r \u2229 (pmod\u22121)\u00b11 6= \u2205 \u21d2 (f\u22121)\u00b11 \u2286 r, and2) r \u2229 (ss\u22121) 6= \u2205 \u21d2 (\u2261) \u2286 r\n}\nH =\n\uf8f1\uf8f4\uf8f2\uf8f4\uf8f3r\n\u2223\u2223\u2223\u2223\u2223\u2223\u2223\n1) r \u2229 (os)\u00b11 6= \u2205 & r \u2229 (o\u22121f)\u00b11 6= \u2205 \u21d2 (d)\u00b11 \u2286 r, and\n2) r \u2229 (ds)\u00b11 6= \u2205 & r \u2229 (d\u22121f\u22121)\u00b11 6= \u2205 \u21d2 (o)\u00b11 \u2286 r, and\n3) r \u2229 (pm)\u00b11 6= \u2205 & r 6\u2286 (pm)\u00b11 \u21d2 (o)\u00b11 \u2286 r\n\uf8fc\uf8f4\uf8fd\uf8f4\uf8fe\nA\u2261 = {r | r 6= \u2205 \u21d2 (\u2261) \u2286 r}\nTable 3: The 18 maximal tractable subalgebras of Allen\u2019s algebra.\n6\n3 Allen\u2019s Interval Algebra Extended With Metric Informa-\ntion\nIn this section we give some applications of Theorem 1. Namely, we consider Allen\u2019s algebra com-\nbined with some forms of disjunctive linear constraints, a well-known framework which subsumes\nmany different types of temporal reasoning problems. Some examples of these problems, including\nscheduling, planning, and indefinite temporal constraint databases, can be found in [25, 30, 48]\n(see also [10] for more information on tractable disjunctive constraints).\nDefinition 2 Let V = {x1, . . . , xn} be a set of real-valued variables, and \u03b1, \u03b2 linear polynomials\n(polynomials of degree one) over V with rational coefficients. A linear relation over V is an\nexpression of the form \u03b1R\u03b2, where R \u2208 {<,\u2264,=, 6=,\u2265, >}.\nA disjunctive linear relation (DLR) over V is a disjunction of a nonempty finite set of linear\nrelations. A DLR is said to be Horn if and only if at most one of its disjuncts is not of the form\n\u03b1 6= \u03b2.\nThe problem of satisfiability for finite sets D of DLRs, denoted DLRsat(D), is that of checking\nwhether there exists an assignment f of variables in V to real numbers such that all DLRs in D\nare satisfied. Such an f is said to be a model of D. The satisfiability problem for finite sets H of\nHorn DLRs is denoted hornDLRsat(H).\nExample 2\nx+ 2y \u2264 3z + 42.3\nis a linear relation,\n(x+ 2y \u2264 3z + 42.3) \u2228 (x+ z < 4y \u2212 8) \u2228 (x > 3\n12\n)\nis a disjunctive linear relation, and\n(x+ 2y \u2264 3z + 42.3) \u2228 (x+ z 6= 4y \u2212 8) \u2228 (x 6= 3\n12\n)\nis a Horn disjunctive linear relation.\nProposition 1 ([25, 30]) The problem DLRsat is NP-complete and hornDLRsat is solvable\nin polynomial time.\nWe can now define the general interval satisfiability problem with metric information.\nDefinition 3 Let I be an instance of A-sat(X) over a set V of variables and let H be a finite set\nof DLRs over the set {v+, v\u2212 | v \u2208 V } of variables, v\u2212 representing starting points and v+ ending\npoints of variables v \u2208 V .\nAn instance of the problem of interval satisfiability with metric information for a set X of\ninterval relations, denoted Am-sat(X), is a pair Q = (I,H).\nIf f is a model for I, and v \u2208 V , let f(v\u2212) and f(v+) denote the starting point and the ending\npoint of the interval f(v), respectively.\nAn instance Q is said to be satisfiable if there exists a model f of I such that the DLRs in H\nare satisfied, with values for all v\u2212 and v+ given by f(v\u2212) and f(v+), respectively.\nObviously, the Am-sat(X) problem is NP-complete for all choices of X since every relation in\nA can be expressed in terms of DLRs. We let Ah-sat(X) denote the Am-sat(X) restricted to\nmetric constraints consisting of Horn DLRs only.\nTheorem 2 Ah-sat(X) is tractable if and only if X \u2286 H. Otherwise Ah-sat(X) is NP-complete.\n7\nProof. Ah-sat(H) is a tractable problem [25]. The interval constraint a(m)b is equivalent to\nthe metric constraint a+ = b\u2212 so we can assume that (m) \u2208 X and the result follows immediately\nfrom Theorem 1. 2\nWe can obtain another classification result if we further restrict the possible metric constraints.\nDefine Ahs -sat(X) to be the Ah-sat(X) problem where the metric constraints H are restricted\nin the following way: H may contain only the variables v\u2212, i.e., it may only relate starting points\nof intervals. The problem Ahe -sat(X) is defined symmetrically by exchanging starting and ending\npoints.\nTheorem 3 1) Ahs -sat(X) is tractable if and only if X is contained in one of the algebras H,\nSp, So, Sd or S\u2217. Otherwise Ahs -sat(X) is NP-complete.\n2) Ahe -sat(X) is tractable if and only if X is contained in one of the algebras H, Ep, Eo, Ed\nor E\u2217. Otherwise Ahe -sat(X) is NP-complete.\nProof. We prove only part 1); part 2) is similar. If X is contained in one of the five algebras listed\nin 1) then tractability of Ahs -sat(X) follows from [13]. The interval constraints a(\u2261 ss\u22121)b and\na(pmod\u22121f\u22121)b are equivalent to the metric constraints a\u2212 = b\u2212 and a\u2212 < b\u2212, respectively. Thus,\nwe can assume that {(\u2261 ss\u22121), (pmod\u22121f\u22121)} \u2286 X. It follows from Theorem 1 that if A-sat(X)\nis tractable then X is contained in one of the five algebras listed in 1), and that otherwise this\nproblem is NP-complete. 2\n4 Proof Techniques\nIn this section we describe the algebraic techniques used in this paper, and the methods for proving\nNP-completeness results.\nIn contrast to earlier approaches [15, 26, 27] we do not make use of computer-assisted exhaustive\nsearch. Instead, we develop an analytical method which breaks the proof down into a collection\nof simple cases, and makes extensive use of the algebraic operations. This approach is commonly\nused in general algebra to identify those substructures of a given structure that have a property\n\u03c6 which is hereditary, that is, if some substructure possesses \u03c6 then so does any substructure\ncontained in it. Note that tractability of a subalgebra is an example of such a property in Allen\u2019s\nalgebra. For examples of a similar approach in other algebraic contexts see [49, 57, 58].\nAs indicated above, it is sufficient to consider only those sets, S, which are subalgebras of\nAllen\u2019s algebra. Furthermore, we can assume without loss of generality that each subalgebra S\ncontains the relation > (the union of all basic relations) since we always allow pairs of variables\nto be unrelated. For each basic relation b of A, we will write rb to denote the least relation r \u2208 S\nsuch that (b) \u2286 r, i.e., the intersection of all r \u2208 S with this property. (Obviously, the relations rb\ndepend on S; however S will always be clear from the context.)\nWe use the relations of the form rb extensively in the algebraic proofs below to show that S\nis contained in one or another maximal tractable subalgebra. For example, suppose we know that\nthe relation (d) is contained in ro. Then any relation r \u2208 S such that (o) \u2286 r satisfies also (d) \u2286 r.\nTo see this, note that if there is r1 \u2208 S such that (o) \u2286 r, but (d) 6\u2286 r, then (o) \u2286 r1 \u2229 ro and\nr1 \u2229 ro is strictly contained in ro which contradicts the definition of ro. By a similar argument,\nif we know that (d) is contained in all of rp, rm, ro, and rs, then we can conclude that, for every\nr \u2208 S, (d) \u2286 r whenever r \u2229 (pmods) 6= \u2205, which means that S \u2286 Ed.\nThroughout the proofs we also use the obvious fact that if r1 \u2286 r2 then, for any r, we have\nr \u25e6 r1 \u2286 r \u25e6 r2 and r1 \u25e6 r \u2286 r2 \u25e6 r.\nTo establish NP-completeness of a set of relations we will often make use of Lemma 1 below.\nFor any given relations R,R1, R2 \u2208 A we define \u0393(a, b, c, x, y) to be the following problem instance\nover the variables {a, b, c, x, y}:\n{xR1a, xR1b, xR2c, yR2a, yR1b, yR1c}.\n8\nWe also define the instances \u03931 = \u0393(a, b, c, x, y)\u222a{aRb, bRc, aRc}, \u03932 = \u0393(a, b, c, x, y)\u222a{bRa, bRc, aR\u222a\nR\u22121c}, and \u03933 = \u0393(a, b, c, x, y) \u222a {aRb, cRb, aR \u222a R\u22121c}. The problem instance \u03931 is illustrated\nin Figure 1.\nx\na\nb\nc\ny\nR\nR\nR\nR1\nR1 R2\nR2 R1\nR1\nFigure 1: The problem instance \u03931 used in Lemma 1\nLemma 1 Let R \u2208 {(p), (o), (d), (s), (f)}, R1, R2 \u2208 A, and let \u03931, \u03932, \u03933 be as above. If \u03931 is\nsatisfiable while \u03932 and \u03933 are not, then {R \u222aR\u22121, R1, R2} is NP-complete.\nProof. Polynomial-time reduction from the NP-complete problem Betweenness4 [16], which\nis defined as follows:\nInstance: A finite set A, a collection T of ordered triples (a, b, c) of distinct elements from A.\nQuestion: Is there a total ordering < on A such that for each (a, b, c) \u2208 T , we have either\na < b < c or c < b < a?\nLet (A, T ) be an arbitrary instance ofBetweenness and construct an instance I ofA-sat({R\u222a\nR\u22121, R1, R2}) as follows:\n(1) for each pair of distinct elements a, b \u2208 A, add the constraint aR \u222aR\u22121b to I; and\n(2) for each triple (a, b, c) \u2208 T , introduce two fresh variables x, y and add \u0393(a, b, c, x, y) to I.\nWe will henceforth refer to the variables in I that correspond to the set A as \u2018basic\u2019 variables and\nthe other variables as \u2018auxiliary\u2019 variables.\nAssume that I has a model f . Then, due to the constraints added in step (1), the intervals\nf(a), a \u2208 A, are pairwise distinct. Moreover, the relation R induces a total order on the set\n{f(a) | a \u2208 A}. Suppose now that there is a triple (a, b, c) \u2208 T such that the model f satisfies\n4This problem is also known as the Total ordering problem [42].\n9\nf(b)Rf(a)Rf(c). Then the instance \u03932, with the auxiliary variables x and y introduced in step (2)\nfor the triple (a, b, c), is satisfiable, a contradiction. With the help of \u03932 and \u03933, we can analogously\nrule out all orderings of f(a), f(b), f(c) except f(a)Rf(b)Rf(c) and f(c)Rf(b)Rf(a). Hence\nthere is a solution to the instance (A, T ): for all a, b \u2208 A, set a < b if and only if f(a)Rf(b).\nWe assume now that there exists a total order < on A that has the required property and show\nhow to construct a model f of I. For all a, b \u2208 A, set f(a)Rf(b) if and only if a < b. Clearly, this\nsatisfies all constraints added in step (1).\nBy assumption, for each triple (a, b, c) \u2208 T , the instance \u03931 is satisfiable, that is, it has some\nmodel g. Then, since R is a basic relation, we know precisely how the intervals g(a), g(b), and g(c)\nare related. It now follows that the model g can be adjusted by moving the intervals g(a), g(b),\ng(c), g(x), and g(y) along the real line and stretching or shrinking them (but without changing\nthe relations between them) so that the new model assigns f(a), f(b), and f(c) to a, b, and c,\nrespectively. The fact that \u03931 = \u0393(a, b, c, x, y) \u222a {aRb, bRc, aRc} is satisfiable and the symmetry\nof \u0393 imply that \u0393(a, b, c, x, y)\u222a{cRb, bRa, cRa} is satisfiable (by exchanging the value for a by the\nvalue for c and vice versa, and doing the same for x and y). Thus, for every triple (a, b, c) \u2208 T ,\nwe can find values for the auxiliary variables x and y so that all sets of constraints of the form\n\u0393(a, b, c, x, y) are satisfied at the same time, and there exists a model of I. 2\nIn order to use Lemma 1 to prove NP-completeness of some fixed set of relations, one only\nneeds to check the satisfiability of three small instances of A-sat. One straightforward way to do\nthis is to use B. Nebel\u2019s CSP solver [38], which is a computer program for checking satisfiablity of\nan instance of A-sat.\nAs an example of the use of Lemma 1, set R = (o), R1 = (d) and R2 = (oo\u22121). In Figure 2,\nwe show how the auxiliary variables x and y can be given consistent values in the two \u2018allowed\u2019\ncases (corresponding to f(a) < f(b) < f(c) and f(c) < f(b) < f(a)) and the reader is encouraged\nto prove that x and y cannot be chosen satisfactorily for the remaining four orderings. Thus,\nLemma 1 implies that {(d), (oo\u22121)} is NP-complete.\nThe second method we use to establish NP-completeness is based on the notion of derivation.\nSuppose X \u2286 A and I is an instance of A-sat(X). Let variables x, y be involved in I. Further,\nlet r \u2208 A be the relation defined as follows: a basic relation r\u2032 is included in r if and and only if\nthe instance obtained from I by adding the constraint xr\u2032y is satisfiable. In this case, we say that\nr is derived from X.\nIt should be noted that if the instance I1 = I \u222a{xr\u2032y} is satisfiable, then, for any two intervals\ni1, j1 such that i1r\u2032j1, there is a model f of I1 such that f(x) = i1 and f(y) = j1. This can be\nestablished as follows: since I1 is satisfiable, it has a model g. Denote g(x) by i2 and g(y) by j2;\nthen i2r\u2032j2. There exists a continuous monotone injective mapping \u03d5 of the real line such that \u03d5\ntakes i2 to i1 and j2 to j1. Obviously, \u03d5 maps intervals to intervals, and it does not change the\nqualitative relations between intervals. Therefore, combining \u03d5 and g we obtain the the required\nmodel f .\nNow it can easily be checked that adding a derived relation r to X does not change the\ncomplexity of A-sat(X) because, in any instance, any constraint involving r can be replaced by\nthe set of constraints in I (introducing fresh variables when needed), and this can be done in\npolynomial time.\nGenerally, one can derive more relations from a given X \u2286 A than one can generate using the\nthree operations of Allen\u2019s algebra, that is, any relation generated from X can also be derived\nfrom X. This follows from the facts that any relation obtained by multiple derivations can also\nbe obtained by a single derivation, and that relations r\u22121, r1 \u2229 r2, and r1 \u25e6 r2, between x and\ny are derived from the instances {yrx}, {xr1y, xr2y}, and {xr1z, zr2y}, respectively. However,\nderivation is essentially harder to manage in general, while the operations of Allen\u2019s algebra give\nus the advantage of employing algebraic techniques. Therefore we use derivations only in NP-\ncompleteness proofs. Note that derivations can also be calculated using B. Nebel\u2019s CSP solver [38].\nOur last proof technique is a principle of duality, which will be used to simplify many of the\nforthcoming proofs. We make use of a function reverse which is defined on the basic relations of\n10\nxa\nb\nc\ny\no\no\no\nd\nd\noo\n-1\noo\n-1\nd\nd\nx\na\nb\nc\ny\no\no\no\nd\nd\noo\n-1\noo\n-1\nd\nd\nFigure 2: Example of using Lemma 1.\n11\nA by the following table:\nb \u2261 p p\u22121 m m\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\nreverse(b) \u2261 p\u22121 p m\u22121 m o\u22121 o d d\u22121 f f\u22121 s s\u22121\nand is defined for all other elements of A by setting reverse(r) = \u22c3b\u2208r reverse(b).\nLet I be any instance of A-sat, and let I \u2032 be obtained from I by replacing every r with\nreverse(r). It is easy to check that I has a model f if and only if I \u2032 has a model f \u2032 given by\nf \u2032(xi) = [\u2212f(x+i ),\u2212f(x\u2212i )].\nIn other words, f \u2032 is obtained from f by redirecting the real line and leaving all intervals (as\ngeometric objects) in their places. This observation leads to the following lemma.\nLemma 2 Let R = {r1, . . . , rn} \u2286 A and R\u2032 = {r\u20321, . . . , r\u2032n} \u2286 A be such that, for all 1 \u2264 k \u2264 n,\nr\u2032k = reverse(rk). Then R is tractable (NP-complete) if and only if R\u2032 is tractable (NP-complete).\nAs an example of the use of Lemma 2, note that a proof of NP-completness for, say, {(ods\u22121)},\nimmediately yields a proof of NP-completeness for {(o\u22121df\u22121)}.\n5 Subalgebras With Non-trivial Basic Relations\nThis section and the next contain the proof of Theorem 1.\nFor a subalgebra S of A, we denote by bas(S) the set of basic relations in S. We can assume\nwithout loss of generality that S contains the relation (\u2261), since it is easy to show that S and\nS \u222a {(\u2261)} have the same complexity (up to polynomial-time equivalence). This implies that the\nsize of bas(S) is odd, since S is closed under converse.\nThe following proposition is proved in [15].\nProposition 2\n1) Let S be a subalgebra of A with |bas(S)| > 3. Then S is tractable if it is contained in one of\nthe following 7 algebras: Sp, Sd, So, Ep, Ed, Eo, and H. Otherwise S is NP-complete.\n2) Let S be a subalgebra of A such that (m) \u2208 S or (p) \u2208 S. Then S is tractable if S \u2286 Sp, or\nS \u2286 Ep, or S \u2286 H. Otherwise S is NP-complete.\n3) Let S be a subalgebra of A such that (pp\u22121) \u2208 S or (pp\u22121mm\u22121) \u2208 S. Then S is tractable if\nS \u2286 Sp or S \u2286 Ep. Otherwise S is NP-complete.\nWe shall say that a relation is non-trivial if it is not equal to the empty relation or the relation\n(\u2261). The result to be shown in this section is the following:\nProposition 3 Let S be a subalgebra of A which contains a non-trivial basic relation. Then S is\ntractable if it is contained in one of the 18 algebras listed in Table 3. Otherwise S is NP-complete.\nNote that if S contains a non-trivial basic relation, then S 6\u2286 A\u2261.\nBy combining Proposition 2(1) and the observation preceding it, it suffices to consider only the\ncase |bas(S)| = 3. By Proposition 2(2), it suffices to consider the cases where bas(S) is one of the\nfollowing sets: {\u2261, d, d\u22121}, {\u2261, o, o\u22121}, {\u2261, s, s\u22121}, and {\u2261, f, f\u22121}. We do this in Subsections 5.1\u2013\n5.3.\nGiven a relation r, we write r\u2217 to denote the relation r \u2229 r\u22121. Evidently, every subalgebra of\nA is closed under the operation \u00b7\u2217 (of taking the symmetric part of a relation). By sym(S) we\ndenote the set {r \u2208 S | r\u2217 = r}.\n12\n5.1 The case bas(S) = {\u2261, d, d\u22121}\nIn this subsection, we will show that if S is a subalgebra with bas(S) = {\u2261, d, d\u22121}, then S \u2286 Sd,S \u2286 Ed or S is NP-complete.\nTo obtain this result we shall assume throughout this subsection that S is a subalgebra of A\nsatisfying the following assumptions:\nAssumption 1 bas(S) = {\u2261, d, d\u22121}.\nAssumption 2 S is not NP-complete.\nUsing these assumptions we obtain increasingly detailed information about S in Lemmas 4-12,\nuntil we are able to show that in all cases S \u2286 Sd or S \u2286 Ed. These lemmas rely on the following\nNP-completeness result.\nLemma 3 The subsets {(d), (oo\u22121)} and {(d\u22121), (pp\u22121)} of A are NP-complete.\nProof. Apply Lemma 1 with R = (o), R1 = (d), R2 = (oo\u22121), or with R = (p), R1 = (d\u22121),\nR2 = (pp\u22121), respectively. 2\nBefore we give the proofs, we note that \u03bd = (d\u22121) \u25e6 (d) \u2208 S, where \u03bd = (\u2261 oo\u22121dd\u22121ss\u22121ff\u22121),\nas defined in Table 2.\nLemma 4 With the assumptions above,\nsym(S) \u2286 {r\u2217|(dd\u22121) \u2286 r} \u222a {r\u2217|r \u2286 (\u2261 ss\u22121)} \u222a {r\u2217|r \u2286 (\u2261 ff\u22121)}.\nProof. We will show that if sym(S) is not included in the above set then S is NP-complete,\nwhich contradicts Assumption 2.\nSuppose first that (\u2261 ss\u22121ff\u22121) or (ss\u22121ff\u22121) belongs to sym(S). Then\nr = (\u2261 ss\u22121ff\u22121) \u25e6 (d) = (ss\u22121ff\u22121) \u25e6 (d) = (oo\u22121dsf) \u2208 S,\nso we have (oo\u22121) = r\u2217 \u2208 S, which implies that S is NP-complete, by Lemma 3.\nSuppose now there is r\u2217 \u2208 sym(S) such that r\u2217 \u2286 (\u2261 pp\u22121mm\u22121oo\u22121ss\u22121ff\u22121) and r\u2217 6\u2286 (\u2261\nss\u22121ff\u22121). Consider r1 = (d) \u25e6 r\u2217 \u2286 (pp\u22121mm\u22121oo\u22121dsf). It is easy to check that r\u22171 is non-empty\nand r\u22171 \u2286 (pp\u22121mm\u22121oo\u22121). If (oo\u22121) \u2286 r\u22171 , then r\u22171 \u2229 \u03bd = (oo\u22121) \u2208 S, so S is NP-complete, by\nLemma 3. Otherwise r\u22171 \u2286 (pp\u22121mm\u22121), so (d) \u25e6 r\u22171 = (pp\u22121) \u2208 S, which again implies that S is\nNP-complete, by Lemma 3. 2\nLemma 5 With the assumptions above,\nS \u2286 {r|r \u2229 (dd\u22121) 6= \u2205} \u222a {r|r \u2286 (\u2261 ss\u22121)} \u222a {r|r \u2286 (\u2261 ff\u22121)}.\nProof. Assume for contradiction that S contains a relation r with r\u2229(dd\u22121) empty, r 6\u2286 (\u2261 ss\u22121)\nand r 6\u2286 (\u2261 ff\u22121).\nAmong such relations, choose r to be minimal with respect to inclusion. Then, since \u03bd \u2208 S,\nwe have either r \u2286 (\u2261 oo\u22121ss\u22121ff\u22121), or r \u2286 (\u2261 pp\u22121mm\u22121ss\u22121), or r \u2286 (\u2261 pp\u22121mm\u22121ff\u22121).\nCase 1. r \u2286 (\u2261 oo\u22121ss\u22121ff\u22121)\nAssume first that (o) \u2286 r (the argument for (o\u22121) is dual by using Lemma 2). Consider r1 =\n(d\u22121)\u25e6r \u2286 (oo\u22121d\u22121s\u22121f\u22121). By the minimality of r, r1\u2229r = r or empty, but (o) \u2286 r, so (o) \u2286 r1, so\nr1\u2229 r is not empty and hence r \u2286 (oo\u22121s\u22121f\u22121). Now consider r2 = (d)\u25e6r \u2286 (pp\u22121mm\u22121oo\u22121dsf).\nBy a similar argument we get r \u2286 (oo\u22121sf). Combining these two results gives r \u2286 (oo\u22121), and\nthen by Lemma 4 we get r = (o), which contradicts Assumption 1.\nHence, we must have r \u2286 (\u2261 ss\u22121ff\u22121). If (sf) \u2286 r then ((d\u22121) \u25e6 r)\u2217 = (oo\u22121) \u2208 S, which\ncontradicts Lemma 4. If r = (\u2261 sf\u22121) or r = (sf\u22121) then r \u2229 ((d) \u25e6 r) = (s) \u2208 S, which contradicts\nAssumption 1.Hence, case 1 is impossible.\n13\nCase 2. r \u2286 (\u2261 pp\u22121mm\u22121ss\u22121).\nIf r\u2229(pp\u22121) 6= \u2205 then r1 = r\u2229((d)\u25e6r) \u2286 (pp\u22121m\u22121). Furthermore, (d)\u25e6r1 is a nonempty subrelation\nof (pp\u22121), which contradicts Assumption 1 or Lemma 3. If (mm\u22121) \u2286 r then ((d) \u25e6 r)\u2217 = (pp\u22121),\na contradiction again. It remains to consider the case (m) \u2286 r \u2286 (\u2261 mss\u22121). If (s\u22121) \u2286 r then,\nagain, ((d) \u25e6 r)\u2217 = (pp\u22121) \u2208 S. Otherwise r2 = r \u25e6 r satisfies (p) \u2286 r2 \u2286 (\u2261 pms), and then\n(p) = r2 \u2229 ((d) \u25e6 r2) \u2208 S, which contradicts Assumption 1.\nCase 3. r \u2286 (\u2261 pp\u22121mm\u22121ff\u22121).\nDual to Case 2. 2\nLemma 6 With the assumptions above, if (pmods) \u2208 S then S \u2286 Ed; if (pmod\u22121f\u22121) \u2208 S thenS \u2286 Sd.\nProof. We prove only the first statement, the second one is dual.\nFirst note that if rs \u2286 (\u2261 ss\u22121) then if (pmods) \u2208 S we have rs = (s), which contradicts\nAssumption 1. Furthermore, each of the relations rp, rm, ro, rs must be contained in (pmods) so,\nby Lemma 5, each of them contains (d). This implies that for every r \u2208 S, we have (d) \u2286 r\nwhenever r \u2229 (pmods) is non-empty. This condition precisely means that S \u2286 Ed. 2\nLemma 7 With the assumptions above, if S contains a non-trivial relation r such that r \u2286 (\u2261\nss\u22121), then S \u2286 Sd; if S contains a non-trivial relation r such that r \u2286 (\u2261 ff\u22121), then S \u2286 Ed.\nProof. The two cases are dual so we consider only the first one.\nObserve that r \u25e6 r\u22121 = (\u2261 ss\u22121) so we can assume that r = (\u2261 ss\u22121). We have (d)\u25e6 (\u2261 ss\u22121) =\n(p\u22121m\u22121o\u22121df), so the inverse relation (pmod\u22121f\u22121) \u2208 S and the result follows from Lemma 6. 2\nIn view of Lemma 7 and Lemma 5, it is sufficient to consider only cases such that for any non-trivial\nr \u2208 S, r \u2229 (dd\u22121) is non-empty.\nLemma 8 With the assumptions above, if (dd\u22121) 6\u2286 ro then S \u2286 Sd or S \u2286 Ed.\nProof. Suppose first that ro \u2229 (dd\u22121) = (d). Then, by Lemma 4, we have (oo\u22121) 6\u2286 ro. By the\nminimality of ro, ro \u2229 \u03bd = ro, so we have r1 = (od) \u2286 ro \u2286 (\u2261 odss\u22121ff\u22121) = r2. Consequently,\nr1 \u25e6 (d) \u2286 ro \u25e6 (d) \u2286 r2 \u25e6 (d), that is, (ods) \u2286 ro \u25e6 (d) \u2286 (oo\u22121dsf). Then, by minimality of ro, we\nhave (od) \u2286 ro \u2286 (odsf). Finally,\n(pmods) = (d) \u25e6 (od) \u2286 (d) \u25e6 ro \u2286 (d) \u25e6 (odsf) = (pmods),\nthat is, (pmods) = (d) \u25e6 ro \u2208 S, which implies, by Lemma 6, that S \u2286 Ed.\nDual calculations show that if ro \u2229 (dd\u22121) = (d\u22121) then (pmod\u22121f\u22121) \u2208 S, and hence, by\nLemma 6, S \u2286 Sd. 2\nLemma 9 With the assumptions above, if rs\u2229(dd\u22121) = (d\u22121) or rf\u2229(dd\u22121) = (d\u22121), then S \u2286 Sd\nor S \u2286 Ed.\nProof. The two cases are dual so we prove only the first one.\nIf rs \u2229 (dd\u22121) = (d\u22121), then, by Lemma 4, we have (ss\u22121) 6\u2286 rs. By the minimality of rs,\nrs \u2229 \u03bd = rs, so we have (d\u22121s) \u2286 rs \u2286 (\u2261 oo\u22121d\u22121sff\u22121).\nSuppose rs \u2229 (oo\u22121) is non-empty. Then (dd\u22121) 6\u2286 ro so S \u2286 Sd or S \u2286 Ed, by Lemma 8.\nSuppose to the contrary that rs \u2229 (oo\u22121) = \u2205. Then, (d\u22121s) \u2286 rs \u2286 (\u2261 d\u22121sff\u22121) and\n(od\u22121f\u22121) = (d\u22121) \u25e6 (d\u22121s) \u2286 (d\u22121) \u25e6 rs \u2286 (d\u22121) \u25e6 (\u2261 d\u22121sff\u22121) = (od\u22121s\u22121f\u22121).\nTherefore we have (od\u22121f\u22121) \u2208 S or (od\u22121s\u22121f\u22121) \u2208 S, which implies (dd\u22121) 6\u2286 ro, so the result\nfollows from Lemma 8. 2\n14\nLemma 10 With the assumptions above, if (dd\u22121) 6\u2286 rp then S \u2286 Sd or S \u2286 Ed.\nProof. We consider only the case rp \u2229 (dd\u22121) = (d) since the case rp \u2229 (dd\u22121) = (d\u22121) is dual.\nBy Lemma 4, we have (pp\u22121) 6\u2286 rp. So, we have\n(pd) \u2286 rp \u2286 (\u2261 pmm\u22121oo\u22121dss\u22121ff\u22121).\nIf r1 = rp \u2229 (oo\u22121s\u22121f\u22121) is non-empty then using Lemmas 8 and 9 we easily get the required\nresult; for example, rp = (pod) implies (dd\u22121) 6\u2286 ro and rp = (pds\u22121) implies rs \u2229 (dd\u22121) = (d\u22121).\nSo we may assume that (pd) \u2286 rp \u2286 (\u2261 pmm\u22121dsf). Then\n(pd) = (d) \u25e6 (pd) \u2286 (d) \u25e6 rp \u2286 (d) \u25e6 (\u2261 pmm\u22121dsf) = (pp\u22121d).\nSince (pp\u22121d) 6\u2208 S (otherwise its symmetric part (pp\u22121) belongs to S which contradicts Lemma 4),\nwe get (pd) = (d) \u25e6 rp \u2208 S. This implies that (pmods) = (pd) \u25e6 (pd) \u2208 S and hence S \u2286 Ed, by\nLemma 6. 2\nLemma 11 With the assumptions above, if (dd\u22121) 6\u2286 rm then S \u2286 Sd or S \u2286 Ed.\nProof. We consider only the case rm \u2229 (dd\u22121) = (d), the case rm \u2229 (dd\u22121) = (d\u22121) is dual.\nAs in the proof of the previous lemma, if rm \u2229 (pp\u22121oo\u22121s\u22121f\u22121) is non-empty then we get the\nrequired result by Lemmas 8, 9 and 10. So we may assume that (md) \u2286 rm \u2286 (\u2261 mdsf). Then\n(pd) = (d) \u25e6 (md) \u2286 (d) \u25e6 rm \u2286 (d) \u25e6 (\u2261 mdsf) = (pd).\nThus, (pd) \u2208 S. This implies that (pmods) = (pd) \u25e6 (pd) \u2208 S and hence S \u2286 Ed, by Lemma 6. 2\nLemma 12 With the assumptions above, S \u2286 Sd or S \u2286 Ed.\nProof. If a subalgebra S satisfies none of the conditions of Lemmas 7-11 then, by Lemma 5, (d)\nis contained in all of the minimal relations rp, rm, ro, and rs. Therefore, every r \u2208 S satisfies\nr \u2229 (pmods) 6= \u2205 \u21d2 (d) \u2286 r, which precisely means that S \u2286 Ed. 2\n5.2 The case bas(S) = {\u2261, o, o\u22121}\nIn this subsection, we will show that if S is a subalgebra with bas(S) = {\u2261, o, o\u22121}, then S \u2286 So,\nS \u2286 Eo or S is NP-complete.\nTo obtain this result we shall assume throughout this subsection that S is a subalgebra of A\nsatisfying the following assumptions:\nAssumption 1 bas(S) = {\u2261, o, o\u22121}.\nAssumption 2 S is not NP-complete.\nUsing these assumptions we obtain increasingly detailed information about S in Lemmas 14-20,\nuntil we are able to show that in all cases S \u2286 So or S \u2286 Eo. (The structure of this proof is quite\nsimilar to the proof of the case when bas(S) = {\u2261, d, d\u22121}, above.) These lemmas rely on the\nfollowing NP-completeness result.\nLemma 13 The subset {(o), (dd\u22121)} of A is NP-complete.\nProof. Apply Lemma 1 with R = (d), R1 = (o), R2 = (dd\u22121). 2\nIn the proofs below, we will make frequent use of the fact that \u03bd = (o) \u25e6 (o\u22121) \u2208 S. Note\nalso that (pmo) = (o) \u25e6 (o) \u2208 S and the relation (pm) does not belong to S since, otherwise,\n(p) = (pm) \u25e6 (pm) \u2208 S, which contradicts Assumption 1. Therefore rp = rm = (pmo) which\nimplies that, for every r \u2208 S, if r \u2229 (pmo) 6= \u2205 then (o) \u2286 r.\n15\nLemma 14 With the assumptions above,\nsym(S) \u2286 {r\u2217|(oo\u22121) \u2286 r} \u222a {r\u2217|r \u2286 (\u2261 ss\u22121) \u222a {r\u2217|r \u2286 (\u2261 ff\u22121)}.\nProof. We will show that if sym(S) is not included in the above set then S is NP-complete,\nwhich contradicts Assumption 2.\nSuppose first that (\u2261 ss\u22121ff\u22121) or (ss\u22121ff\u22121) belongs to sym(S). Then\nr = (o) \u25e6 (\u2261 ss\u22121ff\u22121) = (o) \u25e6 (ss\u22121ff\u22121) = (pmodd\u22121sf\u22121) \u2208 S,\nso we have (dd\u22121) = r\u2217 \u2208 S, which implies that S is NP-complete, by Lemma 13.\nSuppose now that there exists r\u2217 \u2208 sym(S) such that r\u2217 \u2286 (\u2261 pp\u22121mm\u22121dd\u22121ss\u22121ff\u22121) and\nr\u2217 6\u2286 (\u2261 ss\u22121ff\u22121). If r1 = r\u2217 \u2229 (pp\u22121mm\u22121) is non-empty then r\u2032 = r\u2217 \u2229 (pmo) \u2286 (pm) implying\nthat (p) = r\u2032 \u25e6 r\u2032 belongs to S, which contradicts Assumption 1. Therefore (dd\u22121) \u2286 r\u2217 since\nr\u2217 6\u2286 (\u2261 ss\u22121ff\u22121). Now, it is easy to check that if r2 = ((o)\u25e6r\u2217)\u2229((o\u22121)\u25e6r\u2217) then r\u22172 = (dd\u22121) \u2208 S,\nwhich implies that S is NP-complete, by Lemma 13. 2\nLemma 15 With the assumptions above,\nS \u2286 {r|r \u2229 (oo\u22121) 6= \u2205} \u222a {r|r \u2286 (\u2261 ss\u22121)} \u222a {r|r \u2286 (\u2261 ff\u22121)}.\nProof. Assume for contradiction that S contains a relation r with r\u2229(oo\u22121) empty, r 6\u2286 (\u2261 ss\u22121)\nand r 6\u2286 (\u2261 ff\u22121).\nAmong such relations, choose r to be minimal with respect to inclusion. Then, since, as noted\nabove, r \u2229 (pmo) 6= \u2205 implies (o) \u2286 r, we have r \u2286 (\u2261 dd\u22121ss\u22121ff\u22121).\nAssume first that (d) \u2286 r (the argument for (d\u22121) is dual). Consider r1 = (o) \u25e6 r \u2286\n(pmodd\u22121sf\u22121). By the minimality of r, r1 \u2229 r = r or empty, but (d) \u2286 r, so (d) \u2286 r1, so r1 \u2229 r is\nnot empty and hence r \u2286 (dd\u22121sf\u22121). Now consider r2 = (o\u22121) \u25e6 r \u2286 (p\u22121m\u22121o\u22121dd\u22121s\u22121f). By a\nsimilar argument we get r \u2286 (dd\u22121s\u22121f). Combining these two results gives r \u2286 (dd\u22121), and then\nby Lemma 14 we get r = (d), which contradicts Assumption 1.\nHence, we must have r \u2286 (\u2261 ss\u22121ff\u22121). If (s\u22121f) \u2286 r then ((o) \u25e6 r)\u2217 = (dd\u22121) \u2208 S, which\ncontradicts Lemma 14. If r = (\u2261 sf) or r = (sf) then r \u2229 ((o) \u25e6 r) = (s) \u2208 S, which contradicts\nAssumption 1. 2\nThe proofs of the following two lemmas are omitted since they are very similar to the proofs of\nLemmas 6 and 7, respectively.\nLemma 16 With the assumptions above, if (pmods) \u2208 S then S \u2286 Eo; and if (pmod\u22121f\u22121) \u2208 S\nthen S \u2286 So.\nLemma 17 With the assumptions above, if S contains a non-trivial relation r such that r \u2286 (\u2261\nss\u22121), then S \u2286 So; if S contains a non-trivial relation r such that r \u2286 (\u2261 ff\u22121), then S \u2286 Eo.\nIn view of Lemma 17 and Lemma 15, it is sufficient to consider only cases such that for any\nnon-trivial r \u2208 S, r \u2229 (oo\u22121) is non-empty.\nLemma 18 With the assumptions above, if (oo\u22121) 6\u2286 rd then S \u2286 So or S \u2286 Eo.\nProof. Suppose first that rd \u2229 (oo\u22121) = (o). Then (dd\u22121) 6\u2286 rd, since the opposite would\ncontradict Lemma 14. By the minimality of rd, rd \u2229 \u03bd = rd so r1 = (od) \u2286 rd \u2286 (\u2261 odss\u22121ff\u22121) =\nr2. Consequently, (o)\u25e6 r1 \u2286 (o)\u25e6 rd \u2286 (o)\u25e6 r2, that is, (pmods) \u2286 (o)\u25e6 rd \u2286 (pmodd\u22121sf\u22121). Then,\nby minimality of rd, we have (od) \u2286 rd \u2286 (odsf\u22121). Finally,\n(pmods) = (o) \u25e6 (od) \u2286 (o) \u25e6 rd \u2286 (o) \u25e6 (odsf\u22121) = (pmods),\nthat is, (pmods) = (o) \u25e6 rd \u2208 S, which implies, by Lemma 16, that S \u2286 Eo.\nDual calculations show that if rd \u2229 (oo\u22121) = (o\u22121) then (pmod\u22121f\u22121) \u2208 S, and hence S \u2286 So,\nby Lemma 16. 2\n16\nLemma 19 If rs \u2229 (oo\u22121) = (o\u22121) then S \u2286 So or S \u2286 Eo.\nProof. We have (ss\u22121) 6\u2286 rd, since the opposite would contradict Lemma 14. By the minimality\nof rd, rd \u2229 \u03bd = rd so (o\u22121s) \u2286 rs \u2286 (\u2261 o\u22121dd\u22121sff\u22121).\nSuppose first that rs \u2229 (dd\u22121) is non-empty. Then, (oo\u22121) 6\u2286 rd and S \u2286 So or S \u2286 Eo by\nLemma 18.\nSuppose to the contrary that rs \u2229 (dd\u22121) = \u2205. Then (o\u22121s) \u2286 rs \u2286 (\u2261 o\u22121sff\u22121) and\n(o\u22121) \u25e6 (o\u22121s) \u2286 (o\u22121) \u25e6 rs \u2286 (o\u22121) \u25e6 (\u2261 o\u22121sff\u22121),\nthat is,\n(p\u22121m\u22121o\u22121df) \u2286 (o\u22121) \u25e6 rs \u2286 (p\u22121m\u22121o\u22121dd\u22121s\u22121f).\nHence (oo\u22121) 6\u2286 rd, so the result follows by Lemma 18. 2\nLemma 20 With the assumptions above, S \u2286 So or S \u2286 Eo.\nProof. If S satisfies none of the conditions of Lemmas 17-19, then, by Lemma 15, (o) is contained\nin both rd and rs. Since, as we noted in the beginning of this subsection, (o) is also contained in\nboth rp and rm, we conclude that S is contained in Eo. 2\n5.3 The case bas(S) = {\u2261, s, s\u22121} or bas(S) = {\u2261, f, f\u22121}\nIn this subsection, we will show that if bas(S) = {\u2261, s, s\u22121}, then either S is NP-complete or\nS is contained in one of the subalgebras H, Sd, So, Sp, E\u2217, or in one of Ai, 1 \u2264 i \u2264 4. By\nusing the obvious symmetry between the relations (s) and (f), it immediately follows that if\nbas(S) = {\u2261, f, f\u22121}, then either S is NP-complete or contained in one of H, Ed, Eo, Ep, S\u2217 or Bi,\n1 \u2264 i \u2264 4.\nTo obtain this result we shall assume throughout this subsection that S is a subalgebra of A\nsatisfying the following assumptions:\nAssumption 1 bas(S) = {\u2261, s, s\u22121}.\nAssumption 2 S is not NP-complete.\nUsing these assumptions we obtain increasingly detailed information about S in Lemmas 22-29,\nuntil we are able to obtain the result. These lemmas rely on the following NP-completeness result.\nLemma 21 The subset {r} of A is NP-complete whenever (ods\u22121) \u2286 r \u2286 (pmods\u22121f\u22121).\nProof. Let r3 be the union of all basic relations except for \u2261 and s\u22121, and consider the instance\n\u03934 = {xra, xrb, yrb, ary, bra} over the variables x, y, a, b. In the cases when r = (ods\u22121) or\nr = (pmods\u22121f\u22121), it can be shown that \u03934 \u222a {xr\u2032y} is satisfiable for every basic relation r\u2032 \u2286 r3\nbut not satisfiable for any other choice of r\u2032. It follows that, for every r such that (ods\u22121) \u2286 r \u2286\n(pmods\u22121f\u22121), we can derive r3 from r. Further, we can derive the relation r4 = r \u2229 r3 satisfying\n(od) \u2286 r4 \u2286 (pmodf\u22121), and the relation r5 = r4 \u25e6 r4. It is easy to check that\n(pmods) \u2286 r5 \u2286 (pmodsf\u22121)\nwhich implies that r5 \u2229 r\u22121 = (s). Furthermore, (s) \u25e6 (s\u22121) = (\u2261 ss\u22121) and r \u25e6 r is the disequality\nrelation, so the relation (ss\u22121) can be obtained from the relation r. If R = (s), R1 = r\u22121 and\nR2 = r, then these relations satisfy the conditions of Lemma 1 so {(ss\u22121), r\u22121, r} is NP-complete.\nSince all of these relations can be derived from the single relation r, it follows that {r} is NP-\ncomplete. 2\n17\nLemma 22 With the assumptions above, if S contains the relation (od), then every r \u2208 S satisfies\ncondition 3) of H.\nProof. Arbitrarily choose r \u2208 S. Since (od) \u2208 S, it follows that rd = ro = (od) and (o)\u00b11 \u2286\nr \u21d4 (d)\u00b11 \u2286 r. Furthermore, r1 = (s) \u25e6 (od) = (pmod) \u2208 S so rp \u2286 r1 and rm \u2286 r1. Since\n(pm)\u25e6(pm) = (p), we have rp 6\u2286 (pm) and rm 6\u2286 (pm), and therefore rp\u2229(od) 6= \u2205 and rm\u2229(od) 6= \u2205.\nNow it follows that (od) \u2286 rp and (od) \u2286 rm. Thus, if r \u2229 (pm) 6= \u2205, then (od) \u2286 r which means\nthat r satisfies condition 3) of H. 2\nLemma 23 With the assumptions above, if S contains a non-trivial relation r\u2032 with r\u2032 \u2286 (\u2261\npp\u22121mm\u22121ff\u22121) then S is included in one of H, E\u2217, or Sp.\nProof. Case 1. r\u2032 = (ff\u22121)\nSince (ff\u22121) \u25e6 (s) = (od) \u2208 S, it follows that any r \u2208 S satisfies condition 3) of H by Lemma 22.\nNote also that now, for every r \u2208 S, we have\n(o)\u00b11 \u2286 r \u21d4 (d)\u00b11 \u2286 r and (f) \u2286 r \u21d4 (f\u22121) \u2286 r. (1)\nSuppose that S 6\u2286 H, i.e. some r \u2208 S fails to satisfy condition 1) or condition 2) of H. Then,\nusing the conditions (1) from the previous paragraph, it is not hard to check that the relation r\ncan be chosen so that\n(s\u22121ff\u22121) \u2286 r \u2286 (\u2261 pmodss\u22121ff\u22121) or (ods\u22121) \u2286 r \u2286 (\u2261 pmodss\u22121ff\u22121).\nIn both cases, multiplying the relations by (s) from the left we get\n(\u2261 pmodss\u22121) \u2286 (s) \u25e6 r \u2286 (\u2261 pmodss\u22121).\nTherefore (\u2261 pmodss\u22121) \u2208 S, and\n(pmods\u22121) = (\u2261 pmodss\u22121) \u2229 ((\u2261 pmodss\u22121)\u22121 \u25e6 (od)\u22121) \u2208 S,\nso S is NP-complete by Lemma 21, which contradicts Assumption 2.\nCase 2. r\u2032 \u2286 (\u2261 ff\u22121).\nMultiplying r\u2032 and its inverse we get (\u2261 ff\u22121), so we may assume that r\u2032 = (\u2261 ff\u22121). If some\nrelation r2 \u2208 S fails to satisfy condition 2) of E\u2217 then r2 \u2229 r\u2032 is either (f)\u00b11, which is impossible,\nor (ff\u22121) going back to Case 1. Suppose now that each r \u2208 S satisfies condition 2) of E\u2217.\nWe have r\u2032 \u25e6 (s) = (ods) \u2208 S. If (od) \u2208 S then r\u2032 \u2229 ((s\u22121) \u25e6 (od)) = (ff\u22121) \u2208 S, which implies\nS \u2286 H by Case 1. Suppose (od) 6\u2208 S. Then we have r \u2229 (od)\u00b11 6= \u2205 \u21d2 (s)\u00b11 \u2286 r for every\nr \u2208 S. Assume a relation r3 \u2208 S does not satisfy condition 1) of E\u2217, that is, r3 \u2229 (pmod) 6= \u2205\nand (s) 6\u2286 r3. Since (pmods) = (s) \u25e6 r\u2032 \u2208 S, we have r4 = r3 \u2229 (pmods) \u2208 S and r4 \u2286 (pm). This\nimplies r4 \u25e6 r4 = (p), which contradicts Assumption 1. Therefore the relations in S must satisfy\nboth conditions of E\u2217, that is, S \u2286 E\u2217.\nCase 3. r\u2032 \u2286 (\u2261 mm\u22121ff\u22121) and r\u2032 \u2229 (mm\u22121) 6= \u2205.\nWithout loss of generality we may assume that (m) \u2286 r. Then we have (m) \u2286 r1 = (r\u2032 \u2229 (r\u2032 \u25e6\n(s\u22121)) \u2286 (mm\u22121) so (m) = r1 \u2229 (r1 \u25e6 (s\u22121)) \u2208 S, which contradicts Assumption 1.\nCase 4. r\u2032 \u2229 (pp\u22121) 6= \u2205.\nAssume without loss of generality that (p) \u2286 r\u2032. Then (p) \u2286 (s) \u25e6 r\u2032 \u2286 (pp\u22121mm\u22121ods). Further,\n(p) \u2286 r5 = r\u2032 \u2229 ((s) \u25e6 r\u2032) \u2286 (pp\u22121mm\u22121) and (p) \u2286 r6 = r5 \u25e6 (s\u22121) \u2286 (pp\u22121m). If (p\u22121) 6\u2286 r6\nthen r6 \u25e6 r6 = (p) \u2208 S, which contradicts Assumption 1. Otherwise (pp\u22121) = r\u22176 \u2208 S. Then\n(p) \u2286 r \u21d4 (p\u22121) \u2286 r holds for every r \u2208 S.\nWe have (s\u22121) \u25e6 (pp\u22121) = (pp\u22121mod\u22121f\u22121) \u2208 S. For every non-empty r7 \u2286 (mod\u22121f\u22121), we\nhave ((s)\u25e6r7)\u2229 (pp\u22121) = (p). Therefore no such r7 belongs to S. We conclude that, for any r \u2208 S,\nif r \u2229 (mod\u22121f\u22121) 6= \u2205 then (p) \u2286 r, which means that S \u2286 Sp. 2\nIn view of Lemma 23, it is now sufficient to consider cases where the following additional property\nholds:\n18\nAssumption 3 For every non-trivial r \u2208 S, we have r \u2229 (oo\u22121dd\u22121ss\u22121) 6= \u2205.\nLemma 24 With the assumptions above, if rd \u2229 (oo\u22121dd\u22121ss\u22121) = (d) or (dd\u22121) \u2286 rd thenS \u2286 Sd.\nProof. Case 1. rd \u2229 (oo\u22121dd\u22121ss\u22121) = (d).\nBy assumption, the relation rd satisfies condition (d) \u2286 rd \u2286 (\u2261 pp\u22121mm\u22121dff\u22121). Let r1 be\ncalculated as rd \u2229 ((s) \u25e6 rd). Then we have (d) \u2286 r1 \u2286 (pp\u22121mm\u22121d). By minimality of rd\nwe get (d) \u2286 rd \u2286 (pp\u22121mm\u22121d). Calculating r1 again, we get (d) \u2286 rd \u2286 (pp\u22121m\u22121d). By\nAssumption 3, we have (pp\u22121) 6\u2208 S. Furthermore, since we have (m\u22121d) \u2286 rd \u25e6 (s) only if\n(p\u22121) \u2286 rd, we may assume that rd is either (pd), or (p\u22121d), or (p\u22121m\u22121d). In the first case\nwe get (pd) \u2229 ((p\u22121d\u22121) \u25e6 (s)) = (d), which contradicts Assumption 1. Let (p\u22121d) \u2286 rd \u2286\n(p\u22121m\u22121d). Then (p\u22121m\u22121o\u22121df) = rd \u25e6 (s) \u2208 S. Suppose S contains a non-empty subrelation r2\nof (p\u22121m\u22121o\u22121f). Then r3 = rd \u2229 (r2 \u25e6 (s\u22121)) is a non-empty subrelation of (p\u22121m\u22121) implying\nthat (p\u22121) = r3 \u25e6 r3 \u2208 S, which contradicts Assumption 1. Therefore , for every r \u2208 S, we have\nr \u2229 (p\u22121m\u22121o\u22121f) 6= \u2205 \u21d2 (d) \u2286 r, which means that S \u2286 Sd.\nCase 2. (dd\u22121) \u2286 rd.\nSuppose a relation r4 \u2208 S satisfies (dd\u22121) 6\u2286 r4. Then it is not hard to verify that if r4 6\u2286 (\u2261 ss\u22121)\nthen either ((s\u22121)\u25e6r4)\u2229rd or (r4 \u25e6(s))\u2229rd contains exactly one of (d) and (d\u22121) which contradicts\nthe minimality of rd. Thus, for every r \u2208 S such that r 6\u2286 (\u2261 ss\u22121), we have (dd\u22121) \u2286 r. This\nimplies that S \u2286 Sd. 2\nLemma 25 With the assumptions above, if ro \u2229 (oo\u22121dd\u22121ss\u22121) = (o) or (oo\u22121) \u2286 ro then\nS \u2286 So.\nProof. Similar to the previous lemma. 2\nLemma 26 With the assumptions above, if rd = ro\u22121 and rd \u2229 (oo\u22121dd\u22121ss\u22121) = (o\u22121d), thenS \u2286 Sd.\nProof. As in the proof of Lemma 24, we can obtain (o\u22121d) \u2286 rd \u2286 (pp\u22121m\u22121o\u22121df). If\n(po\u22121d) \u2286 rd then (rd \u25e6 (s\u22121))\u2217 = (pp\u22121) \u2208 S, and the result follows from Lemma 23. Therefore\nwe have (o\u22121d) \u2286 rd \u2286 (p\u22121m\u22121o\u22121df), and (p\u22121m\u22121o\u22121df) = rd \u25e6 (s\u22121) \u2208 S. By Assumption\n3, no non-empty subrelation r1 of (p\u22121m\u22121f) belongs to S, so, for every r \u2208 S, we have r \u2229\n(p\u22121m\u22121o\u22121f) 6= \u2205 \u21d2 (d) \u2286 r, which means that S \u2286 Sd. 2\nLemma 27 With the assumptions above, if rd = ro and rd\u2229(oo\u22121dd\u22121ss\u22121) = (od), then S \u2286 H.\nProof. As in the previous lemmas, it can be shown that (od) \u2286 rd \u2286 (pp\u22121mm\u22121od). Then\nr\u2217d = \u2205 and (pmod) = (s) \u25e6 rd \u2208 S. Further, (oo\u22121dd\u22121ff\u22121) = ((s\u22121) \u25e6 (pmod))\u2217 \u2208 S and\n(od) = (pmod)\u2229 (oo\u22121dd\u22121ff\u22121) \u2208 S. By Lemma 22, we know that every r \u2208 S satisfies condition\n3) of H. Suppose some r1 \u2208 S does not satisfy condition 1) of H. Then r1 can be chosen so that\n(s\u22121f\u22121) \u2286 r1 \u2286 (\u2261 pmodss\u22121ff\u22121) or (os\u22121) \u2286 r1 \u2286 (\u2261 pmodss\u22121ff\u22121).\nIf (f) \u2286 r1 then (ff\u22121) = (r1 \u2229 (oo\u22121dd\u22121ff\u22121))\u2217 \u2208 S, which contradicts Assumption 3. Further,\nif (od) 6\u2286 r1 then r1 \u2229 (oo\u22121dd\u22121ff\u22121) = (f\u22121) \u2208 S, which contradicts Assumption 1. Therefore\nwe may assume that (ods\u22121f\u22121) \u2286 r1 \u2286 (\u2261 pmodss\u22121f\u22121). Now it can be checked that r2 = r1 \u2229\n(r\u221211 \u25e6 (o\u22121d\u22121)) satisfies (ods\u22121f\u22121) \u2286 r2 \u2286 (pmods\u22121f\u22121), so {r2} is NP-complete by Lemma 21,\nwhich contradicts Assumption 2.\nOne can proceed similarly if condition 2) of H fails in S. 2\n19\nLemma 28 With the assumptions above, if r\u2229 (ss\u22121) 6= \u2205 for each non-trivial r \u2208 S then S \u2286 Ai\nfor some 1 \u2264 i \u2264 4.\nProof. Case 1. rp \u2229 (ss\u22121) = (s\u22121).\nWe have (ps\u22121) \u2286 rp and (s) 6\u2286 rp. Let r1 = (s\u22121) \u25e6 rp \u2208 S. Then it is easy to check that\n(pmod\u22121s\u22121f\u22121) \u2286 r1, and that r1 \u2229 (\u2261 s) = \u2205. It follows that r1 = (pmod\u22121s\u22121f\u22121), since\notherwise r\u22171 is non-empty and r\n\u2217\n1 \u2229 (ss\u22121) = \u2205. No non-empty subrelation of (pmod\u22121f\u22121) can\nbelong to S. Therefore, for any r \u2208 S, we have r \u2229 (pmod\u22121f\u22121) 6= \u2205 \u21d2 (s\u22121) \u2286 r. Hence S \u2286 A1.\nCase 2. rd \u2229 (ss\u22121) = (s\u22121).\nThe proof is similar to Case 1; the only change is that r1 = rd \u25e6 (s\u22121), and we deduce that\nr1 = (p\u22121m\u22121o\u22121ds\u22121f), and, hence, S \u2286 A2.\nCase 3. ro \u2229 (ss\u22121) = (s\u22121).\nIn view of Cases 1 and 2 we may assume that (os\u22121) \u2286 ro \u2286 (\u2261 p\u22121mm\u22121od\u22121s\u22121ff\u22121). Let r1 =\n(s\u22121) \u25e6 ro \u2208 S. It is easy to check that r1 satisfies (od\u22121s\u22121f\u22121) \u2286 r1 \u2286 (p\u22121m\u22121oo\u22121d\u22121s\u22121f\u22121).\nSince r\u22171 6= (oo\u22121), we obtain r1 \u2286 (p\u22121m\u22121od\u22121s\u22121f\u22121). It can straightforwardly be verified that\nif r1 6= (od\u22121s\u22121f\u22121), then r2 = (r1\u25e6r1)\u2217 contains (pp\u22121) and r2\u2229(ss\u22121) = \u2205, which contradicts the\nassumptions made. Therefore r1 = (od\u22121s\u22121f\u22121), and (pmod\u22121s\u22121f\u22121) = r1 \u25e6 r1 \u2208 S. Therefore,\nfor any r \u2208 S, r \u2229 (pmod\u22121f\u22121) 6= \u2205 implies (s\u22121) \u2286 r, that is, S \u2286 A1.\nCase 4. rm \u2229 (ss\u22121) = (s\u22121).\nSimilarly to Case 3, we infer that S \u2286 A1.\nCase 5. (s) is contained in each of rp, rd, ro, and rm.\nWe have rf \u2229 (ss\u22121) 6= \u2205. Then it follows that if (s) \u2286 rf then S \u2286 A3. Otherwise, (s\u22121) \u2286 rf and\nwe have S \u2286 A4. 2\nLemma 29 With the assumptions above, S is contained in one of the subalgebras H, Sd, So, Sp,E\u2217, or in one of Ai, 1 \u2264 i \u2264 4.\nProof. By Lemma 28 it suffices to consider the case when S contains a non-trivial relation r\nwith r \u2229 (ss\u22121) = \u2205.\nBy Lemma 23 we can assume that, for every non-trivial r \u2208 S, we have r\u2229(oo\u22121dd\u22121ss\u22121) 6= \u2205,\nso it suffices to consider cases when rd \u2229 (ss\u22121) = \u2205 or ro \u2229 (ss\u22121) = \u2205.\nWe claim that the result now follows from Lemmas 24-27. To establish this claim suppose\nthat rd \u2229 (ss\u22121) = \u2205, but rd does not satisfy the conditions of Lemma 24. Then (d\u22121) 6\u2286 rd and\nrd \u2229 (oo\u22121) 6= \u2205. If (oo\u22121) \u2286 rd then r\u2217d \u2229 (oo\u22121dd\u22121) = (oo\u22121), which implies that ro satisfies\nthe conditions of Lemma 25 and S \u2286 So. Otherwise we have ro \u2286 rd or ro\u22121 \u2286 rd. If both of\nthese inclusions are proper then it is easy to see that ro \u2229 (oo\u22121dd\u22121) = (o) and, hence, S \u2286 So\nby Lemma 25. Thus we only need to consider two cases: rd = ro\u22121 and rd = ro which are dealt\nwith in Lemmas 26 and 27. The case when ro \u2229 (ss\u22121) 6= \u2205 but ro does not satisfy the conditions\nof Lemma 25 is similar and it is sufficient to consider the same two cases. 2\n6 Subalgebras With Only Trivial Basic Relation\nIn this section, we consider subalgebras S of A such that bas(S) = {(\u2261)}. We can assume that S\ncontains a relation r\u2032 such that (\u2261) 6\u2286 r\u2032; otherwise S \u2286 A\u2261.\nA relation r is symmetric if r\u2217 = r and it is asymmetric if r\u2217 = \u2205. If we choose the relation\nr\u2032 to be minimal, then this implies that r\u2032 is either asymmetric or symmetric. We consider these\ntwo cases in Subsections 6.1 and 6.2, respectively.\n6.1 Asymmetric relations\nIn this subsection we prove the following proposition.\n20\nProposition 4 Let S be a subalgebra of A such that bas(S) = {\u2261}, which contains an asymmetric\nrelation. Then S is tractable if it is contained in one of the 18 algebras listed in Table 3. Otherwise\nS is NP-complete\nTo obtain this result we shall assume throughout this subsection that S is a subalgebra of A\nsatisfying the following assumptions:\nAssumption 1 bas(S) = {\u2261}.\nAssumption 2 S is not NP-complete.\nAssumption 3 r\u2032 \u2208 S is an asymmetric relation.\nWe first show that r\u2032 must have a very restricted form, and then show that the result holds for all\npossible cases in Lemmas 32-37.\nA relation r \u2208 A is said to be acyclic if, for every k > 1, the instance\nx1rx2, x2rx3, . . . , xk\u22121rxk, xkrx1\nhas no model.The acyclic relations are characterised in [14].\nLemma 30 ([14]) A relation r \u2208 A is acyclic if and only if r or r\u22121 is a subset of one of the\nrelations (pmod\u22121sf\u22121), (pmod\u22121s\u22121f\u22121), (pmodsf) or (pmodsf\u22121).\nProposition 5 If r is asymmetric, but not acyclic, then {r} is NP-complete.\nThe proof of this proposition can be found in Subsection A.2. By using this result, we can\nnow restrict our attention to cases where r\u2032 is an acyclic relation. To complete the proof of\nProposition 4, we will now consider all acyclic relations. The proofs rely on the following NP-\ncompleteness results.\nLemma 31 The following sets of relations are NP-complete:\n1) {(oo\u22121), r} where (d) \u2286 r \u2286 (dsf);\n2) {(dd\u22121), r}, where (o) \u2286 r \u2286 (pmosf\u22121).\nProof. Set R = (o), R1 = r, R2 = (oo\u22121) in the first case, R = (d), R1 = r and R2 = (dd\u22121) in\nthe second case, and apply Lemma 1. 2\nLemma 32 With the assumptions above, if (pmods) \u2286 r\u2032 or (pmod\u22121f\u22121) \u2286 r\u2032 then S is contained\nin one of the 18 maximal tractable subalgebras.\nProof. We will consider only the first case, the second one is dual.\nBy Lemma 30, there are only three possible choices for r\u2032: (pmods), (pmodsf) and (pmodsf\u22121).\nThe relations rp, rm, ro, rd, and rs must all be contained in r\n\u2032. We now consider how they are\nrelated to each other.\nAssume first that one of these five sets is contained in the other four. If rm is contained in\nall of rp, ro, rd, rs, then either rm is one of (mf\n\u22121) and (mf), and in this case S \u2286 B1 or S \u2286 B2,\nrespectively, or else rm coincides with one of rp, ro, rd, rs because (m) 6\u2208 S, by Assumption 1.\nFurther, if rp, ro, or rd is contained in the other four relations, then S is contained in Ep, Eo, orEd, respectively. If rs is contained in all of rp, rm, ro, rd, then S \u2286 B1 if (f\u22121) \u2286 rs, S \u2286 B2 if\n(f) \u2286 rs, and S \u2286 E\u2217 if (\u2261 f) \u2286 rf. In the remaining case, we have rs = rm = (ms) is contained in\nrp, ro and rd, so if rf contains (s) then S \u2286 A3 and if rf contains (s\u22121) then S \u2286 A4, otherwise\nrf \u2286 (ff\u22121), and we have (ms) \u2229 (rf \u25e6 (ms)) = (m) \u2208 S, which contradicts Assumption 1.\nNow assume to the contrary that there are two relations r1 and r2 amongst rp, rm, ro, rd and\nrs which are both minimal in the inclusion ordering. Note that both r1 and r2 are contained in\n21\none of (pmodsf) and (pmodsf\u22121), since they are both subsets of r\u2032. We consider the first case, the\nsecond one is dual.\nBy the choice of r1, r2, r1 \u2229 r2 must be rf or empty. If rf is contained in every possible choice\nof r1 and r2 then S \u2286 B2, so we consider the case when r1 \u2229 r2 is empty.\nAssume first that r1 \u2286 (odsf). If r1 6= (sf) then it can be checked that r\u221211 \u25e6 r1 = \u03bd \u2208 S. If\nr1 = (sf) then r3 = r1 \u25e6 r1 = (dsf) and \u03bd = r\u221213 \u25e6 r3 belongs to S anyway. By the minimality of\nr2, we have either r2 \u2229 \u03bd = \u2205 or r2 \u2286 \u03bd. If r2 \u2229 \u03bd = \u2205 then r2 \u2286 (pm) and r2 \u25e6 r2 = (p) \u2208 S, which\ncontradicts Assumption 1. If r2 \u2286 \u03bd then both r1 and r2 are contained in (odsf). We may assume\nwithout loss of generality that (o) \u2286 r1. It can then be checked that for all possible choices of\nr1, r2, either (r1 \u25e6 r2) \u2229 r2 or (r\u221211 \u25e6 r2) \u2229 r2 is a non-empty proper subset of r2, which contradicts\nthe minimality of r2.\nThis completes the analysis of the case when r1 \u2286 (odsf).\nNow we only need to consider the case when the two distinct minimal relations r1 and r2 are\nrp and rm. Then we have (m) \u2286 rm \u2286 (modsf), and it can be checked that, unless rm = (mf),\nr4 = r\u22121m \u25e6 rm is either \u03bd or \u03bd \u222a (mm\u22121). In the former case r4 \u2229 rm is a non-empty proper\nsubrelation of rm, while in the latter one r4 \u2229 rp is a non-empty proper subrelation of rp, which\ncontradicts the choice of r1 and r2. If rm = (mf) then ((mf) \u25e6 (m\u22121f\u22121)) \u2229 rp = (p), which\ncontradicts Assumption 1. 2\nLemma 33 With the assumptions above, if (pmosf\u22121) \u2208 S then S is contained in one of the 18\nmaximal tractable subalgebras.\nProof. Consider the relation rd. If rd = (\u2261 d) then rd \u25e6 (pmosf\u22121) satisfies the conditions\nof Lemma 32. If (dd\u22121) \u2286 rd \u2286 (\u2261 dd\u22121) then, using (\u2261 dd\u22121) \u2229 ((\u2261 dd\u22121) \u25e6 (pmosf\u22121)) =\n(dd\u22121), we get S is NP-complete by Lemma 31(2), which contradicts Assumption 2. Hence,\nrd \u2229 (pp\u22121mm\u22121oo\u22121ss\u22121ff\u22121) 6= \u2205.\nThe relations rp, rm, ro, rs, and rf\u22121 must all be contained in (pmosf\n\u22121). Assume first that\none of these five relations is contained in the other four. If rm is contained in all of rp, ro, rs, rf\u22121 ,\nthen rm coincides with one of rp, ro, rs, rf\u22121 because (m) 6\u2208 S, by Assumption 1. Further, if rp,\nro, rs or rf\u22121 is contained in the other four relations, then it is also contained in rd or rd\u22121 .\nHence, S is contained in Sp, So, A2, A4, Ep, Eo, B1, or B4.\nNow assume to the contrary that there are two relations r1 and r2 amongst rp, rm, ro, rs and\nrf\u22121 which are both minimal in the inclusion ordering. By the choice of r1, r2, r1 \u2229 r2 must be\nempty.\nAssume first that r1 \u2286 (osf\u22121). If (o) \u2286 r1 then it can be checked that r\u221211 \u25e6 r1 = \u03bd \u2208 S. Then,\nby the minimality of r2, we have either r2 \u2229 \u03bd = \u2205 or r2 \u2286 \u03bd. If r2 \u2229 \u03bd = \u2205 then r2 \u2286 (pm) and\nr2 \u25e6 r2 = (p) \u2208 S, which contradicts Assumption 1. If r2 \u2286 \u03bd then both r1 and r2 are contained in\n(osf\u22121), which contradicts Assumption 1. Hence we may assume that r1 = (sf\u22121), which implies\nthat (o) \u2286 r2 \u2286 (pmo) and hence (r\u221211 \u25e6 r2)\u2217 = (dd\u22121), so S is NP-complete by Lemma 31(2),\nwhich contradicts Assumption 2. This completes the analysis of the case when r1 \u2286 (osf\u22121).\nNow we only need to consider the case when the two distinct minimal relations r1 and r2 are\nrp and rm. Then we have (m) \u2286 rm \u2286 (mosf\u22121), and it can be checked that in all cases either\nr\u22121m \u25e6rm or rm \u25e6r\u22121m is a non-empty proper subrelation of rp, which contradicts the choice of r2. 2\nLemma 34 With the assumptions above, if r\u2032 6\u2286 (dsf)\u00b11, r\u2032 6\u2286 (pmos)\u00b11, and r\u2032 6\u2286 (pmof\u22121)\u00b11,\nthen S is contained in one of the 18 maximal tractable subalgebras.\nProof. It follows from Lemma 30 that if r\u2032 \u2229 (pp\u22121mm\u22121oo\u22121) = \u2205 then r\u2032 (or its converse) is\none of (ds\u22121), (df\u22121), (sf\u22121), (dsf\u22121), or (ds\u22121f). In all of these cases r\u2032 \u25e6r\u2032 (or its converse) satisfies\nthe conditions of Lemma 32 or Lemma 33.\nHence we may assume that r\u2032 \u2229 (pmo) 6= \u2205. Now, using Lemma 30, it can straightforwardly\nbe checked that, except for r\u2032 = (md) and (md\u22121), the relation r\u2032 \u25e6 r\u2032 satisfies the conditions\n22\nof Lemma 32 or Lemma 33. For r\u2032 = (md) or (md\u22121), the relation (r\u2032 \u25e6 r\u2032) \u25e6 r\u2032 is (pmods) or\n(pmod\u22121f\u22121), respectively. Once again, Lemma 32 can be applied. 2\nLemma 35 With the assumptions above, if S contain relations r1 and r2 such that r1 \u2286 (pmos) or\nr1 \u2286 (pmof\u22121), and r2 \u2286 (dsf), then S is contained in one of the 18 maximal tractable subalgebras.\nProof. Let r3 = r1\u25e6r1 and r4 = r2\u25e6r2. Then we have (p) \u2286 r3 \u2286 (pmos) or (p) \u2286 r3 \u2286 (pmof\u22121),\nand (d) \u2286 r4 \u2286 (dsf). Now it is easy to check that either r3 \u25e6 r4 or r\u221214 \u25e6 r3 satisfies the conditions\nof Lemma 32. 2\nLemma 36 With the assumptions above, if r\u2032 \u2286 (dsf) then S is contained in one of the 18 maximal\ntractable subalgebras.\nProof. As noted in the proof of Lemma 32, we have \u03bd \u2208 S.\nWe consider the case when r\u2032 = (ds); the other cases are similar. Then, for every r \u2208 S, we\nhave r \u2229 (ds)\u00b11 6= \u2205 \u21d2 (s)\u00b11 \u2286 r.\nConsider the relation ro. If it is asymmetric then we get the required result by Lemmas 34\nand 35, and by Proposition 5, so assume it is not. It is clear that ro \u2286 \u03bd. Suppose that (ss\u22121) 6\u2286 ro,\nsay (s\u22121) 6\u2286 ro. Then (o) \u2286 ro \u2286 (\u2261 oo\u22121dsff\u22121). It is easy to check that if r1 = (ds) \u25e6 ro then\n(o) \u2286 r1 and (\u2261) 6\u2286 r1. This implies that (\u2261) 6\u2286 ro. Since ro is not asymmetric, we conclude that\n(oo\u22121) \u2286 ro or (ff\u22121) \u2286 ro. If (oo\u22121) 6\u2286 ro then (ff\u22121) = r\u2217o \u2208 S and (pmods) = (ds) \u25e6 (ff\u22121) \u2208 S,\nthat is, we can make use of Lemma 32. Suppose now that (oo\u22121) \u2286 ro; then ro is either (oo\u22121)\nor (oo\u22121ff\u22121). The case ro = (oo\u22121ff\u22121) is impossible in view of (oo\u22121ff\u22121)\u2229 ((ds) \u25e6 (oo\u22121ff\u22121)) =\n(oo\u22121f). If ro = (oo\u22121) then S is NP-complete by Lemma 31(1), which contradicts Assumption\n2. Therefore we may consider further in this proof that, for every r \u2208 S, r \u2229 (oo\u22121) 6= \u2205 implies\n(ss\u22121) \u2286 r.\nConsider the relation rp. If it is asymmetric then we get the required result by Lemmas 34-35,\nso assume it is not. Suppose that (ss\u22121) 6\u2286 rp. Then r\u2217p \u2286 (\u2261 pp\u22121mm\u22121ff\u22121). If (ff\u22121) \u2286 r\u2217p then\nr1 = r\u2217p\u2229 \u03bd (\u2208 S) is either (\u2261 ff\u22121) or (ff\u22121). In both cases (ds)\u25e6 r1 = (pmods) \u2208 S, and the result\nfollows from Lemma 32. We have ((ds) \u25e6 (\u2261 pp\u22121mm\u22121)) \u2229 (\u2261 pp\u22121mm\u22121) = (pp\u22121m\u22121). Then,\nif r\u2217p 6= (\u2261), we get rp = (pp\u22121), and S is NP-complete by Proposition 2(3), since {(pp\u22121), (ds)}\nis contained in neither Sp nor Ep. The only remaining choice for r\u2217p is (\u2261). It is impossible, since\n(p) \u2286 (ds)\u25e6rp, but (\u2261) 6\u2286 (ds)\u25e6rp. Therefore we may consider further in this proof that, for every\nr \u2208 S, r \u2229 (pp\u22121) 6= \u2205 implies (ss\u22121) \u2286 r.\nA similar argument shows that if (ss\u22121) 6\u2286 rm then the result follows. Assume that (ss\u22121) \u2286 rm.\nNow it can be easily verified that S \u2286 E\u2217 if rf \u2286 (\u2261 ff\u22121); otherwise we have rf \u2229 (ss\u22121) 6= \u2205, andS \u2286 B1 if (s\u22121) \u2286 rf, while S \u2286 B2 if (s) \u2286 rf. 2\nLemma 37 With the assumptions above, if r\u2032 \u2286 (pmos) or r\u2032 \u2286 (pmof\u22121), then S is contained in\none of the 18 maximal tractable subalgebras.\nProof. We shall consider the case r\u2032 \u2286 (pmos); the second case is dual. Note that r\u2032 6= (ms) and\nr\u2032 6= (mo); otherwise ((r\u2032)\u22121 \u25e6 r\u2032) \u2229 r\u2032 is (s) or (o), respectively.\nCase 1. (p) 6\u2286 r\u2032.\nWe have (o) \u2286 r\u2032; otherwise r\u2032 = (ms) which contradicts our assumptions. If r\u2032 = (mos) then\n((r\u2032)\u22121 \u25e6 r\u2032) \u2229 r\u2032 = (os) \u2208 S. We may therefore assume that r\u2032 = (os). Then, the proof is very\nsimilar to the one of Lemma 36.\nCase 2. (p) \u2286 r\u2032.\nSince (pm) \u25e6 (pm) = (p), r\u2032 cannot be (pm) and we can assume that (o) \u2286 r\u2032 or (s) \u2286 r\u2032. Then\nr\u2032 \u25e6 r\u2032 is one of (pmo), (ps), (pms), and (pmos). We can also assume that no relation satisfying the\ncondition of Case 1 is contained in S. This implies that rp is a minimal relation in S.\n23\nSubcase 2.1. r\u2032 \u25e6 r\u2032 = (pmo).\nWe have rp = (po) or rp = (pmo). In both cases, every r \u2208 S such that r \u2229 (pmo) 6= \u2205 satisfies\n(p) \u2286 r because, as shown above, (mo) 6\u2208 S.\nSuppose that S contains a non-trivial relation r1 such that r1 \u2286 (\u2261 dd\u22121ss\u22121ff\u22121). Define r2 to\nbe (pmo)\u25e6r1 if r1 6\u2286 (\u2261 sf\u22121), and (pmo)\u25e6r\u221211 otherwise. Then it can be easily checked that either\nr\u22172 = (dd\n\u22121) or else r2 (or r\u221212 ) satisfies the conditions of Lemma 32 or Lemma 33. If (dd\n\u22121) \u2208 S\nthen {(pmo), (dd\u22121)} \u2286 S, so S is NP-complete by Lemma 31(2). We may assume now that every\nnon-trivial r \u2208 S satisfies r \u2229 (pp\u22121mm\u22121oo\u22121) 6= \u2205 and, consequently, r \u2229 (pp\u22121) 6= \u2205.\nArbitrarily choose r \u2208 S. If r is such that r\u2217 is neither \u2205 nor (\u2261), then (pp\u22121) \u2286 r. Assume\nthat r\u2217 = \u2205, that is, r is asymmetric. The required result follows from the previous lemmas if\nr 6\u2286 (pmos)\u00b11 and r 6\u2286 (pmof\u22121)\u00b11. So we can assume that every asymmetric r \u2208 S satisfies\n(p) \u2286 r \u2286 (pmosf\u22121) or (p) \u2286 r\u22121 \u2286 (pmosf\u22121).\nSuppose now that r\u2217 = (\u2261); then r \u2229 (pp\u22121mm\u22121oo\u22121) is contained either in (pmo) or in\n(p\u22121m\u22121o\u22121). Without loss of generality, assume that r \u2229 (pp\u22121mm\u22121oo\u22121) \u2286 (pmo). Then\nconsider the relation r3 = (pmo) \u25e6 r. If r 6\u2286 (\u2261 pmosf\u22121) then either r\u22173 = (dd\u22121) (and then\nS is NP complete by Lemma 31(2)) or r3 is one of the relations satisfying the conditions of\nLemma 32 (and then S is contained in one of the 18 maximal tractable subalgebras). Now let\nr \u2286 (\u2261 pmosf\u22121). By our assumption, S contains no non-trivial subrelation of (\u2261 sf\u22121) which\nimplies that (p) \u2286 r unless r = (\u2261).\nWe conclude that S is contained in Sp or in Ep.\nSubcase 2.2. r\u2032 \u25e6 r\u2032 = (ps).\nWe have r\u2032 = rp = (ps) so every r \u2208 S such that r \u2229 (ps) 6= \u2205 satisfies (p) \u2286 r. Suppose that S\ncontains a non-trivial relation r4 such that r4 \u2286 (\u2261 mm\u22121oo\u22121dd\u22121ff\u22121) and r4 6\u2286 (\u2261 ff\u22121) Then\nit can verified that the relation r5 = (r\u2032 \u25e6 r4) \u2229 r4 is non-empty and (\u2261) 6\u2286 r5. Therefore, we can\nassume that (\u2261) 6\u2286 r4. This leads to a contradiction in view of (r4 \u25e6 r\u2032) \u2229 r\u2032 = (p). The case\nr4 = (ff\u22121) is impossible because ((ps) \u25e6 (ff\u22121))\u2229 (ps) = (p). Finally, if r4 is (\u2261 ff\u22121) or (\u2261 f) then\n(ps) \u25e6 r4 = (pmods), and we can apply Lemma 32.\nWe may therefore assume that, for non-trivial every r \u2208 S, r \u2229 (pp\u22121ss\u22121) 6= \u2205 and, conse-\nquently, r \u2229 (pp\u22121) 6= \u2205.\nArbitrarily choose a non-trivial r \u2208 S. If r is such that r\u2217 is neither \u2205 nor (\u2261), then (pp\u22121) \u2286 r.\nSuppose that r\u2217 = \u2205. If r 6\u2286 (pmos)\u00b11 and r 6\u2286 (pmof\u22121)\u00b11, then we get the required result by\nprevious lemmas so we can assume that every asymmetric r \u2208 S satisfies (p) \u2286 r \u2286 (pmosf\u22121) or\n(p) \u2286 r\u22121 \u2286 (pmosf\u22121).\nIf r\u2217 = (\u2261) then r \u2229 (pp\u22121ss\u22121) is either (ps) or (p\u22121s\u22121). Without loss of generality, assume\nthat r \u2229 (pp\u22121ss\u22121) = (ps). Consider the relation r6 = (ps) \u25e6 r. If r \u2229 (m\u22121o\u22121) 6= \u2205 or (d\u22121f) \u2286 r\nthen r\u22176 is a non-trivial subrelation of (mm\n\u22121oo\u22121dd\u22121ff\u22121) which contradicts our assumptions.\nTherefore, either r \u2286 (\u2261 pmodsf), or r \u2286 (\u2261 pmodsf\u22121), or r \u2286 (\u2261 pmod\u22121sf\u22121). Moreover,\nall r \u2208 S such that r \u2229 (pp\u22121ss\u22121) = (ps) have to satisfy one (and the same) of these three\nconditions, since otherwise it is easy to generate a non-empty subrelation of (df) which would lead\nto a contradiction with our assumptions. We conclude that S is contained in Sp or in Ep.\nSubcase 2.3. r\u2032 \u25e6 r\u2032 = (pms) or r\u2032 \u25e6 r\u2032 = (pmos).\nSimilar to previous subcases. 2\n6.2 Symmetric relations\nTo conclude the proof of Theorem 1, in this subsection we prove the following proposition.\nProposition 6 Let S be a subalgebra of A such that bas(S) = {\u2261}, which contains a symmetric\nrelation r\u2032 such that (\u2261) 6\u2286 r\u2032. Then S is tractable if it is contained in one of the 18 algebras listed\nin Table 3. Otherwise S is NP-complete\nTo obtain this result we shall assume throughout this subsection that S is a subalgebra of A\nsatisfying the following assumptions:\n24\nAssumption 1 bas(S) = {\u2261}.\nAssumption 2 S is not NP-complete.\nAssumption 3 r\u2032 \u2208 S is a minimal symmetric relation such that (\u2261) 6\u2286 r\u2032.\nWe show that the result holds for all possible choices of r\u2032 in Lemmas 40\u201341. These lemmas rely\non the following NP-completeness results.\nProposition 7 If r, s are symmetric relations such that r \u2229 s = \u2205, both r and s are contained in\nneither (\u2261 ss\u22121) nor (\u2261 ff\u22121), then {r, s} is NP-complete.\nThe proof of this proposition can be found in Subsection A.3.\nLemma 38 The following sets of relations are NP-complete:\n1) {(mm\u22121)}; and\n2) {r, (ss\u22121), (ff\u22121)} when r \u2208 {(oo\u22121), (dd\u22121)}.\nProof. 1) We note that the set {(mm\u22121), (pp\u22121ss\u22121ff\u22121)} has been shown NP-complete in [15].\nLet r1 = (mm\u22121) \u25e6 (mm\u22121) = (\u2261 pp\u22121ss\u22121ff\u22121)} and r2 = (mm\u22121) \u25e6 r1 = > \\ (\u2261). Thus,\n(pp\u22121ss\u22121ff\u22121) = r1 \u2229 r2.\n2) Let r = (dd\u22121) and consider the following set of constraints:\na(dd\u22121)b, x(ss\u22121)a, x(ff\u22121)b, y(ff\u22121)a, y(ss\u22121)b.\nThe derived relation between x and y is (oo\u22121) and NP-completeness of {(oo\u22121), (dd\u22121)} follows\nfrom Proposition 7.\nThe case when r = (oo\u22121) is similar: a(dd\u22121)b is replaced by a(oo\u22121)b, the derived relation is\nthen (dd\u22121), and again we have NP-completeness by Proposition 7. 2\nLemma 39 With the assumptions above, if S contains (\u2261 ss\u22121), (\u2261 ff\u22121), and a non-trivial\nrelation r1 such that r1 \u2229 (\u2261 ss\u22121ff\u22121) = \u2205 then S is contained in one of the 18 maximal tractable\nsubalgebras.\nProof. Choose r1 to be minimal. If r1 = (mm\u22121) then S is NP-complete by Lemma 38(1).\nHence we shall assume that r1 6= (mm\u22121).\nWe have (\u2261 ss\u22121) \u25e6 (\u2261 ff\u22121) = (\u2261 pmoo\u22121dd\u22121ss\u22121ff\u22121) \u2208 S. Then either r1 is asymmetric or\nr1 = r\u22171 \u2286 (oo\u22121dd\u22121). In the former case, we get the required result by Proposition 4, so we shall\nassume that r1 is symmetric.\nIf r1 = (oo\u22121) or r1 = (dd\u22121), thn (ss\u22121) = (\u2261 ss\u22121)\u2229(r1 \u25e6(\u2261 ff\u22121)) \u2208 S. Similarly, (ff\u22121) \u2208 S.\nHence, S is NP-complete by Lemma 38(2), which contradicts Assumption 2.\nIt follows that r1 = (oo\u22121dd\u22121). Since r1 is minimal, we have (oo\u22121dd\u22121) \u2286 r for every r \u2208 S\nsuch that (oo\u22121dd\u22121) \u2229 r 6= \u2205. Further, we have\n(pmoo\u22121dd\u22121) = ((r1 \u25e6 (\u2261 ff\u22121)) \u2229 ((\u2261 ss\u22121) \u25e6 r1)) \u2208 S.\nIn view of (pm) \u25e6 (pm) = (p), no non-empty subrelation of (pm) can belong to S. This implies\nthat (oo\u22121dd\u22121) \u2286 r for every r \u2208 S such that (pmoo\u22121dd\u22121) \u2229 r 6= \u2205. Further, neither (sf) nor\n(sf\u22121) can belong to S because they give (s) being intersected with (\u2261 ss\u22121) \u2208 S. If (\u2261 sf) \u2208 S or\n(\u2261 sf\u22121) \u2208 S then we can obtain (\u2261 s) and (\u2261 f), and, further, (\u2261 dsf). However, this contradicts\nthe fact that every relation containing (d) must also contain (oo\u22121dd\u22121). Now it is straightforward\nto check that S \u2286 H. 2\nBy examining the composition table given in Table 2, it is easy to verify that (\u2261) \u2286 r1 \u25e6 r2 if\nand only if there exists a non-trivial basic relation b such that (b) \u2286 r1 and (b\u22121) \u2286 r2. In the\nnext two lemmas, we shall make use of this fact.\n25\nLemma 40 With the assumptions above, if r\u2032 6\u2286 (ss\u22121ff\u22121), then S is contained in one of the 18\nmaximal tractable subalgebras.\nProof. Wemay assume that r\u2032 6\u2286 (pp\u22121mm\u22121); otherwise the result follows from Proposition 2(3).\nBy the minimality of r\u2032, for every non-trivial relation r1 in S we have r\u2032 \u2229 r1 = r\u2032 or empty.\nObviously, if every non-trivial relation in S contains r\u2032 then S is contained in one of the 18 maximal\ntractable subalgebras. Hence we shall assume that S contains a non-trivial relation r1 such that\nr\u2032 \u2229 r1 = \u2205.\nCase 1. r1 is asymmetric.\nApply Proposition 4.\nCase 2. r1 is symmetric.\nIt follows from Proposition 7 that if r1 6\u2286 (\u2261 ss\u22121) and r1 6\u2286 (\u2261 ff\u22121) then S is NP-complete,\nwhich contradicts Assumption 2. We shall consider the case r1 \u2286 (\u2261 ss\u22121); the second case is\ndual.\nNote that we have r\u2032 \u2229 (\u2261 ss\u22121) = \u2205. Also, r\u2032 6= (mm\u22121ff\u22121), since otherwise r\u2032 \u2229 (r\u2032 \u25e6 (\u2261\nss\u22121)) = (mm\u22121f) \u2208 S, which contradicts the minimality of r\u2032. Hence, r\u2032 contains (bb\u22121) where b\nis one of p, o, and d.\nWe have r1 \u25e6 r\u221211 = (\u2261 ss\u22121) \u2208 S. Let r2 = r\u2032 \u25e6 (\u2261 ss\u22121). Obviously, r\u2032 \u2286 r2. Moreover, it can\nbe easily checked by examining Table 2 that r2\u2229 (\u2261 ss\u22121) = \u2205 and that, for every basic relation b1\nsuch that b1 6\u2208 {\u2261, s, s\u22121}, at least one of (b1) and (b\u221211 ) is contained in r2. If (bb\u22121) \u2286 r for every\nr \u2208 S such that r 6\u2286 (\u2261 ss\u22121) then S is contained in one of Sp, So, and Sd. Otherwise S contains a\nnon-empty relation r3 such that r3 6\u2286 (\u2261 ss\u22121) and r3\u2229r\u2032 = \u2205 (because r\u2032 is minimal). Then r3\u2229r2\nor r3 \u2229 r\u221212 is non-empty. Denote this non-empty relation by r4. Then we have r4 \u2229 (\u2261 ss\u22121) = \u2205\nand r4 \u2229 r\u2032 = \u2205. Consider a minimal relation r5 contained in r4. This minimal relation must\nbe either symmetric or asymmetric. Therefore, unless r5 = (ff\u22121), we get the required result by\nProposition 7 or 4, respectively. If r5 = (ff\u22121) then r5\u25e6r5 = (\u2261 ff\u22121) \u2208 S and r\u2032\u2229(\u2261 ss\u22121ff\u22121) = \u2205,\nand we can apply Lemma 39.\nCase 3. r1 is neither symmetric nor asymmetric.\nWe may assume that r1 is minimal. Then, by minimality, we have r\u22171 = (\u2261). Since r\u2032 is symmetric\nand r\u2032 \u2229 r1 = \u2205, we obtain that (\u2261) 6\u2286 r\u2032 \u25e6 r1 and that (\u2261) 6\u2286 r\u2032 \u25e6 r\u221211 . It follows that if one of\nr\u2032 \u25e6 r1 and r\u2032 \u25e6 r\u221211 has a non-empty intersection with r1 or with r\u221211 then we get a contradiction\nwith minimality of r1.\nNow it can be checked that we indeed get this contradiction except when r1 (or r\u221211 ) is one\nof the relations (\u2261 m), (\u2261 s), and (\u2261 f). If r1 = (\u2261 m) then r6 = (\u2261 pm) = r1 \u25e6 r1 \u2208 S,\nand arguing as in the previous paragraph we can obtain a non-empty subrelation r7 of pm which\nleads to a contradiction because r7 \u25e6 r7 = (p). If r1 = (\u2261 s) then r\u2032 \u2229 (\u2261 ss\u22121) = \u2205. Further\n(\u2261 ss\u22121) = r1 \u25e6 r\u221211 \u2208 S, and Case 2 applies. If r1 = (\u2261 f) then the argument is dual. 2\nLemma 41 With the assumptions above, if r\u2032 \u2286 (ss\u22121ff\u22121), then S is contained in one of the 18\nmaximal tractable subalgebras.\nProof. Case 1. r\u2032 = (ss\u22121ff\u22121).\nWe have (ss\u22121ff\u22121) \u2286 r for every r \u2208 S such that r \u2229 (ss\u22121ff\u22121) 6= \u2205. If every non-trivial r \u2208 S\nsatisfies (ss\u22121ff\u22121) \u2286 r then S \u2286 A1. Suppose that S has a non-trivial relation r1 such that\nr1 \u2229 (ss\u22121ff\u22121) = \u2205. Then consider the relation r2 = r1 \u2229 (r1 \u25e6 (ss\u22121ff\u22121)). It is easy to check that\nr2 is a non-empty subrelation of r1 and that (\u2261) 6\u2286 r2 (in fact, r2 = r1 \\ (\u2261)). The relation r2\ncontains some minimal relation that must be either symmetric or asymmetric. Now we obtain the\nrequired result by Lemma 40 or Proposition 4.\nCase 2. Both (ss\u22121) and (ff\u22121) belong to S.\nWe have (oo\u22121dd\u22121) = ((ss\u22121) \u25e6 (ff\u22121))\u2217 \u2208 S. Furthermore, (ss\u22121) \u25e6 (ss\u22121) = (\u2261 ss\u22121) and\n(ff\u22121) \u25e6 (ff\u22121) = (\u2261 ff\u22121) both belong to S, and the result follows from Lemma 39.\nCase 3. Exactly one of (ss\u22121) and (ff\u22121) belongs to S.\nAssume that (ss\u22121) \u2208 S and (ff\u22121) 6\u2208 S, the second case is dual.\n26\nIf (ss\u22121) is the only minimal relation in S then every non-trivial relation in S contains (ss\u22121),\nand we have S \u2286 A1. Suppose that there exists a minimal relation r3 \u2208 S such that r3\u2229(ss\u22121) = \u2205.\nThen we may assume that (\u2261) \u2286 r3; otherwise we get the required result by Proposition 4 or by\nLemma 40. Let r4 = r3 \u25e6 (ss\u22121). We have (\u2261) 6\u2286 r4.\nIt is easy to verify that if r3 6\u2286 (\u2261 ff\u22121) then, for every basic relation b1 such that b1 6\u2208 {\u2261\n, s, s\u22121, f, f\u22121} and (b1) \u2286 r3, at least one of (b1) and (b\u221211 ) is contained in r4. This leads to a\ncontradiction with minimality of r3.\nIf r3 \u2286 (\u2261 ff\u22121) then every r \u2208 S such that r \u2229 (ff\u22121) 6= \u2205 also satisfies (\u2261) \u2286 r. Further\non, we have (\u2261 ff\u22121) = r3 \u25e6 r\u221213 \u2208 S and (pmoo\u22121dd\u22121ss\u22121) = (ss\u22121) \u25e6 (\u2261 ff\u22121) \u2208 S. If some\nnon-empty subrelation of (pmoo\u22121dd\u22121) belongs to S then we get the required result by Lemma 40\nor Proposition 4. Else, every r \u2208 S such that r \u2229 (pmoo\u22121dd\u22121) 6= \u2205 also satisfies (ss\u22121) \u2286 r, and\nwe have S \u2286 E\u2217. 2\n7 Conclusion\nWe have now completed the classification of complexity in Allen\u2019s algebra and shown that there\nexist exactly eighteen forms of tractability in this algebra. We did this by applying a technique\nfrom general algebra which has not been previously used in this context.\nBoth the result and the method can be used to classify the complexity in other temporal and\nspatial formalisms; a first application is given in Section 3. There are also strong connections with\nthe analysis of complexity in temporal logics ([6]) which deserve further investigation.\nIt has already been established that the maximal tractable subalgebra, H, can be used to speed\nup backtracking algorithms [39]. We believe that the complete description of tractability in Allen\u2019s\nalgebra which is presented here may lead to new methods in approximate temporal reasoning, as\none can uniquely loosen, in a minimal way, any set of interval constraints to obtain an instance of\na given tractable case.\nIn this paper, we considered the problem of satisfiability of temporal constraints. However,\nthere are other important tasks in temporal (and spatial) reasoning, for example, the task of\nanswering queries in different types of constraint networks (see, e.g., [32]). The method and the\nresults presented in this paper can contribute to further progress in tackling such tasks.\nFinally, we note that many other constraint formalisms (not just temporal ones) are based on\nmanipulating objects with intrinsic structural properties which can be captured by an appropriate\nalgebra. This prompts us to conjecture that algebraic approaches to constraint manipulation, such\nas the one taken in this paper, or those presented in [8, 9], provide the appropriate reasoning tools\nacross many different areas of constraint reasoning and artificial intelligence.\nAcknowledgements\nThe research is partially supported by the UK EPSRC under grants GR\/R22704 and GR\/R29598,\nand the Swedish Research Council for Engineering Sciences (TFR) under grants 97-301 and 2000-\n361.\nThe authors are grateful to Andrei Bulatov for many helpful comments on an earlier version\nof the paper.\nA Appendix\nThis appendix contains the proofs of Propositions 5 and 7. In the sequel, we will make frequent\n(but implicit) use of Proposition 3 in the following way. With the help of Lemma 30, it is easy to\ncheck that the relations r mentioned in Proposition 5 and pairs of relations {r, s} mentioned in\nProposition 7 are not contained in one of the 18 tractable subalgebras in Table 3. Therefore, we\n27\nconclude that {r} or {r, s} is NP-complete whenever we can derive, from this set, either a non-\ntrivial basic relation or some set of relations whose NP-completeness was shown before. Recall\nthat derivation is introduced in Section 4. B. Nebel\u2019s CSP solver [38] can considerably simplify\ncalculating the derivations. Recall also that if a relation can be obtained from a given set by\nseveral derivations then it can be obtained by using a single derivation.\nA.1 Model Transformations\nThis subsection contains the basics of model transformations which is a method for proving NP-\ncompleteness results. It is based on transforming a solution of one problem to a solution of a\nrelated problem. This method will be used many times in the proofs of Propositions 5 and 7.\nSuppose T is a mapping on models of A-sat-instances with the same set of variables and let\nfT be a function from the set of all basic relations to A such that the following holds: for any\nmodel f of an A-sat-instance over a set V of variables, for any x, y \u2208 V , and for any basic relation\nb, if f(x) is related to f(y) by (b) then T (f(x)) is related to T (f(y)) by fT (b). Then we say that\nT is a model transformation with description fT . A description fT can be extended to handle all\nrelations r \u2208 A in the obvious way: fT (r) =\n\u22c3\nb\u2208r fT (b).\nThe following lemma gives us a way of proving NP-completeness by using model transforma-\ntions.\nLemma 42 Let R = {r1, . . . , rn} \u2286 A and R\u2032 = {r\u20321, . . . , r\u2032n} \u2286 A be such that r\u2032k \u2286 rk for all\n1 \u2264 k \u2264 n. If there exists a model transformation T with description fT such that fT (rk) \u2286 r\u2032k for\nevery 1 \u2264 k \u2264 n, then R is NP-complete if and only if R\u2032 is NP-complete.\nProof. The proof of the only-if direction can be found in [15] and the proof of the other direction\nis analogous. 2\nLet S be a finite set of real numbers. The minimal distance in S, MD(S), is defined as\nMD(S) = min{x\u2212 y | x, y \u2208 S \u2227 x > y}.\nFor a model f of an A-sat-instance over a set V of variables, we define\nMD(f) = MD({f(x\u2212), f(x+) | x \u2208 V }),\nwhere f(x\u2212) and f(x+) denote the starting and the ending point of the interval f(x), as in\nSection 3.\nWe continue by defining a number of model transformations. We shall use them with fixed\ndescriptions which can be found in Table 4. We define the model transformation shrink as follows.\nLet f be a model of anA-sat-instance over {x1, . . . , xn} and let \u00b2 = MD(f)\/3. Then shrink(f) = f \u2032\nwhere, for 1 \u2264 i \u2264 n,\nf \u2032(xi) = [f(x\u2212i ) + \u00b2, f(x\n+\ni )\u2212 \u00b2].\nWe can analogously define a model transformation expand by subtracting \u00b2 from f(x\u2212) and adding\n\u00b2 to f(x+).\nBy ordering the intervals with respect to their length, we can obtain a number of useful model\ntransformations. We define the model transformation ordshrink as follows. Let f be a model\nof an A-sat-instance over {x1, . . . , xn}, let \u00b2 = MD(f)\/(2n) and rename the variables so that\n|f(x1)| \u2265 . . . \u2265 |f(xn)|. Then ordshrink(f) = f \u2032 where, for 1 \u2264 i \u2264 n,\nf \u2032(xi) = [f(x\u2212i ) + i\u00b2, f(x\n+\ni )\u2212 i\u00b2].\nWe analogously define a model transformation ordexpand.\n28\n\u2261 p p\u22121 m m\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\nshrink \u2261 p p\u22121 p p\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\nexpand \u2261 p p\u22121 o o\u22121 o o\u22121 d d\u22121 s s\u22121 f f\u22121\nordshrink dd\u22121 p p\u22121 p p\u22121 o o\u22121 d d\u22121 d d\u22121 d d\u22121\nordexpand dd\u22121 p p\u22121 o o\u22121 o o\u22121 d d\u22121 o o\u22121 o\u22121 o\nleftordshrink ff\u22121 p p\u22121 p p\u22121 o o\u22121 d d\u22121 o o\u22121 f f\u22121\nleftordexpand ff\u22121 p p\u22121 o o\u22121 o o\u22121 d d\u22121 d d\u22121 f f\u22121\nTable 4: Model transformations.\nWe will also use model transformations that only change one of the endpoints of an interval.\nWe define the model transformation leftordshrink as follows. Let f be a model of an A-sat-instance\nover {x1, . . . , xn}, let \u00b2 = MD(f)\/(n+1) and rename the variables so that |f(x1)| \u2264 . . . \u2264 |f(xn)|.\nThen leftordshrink(f) = f \u2032, where, for 1 \u2264 i \u2264 n,\nf \u2032(xi) = [f(x\u2212i ) + i\u00b2, f(x\n+\ni )].\nA.2 Proof of Proposition 5\nWe will now show that if r is asymmetric, but not acyclic, then {r} is NP-complete. The proof is\nlargely based on the use of different derivations. Let C9(r) denote the relation (between x and y)\nderived from the following set of constraints:\uf8f1\uf8f4\uf8f2\uf8f4\uf8f3\nxra1 a1ra2 a1ry\nxra2 a2ra3 a2ry\nxra3 a3ra1 a3ry\n\uf8fc\uf8f4\uf8fd\uf8f4\uf8fe\nC9b(r) is the relation derived from the same set of constraints but with xra2 replaced by xr\u22121a2\nand a2ry replaced by a2r\u22121y. Finally, C14(r) denotes the relation derived from\uf8f1\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f2\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f3\nxr\u22121a1 a1r\u22121a2 a1ry\nxr\u22121a2 a1ra3 a2r\u22121y\nxr\u22121a3 a1r\u22121a4 a3r\u22121y\nxra4 a2r\n\u22121a3 a4r\u22121y\na2ra4\na3r\n\u22121a4\n\uf8fc\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8fd\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8fe\nBefore the proof, we need one auxiliary lemma.\nLemma 43 {(pp\u22121dd\u22121), (oo\u22121)} is NP-complete.\nProof. Let G1 = (V1, E1) and G2 = (V2, E2) be two graphs such that V1 = V2 and E1 \u2286 E2; in\nthis case, we say that G2 is a supergraph of G1. The Graph Sandwich Problem for Property\n\u03a0 is defined as follows:\nInstance: Two graphs, G1 = (V,E1) and G2 = (V,E2), such that G2 is a supergraph of G2.\nQuestion: Is there a graph G = (V,E) such that E1 \u2286 E \u2286 E2 and (V,E) has property \u03a0?\n29\nTwo intervals overlap5 if their intersection is non-empty but neither one of them properly contains\nthe other. An overlap graph (also known as a circle graph [17]) is an undirected graph G = (V,E)\nfor which there is an assignment of an interval to each vertex such that two vertices are adjacent\niff the corresponding intervals overlap. The graph sandwich problem for overlap graphs (SP-\nOverlap) is NP-complete [20]. Clearly, this problem can be transformed to the satisfiability\nproblem for {(\u2261 mm\u22121oo\u22121), (pp\u22121dd\u22121ss\u22121ff\u22121)}: given an instance G1 = (V,E1), G2 = (V,E2)\nof SP-Overlap, construct an instance as follows:\n1. for each node v \u2208 V , introduce a variable v;\n2. for each (v, w) \u2208 E1, add the constraint v(\u2261 mm\u22121oo\u22121)w; and\n3. for each (v, w) 6\u2208 E2, add the constraint v(pp\u22121dd\u22121ss\u22121ff\u22121)w.\nIt is easy to see that the resulting instance has a model if and only if the given instance of\nSP-Overlap has a solution. Thus, S = {(\u2261 mm\u22121oo\u22121), (pp\u22121dd\u22121ss\u22121ff\u22121)} is NP-complete.\nBy applying Lemma 42 to S and the model transformation expand, we get that S\u2032 = {(\u2261\noo\u22121), (pp\u22121dd\u22121ss\u22121ff\u22121)} is NP-complete.\nNow define the model transformation T1 as follows: T1(f) = f \u2032, where f \u2032 is obtained from f\nby first setting \u00b2 = MD(f)\/((n+ 1) \u00b7 c) where c = max{|f(xi)| ; 1 \u2264 i \u2264 n} and defining\nf \u2032(xi) = [f(x\u2212i )\u2212 |f(xi)| \u00b7 \u00b2, f(x+i ) + |f(xi)| \u00b7 \u00b2].\nThen, T1 has the description fT1 with the following properties: fT1(\u2261) = (\u2261), fT1(mm\u22121) =\n(pp\u22121oo\u22121), fT1(ss\n\u22121) = fT1(ff\n\u22121) = (dd\u22121) and fT1(b) = b for b \u2208 {p, p\u22121, o, o\u22121, d, d\u22121}. By\napplying Lemma 42 to this transformation and S\u2032, we see that S\u2032\u2032 = {(\u2261 oo\u22121), (pp\u22121dd\u22121)} is\nNP-complete. Note that we cannot replace T1 with the very similar ordexpand transformation\nsince ordexpand changes the (\u2261) relation.\nFinally, define the model transformation T2 as follows: T2(f) = f \u2032, where f \u2032 is obtained from\nf by first setting \u00b2 = MD(f)\/(n+ 1) and defining\nf \u2032(xi) = [f(x\u2212i ) + i\u00b2, f(x\n+\ni ) + i\u00b2].\nIt is easy to see that T2 has the description fT2 with the following properties: fT2(\u2261) = (oo\u22121),\nfT2(mm\n\u22121) = (pp\u22121oo\u22121), fT2(ss\n\u22121) = fT2(ff\n\u22121) = (oo\u22121dd\u22121) and fT2(b) = b for b \u2208\n{p, p\u22121, o, o\u22121, d, d\u22121}. By applying Lemma 42 to this transformation and S\u2032\u2032, we have shown\nthat {(oo\u22121), (pp\u22121dd\u22121)} is NP-complete. 2\nProof. (of Proposition 5) It is clear that sets {r} and {r\u22121} are NP-complete simultaneously, so\nit suffices to consider only one of them.\nWe assume first that r \u2229 (p\u22121m\u22121o\u22121) = \u2205. If r \u2229 (pmo) = \u2205, then it follows from Lemma 30\nthat r or r\u22121 equals (ds\u22121f\u22121); however, C9((ds\u22121f\u22121)) = (d). Assume now that r \u2229 (pmo) 6= \u2205.\nBy using Lemma 30 once again, one of the following holds:\n1. (ds\u22121) \u2286 r;\n2. (d\u22121f) \u2286 r; or\n3. (s\u22121f) \u2286 r.\nCase 1: (ds\u22121) \u2286 r.\nIf r 6\u2208 {(mds\u22121), (mds\u22121f), (mds\u22121f\u22121)}, then C9(r) = (pmods) and C9(r) \u2229 r\u22121 = (s). If r =\n(mds\u22121f) or r = (mds\u22121f\u22121), then C9(r) = (d) or (pd), respectively, and C9(r)\u2229r = (d). Finally, if\n5Note that this notion is different from the notion \u201cOne interval overlaps another one\u201d used in definition of the\nbasic relation o.\n30\nr = (mds\u22121), then ((m\u22121d\u22121s) \u25e6 (mds\u22121))\u2229 (mds\u22121) = (ds\u22121) and ((ds\u22121) \u25e6 (ds\u22121))\u2229 (m\u22121d\u22121s) =\n(m\u22121).\nCase 2: (d\u22121f) \u2286 r.\nDual to case 1.\nCase 3: (s\u22121f) \u2286 r.\nWe can assume that (dd\u22121) \u2229 r = \u2205 since one of the previous two cases applies otherwise. If\nr 6= (ms\u22121f), then one of the following holds:\n1. (o) 6\u2286 r. This implies that C9(r) = (p) and NP-completeness follows immediately.\n2. (o) \u2286 r. Then, C9(r) = (pmo), (pmo) \u25e6 r = (pmodd\u22121sf\u22121) and we can obtain the relation\n(dd\u22121). Let R = (d), R1 = (pmo), R2 = (dd\u22121) and NP-completeness of {r} follows from\nLemma 1.\nFinally, if r = (ms\u22121f), then consider the following set of constraints:\uf8f1\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f2\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f3\nxra1\na1ra2\na2rx\nyra1\nyra2\n\uf8fc\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8fd\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8fe\nThe relation between x and y derived from these constraints is (pp\u22121dd\u22121). Next, the relation\n(oo\u22121) is derived from the following set of constraints:\uf8f1\uf8f4\uf8f2\uf8f4\uf8f3\nxra1 a1r1a2 a1ry\nxr1a2 a2r1a3 a2r1y\nxra3 a3r1a1 a3ry\n\uf8fc\uf8f4\uf8fd\uf8f4\uf8fe\nConsequently, NP-completeness of {(ms\u22121f)} follows from Lemma 43.\nFinally, we consider the case when r \u2229 (pmo) 6= \u2205 and r \u2229 (p\u22121m\u22121o\u22121) 6= \u2205; then Lemma 30\nimplies that r is not acyclic. The proof considers four cases depending on the value of r \u2229\n(pp\u22121oo\u22121mm\u22121). For every r1 \u2208 A, let r21 denote the relation r1 \u25e6 r1. Recall, that > denotes the\nunion of all basic relations.\nIn the following, Lemma 2 significantly reduces the number of cases to be considered. For\ninstance, by showing that {(mo\u22121ds)} is NP-complete, we also know that {(m\u22121odf)} is NP-\ncomplete.\nCase 1: r \u2229 (pp\u22121oo\u22121mm\u22121) \u2208 {(po\u22121), (pmo\u22121), (pm\u22121o\u22121)}.\nSuppose first that r = r\u2032 \u222a (po\u22121).\n31\nr\u2032 C9(r) NP-completeness of {r}\n\u2205 (p) C9(r) = (p)\n(d) (pmods) C9(r) \u2229 r\u22121 = (o)\n(s) (pds) C9(r)2 \u2229 r\u22121 = (o)\n(s\u22121) (p) C9(r) = (p)\n(ds) (pmods) C9(r) \u2229 r\u22121 = (o)\n(ds\u22121) (pmods) (C9(r) \u2229 r\u22121)2 \u2229 r = (p)\n(df) (pmods) C9(r) \u2229 r\u22121 = (o)\n(df\u22121) C14(r)\u2217 \u2229 r = (o\u22121df\u22121)\n(sf) (pds) C9(r)2 \u2229 r\u22121 = (o)\n(sf\u22121) > \\ (\u2261 s\u22121f) C9(r)\u2217 \u2229 r = (po\u22121)\n(s\u22121f) (p) C9(r) = (p)\n(dsf) (pmods) C9(r) \u2229 r\u22121 = (o)\n(dsf\u22121) > \\ (\u2261 s\u22121) C9(r)\u2217 \u2229 r = (po\u22121df\u22121)\n(ds\u22121f) (pmods) (C9(r) \u2229 r\u22121)2 \u2229 r = (p)\n(ds\u22121f\u22121) > \\ (\u2261 s\u22121) C9(r) \u2229 r = (po\u22121df\u22121)\nNote that, in the table above, if r\u2032 = (df\u22121), that is, if r = (po\u22121df\u22121) then C14(r) = >\\(\u2261 s\u22121),\nand we can obtain (o\u22121df\u22121) as shown in the table; NP-completeness of (o\u22121df\u22121) follows from\nLemma 21 by using Lemma 2. If r \u2229 (pp\u22121mm\u22121oo\u22121) is (pmo\u22121) or (pm\u22121o\u22121), then NP-\ncompleteness of {r} follows from the proof above by using Lemma 42 with model transformations\nshrink and expand, respectively.\nCase 2: r \u2229 (pp\u22121oo\u22121mm\u22121) = (pm\u22121). Let r = r\u2032 \u222a (pm\u22121).\nr\u2032 C9(r) NP-completeness of {r}\n\u2205 (p) C9(r) = (p)\n(d) (pmods) C9(r) \u2229 r\u22121 = (m)\n(s) (p) C9(r) = (p)\n(s\u22121) (p) C9(r) = (p)\n(ds) (pmods) C9(r) \u2229 r\u22121 = (m)\n(ds\u22121) (pmods) C9(r) \u2229 r\u22121 = (ms)\n(df) (pmods) C9(r) \u2229 r\u22121 = (m)\n(df\u22121) (pmods) C9(r) \u2229 r\u22121 = (m)\n(sf) (pds) C9(r)2 \u2229 r\u22121 = (m)\n(sf\u22121) (pmo) C9(r) \u2229 r\u22121 = (m)\n(s\u22121f) (p) C9(r) = (p)\n(dsf) (pmods) C9(r) \u2229 r\u22121 = (m)\n(dsf\u22121) (pmods) C9(r) \u2229 r\u22121 = (m)\n(ds\u22121f) (pmods) C9(r) \u2229 r\u22121 = (ms)\n(ds\u22121f\u22121) (pp\u22121modd\u22121sf\u22121) C9(r) \u2229 r\u22121 = (p\u22121md\u22121s)\nThe relation (ms) generates (s) since ((m\u22121s\u22121) \u25e6 (ms)) \u2229 (ms) = (s).\nCase 3: r \u2229 (pp\u22121oo\u22121mm\u22121) = (pm\u22121o). Let r = r\u2032 \u222a (pm\u22121o).\n32\nr\u2032 C9(r) NP-completeness of {r}\n\u2205 (p) C9(r) = (p)\n(d) (pmods) C9(r) \u2229 r\u22121 = (m)\n(s) (p) C9(r) = (p)\n(s\u22121) (pmo) C9(r) \u2229 r\u22121 = (m)\n(ds) (pmods) C9(r) \u2229 r\u22121 = (m)\n(ds\u22121) (pp\u22121moo\u22121dd\u22121s) (C9(r) \u2229 r)2 \u2229 r\u22121 = (ms)\n(df) (pmods) C9(r) \u2229 r\u22121 = (m)\n(df\u22121) (pmods) C9(r) \u2229 r\u22121 = (m)\n(sf) (pmods) C9(r) \u2229 r\u22121 = (m)\n(sf\u22121) (pmo) C9(r) \u2229 r\u22121 = (m)\n(s\u22121f) (pp\u22121moo\u22121dd\u22121) C9(r) \u2229 r\u22121 = (p\u22121mo\u22121)\n(dsf) (pmods) C9(r) \u2229 r\u22121 = (m)\n(dsf\u22121) (pmods) C9(r) \u2229 r\u22121 = (m)\n(ds\u22121f) (pp\u22121moo\u22121dd\u22121sf) C9(r) \u2229 r\u22121 = (p\u22121mo\u22121d\u22121s)\n(ds\u22121f\u22121) (pp\u22121moo\u22121dd\u22121sf\u22121) C9(r) \u2229 r\u22121 = (p\u22121mo\u22121d\u22121s)\nCase 4: r \u2229 (pp\u22121oo\u22121mm\u22121) = (mo\u22121). Let r = r\u2032 \u222a (mo\u22121).\nr\u2032 C9(r) NP-completeness of {r}\n\u2205 \u2205 r2 \u2229 r = (o\u22121)\n(d) \u2205 (r2 \u2229 r)2 \u2229 r\u22121 = (m\u22121)\n(s) \u2205 r2 \u2229 r\u22121 = (m\u22121o)\n(s\u22121) \u2205 ((r\u22121 \u25e6 r) \u2229 r)2 \u2229 r\u22121 = (m\u22121)\n(ds) \u2205 ((r\u22121 \u25e6 r) \u2229 r)2 \u2229 r\u22121 = (m\u22121)\n(ds\u22121) \u2205 ((r\u22121 \u25e6 r) \u2229 r)2 \u2229 r\u22121 = (m\u22121)\n(df) (d) C9(r) = (d)\n(df\u22121) (pp\u22121m\u22121oo\u22121f) (C9(r) \u2229 r)2 \u2229 r\u22121 = (m\u22121f)\n(sf) (d) C9(r) = (d)\n(sf\u22121) (pp\u22121m\u22121o\u22121dd\u22121) C9(r) \u2229 r = (o\u22121)\n(s\u22121f) \u2205 C9b(r) = (mo\u22121)\n(dsf) (d) C9(r) = (d)\n(dsf\u22121) (pp\u22121m\u22121oo\u22121dd\u22121sf) C9(r) \u2229 r\u22121 = (m\u22121od\u22121f)\n(ds\u22121f) (d)\n(ds\u22121f\u22121) (pp\u22121m\u22121oo\u22121dd\u22121f) C9(r) \u2229 r\u22121 = (m\u22121od\u22121f)\nA.3 Proof of Proposition 7\nThis subsection contains the proof of Proposition 7. We will use a short-hand notation for relations\nof the type (bb\u22121) by writing (O) to denote (oo\u22121), (S) to denote (ss\u22121) and so on. We will also\nuse combinations of these macro relations\u2014for instance, by writing (PO), we mean the relation\n(pp\u22121oo\u22121).\nLet s be a symmetric relation such that s 6\u2286 (\u2261 S) and s 6\u2286 (\u2261 F). We write \u201cs\u0302 is NP-complete\u201d\nto denote that, for every symmetric relation r such that r\u2229 s = \u2205, r 6\u2286 (\u2261 S) and r 6\u2286 (\u2261 F), {r, s}\nis NP-complete. When we show results of the form \u201cs\u0302 is NP-complete\u201d, we will tacitly assume\n33\nthat r\u2032 is an arbitrary symmetric relation satisfying the requirements stated above. Thus, we can\nformulate Proposition 7 as follows:\nif s is a symmetric relation such that s 6\u2286 (\u2261 S) and s 6\u2286 (\u2261 F), then s\u0302 is NP-complete.\nTo prove this result, we begin by showing that s\u0302 is NP-complete for all s \u2286 (\u2261 MSF) such that\ns 6\u2286 (\u2261 S) and s 6\u2286 (\u2261 F); this proof can be found in Subsection A.3.1.\nNext, we show that we do not have to care about the (\u2261) relation. More precisely, assume\nthat {s, s\u2032} is NP-complete for all choices of s, s\u2032 such that\n1. s and s\u2032 are symmetric relations;\n2. s \u2229 s\u2032 = \u2205;\n3. (\u2261) 6\u2286 s and (\u2261) 6\u2286 s\u2032;\n4. s 6\u2286 (S) and s\u2032 6\u2286 (S); and\n5. s 6\u2286 (F) and s\u2032 6\u2286 (F).\nWe show that X = {s \u222a (\u2261), s\u2032} is NP-complete for all choices of s, s\u2032 satisfying the requirements\nabove. If s \u2286 (MSF) or s\u2032 \u2286 (MSF), then X is NP-complete by Lemma 52. Hence, we assume that\neach of s and s\u2032 contains at least one of the relations P, D, and O. Let s\u2261 = s\u222a (\u2261). It is easy to\nrealize that (\u2261) 6\u2286 s\u2261 \u25e6 s\u2032 by inspecting the composition table. Furthermore, the following result\ncan easily be shown: if B,B\u2032 \u2208 {P,D,O}, B 6= D and B\u2032 6= P, then (B) \u2286 B \u25e6 B\u2032. If (D) 6\u2286 s\u2261,\nthen s1 = s\u2261 \u2229 (s\u2261 \u25e6 s\u2032)\u2217 is a non-trivial symmetric relation not containing (\u2261) and it can be\nchecked that the set {s1, s\u2032} satisfies the conditions above and implying that it is NP-complete.\nHence, {s\u2261, s\u2032} is NP-complete. Now assume (D) \u2286 s\u2261. If s\u2032 \u2229 (OSF) 6= \u2205, then (D) \u2286 s\u2261 \u25e6 s\u2032\nand we can reason as above to show that {s\u2261, s\u2032} is NP-complete. Otherwise, s\u2032 \u2286 (PM) and\nNP-completeness follows from Proposition 2(3), since {s\u2261, s\u2032} is contained in neither Sp nor Ep,\nor from Lemma 38(1).\nHence, we can now restrict our attention to pairs of relations s, s\u2032 satisfying conditions 1-5 and\nsuch that s \u2229 (POD) 6= \u2205 and s\u2032 \u2229 (POD) 6= \u2205. These proofs are collected in Subsection A.3.2.\nA.3.1 Below (\u2261 MSF)\nLemma 44 {(OD), (SF)} and {(OD), (\u2261 SF)} are NP-complete.\nProof. We note that ((OD) \u25e6 (\u2261 SF)) \u2229 (\u2261 SF) = (SF) so it is sufficient to give a proof for the\nset {(OD), (SF)}. The proof is by a polynomial-time reduction from the NP-complete problem\nNot-all-equal Satisfiability [16].\nAn instance of Not-all-equal Satisfiability consists of a set U of Boolean variables, and a\ncollection C of clauses over U , where each clause is a set of three literals, and a literal is a variable\nor a negated variable. The question is whether there is an assignment of truth variables to the\nvariables such that each clause contains at least one true literal and at least one false literal.\nTo obtain the reduction from Not-all-equal Satisfiability, we design three \u201cgadgets\u201d,\nthat is, small sets of constarints with convenient properties. The first corresponds to a Boolean\nvariable, the second corresponds to a clause, and the third ensures that the variables are connected\nto the clauses in the appropriate way. Hence there are three parts to the construction.\nLet P be an instance of Not-all-equal Satisfiability. We construct a corresponding\ninstance I of A-sat({(OD), (SF)}) as follows:\n1. For each variable u \u2208 U ,\n\u2022 introduce variables vu1 , vu2 and vu3 in V ;\n\u2022 impose the constraint (SF) on the edges (vu1 , vu2) and (vu2 , vu3);\n34\n\u2022 impose the constraint (OD) on the edge (vu1 , vu3).\n2. For each clause c \u2208 C,\n\u2022 introduce variables vc1 , vc2 , vc3 and vc4 in V ;\n\u2022 impose the constraint (SF) on the edges (vc1 , vc2), (vc2 , vc3) and (vc3 , vc4);\n\u2022 impose the constraint (OD) on the edge (vc1 , vc4).\n3. For each literal ci, i = 1, 2, 3 in each clause c,\n\u2022 introduce variables v\u2032ci and v\u2032\u2032ci in V and impose the constraint (SF) on the edge (v\u2032ci , v\u2032\u2032ci);\n\u2022 impose the constraint (SF) on the edge (vci , v\u2032\u2032ci) and impose the constraint (OD) on the\nedges (vci , v\n\u2032\nci) and (vci+1 , v\n\u2032\u2032\nci);\n\u2022 if ci is the (unnegated) variable u, then impose the constraint (SF) on the edge (v\u2032ci , vu2)\nand impose the constraint (OD) on the edges (v\u2032ci , vu1) and (v\n\u2032\u2032\nci , vu2);\n\u2022 If ci is the negated variable u, then impose the constraint (SF) on the edge (v\u2032ci , vu3)\nand impose the constraint (OD) on the edges (v\u2032ci , vu2) and (v\n\u2032\u2032\nci , vu3).\nClearly, this construction can be carried out in polynomial time and we will now show that I has\na solution if and only if P has a solution. First, assume that I has a solution. We will use this to\nconstruct a corresponding solution to P . Consider a variable u \u2208 U . Because of the constraints\nimposed in part (1) of the above construction, exactly one of the pairs (vu1 , vu2) and (vu2 , vu3)\nmust be related by f or f\u22121. If it is the pair (vu1 , vu2), then we assign the value T (true) to u,\notherwise we assign the value F (false) to u.\nNow consider each clause c \u2208 C. Because of the constraints imposed in part (3) of the con-\nstruction above, the relation between vci and vci+1 is f or f\n\u22121 if and only if the corresponding\nliteral is assigned the value T . Finally, because of the constraints imposed in part (2) of the above\nconstruction, vci and vci+1 must be related by f or f\n\u22121 for at least one and at most two of the 3\npossibilities i = 1, 2, 3. Hence the chosen assignment gives at least one true literal and one false\nliteral in each clause, and so is a solution to P .\nConversely, assume that P has a solution \u03c3. We will use this to construct a corresponding\nsolution to I.\nConsider the variables vu1 , vu2 and vu3 in V , which are associated with the variable u \u2208 U .\nAssign vu1 the interval [5, 8], and assign vu3 the interval [6, 7]. If u is assigned the value T in \u03c3,\nthen assign vu2 the interval [6, 8], otherwise assign vu2 the value [5, 7].\nNow consider the variables vc1 , vc2 , vc3 and vc4 in V , which are associated with the clause c \u2208 C.\nSince \u03c3 is a solution, it must assign values to the literals c1, c2, c3 which contain at least one true\nvalue and at least one false value. There are therefore 6 possibilities, and we assign intervals to\nthe variables vc1 , vc2 , vc3 and vc4 in each case according to the following table:\nc1 c2 c3 vc1 vc2 vc3 vc4\nT T F [1, 12] [2, 12] [3, 12] [3, 10]\nT F T [1, 12] [2, 12] [2, 10] [3, 10]\nF T T [1, 12] [1, 10] [2, 10] [3, 10]\nF F T [1, 12] [1, 11] [1, 10] [3, 10]\nF T F [1, 12] [1, 11] [3, 11] [3, 10]\nT F F [1, 12] [3, 12] [3, 11] [3, 10]\nIt is easy to check that each of these assignments satisfies all constraints on the variables vc1 , vc2 , vc3\nand vc4 .\nIt remains to show that each of these assignments can be extended to a complete solution to\nI by assigning the remaining variables v\u2032c1 , v\n\u2032\u2032\nc1 , v\n\u2032\nc2 , v\n\u2032\u2032\nc2 , v\n\u2032\nc3 and v\n\u2032\u2032\nc3 appropriately. To show this we\nnote that, for i = 1, 2, 3, if the literal ci is assigned the value T in \u03c3, then in order to satisfy the\n35\nconstraints on v\u2032ci and v\n\u2032\u2032\nci the starting point of v\n\u2032\nci must equal the starting point of vu1 or vu2\nand the starting point of v\u2032\u2032ci must equal the starting point of vci . In this case we simply assign\nthe ending points of both of these intervals the value 13. Similarly, if the literal ci is assigned\nthe value F in \u03c3, then the ending points of these intervals are forced to take certain (distinct)\nvalues, and we assign the starting points of these intervals the value 0. It is easy to check that this\nassignment satisfies all the constraints. For example, if c = {x,\u00acy, z} and \u03c3(x) = T, \u03c3(y) = T , and\n\u03c3(z) = F then these variables are assigned the values [6, 13], [1, 13], [0, 7], [0, 12], [0, 7] and [0, 11],\nrespectively. 2\nLemma 45 (\u0302SF) is NP-complete.\nProof. we have (B) \u2286 (SF) \u25e6 (B) when B \u2208 {P,M,O,D}. It can be easily verified that\n(\u2261) 6\u2286 r1 = (r\u2032 \u2229 ((SF) \u25e6 r\u2032))\u2217. Consequently, we may assume that (\u2261) 6\u2286 r\u2032. If r\u2032 \u2286 (PM) then\nNP-completeness follows from Proposition 2(3) or Lemma 38(1), so we assume that r\u2032\u2229 (OD) 6= \u2205.\nTo show NP-completeness of the remaining cases, we introduce the OD-switch. The switch is\nan instance \u0393 on five variables a, b, c, x, y:\n{a(SF)b, a(SF)c, x(SF)b, x(SF)c, y(SF)b, y(SF)c}.\nIt has the following properties (which can easily be checked):\n1. if b(PM)c holds, then x(\u2261)y;\n2. if b(D)c holds, then x(\u2261 O)y; and\n3. if b(O)c holds, then x(\u2261 D)y.\nIt can be checked that one of the relations (\u2261 O), (\u2261 D), (\u2261 OD) is derived from \u0393 \u222a {br\u2032c}.\nTherefore we can obtain one of (O), (D), (OD) as described above. For (OD), apply Lemma 44.\nIf we obtain (O) or (D) then apply Lemma 1 with R = (o), R1 = (SF), R2 = (O) or with R = (d),\nR1 = (SF), R2 = (D) If r\u2032 = (D), respectively. 2\nLemma 46 \u0302(\u2261 SF) are NP-complete.\nProof. This proof is analogous to the previous one because the properties of the OD-switch are\nthe same if we replace the relation (SF) with (\u2261 SF).\nLemma 47 \u0302(\u2261 M) is NP-complete.\nProof. Consider the following:\n(\u2261 M) \u25e6 (P) = (PMOd\u22121s\u22121f\u22121) (\u2261 M) \u25e6 (O) = (POdsf)\n(\u2261 M) \u25e6 (D) = (PODsf) (\u2261 M) \u25e6 (S) = (p\u22121mo\u22121dSf)\n(\u2261 M) \u25e6 (F) = (pm\u22121odsF)\nIf (PSF) \u2229 r\u2032 6= \u2205, then (\u2261) 6\u2286 r1 = (\u2261 M) \u25e6 r\u2032 but at least one of (m), (m\u22121) is a member of\nr1. Consequently, the relation r1 \u2229 (\u2261 M) implies NP-completeness by either Proposition 3 or\nLemma 38(1). Otherwise, r\u2032 \u2286 (OD) and (PO) \u2286 ((\u2261 M) \u25e6 r\u2032)\u2217 \u2286 (POD). Since (\u2261 M) \u25e6 (\u2261 M) =\n(\u2261 PSF), we can obtain the relation (P) and NP-completeness is a consequence of Proposition 2(3)\nbecause {(\u2261 M), (P)} is contained in neither Sp nor Ep. 2\nLemma 48 \u0302(MS) and \u0302(MF) are NP-complete.\n36\nProof. We show the result for \u0302(MS); the other case follows by applying Lemma 2. Consider\nthe symmetric relation r1 = (r\u2032 \u2229 ((MS) \u25e6 r\u2032))\u2217. It is easily verified that (\u2261) 6\u2286 r1. Furthermore\nr1 is non-empty since (B) \u2286 (MS) \u25e6 (B) when B \u2208 {P,O,D} and we know that r\u2032 6\u2286 (\u2261 F).\nConsequently, we can assume that (\u2261) 6\u2286 r\u2032.\nCase 1: (P) \u2229 r\u2032 = \u2205 or (F) \u2229 r\u2032 = \u2205. We note the following:\n(MS) \u25e6 (P) = (PMOd\u22121s\u22121f\u22121) (MS) \u25e6 (O) = (PmODsF)\n(MS) \u25e6 (D) = (PmODsF) (MS) \u25e6 (F) = (pMODs)\nIt follows that r1 = ((MS) \u25e6 r\u2032) \u2229 (MS) equals either (ms), (ms\u22121), (mS), (Ms), or (Ms\u22121). If\nr1 = (Ms) or r1 = (Ms\u22121), then r\u22171 = (M) and NP-completeness follows from Lemma 38(1). If\nr1 = (ms) or r1 = (ms\u22121), then ((m\u22121s\u22121) \u25e6 (ms)) \u2229 (ms) = ((m\u22121s) \u25e6 (ms\u22121)) \u2229 (m\u22121s) = (s).\nFinally, if r1 = (mS), then (S) = r\u22171 and\n(S) \u25e6 (P) = (Pmod\u22121f\u22121) (S) \u25e6 (O) = (pmODF)\n(S) \u25e6 (D) = (pmODF) (S) \u25e6 (F) = (pmOD)\nHence, ((S) \u25e6 r\u2032) \u2229 (MS) = (m) and NP-completeness follows immediately.\nCase 2: (PF) \u2286 r\u2032. Consider the following instance \u0393 over the variables x, y, a, b:\nx(MS)y, y(MS)a, a(MS)x, b(MS)x, b(MS)y, br\u2032a.\nOne can show x(S)y is derived from \u0393 so ((S) \u25e6 r\u2032)\u2229 (MS) = (m) and NP-completeness follows. 2\nLemma 49 \u0302(\u2261 MS) and \u0302(\u2261 MF) are NP-complete.\nProof. We show the result for \u0302(\u2261 MS); the other case follows by applying Lemma 2. It can\nbe shown that r1 = ((\u2261 MS) \u25e6 r\u2032) \u2229 (\u2261 MS) \u2208 {(m), (ms), (Ms), (Ms\u22121)}. All three cases lead to\nNP-completeness as shown in Lemma 48. 2\nLemma 50 \u0302(MSF) is NP-complete.\nProof. It is easy to see that B \u2286 (MSF) \u25e6 B when B \u2208 {(P), (O), (D)}. Hence, r\u2032 \u2286 (MSF) \u25e6 r\u2032.\nBy inspecting the composition table, one can see that if (\u2261) is a member of the composition of two\nsymmetric relations, then these two relations cannot be disjoint. It follows that (\u2261) 6\u2286 (MSF) \u25e6 r\u2032\nso we can obtain the relation r\u2032 \\ (\u2261) = r\u2032\u2229 ((MSF)\u25e6 r\u2032). We assume henceforth that (\u2261) 6\u2286 r\u2032 and\ncontinue by noting that (MSF) \u25e6 (P) = (PMOd\u22121s\u22121f\u22121) and (MSF) \u25e6 (O) = (MSF) \u25e6 (D) = neq\nwhere neq = > \\ (\u2261).\nIf r\u2032 = (P), then NP-completeness follows from Proposition 2(3). Otherwise, (MSF) \u25e6 r\u2032 = neq\nand we can show NP-completeness by a polynomial-time reduction fromGraph 4-colourability.\nLetG = (V,E) be an arbitrary, undirected graph and construct a set of Allen constraints as follows:\n1. introduce two variables x, y and the constraint xr\u2032y;\n2. for each v \u2208 V , introduce a variable v and the constraints v(MSF)x and v(MSF)y; and\n3. for each (v, w) \u2208 E, add the constraint vneqw.\nIt is a routine verification to see that the resulting instance is satisfiable iff G is 4-colourable. 2\nLemma 51 \u0302(\u2261 MSF) is NP-complete.\n37\n\uf8f1\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f2\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f3\nxr1a1 a7r1a1 yr1a1\na1r1a2 a7r2x yr1a2\nxr1a2 a7r2a2 yr1a3\na3r2x a8r1x yr1a4\na3r2a1 a8r2a1 yr2a5\na3r1a2 a8r2a2 yr2a6\na4r1x a9r1a1 yr1a7\na4r2a1 a9r2x yr1a8\na4r2a2 a9r2a2 yr1a9\na5r1x a7r1a8\na5r1a1 a8r1a9\na5r1a2 a7r2a9\na6r1x\na6r2a1\na6r2a2\na4r1a5\na5r1a6\na4r2a6\n\uf8fc\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8fd\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8f4\uf8fe\nTable 5: Definition of C39(r1, r2).\nProof. Note that (\u2261 MSF) \u25e6 (P) = (PMOd\u22121s\u22121f\u22121) and (\u2261 MSF) \u25e6 (O) = (\u2261 MSF) \u25e6 (D) = neq.\nIf r\u2032 = (P), then NP-completeness follows from Proposition 2(3). Otherwise, (\u2261 MSF) \u25e6 r\u2032 = neq\nso we can generate the relation (MSF) and NP-completeness follows from Lemma 50. 2\nLemma 52 If s \u2286 (\u2261 MSF), then s\u0302 is NP-complete.\nProof. Combine Lemmas 38 and 47\u201351. 2\nA.3.2 Remaining cases\nThis subsection considers the relations not covered in the previous section. We will henceforth\nassume that r\u2032 6\u2286 (\u2261 MSF) and we will only consider s\u0302 where s 6\u2286 (\u2261 MSF). In the proofs, we will\nmake use of a derivation C39(r1, r2) that denotes the relation (between x and y) derived from the\nset of constraints found in Table 5.\n\u2022 (\u0302PS) and (\u0302PF): We give the proof for (\u0302PS); the other case follows by applying Lemma 2. Now,\n(PS) \u25e6 (B) = (PMODsF) when B \u2208 {M,O,D} and (PS) \u25e6 (F) = (PmODs). Thus, (((PS) \u25e6 r\u2032)) \u2229\n(PS))\u2217 = (P) and the result follows from Proposition 2.\n38\n\u2022 \u0302(PSF): Recall that r\u2032 6= (M) and consider the following instance \u0393 on {x, y, a, b}:\n{x(PSF)a, ar\u2032y, x(PSF)b, br\u2032y, ar\u2032b.}\nLet r1 = > \\ (\u2261 s\u22121f\u22121). One can show that xr1y is derived from \u0393 which implies that\n(P) = ((PSF) \u2229 r1)\u2217 can be obtained. NP-completeness follows from Proposition 2(3).\n\u2022 s\u0302 when (PM) \u2286 s \u2286 (PMSF): Follows from previous results by applying Lemma 42 with model\ntransformation shrink.\nWe will from now assume that r\u2032 does not satisfy the inclusion (P) \u2286 r\u2032 \u2286 (PMSF); the previous\nresults together with Proposition 2(3) allows us to do this without loss of generality.\n\u2022 (\u0302D): By setting R = (d), R1 = r\u2032 and R2 = (D) and applying Lemma 1, we have that {(D), r\u2032}\nis NP-complete.\n\u2022 (\u0302O): Case 1. (PD) \u2286 r\u2032 \u2286 (PMDSF). The case r\u2032 = (PD) is considered in Lemma 43. Otherwise\napply Lemma 43 and Lemma 42 with model transformation ordshrink.\nCase 2. (D) \u2286 r\u2032 \u2286 (DSF). Apply Lemma 42 with model transformation ordshrink and then\nLemma 1 with R = (d), R1 = (O), R2 = (D).\nCase 3. (DM) \u2286 r\u2032 \u2286 (DMSF). Now, (D) \u2286 C39(r\u2032, (O)) \u2286 (PD) so we can obtain the relation (D).\n\u2022 \u0302(PM) and \u0302(MO): Using Lemma 42 with model transformations shrink and expand, the result\nfollows from the earlier results.\n\u2022 \u0302(PD): Obviously, (O) \u2286 r\u2032 \u2286 > \\ (PD). Apply Lemma 42 with model transformation ordexpand\nand then use Lemma 43.\n\u2022 \u0302(PO): Case 1: (D) \u2286 r\u2032 \u2286 (DSF). Apply Lemma 42 with model transformation ordshrink and\nthen Lemma 1 with R = (d), R1 = (PO), R2 = (D).\nCase 2: (DM) \u2286 r\u2032 \u2286 (DMSF). In this case, (DSF) \u2286 C39(r\u2032, (PO)) \u2286 (PODSF) and we can obtain\na relation r1 such that (D) \u2286 r1 \u2286 (DSF). Hence, NP-completeness follows from the previous case.\n\u2022 (\u0302OS) and (\u0302OF): We prove the result for (\u0302OS); the other case follows by applying Lemma 2.\nCase 1. (PD) \u2286 r\u2032 \u2286 (PMDF). Apply Lemma 42 thrice with model transformations shrink,\nleftordshrink, and ordshrink, consecutively, and then use Lemma 43.\nCase 2. (D) \u2286 r\u2032 \u2286 (DMF). Now, (ODS) \u2286 C39(r\u2032, (OS)) \u2286 (PODS) so we can obtain the relation\n(D).\n\u2022 (\u0302DS) and (\u0302DF): We prove the result for (\u0302DS); the other case follows by applying Lemma 2.\nCase 1. (PO) \u2286 r\u2032 \u2286 (PMOF). Apply Lemma 42 thrice with model transformations shrink,\nleftordexpand, and ordexpand, consecutively, and then use Lemma 43.\nCase 2. (O) \u2286 r\u2032 \u2286 (OMF). Use Lemma 42 with model transformation expand and the earlier\nresults.\n\u2022 \u0302(MD): Case 1. (O) \u2286 r\u2032 \u2286 (OSF). In this case, (D) \u2286 C39((MD), r\u2032) \u2286 (ODSF) and NP-\ncompleteness follows since we can obtain the relation (D).\nCase 2. (PO) \u2286 r\u2032 \u2286 (POSF). Now, (DSF) \u2286 C39((MD), r\u2032) \u2286 (PODSF) so we can obtain the\nrelation (D).\nNow, it remains to consider pairs r, s of disjoint relations such that neither r nor s contains (\u2261)\nand both of them contain exactly six basic relations. There are 10 such pairs. NP-completeness of\n{(MSF), (POD)} was proved in Lemma 50. NP-completeness of {(PMS), (ODF)}, {(PMF), (ODS)},\nand {(PSF), (MOD)} was shown earlier in this subsection. Here we consider the remaining six pairs.\n39\nFor the pairs {(PMO), (DSF)}, {(PMD), (OSF)}, and {(PDF), (MOS)}, apply Lemma 42 with\nmodel transformations shrink, leftordshrink, and expand, respectively, and then use earlier results.\nNP-completeness of {(PDS), (MOF)} follows from that of {(PDF), (MOS)} by using Lemma 2.\nConsider {(POF), (MDS)}. It can be verified that C39((MDS), (POF)) = (PODSF), and we\ncan obtain the relation (DS) and use earlier results. Finally, NP-completeness of {(POS), (MDF)}\nfollows from that of {(POF), (MDS)} by using Lemma 2 once again.\nReferences\n[1] J.F. Allen. Maintaining knowledge about temporal intervals. Communications of the ACM,\n26(11):832\u2013843, 1983.\n[2] J.F. Allen. Temporal reasoning and planning. In J.F. Allen, H. Kautz, R.N. Pelavin, and\nJ. Tenenberg, editors, Reasoning about Plans, chapter 1, pages 1\u201367. Morgan Kaufmann,\n1991.\n[3] O. Angelsmark and P. Jonsson. Some observations on durations, scheduling and Allen\u2019s\nalgebra. In Proceedings of the 6th Conference on Constraint Programming (CP\u201900), volume\n1894 of Lecture Notes in Computer Science, pages 484\u2013488. Springer-Verlag, 2000.\n[4] F.D. Anger and R.V. Rodriguez. Effective scheduling of tasks under weak temporal interval\nconstraints. In B. Bouchon-Meunier, R. R. Yager, and L. A. Zadeh, editors, Advances in\nIntelligent Computing - IPMU\u201994, pages 584\u2013594. Springer, Berlin, 1994.\n[5] A. Belfer and M.C. Golumbic. A combinatorial approach to temporal reasoning. In Proceed-\nings of 5th Jerusalem Conference on Information Technology, pages 774\u2013780. IEEE Computer\nSociety Press, October 1990.\n[6] P. Bellini, R. Mattolini, and P. Nesi. Temporal logics for real-time system specification. ACM\nComputing Surveys, 32(1):12\u201342, 2000.\n[7] S. Benzer. On the topology of the genetic fine structure. In Proceedings of the National\nAcademy of Science, U.S.A., volume 45, pages 1607\u20131620, 1959.\n[8] A.A. Bulatov, A.A. Krokhin, and P. Jeavons. Constraint satisfaction problems and finite\nalgebras. In Proceedings of the 27th International Colloquium on Automata, Languages, and\nProgramming (ICALP\u201900), volume 1853 of Lecture Notes in Computer Science, pages 272\u2013\n282. Springer, 2000.\n[9] A.A. Bulatov, A.A. Krokhin, and P. Jeavons. The complexity of maximal constraint lan-\nguages. In Proceedings of the 33rd ACM Symposium on the Theory of Computing (STOC\u201901),\npages 667\u2013674, 2001.\n[10] D. Cohen, P. Jeavons, P. Jonsson, and M. Koubarakis. Building tractable disjunctive con-\nstraints. Journal of the ACM, 47(5):826\u2013853, 2000.\n[11] C.H. Coombs and J.E.K. Smith. On the detection of structures in attitudes and developmental\nprocesses. Psychological Review, 80:337\u2013351, 1973.\n[12] N. Creignou. A dichotomy theorem for maximum generalized satisfiability problems. Journal\nof Computer and System Sciences, 51(3):511\u2013522, 1995.\n[13] T. Drakengren and P. Jonsson. Eight maximal tractable subclasses of Allen\u2019s algebra with\nmetric time. Journal of Artificial Intelligence Research, 7:25\u201345, 1997.\n[14] T. Drakengren and P. Jonsson. Twenty-one large tractable subclasses of Allen\u2019s algebra.\nArtificial Intelligence, 93(1-2):297\u2013319, 1997.\n40\n[15] T. Drakengren and P. Jonsson. A complete classification of tractability in Allen\u2019s algebra\nrelative to subsets of basic relations. Artificial Intelligence, 106(2):205\u2013219, 1998.\n[16] M. Garey and D. Johnson. Computers and Intractability: A Guide to the Theory of NP-\nCompleteness. Freeman, New York, 1979.\n[17] F. Gavril. Algorithms for a maximum clique and a maximum independent set of a circle\ngraph. Networks, 3:261\u2013273, 1973.\n[18] A. Gerevini and L. Schubert. Efficient temporal reasoning through timegraphs. In Proceed-\nings of International Joint Conference on Artificial Intelligence (IJCAI\u201993), pages 648\u2013654.\nMorgan Kaufmann, 1993.\n[19] M.C. Golumbic, H. Kaplan, and R. Shamir. On the complexity of DNA physical mapping.\nAdvances in Applied Mathematics, 15(3):251\u2013261, 1994.\n[20] M.C. Golumbic, H. Kaplan, and R. Shamir. Graph sandwich problems. Journal of Algorithms,\n19(3):449\u2013473, 1995.\n[21] M.C. Golumbic and R. Shamir. Complexity and algorithms for reasoning about time: A\ngraph-theoretic approach. Journal of the ACM, 40(5):1108\u20131133, 1993.\n[22] P. Hell and J. Nes\u02c7etr\u02c7il. On the complexity of H-coloring. Journal of Combinatorial Theory,\nSer. B, 48:92\u2013110, 1990.\n[23] R. Hirsch. Relation algebras of intervals. Artificial Intelligence, 83(2):1\u201329, 1996.\n[24] R. Hirsch. Expressive power and complexity in algebraic logic. Journal of Logic and Compu-\ntation, 7(3):309\u2013351, 1997.\n[25] P. Jonsson and C. Ba\u00a8ckstro\u00a8m. A unifying approach to temporal constraint reasoning. Artificial\nIntelligence, 102(1):143\u2013155, 1998.\n[26] P. Jonsson and T. Drakengren. A complete classification of tractability in RCC-5. Journal\nof Artificial Intelligence Research, 6:211\u2013221, 1997.\n[27] P. Jonsson, T. Drakengren, and C. Ba\u00a8ckstro\u00a8m. Computational complexity of relating time\npoints with intervals. Artificial Intelligence, 109(1-2):273\u2013295, 1999.\n[28] R.M. Karp. Mapping the genome: some combinatorial problems arising in molecular biology.\nIn Proceedings of the 25th ACM Symposium on the Theory of Computing (STOC\u201993), pages\n278\u2013285, New-York, 1993. ACM Press.\n[29] D.G. Kendall. Some problems and methods in statistical archaeology. World Archaeology,\n1:68\u201376, 1969.\n[30] M. Koubarakis. Tractable disjunctions of linear constraints. In Proceedings of the 2nd Confer-\nence on Principles and Practice of Constraint Programming (CP\u201996), pages 297\u2013307, Boston,\nMA, 1996.\n[31] M. Koubarakis. The complexity of query evaluation in indefinite temporal constraint\ndatabases. Theoretical Computer Science, 171(1-2):25\u201360, 1997.\n[32] M. Koubarakis and S. Skiadopoulos. Querying temporal and spatial constraint networks in\nPTIME. Artificial Intelligence, 123(1-2):223\u2013263, 2000.\n[33] P.B. Ladkin and R.D. Maddux. On binary constraint problems. Journal of the ACM,\n41(3):435\u2013469, 1994.\n[34] P.B. Ladkin and A. Reinefeld. Fast algebraic methods for interval constraint problems. Annals\nof Mathematics and Artificial Intelligence, 19(3-4):383\u2013411, 1997.\n41\n[35] G. Ligozat. A new proof of tractability for ORD-Horn relations. In Proceedings of the 13th\nNational (US) Conference on Artificial Intelligence (AAAI-96), pages 395\u2013401, Menlo Park,\nCA, 1996. AAAI Press.\n[36] G. Ligozat. \u201cCorner\u201d relations in Allen\u2019s algebra. Constraints, 3(2-3):165\u2013177, 1998.\n[37] I. Meiri. Combining qualitative and quantitative constraints in temporal reasoning. Artificial\nIntelligence, 87(1-2):343\u2013385, 1996.\n[38] B. Nebel. Archive of C-programs used for obtaining the results from [39], 1997. available\nfrom the author at http:\/\/www.informatik.uni-freiburg.de\/~nebel\/journals.html.\n[39] B. Nebel. Solving hard qualitative temporal reasoning problems: Evaluating the efficiency of\nusing the ORD-Horn class. Constraints, 1(3):175\u2013190, 1997.\n[40] B. Nebel and H.-J. Bu\u00a8rckert. Reasoning about temporal relations: A maximal tractable\nsubclass of Allen\u2019s interval algebra. Journal of the ACM, 42(1):43\u201366, 1995.\n[41] K. No\u00a8kel. Temporally Distributed Symptoms in Technical Diagnosis, volume 517 of Lecture\nNotes in Artificial Intelligence. Springer-Verlag, 1991.\n[42] J. Opatrny\u00b4. Total ordering problem. SIAM Journal on Computing, 8(1):111\u2013114, 1979.\n[43] C. Papadimitriou and M. Yannakakis. Scheduling interval ordered tasks. SIAM Journal on\nComputing, 8(3):405\u2013409, 1979.\n[44] I. Pe\u2019er and R. Shamir. Satisfiability problems on intervals and unit intervals. Theoretical\nComputer Science, 175(2):349\u2013372, 1997.\n[45] T.J. Schaefer. The complexity of satisfiability problems. In Proceedings of the 10th ACM\nSymposium on the Theory of Computing (STOC\u201978), pages 216\u2013226, New-York, 1978. ACM\nPress.\n[46] E. Schwalb and L. Vila. Temporal constraints: A survey. Constraints, 3(2-3):129\u2013149, 1998.\n[47] F. Song and R. Cohen. The interpretation of temporal relations in narrative. In Proceedings\nof the 7th National (US) Conference on Artificial Intelligence, pages 745\u2013750, St. Paul, MN,\nUSA, 1988. AAAI Press\/The MIT Press.\n[48] K. Stergiou and M. Koubarakis. Backtracking algorithms for disjunctions of temporal con-\nstraints. Artificial Intelligence, 120(1):81\u2013117, 2000.\n[49] A\u00b4. Szendrei. Maximal non-affine reducts of simple affine algebras. Algebra Universalis,\n34(1):144\u2013174, 1995.\n[50] A. Tarski. On the calculus of relations. Journal of Symbolic Logic, 6:73\u201389, 1941.\n[51] P.G. van Beek. Reasoning about qualitative temporal information. Artificial Intelligence,\n58(1-3):297\u2013326, 1992.\n[52] P.G. van Beek and R. Cohen. Exact and approximate reasoning about temporal relations.\nComputational Intelligence, 6(3):132\u2013144, 1990.\n[53] P.G. van Beek and D.W. Manchak. The design and experimental analysis of algorithms for\ntemporal reasoning. Journal of Artificial Intelligence Research, 4:1\u201318, 1996.\n[54] M.B. Vilain. A system for reasoning about time. In Proceedings of the 2nd National (US)\nConference on Artificial Intelligence, pages 197\u2013201, Pittsburgh, PA, USA, 1982. AAAI Press.\n42\n[55] M.B. Vilain, H.A. Kautz, and P.G. van Beek. Constraint propagation algorithms for temporal\nreasoning: A revised report. In Daniel S. Weld and Johan de Kleer, editors, Readings in\nQualitative Reasoning about Physical Systems, pages 373\u2013381. Morgan Kaufmann, San Mateo,\nCA, 1989.\n[56] S.A. Ward and R.H. Halstead. Computation Structures. MIT Press, Cambridge, MA, 1990.\n[57] R.A. Wilson. The maximal subgroups of the Baby Monster. I. Journal of Algebra, 211(1):1\u201314,\n1999.\n[58] X. Yang. A classification of maximal subsemigroups of finite order-preserving transformation\nsemigroups. Communications in Algebra, 28(3):1503\u20131513, 2000.\n43\n"}