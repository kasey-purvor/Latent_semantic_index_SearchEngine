{"doi":"10.1016\/j.tpb.2006.02.001","coreId":"71011","oai":"oai:eprints.lancs.ac.uk:8188","identifiers":["oai:eprints.lancs.ac.uk:8188","10.1016\/j.tpb.2006.02.001"],"title":"The stationary distribution of allele frequencies when selection acts at unlinked loci.","authors":["Fearnhead, Paul"],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2006-11","abstract":"We consider population genetics models where selection acts at a set of unlinked loci. It is known that if the fitness of an individual is multiplicative across loci, then these loci are independent. We consider general selection models, but assume parent-independent mutation at each locus. For such a model, the joint stationary distribution of allele frequencies is proportional to the stationary distribution under neutrality multiplied by a known function of the mean fitness of the population. We further show how knowledge of this stationary distribution enables direct simulation of the genealogy of a sample at a single-locus. For a specific selection model appropriate for complex disease genes, we use simulation to determine what features of the genealogy differ between our general selection model and a multiplicative model","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/71011.pdf","fullTextIdentifier":"http:\/\/eprints.lancs.ac.uk\/8188\/1\/CSG_statn_distn.pdf","pdfHashValue":"36b51eef583002bbe64bf8614a3b22cf07d2f8fd","publisher":null,"rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:eprints.lancs.ac.uk:8188<\/identifier><datestamp>\n      2018-01-24T03:16:55Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      7375626A656374733D51:5141<\/setSpec><setSpec>\n      74797065733D61727469636C65<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        The stationary distribution of allele frequencies when selection acts at unlinked loci.<\/dc:title><dc:creator>\n        Fearnhead, Paul<\/dc:creator><dc:subject>\n        QA Mathematics<\/dc:subject><dc:description>\n        We consider population genetics models where selection acts at a set of unlinked loci. It is known that if the fitness of an individual is multiplicative across loci, then these loci are independent. We consider general selection models, but assume parent-independent mutation at each locus. For such a model, the joint stationary distribution of allele frequencies is proportional to the stationary distribution under neutrality multiplied by a known function of the mean fitness of the population. We further show how knowledge of this stationary distribution enables direct simulation of the genealogy of a sample at a single-locus. For a specific selection model appropriate for complex disease genes, we use simulation to determine what features of the genealogy differ between our general selection model and a multiplicative model.<\/dc:description><dc:date>\n        2006-11<\/dc:date><dc:type>\n        Journal Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/eprints.lancs.ac.uk\/8188\/1\/CSG_statn_distn.pdf<\/dc:identifier><dc:relation>\n        http:\/\/dx.doi.org\/10.1016\/j.tpb.2006.02.001<\/dc:relation><dc:identifier>\n        Fearnhead, Paul (2006) The stationary distribution of allele frequencies when selection acts at unlinked loci. Theoretical Population Biology, 70 (3). pp. 376-386. ISSN 1096-0325<\/dc:identifier><dc:relation>\n        http:\/\/eprints.lancs.ac.uk\/8188\/<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/dx.doi.org\/10.1016\/j.tpb.2006.02.001","http:\/\/eprints.lancs.ac.uk\/8188\/"],"year":2006,"topics":["QA Mathematics"],"subject":["Journal Article","PeerReviewed"],"fullText":"The Stationary Distribution of Allele\nFrequencies when Selection acts at Unlinked\nLoci\nPaul Fearnhead1\n1. Department of Mathematics and Statistics, Lancaster University, Lan-\ncaster, LA1 4YF, UK\n(e-mail: p.fearnhead@lancs.ac.uk).\nSummary: We consider population genetics models where selection acts at a set\nof unlinked loci. It is known that if the fitness of an individual is multiplicative\nacross loci, then these loci are independent. We consider general selection models,\nbut assume parent-independent mutation at each locus. For such a model, the\njoint stationary distribution of allele frequencies is proportional to the stationary\ndistribution under neutrality multiplied by a known function of the mean fitness\nof the population. We further show how knowledge of this stationary distribution\nenables direct simulation of the genealogy of a sample at a single locus. For a\nspecific selection model appropriate for complex disease genes, we use simulation\nto determine what features of the genealogy differ between our general selection\nmodel and a multiplicative model.\nKeywords: Ancestral Selection Graph, Complex Diseases, Genealogies, Wright-\nFisher Model\n1\n1 Introduction\nConsider selection acting on a set of unlinked loci. Under a multiplicative model\nfor fitness, these loci will evolve independently (Risch, 1990). However, for com-\nplex diseases there may be interactions between unlinked genes, and a simple\nmultiplicative model will be innappropriate (Wiesch et al., 1999; Niu et al.,\n1999; Cordell et al., 2001). Fearnhead (2003) introduced a coalescent-type an-\ncestral process for such models of selection, where the fitness depends in a non-\nmultiplicative way on the alleles at a set of unlinked loci. Here we show that\nif parent-independent mutations occur at each loci, then the joint stationary\ndistribution of the allele frequencies at the unlinked loci is proportional to this\nstationary distribution under neutrality multiplied by the exponential of the\nmean fitness of the population. This result is a natural extension of the result\nfor selection acting at a single loci (Wright, 1949; Donnelly et al., 2001).\nCentral to our proof of this result is the following result for Langevin diffusions\n(see Roberts and Stramer, 2002; Kent, 1978)\nTheorem 1 Consider a diffusion in d-dimensions, specified by the following\nstochastic differential equation\ndX(t) = b(X(t))dt + \u03c3(X(t))dB(t) (1)\nwhere B is a d-dimensional Brownian Motion, b(\u00b7) is a d-dimensional vector and\n\u03c3(\u00b7) a d\u00d7 d matrix. Assume X = (X1, . . . , Xn) is not explosive, define the d\u00d7 d\nmatrix a(x) = \u03c3(x)\u03c3T (x), and \u03b4(x) as the determinant of a(x). Further assume\nthat there exists a density function pi(x) such that for all j\nbi(x) =\n1\n2\nd\u2211\nj=1\naij(x)\u2202 log pi(x)\/\u2202xj + \u03b4\n1\/2(x)\nd\u2211\nj=1\n\u2202\n\u2202xj\n(aij(x)\u03b4\n\u22121\/2(x)). (2)\nThen pi(x) is the unique stationary distribution of X.\n2\nThe interpretation of the d- dimensional drift vector b(x) and the d \u00d7 d matrix\na(x), are that\nlim\nh\u21920\n(\nE(Xi(t + h)\u2212Xi(t)|X(t) = x)\nh\n)\n= bi(x), (3)\nrepresents the expected infinitesimal change in X(t) and\nlim\nh\u21920\n(\nCov(Xi(t + h), Xj(t + h)|X(t) = x)\nh\n)\n= aij(x) (4)\nrepresents the instantaneous covariation of X(t).\nWe introduce our general selection model in Section 2; this is equivalent to the\nmodel considered in Fearnhead (2003). Our result for the stationary distribution\nof the allele frequencies is then given in Section 3. In the following two Sections\nwe compare features of our general selection model with multiplicative selection\nmodels where loci are independent. Firstly we compare the stationary distri-\nbution of each model; and we then look at features of the distribution of the\ngenealogy at a single locus under each model. For the latter, we extend existing\napproaches to sample genealogies at a non-neutral locus. The paper ends with a\ndiscussion.\n2 Model and Notation\nWe consider the diffusion limit of the following Wright-Fisher model. Assume a\npopulation of N diploid individuals. Each individual is charaterised by its two\nhaplotypes at a set of L independent loci, and we assume Ki possible alleles at\nloci i (for i = 1, 2, . . . , L). Thus one haplotype of an individual will be a vector\nof L alleles, describing the allele carried by the individual at each of its L loci on\none of its two copies of its genome. We characterise the state of the population\nby the list of haplotypes (and their multiplicities) in the current generation.\n3\nThe fitness of an individual with haplotypes (\u03b1, \u03b2) is 1 + s\u03b1,\u03b2. We proceed from\none generation to another as follows. We choose 2N pairs of haplotypes from\nthe current generation. These choices are independent, and the chance that a\nparticular pair, (\u03b1, \u03b2) is chosen at each choice is proportional to 1 + s\u03b1,\u03b2. For\neach of these 2N pairs we then produce a new haplotype by choosing an allele\nuniformly at random from the pair of alleles at each loci (with the choices at\neach loci being independent of all other choices), and for locus l = 1, . . . , L, we\nhave a probability ul of mutating the chosen allele. If a mutation occurs at locus\nl the mutant will be of type i with probability \u03bd\n(l)\ni , which is independent of the\nparent allele. (Note, that for this and all our notation that follows, we subscript\nby the allele and superscript by the locus.)\nWe consider the diffusion limit of this model as N \u2192 \u221e; time is measured in\nunits of 2N generations; and \u03b8\n(l)\ni = 4Nul\u03bd\n(l)\ni (population scaled mutation rates)\nand \u03c3\u03b1,\u03b2 = 4Ns\u03b1,\u03b2 (population scaled selection rates) are kept fixed. We let\n\u03b8(l) =\n\u2211\ni \u03b8\n(l)\ni , the mutation rate at locus l. Note that this diffusion limit applies\nto a wide range of population models and hence our results apply more widely\nthan for just the Wright-Fisher model.\nIn this diffusion limit, the loci are unlinked, and the population frequency of a\nhaplotype \u03b1, Pr(\u03b1), is obtained as the product of the population frequencies of\nthe alleles of \u03b1 across the L loci. The population can thus be characterised by\nthe population frequencies of the alleles at each loci. We denote the frequency\nof allele i at loci l by x\n(l)\ni , and let x = (x\n(1)\n1 , . . . , x\n(L)\nKL\u22121\n) be the set of allele\nfrequencies at the L loci. Note that for locus l we record only the frequencies of\nalleles 1, . . . , Kl \u2212 1 as the final allele frequency is defined by the fact that allele\nfrequencies sum to 1.\n4\nConditional on x we can define the mean selection rate of the population\n\u03c3\u00af =\n\u2211\n\u03b1\n\u2211\n\u03b2\nPr(\u03b1) Pr(\u03b2)\u03c3\u03b1,\u03b2. (5)\nWe can also define the conditional mean selection rate of an individual of geno-\ntype (i, j) at locus l as\n\u03c3\u00af\n(l)\nij =\n\u2211\n\u03b1\n\u2211\n\u03b2\nPr\nl\n(\u03b1|i) Pr\nl\n(\u03b2|j)\u03c3\u03b1\u03b2,\nwhere Prl(\u03b1|i) is the conditional probability of haplotype \u03b1 given an allele i at\nlocus l. If haplotype \u03b1 has allele i at locus l then this is the product of the\nmarginal frequencies of the alleles at other loci, otherwise this is 0. Note that\nthe \u03c3\u00af\n(l)\nij s are independent of the allele frequencies at locus l, and that\n\u03c3\u00af =\nKl\u2211\ni=1\nKl\u2211\nj=1\nx\n(l)\ni x\n(l)\nj \u03c3\u00af\n(l)\nij . (6)\nFinally we can define a mean selection rate for an allele i at locus l as\n\u03c3\u00af\n(l)\ni =\nKl\u2211\nj=1\nx\n(l)\nj \u03c3\n(l)\nij .\nBy standard arguments the stochastic differential equation which describes the\nevolution of x is of the form (1). Using (3) and (4) we can obtain the drift\nfunction of x\n(l)\ni as,\nb\n(l)\ni (x) =\n1\n2\n(\u03b8\n(l)\ni \u2212 \u03b8\n(l)x\n(l)\ni ) + x\n(l)\ni (\u03c3\u00af\n(l)\ni \u2212 \u03c3\u00af).\nand that the infinitessimal covariance matrix is block diagonal (due to the sam-\npling independence across loci). The block diagonal entries A(1), . . . , A(L) corre-\nspond to the covariance matrices for loci 1, . . . , L respectively, with A(l) having\nentries\na\n(l)\nij =\n\uf8f1\uf8f2\n\uf8f3 x\n(l)\ni (1\u2212 x\n(l)\ni ) if i = j\n\u2212x\n(l)\ni x\n(l)\nj otherwise.\n5\nNote that the form of this covariance matrix comes directly from the covariance\nof multinomial random variables.\nFinally, we note that the neutral model is a special case of this model. Selection\nonly effects the drift function, and if c(x) is the drift function under neutrality\nwe have\nb\n(l)\ni (x) = c\n(l)\ni (x) + x\n(l)\ni (\u03c3\u00af\n(l)\ni \u2212 \u03c3\u00af). (7)\nFurthermore, in the neutral case the allele frequencies at each locus are indepen-\ndent. We denote the marginal distribution of allele frequencies at locus l in this\ncase by\npi\n(l)\nN (x\n(l)) \u221d\nKl\u220f\ni=1\n(x\n(l)\ni )\n\u03b8\n(l)\ni\n\u22121, (8)\nwhich is a Dirichlet distribution with parameters (\u03b8\n(l)\n1 , . . . , \u03b8\n(l)\nKl\n).\n3 Stationary Distribution\nOur main result is the following, which gives the stationary distribution of the\nmulti-locus selection model introduced in Section 2.\nTheorem 2 Consider the multi-locus model of Section 2. Let piN(x) be the sta-\ntionary distribution of the neutral model (\u03c3\u03b1,\u03b2 = 0 for all \u03b1 and \u03b2),\npiN(x) =\nL\u220f\nl=1\npi\n(l)\nN (x\n(l)),\nwhere pi\n(l)\nN (x\n(l)) is defined by (8). The stationary distribution of the general se-\nlection model is\npi(x) \u221d piN(x) exp\n{\n1\n2\n\u03c3\u00af\n}\n, (9)\nwhere \u03c3\u00af is the mean population selection rate, defined by (5).\n6\nProof: See Appendix A. 2\nThis result is a multilocus extension of the result presented in Donnelly et al.\n(2001). For the single locus case, (9) differs from equations 1\u20134 of Donnelly\net al. (2001) by the factor of 1\/2 in the exponent; and this is because we chose\na different scaling for our population-scaled selection rates (of 4N as opposed to\n2N).\nA special case of the general selection model of Section 2 is genic selection,\nwhere \u03c3\u03b1,\u03b2 = \u03c3\n\u2217\n\u03b1 + \u03c3\n\u2217\n\u03b2. In this case, we can define a haplotype mean selection\nrate \u03c3\u00af\u2217 =\n\u2211\nPr(\u03b1)\u03c3\u2217\u03b1, and we get \u03c3\u00af = 2\u03c3\u00af\n\u2217. Thus for genic selection\npi(x) \u221d piN(x) exp {\u03c3\u00af\n\u2217} .\nFinally the conditional distribution of the population allele frequencies at locus\nl, given the population frequencies at all other loci satisfies\npi(x(l)|x(\u2212l)) \u221d pi\n(l)\nN (x\n(l)) exp\n{\u2211\ni\n\u2211\nj\nx\n(l)\ni x\n(l)\nj \u03c3\n(l)\nij\n}\n.\nWhich is the stationary distribution of allele frequencies for a locus with the\nsame mutation parameters as locus l, and selection rates \u03c3\n(l)\nij .\n4 Properties of the Stationary distribution\nWe now consider properties of the joint stationary distribution of allele frequences\nat different loci, and how this distribution differs from that of a multiplicative\nselection model for which the allele frequencies are independent across loci. There\nare a large range of possible multi-locus models and parameter values we could\nconsider. For simplicity we concentrate on 2-locus models with genic selection,\nand we choose parameter values suitable for modelling complex disease genes.\nThe properties of the marginal and joint distributions of allele frequencies in\n7\nthe multiplicative model have been studied by Pritchard (2001) and Pritchard\nand Cox (2002) to address the question of whether common complex diseases\nare caused by common or rare variants. We will focus on one such model for\ncomplex diseases, and address to what extent the conclusions of this work are\nrobust to the assumption of a multiplicative selection model.\nWe consider a 2 locus model with alleles 1 and 2 at each locus. The loci represent\n2 unlinked genes, and we let 1 denote the susceptible allele at each gene (the\nallele that marginally increases the risk of a disease), and 2 the normal allele.\nSelection is in favour of the normal allele, whereas the mutation rate from normal\nto susceptible allele is much greater than for the reverse mutation, modelling\nthe fact that there may be many ways to impair the function of a gene, but\nmutations which repair a gene must be more specific (see Pritchard, 2001, for\nmore discussion)\nWe simplify notation from Section 3 by dropping the \u2217 superscript on genic\nselection rates. We fix mutation rates at \u03b8\n(l)\n1 = 1.5 and \u03b8\n(l)\n2 = 0.1. We assume the\nselection rates for the haplotype across the two loci satisfy \u03c311 = 0, \u03c312 = \u03c321 \u2265 0\nand \u03c322 \u2265 \u03c312. Under the multiplicative model of Pritchard (2001), \u03c312 = \u03c321 = \u03c3\nand \u03c322 = 2\u03c3 for some parameter \u03c3. We consider two general selection models,\nwhich are the two models most different from the multiplicative model: (A)\n\u03c312 = \u03c321 = 0; and (B) \u03c322 = \u03c312.\nFor models A and B we choose the (single) selection rate in the model to be\n12. For an appropriate comparison with a multiplicative selection model we\nfound the value of \u03c3 in the multiplicative selection model which gives the same\nmean population frequency of the susceptible alleles at each loci. These mean\nfrequencies are 49% and 52% for models A and B respectively; and we require\n\u03c3 = 5.6 and \u03c3 = 5.3 in the multiplicative model to attain the same mean\nfrequencies. We denote these two multiplicative models as models MA and MB\n8\nrespectively.\nA comparison of the joint distribution of allele frequencies at the two loci is shown\nin Figure 1, and a comparison of the marginal allele frequencies (calculated via\nnumerical integration, using ideas from Joyce, 2005) at a single locus are shown\nin Figure 2. The joint distribution for model A has a similar, though more highly\npeaked, mode at low allele frequencies at both loci as compared to model MA.\nThe main difference between these two models is that model A has a further mode\nwhere both allele frequencies are large; whereas the model MA has further modes\nwhere only one of the allele frequencies is large. The distribution of marginal\nallele frequencies has similar modes for both models A and MA, with the main\ndifference in the two distributions being that the variance of the allele frequencies\nis larger for model A, with less mass at intermediate frequencies (20%-80%).\nThere is a greater difference in the joint distribution of allele frequencies for\nmodels B and MB. Model B has modes for a high allele frequency at just one\nloci; whereas the main mode for model MB is for low allele frequencies at both\nloci. Again the main difference in the marginal distribution of allele frequencies\nat a single locus is that there is greater variance for model B, with less probability\nmass at intermediate frequencies.\nWe further looked at the distribution of the larger and smaller minor allele fre-\nquencies at the two loci for each model. These are shown in Figure 3, and are\nof interest as they show the probability of either one of both loci having a high\nminor allele frequency (and hence being a common variant responsible for the\ncomplex disease we are modelling). The distribution of the larger minor allele\nfrequency is concentrated on smaller values for the general models A and B then\nfor the comparative multiplicative models, while there is little difference in the\nsmaller minor allele frequency in each case. This shows that the probability of\na common variant for the complex disease under either general model is smaller\n9\nthan under the corresponding multiplicative model, and is consistent with the\nsmaller probability mass at intermediate frequencies (see Figure 2) under the\ngeneral models. Quantitatively, the difference between general and multiplica-\ntive models is small for Model B (probability of larger minor allele frequency\ngreater than 10% is 85% and 94% for the general and multiplicative models),\nbut much more substantial for model A (probabilities of 67% and 94% for the\ngeneral and multiplicative models).\n5 Simulating the Genealogy\nWe now consider simulating from the genealogy at a selective locus under our\nmulti-locus selection model. We first describe the ancestral process for these\nmodels, and then how knowledge of the stationary distribution of the population\nallele frequency enables us to perform exact simulation of the genealogy (at one\nlocus) of a sample conditional on the type of the sample. Furthermore, this\nenables us to sample from the unconditional distribution of the genealogy by\n(i) simulating the type of the sample (using Equation 9 to first simulate the\npopulation allele frequencies); and (ii) simulating the genealogy conditional on\nthe type of the sample.\nThe idea of conditional simulation of genealogies under (single-locus) selection\nwas first considered by Slade (2000), and exact simulation was introduced for\nthese models by Stephens and Donnelly (2003). We use the approach of Stephens\nand Donnelly (2003), together with a simplification from Fearnhead (2002) which\ncan greatly reduce the computational burden, to perform exact conditional sim-\nulation for our multi-locus selection models.\nFor simplicity and ease of exposition, we solely consider 2-locus, 2-allele genic\nselection models. We denote the alleles at each locus by 1 and 2. As described\n10\n0.2 0.6\n0.\n2\n0.\n6\n(a)\nAllele frequency locus 1\nAl\nle\nle\n fr\neq\nue\nnc\ny \nlo\ncu\ns \n2\n0.2 0.6\n0.\n2\n0.\n6\n(b)\nAllele frequency locus 1\nAl\nle\nle\n fr\neq\nue\nnc\ny \nlo\ncu\ns \n2\n0.2 0.6\n0.\n2\n0.\n6\n(c)\nAllele frequency locus 1\nAl\nle\nle\n fr\neq\nue\nnc\ny \nlo\ncu\ns \n2\n0.2 0.6\n0.\n2\n0.\n6\n(d)\nAllele frequency locus 1\nAl\nle\nle\n fr\neq\nue\nnc\ny \nlo\ncu\ns \n2\nFigure 1: Comparison of the joint distribution of allele frequencies at two loci.\n(a) General model A, \u03c312 = \u03c321 = 0 and \u03c322 = 12 (b) Multiplicative model MA\n\u03c3 = 5.6; (b) General model B, \u03c312 = \u03c321 = \u03c322 = 12; and (d) Multiplicative\nmodel MB \u03c3 = 5.3. The mean marginal allele frequencies are the same in (a)\nand (b); and in (c) and (d). In each plot lighter colours imply higher density.\n11\n0.0 0.2 0.4 0.6 0.8 1.0\n0.\n0\n0.\n5\n1.\n0\n1.\n5\n2.\n0\n2.\n5\n3.\n0\n(a)\nFrequency of Susceptible Allele\nPr\nob\nab\nilit\ny \nde\nns\nity\n0.0 0.2 0.4 0.6 0.8 1.0\n0.\n0\n0.\n5\n1.\n0\n1.\n5\n2.\n0\n2.\n5\n3.\n0\n(b)\nFrequency of Susceptible Allele\nPr\nob\nab\nilit\ny \nde\nns\nity\nFigure 2: Comparison of the marginal allele frequency of two-locus models. (a)\nGeneral model A, \u03c312 = \u03c321 = 0 and \u03c322 = 12 (full-line) and multiplicative model\nMA, \u03c3 = 5.6 (dashed-line); (b) General model B, \u03c312 = \u03c321 = \u03c322 = 12 (full line)\nand multiplicative model MB, \u03c3 = 5.3 (dashed-line).\n12\n0.0 0.2 0.4\n0\n1\n2\n3\n4\n5\n(a)\nMax Minor Allele Freq\nPr\nob\nab\nilit\ny \nde\nns\nity\n0.0 0.2 0.4\n0\n10\n20\n30\n(b)\nMin Minor Allele Freq\nPr\nob\nab\nilit\ny \nde\nns\nity\n0.0 0.2 0.4\n0.\n0\n1.\n0\n2.\n0\n3.\n0\n(c)\nMax Minor Allele Freq\nPr\nob\nab\nilit\ny \nde\nns\nity\n0.0 0.2 0.4\n0\n5\n10\n20\n(d)\nMin Minor Allele Freq\nPr\nob\nab\nilit\ny \nde\nns\nity\nFigure 3: Comparison of the marginal distribution of the larger and smaller minor\nallele frequencies. (a) larger minor allele frequencies; and (b) smaller minor allele\nfrequencies for general model A (full-line) and multiplicative model MA (dashed-\nline); (c) larger minor allele frequencies; and (d) smaller minor allele frequencies\nfor general model B (full-line) and multiplicative model MB (dashed-line).\n13\nabove, genic selection models are parameterised by a set of selection rates, one\nfor each possible haplotype. We denote these rates \u03c3ij for a haplotype with allele\ni at the first locus, and allele j at the second locus (again we have dropped the \u2217\nsuperscript used in Section 3 to simplify notation). Without loss of generality we\nassume \u03c311 = 0. For concreteness, from Section 5.2 onwards we further assume\nthat \u03c312 = \u03c321 = \u03c31 and \u03c322 = \u03c31+\u03c32, with \u03c31, \u03c32 \u2265 0. However, generalisation of\nour approach to multi-locus, multi-allele and general selection models is possible.\n5.1 Ancestral Processes\nThe ancestral process for our multi-locus model was derived in Fearnhead (2003),\nand is called the complex selection graph (CSG). This processes is an extension of\nthe Ancestral Selection Graph (Krone and Neuhauser, 1997) and the Ancestral\nInfluence Graph (Donnelly and Kurtz, 1999) and produces supra-genealogies,\nthat is graphs in which the genealogies are embedded, of samples at each of the\nloci. For a sample consisting of n(l) chromosomes at locus l, the CSG is started\nat time 0 with n(l) branches at locus l, for l = 1, 2. The CSG is a continuous\ntime Markov process, which simulates events in the history of the sample. The\npossible events are coalescent, mutation, and selection events. If at time t (in the\npast) there are n(t)(l) branches at locus l, then (backwards in time) coalescent and\nmutation events occur at the same rates as for the coalescent (n(t)(l)(n(t)(l)\u22121)\/2\nand n(t)(l)\u03b8(l)\/2 respectively), independent of the state or events at the other\nlocus. Selection events jointly affect both supra-genealogies. A selection event\noccurs at rate \u03c3\/2 to each branch at each locus, where \u03c3 = max{\u03c3ij} is the\nmaximum selection rate. At a selection event a new branch is added to the\nsupra-genealogy at each locus. The branch to which the selection event occured\nbecomes the continuing branch, the new branch at the same locus the incoming\nbranch, and the new branch at the other locus the linked-incoming branch.\n14\nIf the CSG is simulated until a time T in the past, and the alleles on each of the\nbranches in the CSG at time T are simulated, then the alleles on the branches\nin the CSG for all t < T can be simulated forward in time, and the genealogy\nof the sample at each locus can be recovered. Simulation forward in time is\nthe same as for the coalescent except for at the selection events. Consider a\nselection event to a branch at locus 1. At such a selection event, if the alleles on\nthe incoming and linked-incoming branches are i and j respectively, then with\nprobability \u03c3ij\/\u03c3 the incoming branch will be parental, otherwise the continuing\nbranch will be. This determines the allele of the branch to which the selection\nevent occurred, and by resolving which branches are parental at each selection\nevent we can obtain the genealogy at each locus.\nFor full details of the CSG, and its generalisations to multi-locus, multi-allele, and\ngeneral selection models see Fearnhead (2003). Whilst the above procedure can\nbe used to simulate genealogies under our multi-locus model, it can be inefficient.\nIn particular, the CSG has to be simulated back until a time T that is sufficiently\nlarge that there is negligible probability that the time to the most recent common\nancestor (TMRCA) at each locus will be larger than T . A more efficient approach\nto simulating genealogies is to first simulate the type of the sample, and then\nsimulate the CSG back in time conditional on this.\n5.2 Conditional Simulation\nWe now assume that the type of our sample is known. We focus on the case\nwhere the genealogy at a single locus is of interest. Without loss of generality\nwe assume that this is the first locus, and consider a sample of size n(1) at locus\n1, and of size 0 at locus 2. We further assume the haploid selection model where\n\u03c312 = \u03c321 = \u03c31 and \u03c322 = \u03c31 + \u03c32, with \u03c31, \u03c32 \u2265 0. We initially know the\nalleles of the n(1) branches at locus 1 in the CSG, and we will simulate the CSG\n15\nbackwards in time such that we always know the allele on each branch at each\nlocus. At time t in the past we will let n(t)\n(l)\ni denote the number of branches at\nlocus l which have allele i. Where the meaning is clear, we write n\n(l)\ni for n(t)\n(l)\ni\nin the following.\nBackward Simulation\nStephens and Donnelly (2000) show how to calculate the rates of events in the\ncoalescent backwards in time, conditional on knowing the alleles on the branches.\nThese calculations were extended to the ancestral selection graph in Stephens and\nDonnelly (2003). We briefly describe the general form of these calculations, which\ncan be intuitively viewed as an application of Bayes formula, or of time-reversing\na Markov process.\nLet pi(x) denote the stationary distribution of population allele frequencies (at a\nsingle locus). We can define the stationary probability of an ordered sample A\n(which consists of ni branches carrying allele i, for i = 1, . . . , K) by\npi(A) =\n\u222b ( K\u220f\ni=1\nxnii\n)\npi(x)dx.\nNow assume that the current state of our ancestral process, defined as the alleles\non each of the branches, is denoted by A; the unconditional rate of a specific\nevent is \u03bb and the new state of the process after this event is A\u2032. Then the\nconditional rate of such an event is just\n\u03bbpi(A\u2032)\/pi(A). (10)\nThese results generalise to the multi-locus case we consider, and a list of the\nconditional rates are given in Table 1. In this case A will represent the type of\nbranches at both loci. Our numerical method for calculating of pi(A) is described\nin Appendix B.\nVirtual and Real Branches\n16\nEvent Rate\nCoalescence: two branches type i n\n(1)\ni (n\n(l)\ni \u2212 1)pi(A\u2212 i)\/(2pi(A))\nMutation: branch i to j n\n(1)\ni \u03b8\n(l)\ni pi(A\u2212 i + j)\/(2pi(A))\nSelection: to branch type 1:\nS1a: addition of (1, 1) n\n(1)\n1 (\u03c31 + \u03c32)pi(A + 1\n(1) + 1(2))\/(2pi(A))\nS1b: addition of (1, 2) n\n(1)\n1 (\u03c31 + \u03c32)pi(A + 1\n(1) + 2(2))\/(2pi(A))\nS1c: addition of (2, 1) n\n(1)\n1 \u03c32pi(A + 2\n(1) + 1(2))\/(2pi(A))\nS1d: addition of (2, 2) n\n(1)\n1 \u03c31pi(A + 2\n(1) + 2(2))\/(2pi(A))\nSelection: to branch type 2:\nS2a: addition of (1, 1) n\n(1)\n2 (2\u03c31 + \u03c32)pi(A + 1\n(1) + 1(2))\/(2pi(A))\nS2b: addition of (1, 2) n\n(1)\n2 (\u03c31 + 2\u03c32)pi(A + 1\n(1) + 2(2))\/(2pi(A))\nS2c: addition of (2, 1) n\n(1)\n2 (\u03c31 + \u03c32)pi(A + 2\n(1) + 1(2))\/(2pi(A))\nS2d: addition of (2, 2) n\n(1)\n2 (\u03c31 + \u03c32)pi(A + 2\n(1) + 2(2))\/(2pi(A))\nTable 1: Backward rates conditional on the current state: the set of alleles on\neach branch in the CSG. Rates are given for events at locus 1 (the rates at locus\n2 can be calculated by symmetry). The current state is denoted by A. For\ncoalesence and mutation events we have used the shorthand, whereby we denote\nby A\u2212 i and A + j, states which differ from A by the removal of an allele i and\nthe addition of allele j at locus 1 respectively. For selection events we use the\nnotation A + 1(1) + 2(2) to denote a state which differs from A by the addition of\na branch of type 1 at locus 1 and of type 2 at locus 2. At selection events two\nvirtual branches are added to CSG; for example the event denoted S1b adds a\nbranch of type 1 at locus 1 and a branch of type 2 at locus 2. For derivation of\nthe selection rates see Appendix C.\n17\nBy simulating selection events conditional on the alleles on the branches, we are\nable to determine which of the incoming and continuing branches are ancestral\n(see Table 1). As noted by Slade (2000), this enables us to keep track of which\nbranches in the CSG are ancestral to the sample, and hence in the genealogy of\nthe sample, and which are not. We call the branches which are in the genealogy\nreal branches, and those which are not, virtual branches.\nThere are two practical advantages of keeping track of which branches are real\nand which are virtual. Firstly it enables us to determine the first point at which\nwe can stop our conditional simulation of the genealogy, as this will be the first\ntime at which there is just one real branch at the first locus in our CSG.\nSecondly, it enables us to simplify the conditional simulation of the CSG, as it is\nonly events which effect the real branches that we are interested in. We do need\nto include virtual branches in our CSG, however it is shown in Fearnhead (2002)\nthat some virtual branches can be removed. The intuition behind this idea is as\nfollows.\nA key feature of the CSG (and other ancestral processes) is that the distribution\nof the population allele frequencies at a time t in the past, conditional on the\nevents in the CSG up to time t, is equal to the conditional distribution of the\nallele frequencies given the state of the CSG at time t. This is the condition that\nmeans that (10) is the correct rate for simulating events in the CSG (and that\nthese rates only depend on the current state). The reason that virtual branches\ncannot be removed from the CSG is that this condition would no longer hold:\nthat is that the distribution of the population allele frequencies at a time t in\nthe past, conditional on the events in the CSG up to time t, is not necessarily\nequal to the conditional distribution of the allele frequencies given the alleles on\nthe real branches at time t.\nHowever it is possible to remove certain virtual branches in the CSG, such that\n18\nthis key feature of the CSG is maintained. The condition for removing branches\nis that the distribution of the allele on the virtual branch must be the conditional\ndistribution of an allele given the alleles on all branches in the CSG.\nRemoval of Virtual Branches\nIn practice, virtual branches can be removed at (i) mutation events to virtual\nbranches; and (ii) selection events. We first describe (i) in detail, and then more\nbriefly cover the calculations for (ii).\nConsider a mutation event at locus l (backwards in time) to a virtual branch of\ntype i. Let the current state of the CSG be A, and denote by A\u2212 i + j the state\nobtained by removing an allele of type i and adding an allele of type j to the\ncurrent set of alleles at locus l. (We have suppressed the dependence on l in our\nnotation to simplify notation.) The backward rate at which such an event occurs\nis \u03b8\n(l)\ni pi(A \u2212 i + j)\/(2pi(A)). Note the mutation rate depends on i and not j, as\nthe actual mutation forward in time is from allele j to i.\nBy summing over j we get that the rate of a mutation at locus l to a virtual branch\nof type i is just \u03b8\n(l)\ni pi(A\u2212i)\/(2pi(A)). So we could simulate a mutation event by (a)\nsimulating a mutation event with rate \u03b8\n(l)\ni pi(A\u2212 i)\/(2pi(A)); and (b) conditional\non a mutation occuring, simulate the new type from pi(A \u2212 i + j)\/pi(A \u2212 i) =\npi(j|A \u2212 i), the conditional distribution of an allele given the alleles on all the\nother branches in the CSG. As shown by Theorem 1 of Fearnhead (2002), and\ndescribed above, we can thus remove this branch.\nWe now describe the calculations for selection events in the case \u03c32 \u2265 \u03c31. The\ncalculations for \u03c32 < \u03c31 proceed similarly. The resulting rates of selection event\nare summarised in Table 2.\nFirst consider selection to branches of type 1, and sum the rate of the events S1a\u2013\nS1d. Using the same notation as in Table 1, the total rate of selection events to\n19\nbranches of type 1 becomes\nn\n(1)\n1\n2pi(A)\n(\n\u03c31(pi(A + 1\n(1) + 1(2)) + pi(A + 1(1) + 2(2)) + pi(A + 2(1) + 1(2)) + pi(A + 2(1) + 2(2)))\n+\u03c32(pi(A + 1\n(1) + 1(2)) + pi(A + 1(1) + 2(2))) + (\u03c32 \u2212 \u03c31)pi(A + 2\n(1) + 1(2))\n)\n,\nwhich simplifies to\nn\n(1)\n1\n2pi(A)\n(\n\u03c31pi(A) + \u03c32pi(A + 1\n(1)) + (\u03c32 \u2212 \u03c31)pi(A + 2\n(1) + 1(2))\n)\n.\nThus we can split simulating an selection event to a specfic branch of type 1 into\nthree, each refering to a term in this expression:\n(1) At rate n\n(1)\n1 \u03c31\/2 simulate the types of new branches at both loci from\npi(i(1), j(2), |A).\n(2) At rate n\n(1)\n1 \u03c32pi(A + 1\n(1))\/(2pi(A)) add a branch of type 1 to locus 1. Sim-\nulate the type of a new branch at locus 2 from pi(i(2)|A + 1(1)).\n(3) At rate n\n(1)\n1 (\u03c32 \u2212 \u03c31)pi(A + 2\n(1) + 1(2))\/(2pi(A)) add a branch of type 2 to\nlocus 1 and of type 1 to locus 2.\nThus by Theorem 1 of Fearnhead (2002), we do not need to add the branch at\nlocus 2 for event (2) or either new branch for event (1). Thus in total we add\na new virtual branch of type 1 to locus 1 with rate n\n(1)\n1 \u03c32pi(A + 1\n(1))\/(2pi(A))\nand two virtual branches of types 2 at locus 1 and type 1 at locus 2 with rate\nn\n(1)\n1 (\u03c32 \u2212 \u03c31)pi(A + 2\n(1) + 1(2))\/(2pi(A)).\nBy similar argument for selection events to branches of type 2, we just need to\nadd a new virtual branch of type 1 to locus 1 with rate n\n(1)\n2 \u03c32pi(A+1\n(1))\/(2pi(A)),\nand two new virtual branches, of types 1 at locus 1 and 2 at locus 2 with rate\nn\n(1)\n2 (\u03c32 \u2212 \u03c31)pi(A + 2\n(1) + 1(2))\/(2pi(A)).\n20\nAdd \u03c31 \u2264 \u03c32 \u03c31 > \u03c32\n1(1) (n\n(1)\n2 \u03c31 + n\n(1)\n1 \u03c32)pi(1\n(1)|A)\/2 (n\n(1)\n2 \u03c32 + n\n(1)\n1 \u03c31)pi(1\n(1)|A)\/2\n1(2) (n\n(2)\n2 \u03c31 + n\n(2)\n1 \u03c32)pi(1\n(2)|A)\/2 (n\n(2)\n2 \u03c32 + n\n(2)\n1 \u03c31)pi(1\n(2)|A)\/2\n1(1), 1(2) 0 (n\n(1)\n2 + n\n(2)\n2 )(\u03c31 \u2212 \u03c32)pi(1\n(1) + 1(2)|A)\/2\n1(1), 2(2) (n\n(1)\n2 + n\n(2)\n1 )(\u03c32 \u2212 \u03c31)pi(1\n(1) + 2(2)|A)\/2 0\n2(1), 1(2) (n\n(1)\n1 + n\n(2)\n2 )(\u03c32 \u2212 \u03c31)pi(2\n(1) + 1(2)|A)\/2 0\n2(1), 2(2) 0 (n\n(1)\n1 + n\n(2)\n1 )(\u03c31 \u2212 \u03c32)pi(2\n(1) + 2(2)|A)\/2\nTable 2: Simplified rates for addition of virtual branches due to selection events.\nFor notational convenience we write pi(1(1)|A) for pi(A + 1(1))\/pi(A) etc. See text\nfor details of calculation of these rates; rates are calculated by summing rates of\nadding branches of specific type at selection events for both loci.\n5.3 Results\nWe simulated genealogies at the first locus under Models A and B from Section\n4. For each model we considered two cases (i) the distribution of the genealogy\nat a locus conditional on a sample of 50 alleles of type 1 and 50 alleles of type\n2 at that locus; and (ii) the unconditional genealogy of a sample of size 100.\nFor comparison, we also simulated genealogies under models MA and MB (see\nSection 4) in each case. We simulated 1000 genealogies for each of these eight\ncases, and looked at the distribution of summaries of these genealogies and the\nmutations on the genealogies.\nFirstly we looked at three features of the genealogies, the time to the most recent\ncommon ancestor (TMRCA), the total length of the branches, and the total\nlength of the exterior branches. We found little difference in the distribution of\nthese between the general and multiplicative models in each to the four cases\nabove. For example, Figure 4 shows the distributions of TMRCA and length of\n21\nthe tree for Model A.\nSecondly we looked at features of mutations on the genealogies. We motivated\nmodels A and B as suitable for complex disease genes, and the age and frequency\nof susceptible mutations under such models are important factors underlying the\npower of studies to detect such genes (see Pritchard, 2001). Again we aim to\nget some insight into the robustness of the results in Pritchard (2001) to the\nassumption of a multiplicative model for selection.\nWe studied the number of mutations from a Normal to a Susceptible allele, and\nthe age of the most common Susceptible allele. For each of our four scenarios the\nmean number of mutations is smaller under the general model (2.2, 3.6, 2.1 and\n3.5 for scenarios A(i), A(ii), B(i) and B(ii) respectively) than the multiplicative\nmodel ( 2.8, 3.9, 2.5 and 3.9 respectively for the four scenarios). The distribution\nof the age of the most common mutation is concentrated on smaller values for the\ngeneral models (see Figure 5). These results suggest smaller allelic heterogeneity\nunder the general models, which means greater power for association studies;\nand younger mutations under the general models, which means larger regions\naround the mutations that are identical by descent.\n6 Discussion\nWe have considered a population genetics model for unlinked loci, where parent-\nindependent mutations occur at each locus, but where the fitness of an individual\ndepends on the alleles at each locus. If the fitness of an individual depended in\na multiplicative way on individual fitnesses of genotypes at each locus, then the\ndistribution of the allele frequencies would be independent across loci. We have\ncalculated the stationary distribution of the allele frequencies for a general selec-\ntion model. This distribution is proportional to the distribution under neutrality\n22\n0 2 4 6 8 10\n0.\n0\n0.\n1\n0.\n2\n0.\n3\n0.\n4\n0.\n5\n(a)\nTMRCA\nde\nns\nity\n0 5 10 15 20 25\n0.\n00\n0.\n05\n0.\n10\n0.\n15\n0.\n20\n(b)\nLength\nde\nns\nity\n0 2 4 6 8\n0.\n0\n0.\n2\n0.\n4\n0.\n6\n(c)\nTMRCA\nde\nns\nity\n0 5 10 15 20\n0.\n00\n0.\n05\n0.\n10\n0.\n15\n0.\n20\n(d)\nLength\nde\nns\nity\nFigure 4: Comparison of the distribution of TMRCA and length of the tree for a\nsample of size 100 for Model A (full-line) and a model MA (dashed-line). Plots\n(a) and (b): unconditional distributions; plots (c) and (d): conditional on 50\nalleles of each type.\n23\n0 1 2 3 4 5\n0.\n0\n1.\n0\n2.\n0\n3.\n0\nA(i)\nAge of Most Common Mutation\nPr\nob\nab\nilit\ny \nde\nns\nity\n0 1 2 3\n0.\n0\n0.\n5\n1.\n0\n1.\n5\nA(ii)\nAge of Most Common Mutation\nPr\nob\nab\nilit\ny \nde\nns\nity\n0 1 2 3 4\n0.\n0\n0.\n5\n1.\n0\n1.\n5\n2.\n0\n2.\n5\nB(i)\nAge of Most Common Mutation\nPr\nob\nab\nilit\ny \nde\nns\nity\n0 1 2 3 4 5\n0.\n0\n1.\n0\n2.\n0\n3.\n0\nB(ii)\nAge of Most Common Mutation\nPr\nob\nab\nilit\ny \nde\nns\nity\nFigure 5: Comparison of the age of the most common susceptible mutation.\nPlots are labelled according to the Model (A or B) and whether unconditional\n(i) or conditional (ii). In each plot the full-line is the density under the general\nmodel, and the dashed-line the density under the multiplicative model.\n24\nmultiplied by the exponential of half the mean population fitness. This result is\na multi-locus extension of the result in Donnelly et al. (2001).\nWe have also shown how knowledge of this stationary distribution allows in-\ndependent samples from the distribution of genealogies at a single locus to be\nsimulated. Our simulation method is based on the idea of Stephens and Don-\nnelly (2003), but additionally uses the simplification of Fearnhead (2003). This\nsimplification, and the resulting method for simulation applies more general to\nsimulation of genealogies at selected loci. For example, it trivially applies to sin-\ngle locus models (as they are a special case of our multi-locus models); and this\nsimplification can substantially reduce the computational burden of the approach\nof Stephens and Donnelly (2003) for some selection models.\nWe have presented a few results comparing the features of our general selection\nmodel and the multiplicative model. Our focus has been on suitable models\nfor complex diseases. For the parameter values considered we found that most\nimportant features of the data and genealogy under the multiplicative model were\nvery similar to those under the general model. The two exceptions appear to be\nthat (i) mutations which increase susceptibility to the disease (or equivalently\nreduce fitness) tend to be younger under the general model; (ii) there are fewer\nsuch mutations in the history of a sample under the general model; and (iii) there\nis less chance of obtaining alleles at intermediate frequency under the general\nmodel.\nAcknowledgement I would like to thank Gareth Roberts for helpful discussions\nabout Langevin Diffusions. This work was funded by EPSRC grant GR\/R91724\/01.\n25\nReferences\nCordell, H. J., Todd, J. A., Hill, N. J., Lyons, P. A., Peterson, L. B., Wicker,\nL. S. and Clayton, D. G. (2001). Statistical modeling of interlocus interactions\nin a complex disease: Rejection of the multiplicative model of epistasis in type\n1 diabetes. Genetics 158, 357\u2013367.\nDonnelly, P. and Kurtz, T. (1999). Genealogical processes for Fleming-Viot mod-\nels with selection and recombination. Annals of Applied Probability 9, 1091\u2013\n1148.\nDonnelly, P., Nordborg, M. and Joyce, P. (2001). Likelihoods and simulation\nmethods for a class of non-neutral population genetics models. Genetics 159,\n853\u2013867.\nFearnhead, P. (2002). The common ancestor at a non-neutral locus. Journal of\nApplied Probability 39, 38\u201354.\nFearnhead, P. (2003). Ancestral processes for non-neutral models of complex\ndiseases. Theoretical Population Biology 63, 115\u2013130.\nFearnhead, P. and Meligkotsidou, L. (2004). Exact filtering for partially-observed\ncontinuous-time Markov models. Journal of the Royal Statistical Society, series\nB 66, 771\u2013789.\nJoyce, P. (2005). Efficient simulation methods for a class of nonneutral population\ngenetics models. Theoretical Population Biology to appear.\nKent, J. (1978). Time-reversible diffusions. Advances in Applied Probability 10,\n819\u2013835.\nKrone, S. M. and Neuhauser, C. (1997). Ancestral processes with selection. The-\noretical Population Biology 51, 210\u2013237.\n26\nNiu, T. H., Xu, X. P., Cordell, H. J., Rogus, J., Zhou, Y. S., Fang, Z. and\nLindpaintner, K. (1999). Linkage analysis of candidate genes and gene-gene\ninteractions in Chinese hypertensive sib pairs. Hypertension 33, 1332\u20131337.\nPritchard, J. K. (2001). Are rare variants responsible for susceptibility to complex\ndiseases? American Journal of Human Genetics 69, 124\u2013137.\nPritchard, J. K. and Cox, N. J. (2002). The allelic architecture of human disease\ngenes: common disease\u2013common variant...or not? Human Molecular Genetics\n11, 2417\u20132423.\nRisch, N. (1990). Linkage strategies for genetically complex traits. I. Multilocus\nmodels. American Journal of Human Genetics 46, 222\u2013228.\nRoberts, G. O. and Stramer, O. (2002). Tempered Langevin diffusions and algo-\nrithms .\nSlade, P. F. (2000). Simulation of selected genealogies. Theoretical Population\nBiology 57, 35\u201349.\nStephens, M. and Donnelly, P. (2000). Inference in molecular population genetics\n(with discussion). Journal of the Royal Statistical Society, Series B 62, 605\u2013\n655.\nStephens, M. and Donnelly, P. (2003). Ancestral inference in population genetics\nmodels with selection. Australian and New Zealand Journal of Statistics 45,\n395\u2013423.\nWiesch, D. G., Meyers, D. A. and Bleecker, E. R. (1999). Genetics of asthma.\nJournal of allergy and clinical immunology 104, 895\u2013901.\n27\nWright, S. (1949). Adaption and selection. In: Genetics, Paleontology and Evo-\nlution (eds. G. L. Jepson, G. G. Simpson and E. Mayr), Princeton University\nPress, Princeton, NJ, 365\u2013389.\nAppendix A: Proof of Thoerem 2\nAn immediate corollary of Theorem 1 is the following. Assume we have a d-\ndimensional diffusion with drift function c(x) and covariance matrix a(x) which\nsatisfies Equation 2 (with c(x) in place for b(x)) for a given probability density\npi(x). Further assume a process X \u2032 satisfies is second d-dimensional diffusion\nwhich satisifes stochastic differential equation (1) with drift function\nb(x) = c(x) + d(x)\nfor some d-dimensional function d(x), but the same covariance matrix a(x). Then\nif there exists a positive d-dimensional function \u03bb(x) such that for i = 1, . . . , d,\ndi(x) =\n1\n2\nd\u2211\nj=1\naij(x)\u2202 log \u03bb(x)\/\u2202xj (11)\nthen the stationary distribution, p\u02dci(x) of X \u2032 satisfies\np\u02dci(x) \u221d pi(x)\u03bb(x).\nThis corrolary can be applied to the multi-locus selection model of Section 2 by\nletting the first diffusion be that for the neutral model, and the X \u2032 diffusion be\nthat for the non-neutral model. The relationship between the drifts is given by\n(7), so\nd\n(l)\ni (x) = x\n(l)\ni (\u03c3\u00af\n(l)\ni \u2212 \u03c3\u00af).\nWe thus only need to show that log \u03bb(x) = 1\n2\n\u03c3\u00af satisfies (11) in order to prove\nTheorem 2. We further note that the if we consider the drift for x\n(l)\n(i) we need only\nconsider the sum over j for the allele frequencies at locus l on the right-hand\nside of (11), as the aij terms are 0 for allele frequencies at two distinct loci.\n28\nBy using (6), and noting \u03c3\n(l)\nij = \u03c3\n(l)\nji we can see that\n\u2202\u03c3\u00af\/\u2202x\n(l)\nj = 2\nKl\u2211\nk=1\n(\u03c3\n(l)\nkj \u2212 \u03c3\n(l)\nkKl\n).\nSo if \u03bb(x) = exp{\u03c3\u00af\/2} the right-hand side of (11) becomes\nx\n(l)\ni\n[\nKl\u2211\nk=1\nx\n(l)\nk \u03c3\n(l)\nkj \u2212\nKl\u2211\nk=1\nx\n(l)\nk \u03c3\n(l)\nkKl\n\u2212\nKl\u2211\nj=1\nx\n(l)\nj\nKl\u2211\nk=1\nx\n(l)\nk \u03c3\n(l)\nkj +\nKl\u2211\nj=1\nx\n(l)\nj\nKl\u2211\nk=1\nx\n(l)\nk \u03c3\n(l)\nkKl\n]\n.\n(12)\nThe first two sums on the left-hand side of this equation come from the product\nof \u2202\u03c3\u00af\/\u2202x\n(l)\ni and the x\n(l)\ni term in aii and the third and fourth terms come from\nthe product of \u2202\u03c3\u00af\/\u2202x\n(l)\nj and the \u2212x\n(l)\ni x\n(l)\nj terms in the aij (remembering aij = 0\nfor allele frequencies at separate loci).\nFinally we note that the second and fourth sums in this equation cancel; the first\nsimplifies to \u03c3\u00af\n(l)\ni and the third simplifies to \u03c3\u00af. Thus (12) simplifies to d\n(l)\ni (x) as\nrequired. 2\nAppendix B: Evaluating pi(A)\nCalculating pi(A) requires the calculation of an integral of the form\u222b 1\n0\n\u222b 1\n0\nxa\u22121(1\u2212x)b\u22121yc\u22121(1\u2212y)d\u22121 exp{\u03c31(x(1\u2212y)+y(1\u2212x))+(\u03c31+\u03c32)xy}dxdy,\n(13)\nwhere in the integrand x and y represent the frequency of the advantageous\nalleles at the first and second loci, and the known constants a, b, c and d depend\non the mutation rates and sample configuration.\nOur approach to calculating integrals of this form is based on ideas from Fearn-\nhead and Meligkotsidou (2004) and depends on whether or not \u03c31 > \u03c32. For\neach case we introduce the following notation\nRx[i, j] =\n\u222b 1\n0\nxa+i\u22121(1\u2212 x)b+j\u22121dx, and\nRy[i, j] =\n\u222b 1\n0\nyc+i\u22121(1\u2212 y)d+j\u22121dy,\n29\nwhich are standard Beta constants.\nCase 1: \u03c32 \u2265 \u03c31\nIn this case we can simplify and then expand the exponential in (13) as\nexp(\u03c31(x + y) + (\u03c32 \u2212 \u03c31)xy) =\n\u221e\u2211\nk=0\n(\u03c32 \u2212 \u03c31)\nk\nk!\n\u221e\u2211\ni=0\n\u221e\u2211\nj=0\n\u03c3i+j1\ni!j!\nxi+kyj+k.\nThus (13) can be written as\n\u221e\u2211\nk=0\n(\u03c32 \u2212 \u03c31)\nk\nk!\n\u221e\u2211\ni=0\n\u221e\u2211\nj=0\n\u03c3i+j1\ni!j!\nRx[i + k, 0]Ry[j + k, 0].\nFinally writing\nAk =\n\u221e\u2211\ni=0\n\u03c3i1\ni!\nRx[i + k, 0], and Bk =\n\u221e\u2211\nj=0\n\u03c3j1\nj!\nRy[j + k, 0],\nwe get that (13) is equal to\n\u221e\u2211\nk=0\n(\u03c32 \u2212 \u03c31)\nk\nk!\nAkBk. (14)\nWe first evaluate Ak and Bk by truncating their infinite sums, and then truncate\nthis infinite sum to evaluate (13). All sums are sums of positive terms, and\nare thus stable to evaluate, and the terms in the sums decay exponentially for\nsufficiently large values of the sums. Furthermore a look-up table of the Aks and\nBks can be constructed to speed up the calculation of (14).\nCase 2: \u03c31 > \u03c32\nWe now write and expand the exponential in (13) as\nexp(\u03c31y + (\u03c31 \u2212 \u03c32)x + \u03c32x(1\u2212 y)) =\n\u221e\u2211\nk=0\n\u03c3k2\nk!\n\u221e\u2211\ni=0\n\u221e\u2211\nj=0\n(\u03c31 \u2212 \u03c32)\ni\u03c3j1\ni!j!\nxi+kyj(1\u2212 y)k.\nThus (13) can be written as\n\u221e\u2211\nk=0\n\u03c3k2\nk!\n\u221e\u2211\ni=0\n\u221e\u2211\nj=0\n(\u03c31 \u2212 \u03c32)\ni\u03c3j1\ni!j!\nRx[i + k, 0]Ry[j, k].\n30\nFinally writing\nCk =\n\u221e\u2211\ni=0\n(\u03c31 \u2212 \u03c32)\ni\ni!\nRx[i + k, 0], and Dk =\n\u221e\u2211\nj=0\n\u03c3j1\nj!\nRy[j, k],\nwe get that (13) is equal to\n\u221e\u2211\nk=0\n\u03c3k2\nk!\nCkDk.\nThis can be evaluate in an equivalent way to (14), and again is stable as it\nrequires sums of positive terms which decay exponentially. Calculation of this\nsum can be made efficient by constructing a look-up table for the Ck and Dk\nterms.\nAppendix C: Backward Rates at Selection events\nConsider a selection event forward in time. There are 8 possible configurations\nof continuing, incoming and linked-incoming branch, and for each configuration\nwe can write down the probability of the new branch being of type 1 or 2. These\nprobabilities multiplied by the unconditional rate of selection events per branch\n(\u03c31 + \u03c32)\/2 are summaried in Table 3\nTo get conditional backward rates involves (i) summing up the rates of selection\nevents per branch that produce the correct offsrping, and have the correct type of\nvirtual branch at each locus; and (ii) multiplying this by the number of branches\nof the correct type and the ratio of the stationary probabilities of the new and\nold states of the CSG.\nSo to obtain the rate of event S2a (selection to branch of type 2, producing\nvirtuals of type 1 at each locus) in Table 1, for (i) we get contributions of \u03c31\/2\nand (\u03c31 +\u03c32)\/2 from respectively lines 3 and 5 of the above table; and for (ii) we\nget a factor of n\n(1)\n2 pi(n\n(1)\n1 + 1, n\n(1)\n2 , n\n(2)\n1 + 1, n\n(2)\n2 )\/pi(A). The rates in (i) are added\nand their sum multiplied by the factor in (ii) to obtain the required rate. Other\nentries in Table 1 are obtained similarly.\n31\nContinuing Incoming Linked Incoming 1 2\n1 1 1 (\u03c31 + \u03c32)\/2 0\n1 1 2 (\u03c31 + \u03c32)\/2 0\n1 2 1 \u03c32\/2 \u03c31\/2\n1 2 2 0 (\u03c31 + \u03c32)\/2\n2 1 1 0 (\u03c31 + \u03c32)\/2\n2 1 2 \u03c31\/2 \u03c32\/2\n2 2 1 0 (\u03c31 + \u03c32)\/2\n2 2 2 0 (\u03c31 + \u03c32)\/2\nTable 3: Rates of specific selection events producing branches of type 1 and 2\n(forward in time)\n32\n"}