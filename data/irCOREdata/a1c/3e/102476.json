{"doi":"10.1109\/MMSP.2005.248573","coreId":"102476","oai":"oai:epubs.surrey.ac.uk:1939","identifiers":["oai:epubs.surrey.ac.uk:1939","10.1109\/MMSP.2005.248573"],"title":"Efficient RobustWatermarking of Compressed 2-D Grayscale Patterns for H.264\/AVC","authors":["Zhang, Jing","Ho, Anthony T. S."],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2005-10-01","abstract":"<p>An efficient and robust video watermarking algorithm for the state-of-the-art video coding standard H.264\/AVC is proposed for copyright protection. Grayscale 2-D watermark patterns such as detailed trademarks or logos can be highly compressed by a proposed grayscale watermark pre-processing, and inserted into the low bit-rate H.264\/AVC videos in the compressed domain. The marked video sequences maintain good visual quality and the same overall consuming bit-rate. The proposed algorithm can robustly survive transcoding process and common signal processing, such as bit-rate reduction, Gaussian filtering and contrast enhancement. <\/p","downloadUrl":"","fullTextIdentifier":null,"pdfHashValue":null,"publisher":null,"rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:epubs.surrey.ac.uk:1939<\/identifier><datestamp>\n      2017-10-31T14:03:43Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      74797065733D636F6E666572656E63655F6974656D<\/setSpec><setSpec>\n      6469766973696F6E733D656E67616E64706879736963616C736369656E636573:436F6D707574696E67<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:relation>\n    \n      \n        http:\/\/epubs.surrey.ac.uk\/1939\/<\/dc:relation><dc:title>\n        Efficient RobustWatermarking of Compressed 2-D Grayscale Patterns for H.264\/AVC<\/dc:title><dc:creator>\n        Zhang, Jing<\/dc:creator><dc:creator>\n        Ho, Anthony T. S.<\/dc:creator><dc:description>\n        <p>An efficient and robust video watermarking algorithm for the state-of-the-art video coding standard H.264\/AVC is proposed for copyright protection. Grayscale 2-D watermark patterns such as detailed trademarks or logos can be highly compressed by a proposed grayscale watermark pre-processing, and inserted into the low bit-rate H.264\/AVC videos in the compressed domain. The marked video sequences maintain good visual quality and the same overall consuming bit-rate. The proposed algorithm can robustly survive transcoding process and common signal processing, such as bit-rate reduction, Gaussian filtering and contrast enhancement. <\/p><\/dc:description><dc:date>\n        2005-10-01<\/dc:date><dc:type>\n        Conference or Workshop Item<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:format>\n        text<\/dc:format><dc:language>\n        en<\/dc:language><dc:identifier>\n        http:\/\/epubs.surrey.ac.uk\/1939\/1\/fulltext.pdf<\/dc:identifier><dc:identifier>\n          Zhang, Jing and Ho, Anthony T. S.  (2005) Efficient RobustWatermarking of Compressed 2-D Grayscale Patterns for H.264\/AVC  In: 2005 IEEE 7th Workshop on Multimedia Signal Processing.     <\/dc:identifier><dc:relation>\n        10.1109\/MMSP.2005.248573<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/epubs.surrey.ac.uk\/1939\/","10.1109\/MMSP.2005.248573"],"year":2005,"topics":[],"subject":["Conference or Workshop Item","PeerReviewed"],"fullText":"Efficient Robust Watermarking of Compressed 2-D Grayscale Patterns for H.264\/AVC\nJing Zhang and Anthony T. S. Ho\nCenter for Information Security\nSchool of Electrical and Electronic Engineering\nNanyang Technological University\nSingapore 639798\nEmail: JingzhangWpmail.ntu.edu.sg; etshogntu.edu.sg\nAbstract-An efficient and robust video watermarking algo-\nrithm for the state-of-the-art video coding standard H.264\/AVC\nis proposed for copyright protection. Grayscale 2-D watermark\npatterns such as detailed trademarks or logos can be highly\ncompressed by a proposed grayscale watermark pre-processing,\nand inserted into the low bit-rate H.264\/AVC videos in the\ncompressed domain. The marked video sequences maintain good\nvisual quality and the same overall consuming bit-rate. The\nproposed algorithm can robustly survive transcoding process and\ncommon signal processing, such as bit-rate reduction, Gaussian\nfiltering and contrast enhancement.\nIndex Terms- H.264\/AVC, robust video watermarking,\ngrayscale watermark pre-processing, compressed 2-D grayscale\npatterns, copyright protection.\nI. INTRODUCTION\nThe progress in multimedia storage and transmission tech-\nnology has allowed an ever increasing amount of information\nin digital format for archiving and transmission. However,\nthe ease of copying and reproducing digital data is more\nlikely to encourage the work of pirates and hackers, since\nit enables perfect copies with no loss in data quality. Digital\nwatermarking represents a valid solution to the above problem,\nsince it is possible to identify the source, author, creator,\nowner, distributor or authorized consumer of digitized images,\nvideo recordings or audio recordings. A digital watermark is\nan identification code, permanently embedded into digital data,\ncarrying information pertaining to copyright protection.\nDigital video watermarking algorithms can be sorted ac-\ncording to the embedding domain, such as the spatial domain,\ncompressed domain, and bitstream domain. Compressed-\ndomain watermarking methods arouse great interests among\nresearchers. Hartung et al. [1] embedded spread-spectrum wa-\ntermark into the MPEG-2 bitstream with drift compensation,\nbut the capacity is reduced. Arena et al. [2] watermarked\nthe MPEG-2 video using interleaved coding. The differential\nenergy watermark method has been extended to video from\nstill images by watermarking the I-frames of an MPEG stream\nas in [3]. However, most of the previous works were focusing\non MPEG standards for high bit-rate applications rather than\nlow bit-rate videos (< 1 Mbit\/s).\nThe H.264\/AVC standard is specially designed for low bit-\nrate applications. It significantly improves the coding effi-\nciency with the help of many enhanced functional features,\nsuch as the highly flexible tree-structured motion compen-\nsation, superior rate-distortion related Lagrangian Optimiza-\ntion, 4 x 4 Integer DCT and the very efficient context-\nbased arithmetic-coding scheme [4]. H.264\/AVC has achieved\naveragely 50% in bit-rate savings when compared with exist-\ning standards such as MPEG-4 Video [4]. However, higher\ncompression ratio leads to the difficulty in balancing among\ntradeoff requirements for watermarking video data [5], [6].\nThis paper describes a digital watermarking scheme of\nH.264\/AVC video format, working directly in the compressed\ndomain. The scheme makes an accurate usage of the video\nencoder for watermark embedding, and experimental results\nexhibit robust results for this low bit-rate format under\ntranscoding and common signal processing. In the digital\nrights management system, company trademarks and logos\nare always considered as excellent watermark for copyright\nprotection [5]. Hence, this paper also proposes a novel pre-\nprocessing for grayscale watermark patterns. It is more impor-\ntant that the pre-processing can help to solve the low capacity\nproblem for watermarking the H.264\/AVC video due to the\nhigh compression performance.\nThe grayscale watermark pre-processing method is intro-\nduced in the next section. The proposed watermarking method\nbased on the emerging H.264\/AVC standard will also be\ndescribed. The simulation results and conclusions will be given\nin Section III and Section IV, respectively.\nII. PROPOSED WATERMARKING ALGORITHM\nIn this paper, 2-D texture grayscale trademarks and logos\nare first pre-processed and then embedded as the robust wa-\ntermarks for copyright protection for H.264\/AVC video data.\nFigure 1 shows the watermarking embedding scheme consist-\ning of grayscale watermark pre-processing and H.264\/AVC\nencoder with watermark embedding.\nA. Grayscale Watermark Pre-processing\nThe advancement in video coding technology has led to a\nsignificant decrease in redundancy for watermark embedding.\nFor example, in bi-predicted frames of a video clip with\nlow motion at a low coding bit-rate, most coefficients after\nprediction are zero [6]. Accordingly, the watermark should\nbe pre-processed to decrease the data size for embedding. A\nGrayscale patterns Grayscale Watermark Key\n(N by N) Pre-processing\nMarked\nRaw Video H.264 Encoder - Compressed\nVideo\nFig. 1. Watermark Embedding Scheme with H.264\/AVC Encoder.\ngrayscale watermark pre-processing is proposed to deal with\nthis problem.\n1) 4 x 4 Integer DCT: The grayscale pattern is first decom-\nposed into non-overlapping 4 x 4 blocks, denoted by m(x, y)\n(O < x, y < 3). Each block m(x, y) is transformed by\nM(u, v) = DCT{m(x, y)} 0 < u, v < 3 (1)\nwhere DCT{ } represents the less complex but more accurate\ninteger DCT with the fixed block-size 4 x 4 which is uniquely\nused in H.264\/AVC [4].\n2) Zigzag Scanning and Frequency Masking: After zigzag\nscanning, from the 4 x 4 transformed block we obtain 16\ncoefficients M(j), where j C [0,15] indicates the position in\nzigzag scanning. There are several lowest frequencies which\npossess the significant energy with sufficient information for\nthe pattern reconstruction. To achieve higher efficiency, a mask\nis applied to select the top 6 coefficients and discard the other\ncomponents.\n3) Transformation: After masking, there is a significant\ndifference between the dynamic range of every two adjacent\ncoefficients. Thus, the remaining coefficients M(j) are trans-\nformed to reduce the dynamic range as follows:\nM(j) M(j) +A(j) 0 < j < 15 (2)\nB(j\nwhere A(j) and B(j) represent the corresponding transforma-\ntion parameters to j, where j e [0,15] indicates the position\nin zigzag scanning.\n4) Level Reduction: The coefficients M'(j) after transfor-\nmation have multiple values. They can be further simplified\nto be binary, denoted by w(j) as\nw(j) [M'(J)]mod2 (3)\nK(j) M'(j)\/2 (4)\nWatermark patterns can then be reconstructed from the 1-D\noutput sequence w obtained from the pre-processing and the\nkey file K.\nAfter the grayscale watermark pre-processing, a 2-D\ngrayscale watermark pattern with the size N x N (with N x N\nspacial pixels) can be compressed into a binary sequence w\nwith the shortest length 3N2\/8. This significantly decreases\nthe watermarking payload for every frame by approximately\n63%.\nB. H.264\/AVC Watermarking Method\n1) Watermark Embedding: In the next stage, the binary\nsequence w is first mapped into a bipolar sequence and then\nmodulated by the Spread-Spectrum method in [7] to obtain\nthe watermark sequence for embedding, denoted by w'.\nDue to the significant compression efficiency of the\nH.264\/AVC standard, the remaining DCT coefficients of the\nresidual data are perceptually essential. Thus, during the\nH.264\/AVC encoding process, only one middle frequency\nD(u, v) in the diagonal position in a 4 x 4 DCT block is\nsubstituted by\nD*(u,v) = a 13i wiS (5)\nwhere u and v indicate the position of the coefficient, w2 is\nthe spread-spectrum watermark component, both a and \/i are\npositive gain factors to maintain a good visual quality of the\nmarked video, and i denotes the position of the block, i C R.\nThe embedded watermark w2 is a bipolar component. Thus,\nfrom Equ. 5, the watermark information is embedded into\nthe polarity the frequency component by replacing operation,\ninstead of modulating the amplitude in traditional addition\nembedding methods:\nsignr(D*(u,v)) = w' (6)\nDuring video processing and transcoding process, the am-\nplitude of the H.264\/AVC compressed video data can be\naltered in a very wide dynamic range. Therefore, embedding\nwatermark components into the data polarity can help increase\nthe robustness of the watermarking scheme.\nThe gain factor a is derived empirically. The local gain\nfactor \/3i is obtained from the DC coefficient D(O, 0) and the\nAC coefficients D(u, v):\n13i = p ,: D(u, V) ID(O, O) (7)\n1<u<3\nl<v<3\nGrayscale Integer Zigzag Frequency\npatterns DCT Scanning Masking\n(N by N) LTn\n1-D seuquence Level Reduction I-Transformation\nwhere ,u is the the weighting factor which balances the DC\nand AC coefficients.\nFrom this formula, the local watermark gain is determined\nby the local motion activity from the integer DCT coefficients\nof the residual error. The DC coefficient represents the lu-\nminance of the block, and the sum of the AC coefficient\nD(u, v) represents the spatial activity of the block. The\nlocal gain factor can alter adaptively according to the local\nmotion activity. The local watermark gain can be linked with\nperceptual masking adaptively with the visual content.\nTo increase compression efficiency, the H.264\/AVC standard\nsupports a tree-structured motion compensation [4] with 7\nInter-prediction modes for each macroblock S as well as two\nIntra-prediction modes: 16 x 16, 16 x 8, 8 x 16, 8 x 8, 8 x 4,\n4 x 8 and 4 x 4 for Inter-prediction, 116 x 16 and 14 x 4\nfor Intra-prediction. A larger partition size is suitable for still\nareas and a smaller partition size is suitable for areas with\ndetailed motion.\nAfter embedding w2 into all the available Inter\/Intra modes\n(denoted by I), the best mode o* for the marked macroblock\nMB* is selected by minimizing the expression in Eq. (8)\nwithin the constrained R and minimized D, using Lagrangian\nOptimization technique [4] of H.264\/AVC:\no argmin (D(MB*,o) +AR(MB* ,o)) (8)\nwhere A denotes the predetermined Lagrangian multiplier\nfor mode choice, and D and R represent the distortion and\nconsumed bits for encoding the current mode o, respectively.\n2) Watermark Retrieval: For extraction, the original em-\nbedded watermark components are not needed. At the\nH.264\/AVC Decoder, one watermark coefficient w2 can be\nestimated by the sign of the corresponding marked quantized\ncoefficient Dq(u, v) in each 4 x 4 block:\nwlc sign(Dq(u, v)) O< u, v < 3, i C R (9)\nThe Hamming distance H between the extracted watermark\nws and the original spread-spectrum chip sequence is com-\nputed. The extracted bit wj can be derived from the Hamming\ndistance with an appropriate threshold T. wI 1 if H > T;\nwj = O if H <-T.\nC. Grayscale Watermark Post-precessing\nAfter extracting the sequence wi from the compressed\nH.264 video, the grayscale watermark is reconstructed by per-\nforming an inverse operation of the watermark pre-processing.\nIII. RESULTS AND ANALYSIS\nIn our experiments, the proposed H.264\/AVC watermarking\nalgorithm has been integrated into the H.264 JM-7.6 reference\nsoftware [8]. The standard test video clips include Foreman,\nStefan, Coastguard, Flower Garden, Container Ship, and\nSilent. All the first 100 frames are coded at 15 frames\/s at\n768 kbits\/s, 512 kbits\/s and 396 kbist\/s, respectively.\nOK K (p =0.9482) K (p=0.9327)\n(a) Original (b) Reconstructed (c) Extracted\nFig. 2. Samples of The Original, Reconstructed and Extracted Watermarks\nfrom the 30th Frame of Stefan (768 kbit\/s, CIF-size) and Normalized Corre-\nlation.\n(a) Unmarked (41.82dB) (b) Marked (39.52dB)\n(c) Unmarked (41.55dB) (d) Marked (41.00dB)\nFig. 3. The 20th frames of unmarked and markedSilent((a) and (b)) and\nForeman((c) and (d)) (768 kbit\/s, CIF-size).\nA small 16 x 16 grayscale watermark is used as the\nwatermark pattern for our experiments. Figure 2 shows the re-\nconstructed watermark without watermarking and the retrieved\nsamples from the marked Stefan (768 kbit\/s, CIF-size). These\nreconstructed watermark samples are highly correlated to the\noriginal pattern. This demonstrates and supports the feasibility\nof the proposed grayscale watermark pre-processing technique.\nFigure 3 shows the frame samples from the unmarked\nand marked video clips with PSNR(dB). The unmarked and\nmarked video clips are reconstructed from the compressed data\nwithout and with watermarks, respectively. The average PSNR\nvalues are computed by comparing the reconstructed video\nframes to the original raw video frames.\nOn average, the watermark insertion leads to a decrease of\napproximately 0.97 dB for all video clips coded at 768 kbits\/s,\n0.96 dB at 512 kbits\/s and 0.64 dB at kbits\/s, which are all\nless than 1 dB. In the experiments, no visible artifacts can be\nobserved in all of the test video sequences.\nTwo categories of video attacks have been applied to the\nmarked video to test the robustness of the watermarking algo-\nrithm: transcoding and common signal processing processes.\nIn the first group, we utilized the bit-rate reduction. During\nwatermarking in the H.264\/AVC encoding process, the La-\ngrangian Optimization technique targets the overall consuming\nbit-rate at 768 kbits\/s, 512 kbits\/s and 396 kbits\/s. When\ntranscoding is applied after watermarking, the bit-rates have\nbeen reduced to approximately the 1\/2 and even the 1\/3\nof the original bit-rates. During re-encoding with the bit-rate\nreduction, most high frequency components which represent\ndetailed texture will be discarded.\nAfter decoding the marked bitstream, common signal pro-\ncessing attacks are applied to the raw video frame by frame,\nincluding 5 x 5 Gaussian low-pass filtering, circular averag-\ning filtering, unsharpened contrast enhancement, and additive\nGaussian noise (mean=0, variance= 0.001). Then the attacked\nraw video is coded again. Thus, there are actually two attacks\napplied each time: decoding and re-encoding, and common\nsignal processing.\nThe robustness is measured by the normalized correlation\nbetween the original grayscale watermark and the extracted\nand results are presented in Figure 4.\nFigure 4 shows that the proposed watermarking algorithm\ntogether with the watermark pre-processing can survive strong\nattacks, such as bit-rate reduction, contrast enhancement and\nGaussian noise. The watermark patterns can tolerate the\ndistortion introduced by some incorrect extracted watermark\ncomponents, and perform better than binary watermark se-\nquences. Moreover, the fact that the watermark components\nare embedding into the polarities of the DCT coefficients of\nthe residual data, instead of modifying the amplitude also\nplay an important role in increasing the robustness of the\nalgorithm. Further more, by applying the spread-spectrum to\nthe pre-processed watermark components before embedding\nrepeatedly spreads the watermark components into every mac-\nroblock of each frame. This also increases the robustness of\nour algorithm.\nIV. CONCLUSIONS\nThe proposed grayscale watermark pre-processing with the\npresented video watermarking algorithm for copyright protec-\ntion technique performed well in terms of robustness and data\ncapacity. The watermarked H.264\/AVC video clips maintained\nthe good visual quality and almost the same Bit-rate. Other\nmore detailed copyright information, such as textured com-\npany trademarks or logos can also be used as watermark to\nfurther protect ownership and defend against illegal attacks.\nREFERENCES\n[1] F. Hartung and B. Girod, \"Watermarking of uncompressed and com-\npressed video,\" Signal Processing, vol. 66, no. 3, pp. 283-301, May 1998.\n[2] S. Arena, M. Caramma and R. Lancini, \"Digital watermarking applied\nto MPEG-2 coded video sequences exploiting space and frequency\nmasking,\" The IEEE International Conf on Image Processing, pp. 1987-\n1990, Sep. 2000.\n[3] G. Langelaar and R. Lagendijk, \"Optimal differential energy watermark-\ning of DCT encoded images and video,\" IEEE Trans. Signal Processing:\nImage Commun., vol. 10, pp. 148-158, 2001.\n[4] T. Wiegang, G.J. Sullivan, G. Bj0ntegaard, and A. Luthra, \"Overview of\nthe H.264\/AVC video coding standard,\" IEEE Trans. Circuits Syst. Video\nTechnol., vol. 13, no. 7, pp. 560 -576, Jul. 2003.\n[5] J. Zhang and A.T.S. Ho, \"An efficient digital image-in-image watermark-\ning algorithm using the integer discrete cosine transform (IntDCT),\" in\nIEEE Joint Conf of 4th Int. Conf Info., Commun. and Signal Processing\nand 4th Pacific-Rim Conf Multimedia, Dec. 2003.\nFlo Sl\n0 9 ..... ......\no.5\nFor Ste Coa Flo Sil Con\n1\n0.9\n0. 8\n017\n0.6\n0.5\nF\n(a) No attacks\n1\n09\n0 8\n0 7(\n1\n0.9\n068\n0.5\nFc\n(c) 5x5 Gaussian Filtering\n768\ne5 1 2\n396\nl~~~~~~~\nor Ste Coa Flo Sil Con\n(b) To 1\/3 Bit-rate\n766\n-e- 612\n396\nor Ste Coa Flo Sil Con\n(d) Circular Filtering\n1 ,1\n768\n-e-G5120.9 * ----- 0.9 ----.--\n0 7 OG'7\n.\n.\n--\n0.5 0.1\nFor Ste Coa Flo Sil Con For Ste Coa Flo Sil Con\n(e) Contrast Enhancement (f) Gaussian Noise\nFig. 4. Robustness under transcoding and common signal processing on\nForeman, Stefan, Coastguard, Flower, silent and Container (denoted by For,\nSte, Coa, Flo, Sil and Con in the horizontal axis) (768 kbit\/s, 512 kbit\/s, and\n396 kbit\/s, CIF-size).\n[6] G. Qiu, P. Marziliano, A.T.S. Ho, D.J. He, and Q.B. Sun, \"A hybrid wa-\ntermarking scheme for H.264\/AVC video,\" in Proc. the 17th International\nConference on Pattern Recognition, Cambridge, UK, Aug. 2004.\n[7] A.T.S. Ho, and F. Shu, \"A Robust Spread-Spectrum Watermarking\nMethod Using Two-Level Quantization,\" in IEEE International Confer-\nence on Image Processing (ICIP 2004), Singapore, Oct. 2004.\n[8] H.264\/AVC Joint Model 7.6 (JM-7.6) Reference Software. [Online].\nAvailable: http:\/\/iphome.hhi.de\/suehring\/tml\/download\/old jm\/.\n"}