{"doi":"10.1534\/genetics.106.060681","coreId":"71012","oai":"oai:eprints.lancs.ac.uk:8187","identifiers":["oai:eprints.lancs.ac.uk:8187","10.1534\/genetics.106.060681"],"title":"Perfect Simulation From Nonneutral Population Genetic Models: Variable Population Size and Population Subdivision.","authors":["Fearnhead, Paul"],"enrichments":{"references":[{"id":16371793,"title":"A comparison of Bayesian methods for haplotype reconstruction from population genotype data.","authors":[],"date":"2003","doi":"10.1086\/379378","raw":"Stephens, M. and Donnelly, P. (2003). A comparison of Bayesian methods for haplotype reconstruction from population genotype data. American Journal of Human Genetics 73, 1162\u20131169.","cites":null},{"id":16371689,"title":"A di\ufb00usion approximation for selection and drift in a subdivided population.","authors":[],"date":"2003","doi":"10.1016\/j.tpb.2004.04.005","raw":"Cherry, J. L. and Wakeley, J. (2003). A di\ufb00usion approximation for selection and drift in a subdivided population. Genetics 163, 421\u2013428.","cites":null},{"id":16371690,"title":"Ancestral inference on gene trees under selection.","authors":[],"date":"2004","doi":"10.1016\/j.tpb.2004.06.006","raw":"Coop, G. and Gri\ufb03ths, R. C. (2004). Ancestral inference on gene trees under selection. Theoretical Population Biology 66, 219\u2013232.","cites":null},{"id":16371733,"title":"Ancestral processes with selection.","authors":[],"date":"1997","doi":"10.1006\/tpbi.1997.1299","raw":"Krone, S. M. and Neuhauser, C. (1997). Ancestral processes with selection. Theoretical Population Biology 51, 210\u2013237.","cites":null},{"id":16371716,"title":"Archaic African and Asian lineages in the genetic ancestry of modern humans.","authors":[],"date":"1997","doi":null,"raw":"Harding, R. M., Fullerton, S. M., Gri\ufb03ths, R. C., Bond, J., Cox, M. J., Schneider, J. A., Moulin, D. S. and Clegg, J. B. (1997). Archaic African and Asian lineages in the genetic ancestry of modern humans. American Journal of Human Genetics 60, 772\u2013789.","cites":null},{"id":16371783,"title":"Are rare variants responsible for susceptibility to complex diseases?","authors":[],"date":"2001","doi":"10.1086\/321272","raw":"Pritchard, J. K. (2001). Are rare variants responsible for susceptibility to complex diseases? American Journal of Human Genetics 69, 124\u2013137.","cites":null},{"id":16371772,"title":"Assessing population di\ufb00erentiation and isolation from single-nucleotide polymorphism data.","authors":[],"date":"2002","doi":null,"raw":"Nicholson, G., Smith, A. V., J\u00b4 onsson, F., G\u00b4 ustafsson, O., Stef\u00b4 ansson, K. and Donnelly, P. (2002). Assessing population di\ufb00erentiation and isolation from single-nucleotide polymorphism data. Journal of the Royal Statistical Society Series B 64, 695\u2013715.","cites":null},{"id":16371789,"title":"Calibrating a coalescent simulation of human genome sequence variation.","authors":[],"date":"2005","doi":"10.1101\/gr.3709305","raw":"Scha\ufb00ner, S. F., Foo, C., Gabriel, S., Reich, D., Daly, M. J. and Altshuler, D. (2005). Calibrating a coalescent simulation of human genome sequence variation. Genome Research 15, 1576\u20131583.","cites":null},{"id":16371774,"title":"Coalescent theory. In: Handbook of Statistical Genetics,","authors":[],"date":"2001","doi":"10.1002\/0470022620.bbc21","raw":"Nordborg, M. (2001). Coalescent theory. In: Handbook of Statistical Genetics, John Wiley and Sons, England, 179\u2013212.","cites":null},{"id":16371692,"title":"Coalescents and genealogical structure under neutrality.","authors":[],"date":"1995","doi":"10.1146\/annurev.genet.29.1.401","raw":"Donnelly, P. and Tavar\u00b4 e, S. (1995). Coalescents and genealogical structure under neutrality. Annual Review of Genetics 29, 401\u2013421.","cites":null},{"id":16371725,"title":"E\ufb00ects of natural selection on interpopulation divergence at polymorphic sites in human protein-coding loci.","authors":[],"date":"2005","doi":"10.1534\/genetics.104.037077","raw":"Hughes, A. L., Packer, B., Welch, R., Bergen, A. W., Chanock, S. J. and Yeager, M. (2005). E\ufb00ects of natural selection on interpopulation divergence at polymorphic sites in human protein-coding loci. Genetics 170, 1181\u20131187.","cites":null},{"id":16371727,"title":"E\ufb03cient simulation methods for a class of nonneutral population genetics models.","authors":[],"date":"2006","doi":null,"raw":"Joyce, P. and Genz, A. (2006). E\ufb03cient simulation methods for a class of nonneutral population genetics models. To appear in Theoretical Population Biology .","cites":null},{"id":16371787,"title":"Estimating the time since the \ufb01xation of a bene\ufb01cial allele.","authors":[],"date":"2003","doi":null,"raw":"Przeworski, M. (2003). Estimating the time since the \ufb01xation of a bene\ufb01cial allele. Genetics 164, 1667\u20131676.","cites":null},{"id":16371714,"title":"Exact \ufb01ltering for partially-observed continuous-time Markov models.","authors":[],"date":"2004","doi":"10.1111\/j.1467-9868.2004.05561.x","raw":"20Fearnhead, P. and Meligkotsidou, L. (2004). Exact \ufb01ltering for partially-observed continuous-time Markov models. Journal of the Royal Statistical Society, series B 66, 771\u2013789.","cites":null},{"id":16371785,"title":"Exact sampling with coupled Markov chains and applications to statistical mechanics.","authors":[],"date":"1996","doi":"10.1002\/(sici)1098-2418(199608\/09)9:1\/2<223::aid-rsa14>3.0.co;2-o","raw":"Propp, J. G. and Wilson, D. B. (1996). Exact sampling with coupled Markov chains and applications to statistical mechanics. Random Structures and Algorithms 9, 223\u2013252.","cites":null},{"id":16371719,"title":"Gene genealogies and the coalescent process. In:","authors":[],"date":"1990","doi":null,"raw":"Hudson, R. R. (1990). Gene genealogies and the coalescent process. In: Oxford Surveys in Evolutionary Biology (eds. D. Futuyma and J. Antonovics), volume 7, Oxford University Press, New York, 1\u201344.","cites":null},{"id":16371691,"title":"Genealogical processes for Fleming-Viot models with selection and recombination.","authors":[],"date":"1999","doi":"10.1214\/aoap\/1029962866","raw":"Donnelly, P. and Kurtz, T. (1999). Genealogical processes for Fleming-Viot models with selection and recombination. Annals of Applied Probability 9, 1091\u20131148.","cites":null},{"id":16371721,"title":"Generating samples under a Wright-Fisher neutral model of genetic variation.","authors":[],"date":"2002","doi":"10.1093\/bioinformatics\/18.2.337","raw":"Hudson, R. R. (2002). Generating samples under a Wright-Fisher neutral model of genetic variation. Bioinformatics 18, 337\u2013338.","cites":null},{"id":16371693,"title":"Likelihoods and simulation methods for a class of non-neutral population genetics models.","authors":[],"date":"2001","doi":null,"raw":"Donnelly, P., Nordborg, M. and Joyce, P. (2001). Likelihoods and simulation methods for a class of non-neutral population genetics models. Genetics 159, 853\u2013867.","cites":null},{"id":16371737,"title":"Molecular Evolutionary Genetics.","authors":[],"date":"1987","doi":"10.1016\/s0092-8240(89)80097-7","raw":"Nei, M. (1987). Molecular Evolutionary Genetics. Columbia University Press, New York.","cites":null},{"id":16371695,"title":"Non-equilibrium theory of the allele frequency spectrum. Theoretical Population Biology ,","authors":[],"date":"2006","doi":"10.1016\/j.tpb.2006.06.005","raw":"Evans, S. N., Shvets, Y. and Slatkin, M. (2006). Non-equilibrium theory of the allele frequency spectrum. Theoretical Population Biology , To appearDoi:10.1016\/j.tpb.2006.06.005.","cites":null},{"id":16371730,"title":"Notes on perfect simulation. In: Markov Chain Monte Carlo: Innovations and Applications","authors":[],"date":"2005","doi":"10.1142\/9789812700919_0003","raw":"Kendall, W. S. (2005). Notes on perfect simulation. In: Markov Chain Monte Carlo: Innovations and Applications (eds. W. S. Kendall, F. Liang and J. Wang), volume 7 of Lecture Note Series, Instiute for Mathematical Science, National University of Singapore, 93\u2013146.","cites":null},{"id":16371709,"title":"Perfect simulation from population genetic models with selection.","authors":[],"date":"2001","doi":"10.1006\/tpbi.2001.1514","raw":"Fearnhead, P. (2001). Perfect simulation from population genetic models with selection. Theoretical Population Biology 59, 263\u2013279.","cites":null},{"id":16371688,"title":"Selection in a subdivided population with dominance or local frequency dependence.","authors":[],"date":"2003","doi":null,"raw":"Cherry, J. L. (2003). Selection in a subdivided population with dominance or local frequency dependence. Genetics 163, 1511\u20131518.","cites":null},{"id":16371792,"title":"SelSim: a program to simulate population genetic data with natural selection and recombination.","authors":[],"date":"2004","doi":"10.1093\/bioinformatics\/bth417","raw":"Spencer, G. C. A. and Coop, G. (2004). SelSim: a program to simulate population genetic data with natural selection and recombination. Bioinformatics 20, 3673\u20133675.","cites":null},{"id":16371790,"title":"Simulation of selected genealogies.","authors":[],"date":"2000","doi":"10.1006\/tpbi.1999.1438","raw":"Slade, P. F. (2000). Simulation of selected genealogies. Theoretical Population Biology 57, 35\u201349.","cites":null},{"id":16371797,"title":"Testing models of selection and demography in Drosophila simulans.","authors":[],"date":"2002","doi":null,"raw":"22Wall, J. D., Andolfatto, P. and Przeworski, M. (2002). Testing models of selection and demography in Drosophila simulans. Genetics 162, 203\u2013216.","cites":null},{"id":16371735,"title":"The allele frequency spectrum in genome-wide human variation data reveals signals of di\ufb00erential demographic history in three large world populations.","authors":[],"date":"2004","doi":"10.1534\/genetics.166.1.351","raw":"Marth, G. T., E Czabarka, J. M. and Sherry, S. T. (2004). The allele frequency spectrum in genome-wide human variation data reveals signals of di\ufb00erential demographic history in three large world populations. Genetics 166, 351\u2013372.","cites":null},{"id":16371795,"title":"The discovery of SingleNucleotide Polymorphisms \u2013 and inferences about human demographic history.","authors":[],"date":"2001","doi":"10.1086\/324521","raw":"Wakeley, J., Nielsen, R., Liu-Cordero, S. N. and Ardlie, K. (2001). The discovery of SingleNucleotide Polymorphisms \u2013 and inferences about human demographic history. American Journal of Human Genetics 69, 1332\u20131347.","cites":null},{"id":16371769,"title":"The genealogy of samples in models with selection.","authors":[],"date":"1997","doi":null,"raw":"21Neuhauser, C. and Krone, S. M. (1997). The genealogy of samples in models with selection. Genetics 145, 519\u2013534.","cites":null},{"id":16371777,"title":"The genealogy of sequences containing multiple sites subject to strong selection in a subdivided population.","authors":[],"date":"2003","doi":"10.3410\/f.1013134.189252","raw":"Nordborg, M. and Innan, H. (2003). The genealogy of sequences containing multiple sites subject to strong selection in a subdivided population. Genetics 163, 1201\u20131213.","cites":null},{"id":16371712,"title":"The stationary distribution of allele frequencies when selection acts at unlinked loci. Theoretical Population Biology , To AppearDoi:10.1016\/j.tpb.2006.02.001.","authors":[],"date":"2006","doi":"10.1016\/j.tpb.2006.02.001","raw":"Fearnhead, P. (2006). The stationary distribution of allele frequencies when selection acts at unlinked loci. Theoretical Population Biology , To AppearDoi:10.1016\/j.tpb.2006.02.001.","cites":null}],"documentType":{"type":1}},"contributors":[],"datePublished":"2006-11","abstract":"We show how the idea of monotone coupling from the past can produce simple algorithms for simulating samples at a nonneutral locus under a range of demographic models. We specifically consider a biallelic locus and either a general variable population size mode or a general migration model for population subdivision. We investigate the effect of demography on the efficacy of selection and the effect of selection on genetic divergence between populations","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/71012.pdf","fullTextIdentifier":"http:\/\/eprints.lancs.ac.uk\/8187\/1\/MonotonePS_Sel.pdf","pdfHashValue":"def1b28140f5c374d4943db765c6c361fbc87035","publisher":null,"rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:eprints.lancs.ac.uk:8187<\/identifier><datestamp>\n      2018-01-24T03:16:55Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      7375626A656374733D51:5141<\/setSpec><setSpec>\n      74797065733D61727469636C65<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        Perfect Simulation From Nonneutral Population Genetic Models: Variable Population Size and Population Subdivision.<\/dc:title><dc:creator>\n        Fearnhead, Paul<\/dc:creator><dc:subject>\n        QA Mathematics<\/dc:subject><dc:description>\n        We show how the idea of monotone coupling from the past can produce simple algorithms for simulating samples at a nonneutral locus under a range of demographic models. We specifically consider a biallelic locus and either a general variable population size mode or a general migration model for population subdivision. We investigate the effect of demography on the efficacy of selection and the effect of selection on genetic divergence between populations.<\/dc:description><dc:date>\n        2006-11<\/dc:date><dc:type>\n        Journal Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/eprints.lancs.ac.uk\/8187\/1\/MonotonePS_Sel.pdf<\/dc:identifier><dc:relation>\n        http:\/\/dx.doi.org\/10.1534\/genetics.106.060681<\/dc:relation><dc:identifier>\n        Fearnhead, Paul (2006) Perfect Simulation From Nonneutral Population Genetic Models: Variable Population Size and Population Subdivision. Genetics, 174. pp. 1397-1406. ISSN 1943-2631<\/dc:identifier><dc:relation>\n        http:\/\/eprints.lancs.ac.uk\/8187\/<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/dx.doi.org\/10.1534\/genetics.106.060681","http:\/\/eprints.lancs.ac.uk\/8187\/"],"year":2006,"topics":["QA Mathematics"],"subject":["Journal Article","PeerReviewed"],"fullText":"Perfect Simulation from Non-neutral Population\nGenetic Models: Variable Population Size and\nPopulation sub-division\nPaul Fearnhead1\n1. Department of Mathematics and Statistics, Lancaster University, Lancaster, LA1\n4YF, UK\n(e-mail: p.fearnhead@lancs.ac.uk).\nSummary: We show how the idea of monotone coupling from the past can produce sim-\nple algorithms for simulating samples at a non-neutral locus under a range of demographic\nmodels. We specifically consider a biallelic locus, and either a general variable population\nsize mode, or a general migration model for population subdivision. We investigate the\neffect of demography on the efficacy of selection, and the effect of selection on genetic\ndivergence between populations.\nKeywords: Ancestral Selection Graph, Coupling from the Past, Demes, Frequency Spec-\ntrum, Migration model, Stepping-stone model\n1\n1 Introduction\nWhile simulating from neutral population genetics models is straightforward using the\ncoalescent (Kingman, 1982), even for complex demographic models (see e.g. Donnelly and\nTavare\u00b4, 1995; Hudson, 2002), simulation from non-neutral models is much more difficult.\nThere are currently numerous approaches to simulation for non-neutral models. These can\nbe split into two cases, simulating from the stationary distribution of the population, or\nsimulating from the population at a specfic time. Examples of the latter include simulating\nsamples a specific time after the fixation of a beneficial allele (e.g. Przeworski, 2003). In\nthis paper we focus on the former.\nFor non-neutral models which assume parent-independent mutation, constant population\nsize and random-mating, the stationary distribution of allele frequencies is known and can\nbe simulated from directly using rejection sampling (Donnelly et al., 2001) or numerical\nintegration methods (Fearnhead and Meligkotsidou, 2004; Joyce and Genz, 2006). For\nsuch models it is also possible to simulate the genealogy of a sample, and linked neutral\nvariation. This is possible by simulating and conditioning on the frequency of the non-\nneutral allele in the history of the population(Spencer and Coop, 2004; Coop and Griffiths,\n2004; Nordborg, 2001; Nordborg and Innan, 2003), or by simulating from the conditional\ndistribution of the ancestral selection graph given the allelic type of the sample (Slade,\n2000; Stephens and Donnelly, 2003; Fearnhead, 2006)\nFor models which do not assume parent-independent mutations, it is possible to use\ncoupling-from-the-past (CFTP) (Propp and Wilson, 1996; Kendall, 2005) to simulate sam-\nples from the ancestral selection graph (Fearnhead, 2001). Here we extend this idea. Firstly\nwe introduce a simpler implementation of CFTP, which is obtained by having a state-space\nof unordered rather than ordered samples. This means that we characterise a sample by\nthe number of alleles of each type, rather than by the allelic type of each of an ordered set\nof chromosomes. This has two advantages, firstly that as we work on a smaller dimensional\nspace, coupling should be quicker. Secondly, for the models we consider, by working with\nunordered samples we obtain a monotonicity of the sample space, which makes it more\nstraightforwad to detect when we have obtained a sample from the stationary distribution\nof interest, and thus provides a much simpler algorithm to implement.\nOur second extension is to allow for a variety of demographic models, including arbitrary\nvariable population size models, and models with multiple sub-populations (demes). As\nfar as we are aware, the method we propose is the only current method for simulating\n2\nfrom such multiple deme coalescent models in the presence of selection. Our method is\ncomputationally efficient, with for example 1,000 samples of size 100 being simulated in\nless than 40s for a 10 deme stepping-stone model under a variety of selection models (see\nRESULTS).\n2 Methods\nMonotone Coupling From The Past\nConsider an ergodic Markov chain Xt with state space {0, 1, . . . , K}. Coupling from the\npast (CFTP; Propp and Wilson, 1996) gives a method for simulating from the stationary\ndistribution of Xt. The idea is based on the fact that if we simulated the Markov chain\nfrom time \u2212\u221e to time 0, then regardless of the initial value of the chain, X\u2212\u221e, we would\nhave that X0 is a draw from the stationary distribution of the chain. The idea of CFTP is\nthat it enables us to perform such simulation in finite computing time.\nTo do this we first introduce some extra simulation, in that we consider simulating the value\nof Xt+1 for all possible values of Xt. To simplify notation we will define a function Ft(\u00b7)\nwhich specifies all these transitions. So if we are told that Xt = x, then we have Xt+1 =\nFt(x). Note that the function Ft is a realisation of a random variable; the stochasticity of\nthe Markov chain is now encompassed in the randomness of this function, but given a set\nof realisations F\u2212T , F\u2212T+1, . . . , F\u22121 we have a deterministic relationship between X\u2212T and\nX0.\nWe now have an idealised simulation algorithm:\n(a) For t = \u22121,\u22122, . . . ,\u2212\u221e simulate the value of Xt+1 for all possible values of Xt; and\nhence the function Ft(\u00b7).\n(b) Arbitrarily specify X\u2212\u221e; and for t = \u2212\u221e, . . . ,\u22121 recursively apply xt+1 = Ft(xt) to\nobtain x0, a draw from the stationary distribution of the Markov chain.\nThis algorithm is obviously impracticable, as it involves infinite computing time. However\nwe can perform this simulation in finite computing time by doing this simulation a bit at\na time. This gives the following CFTP algorithm:\n(a) Arbitrarily choose a negative integer T0; set T = T0 and S = 0.\n(b) For t = S \u2212 1, S \u2212 2, . . . , T , simulate Ft.\n3\n(c) For each possible starting value x = 0, 1, . . . , K, set XT = x and recursively apply\nxt+1 = Ft(xt) to obtain x0. If the value of x0 is identical for all starting values of\nXt then output x0, a draw from the stationary distribution of the Markov Chain;\notherwise set S = T , T = 2T and return to (b).\nThe idea here is that we imagine that we are doing the idealised simulation algorithm\nabove. However, we first simulate the dynamics of the chain from time T0 to time 0; then\nthe extra dynamics from time 2T0 to time T0; then the extra dynamics from time 4T0 to\ntimes 2T0 and so on (step b). The coupling condition in step (c) enables us to determine\nwith certainty what the value of X0 would be if we had continue to simulated the dynamics\nof the chain back to time \u2212\u221e (as in the idealised algorithm). For example, imagine that\nthe condition in step (c) is satisfied after simulating back to time 4T0; this condition says\nthat regardless of the value of X4T0 , the value of X0 will be the same (x0). Thus we do not\nneed to know the realisation of the chain from time \u2212\u221e to time 4T0, as regardless of this\nwe know that continuing the realisation on to time 0 will produce X0 = x0. Thus the value\nwe output in step (c) is the same as the value we would obtain in step (b) of the idealised\nsimulation algorithm, and is thus a draw from the stationary distribution of the Markov\nchain.\nAny choice for how to decrease T when coupling does not occur would produce a valid\nalgorithm, but it has been argued that doubling T each time is optimum (by its relationship\nwith a binary search; see e.g. Kendall, 2005). Note that the validity of the approach requires\nthat we do not resimulate any of the dynamics of the Markov chain if coupling does not\noccur in step (c). Furthermore, the algorithm requires only that the functions Ft(\u00b7) are\nsimulated in such a way that marginally the dynamics of the Markov chain are correct, and\nit is possible to have any amount of dependence in terms of the value of Xt+1 for different\nvalues of Xt. In some cases it is possible to utilise this to obtain a more efficient way\nof determining whether coupling occurs in step (c). If we can find a distribution on Ft,\nwhich marginally has the dynamics of the Markov chain, and that staisfies the monotonicty\ncondition that x \u2265 y \u21d2 F (x) \u2265 F (y) then we can replace step (c) with:\n(c) For both x = 0 and x = K, set XT = x and recursively apply xt+1 = Ft(xt) to obtain\nx0. If the value of x0 is identical for both starting values of Xt then output x0, a draw\nfrom the stationary distribution of the Markov Chain; otherwise set S = T , T = 2T\nand return to (b).\nWe call the resulting algorithm monotone CFTP. The only difference is that we only run\n4\nthe Markov chain forward in time for the minimal and maximal elements of the state-space.\nThe monotonicity ensures that if these two realisations couple, then all realisations from\nother starting points (which lie between them) will also couple.\nWhile in this example we have assumed a totally ordered state-space, monotone CFTP\nwill still apply if we have only a partial order: if starting the chain at each of the maximal\nand minimal elements of our state-space produce the same x0 value, then so must all other\nstarting values of the chain (which lie between the minimal and maximal elements). We\nwill use this extension to partial orderings in the multi-deme models we consider below.\nAn example of the CFTP algorithms is given in Figure 1.\nModels\nWe consider coalescent models which include selection, variable population size and pop-\nulation structure, and focus on a single biallelic locus. Details of how selection is incor-\nporated within a coalescent-type process can be found in work on the Ancestral Selection\nGraph (Krone and Neuhauser, 1997; Neuhauser and Krone, 1997) or the Ancestral In-\nfluence Graph (Donnelly and Kurtz, 1999). For background on incorporating population\ngrowth or population structure see for example Donnelly and Tavare\u00b4 (1995) and Hudson\n(1990) and references therein.\nThe coalescent model we consider is obtained in the large population size limit to a range\nof forward population genetics model. We briefly describe how the parameters are defined\nin the case of the Wright-Fisher model. Firstly define an effective population size of N0\ndiploid individuals, or equivalently 2N0 chromosomes. We measure time in units of 2N0\ngenerations, and as is common define time in terms of time before the present. We consider\na population consisting of D demes, with random mating within each deme. At time t in\nthe past, the population size of deme d is Nd(t) = N0\u03bbd(t) diploid individuals. For the\ncase D > 1 we further define a migration matrix by Mij = 4N0mij for i 6= j, where mij is\nthe proportion of the population of deme i in a generation that have migrated there from\ndeme j in the previous generation. We define Mi =\n\u2211\nj 6=i Mij.\nWe denote the alleles at our locus by 1 and 2. As with any biallelic model, mathematically\nwe can describe the mutation process in terms of parent-independent mutations. We let\n\u03b8 = 4N0u, where u is the probability of mutation per chromosome per generation, and let\n\u03bd = (\u03bd1, \u03bd2) be the probability distribution of the mutant allele. (Note that this model\nallows for \u201csilent\u201d mutations, which do not change the allele at the locus; thus the effective\nmutation rate of allele 2 to allele 1 is \u03b8\u03bd1, and of allele 1 to allele 2 is \u03b8\u03bd2.)\nFinally we define the selection process. We assume that the fitness of an ij genotype is\n5\n43\n2\n1\n0\nSTA\nTE\n0\u22128 \u22127 \u22126 \u22125 \u22124 \u22123 \u22122 \u22121\nTime\nFigure 1: Example of monotone CFTP for a 5-state Markov chain. For each state at\neach time we imagine simulating the transitions of the Markov chain (red dashed lines).\n(Informally the monotonicity can be seen by the fact that no pair of transitions cross each\nother.) Initially in this example we actually simulate these from times t = \u22121,\u22122, . . . ,\u22124.\nWe then simulate forward in time from the maximal (4) and minimal (0) states at t = \u22124\n(blue dashed lines). As simulating forward these states produce different samples, we\nsimulate the transitions for times t = \u22125, . . . ,\u22128, and repeat simulating forward in time\nfrom the maximal and minimal states at t = \u22128. These both give the value X0 = 0, and\nthus the Markov chain has coupled and we have a draw from the stationary distribution of\nthe chain. (Notice that regardless of what value X\u22128 is, forward simulation produces the\nvalue X0 = 0, and thus this is the value we would have obtained if we had simulated the\nMarkov chain from time t = \u2212\u221e.)\n6\n1 + sij for i, j = 1, 2, with sij \u2265 0 and s12 = s21, We can thus define selection rates \u03c3\n\u2217\nij =\n4N0sij. We choose a different parameterisation of these selection rates where \u03c3\n\u2217\n11 = \u03c311,\n\u03c3\u221712 = \u03c3g + \u03c312 and \u03c3\n\u2217\n22 = 2\u03c3g + \u03c322. This is an over-parameterisation of the selection\nprocess, and any choice of \u03c3g \u2265 0 and \u03c3ij \u2265 0 for i, j = 1, 2 which gives the correct values\nof \u03c3\u2217ij could be used. We then define \u03c3 = max{\u03c311, \u03c312, \u03c322}.\nThe choices of defining the mutation process in terms of a parent-independent mutation\nprocess, and the parameterisation of selection rates, have been made in order to make the\nsimulation algorithm detailed below as efficient as possible. In particular the parameteri-\nsation of the selection rates is in terms of a genic component (given by the \u03c3g terms) and\na non-genic component. The efficiency of the simulation algorithm is increased by choos-\ning \u03c3g to be as large as possible subject to the constraints on the positivity of the other\nselection rates. (To do this we should label the alleles so that \u03c3\u221722 \u2265 \u03c3\n\u2217\n11.)\nFor ease of presentation we have assumed that the selection rates are constant through\ntime and across demes; though it is straightforward to generalise to the case where these\nrates vary. The coalsescent process for our above model can be described in terms of a\nbackward process for the history of our sample (which is independent of the alleles in the\nsample) and conditional on this backward process some forward dynamics for the allelic\ntypes of the branches. If we simulated the backward process until time t = \u221e, then for any\ninitial choice for the population frequency of the alleles at that time, when we simulated\nthe process forward we would obtain a sample at the present time which is drawn from the\nstationary distribution of the population. We now describe these backward and forward\nprocesses and how we can appply monotone CFTP.\nBackward Process\nThe Backward Process is a continuous time Markov Chain, whose state N(t) = (N1(t), . . . ,ND(t))\nis the number of branches in the underlying coalscent-type process at time t in the past\nthat come from each deme. The transitions correspond to different possible events in this\ncoalescent-type process. To ease notation, let the state at current time t be (n1, n2, . . . , nD),\nthen the rates of the possible events, and the corresponding transitions, are:\n(i) Coalescence, deme d occurs at rate nd(nd\u22121)\/(2\u03bbd(t)); with transition nd = nd\u22121.\n(ii) Migration, deme d to deme i occurs at rate ndMdi\/2;with transition nd = nd \u2212 1\nand ni = ni + 1.\n(iii) Mutation deme d occurs at rate nd\u03b8\/2; no change to state.\n7\n(iv) Genic Selection, deme d occurs at rate nd\u03c3g\/2; with transition nd = nd + 1.\n(v) Diploid Selection, deme d occurs at rate nd\u03c3\/2; with transition nd = nd + 2.\n(When describing the transition we have listed only the elements of the state that change.)\nThe initial value of the state, N(0) is given by the number of chromosomes sampled from\neach deme.\nForward Dynamics and Monotone CFTP\nAssume we have simulated and stored T events in the backward process above. We now\nconsider the forward in time dynamics; however in order to apply CFTP we need to make\nthese forward dynamics deterministic, and thus for each event that we simulate in the\nbackward process we also simulate and store a realisation of an independent continuous\nuniform [0, 1] random variable. These realisations will then determine the specific forward\ntransition at each event.\nForward in time the state of our system is given by the number of each type of allele in\neach deme in our ancestral process. As we have stored the number of branches in each\ndeme at each event, we can define this state solely in terms of the number of type 1 alleles\nin each deme; which we denote by n(1) = (n\n(1)\n1 , . . . , n\n(1)\nD ). Our forward in time dynamics\nare determined by specifing an initial value for the state n(1). Then for the T th event,\nT \u2212 1th event, . . . , 1st event in turn we update this state as follows.\nConsider the jth event. Let u denote the realisation of the uniform random variable\nassociated with this event. Assume the current state is n(1), and the number of branches\nin each deme is n = (n1, . . . , nD). Then the dynamics depend on the type of the jth event\nas follows:\n(i) Coalescence, deme d; if u < n\n(1)\nd \/nd then let n\n(1)\nd = n\n(1)\nd + 1.\n(ii) Migration, deme d to deme i; if u < n\n(1)\ni \/ni then let n\n(1)\nd = n\n(1)\nd + 1 and n\n(1)\ni =\nn\n(1)\ni \u2212 1.\n(iii) Mutation deme d; if u < (nd\u2212n\n(1)\nd )\u03bd1\/nd then let n\n(1)\nd = n\n(1)\nd +1; if u > 1\u2212n\n(1)\nd \u03bd2\/nd\nthen let n\n(1)\nd = n\n(1)\nd \u2212 1.\n(iv) Genic Selection, deme d; if u < 1 \u2212 (nd \u2212 n\n(1)\nd )(nd \u2212 n\n(1)\nd \u2212 1)\/(nd(nd \u2212 1)) then\nlet n\n(1)\nd = n\n(1)\nd \u2212 1.\n8\n(v) Diploid Selection, deme d; if\nu <\nn\n(1)\nd (n\n(1)\nd \u2212 1)(n\n(1)\nd \u2212 2 + (\u03c3 \u2212 \u03c311 + \u03c312)(nd \u2212 n\n(1)\nd )\/\u03c3)\nnd(nd \u2212 1)(nd \u2212 2)\n, (1)\nthen let n\n(1)\nd = n\n(1)\nd \u2212 2; otherwise if\nu < 1\u2212\n(nd \u2212 n\n(1)\nd )(nd \u2212 n\n(1)\nd \u2212 1)(nd \u2212 n\n(1)\nd \u2212 2 + (\u03c3 \u2212 \u03c322 + \u03c312)n\n(1)\nd \/\u03c3)\nnd(nd \u2212 1)(nd \u2212 2)\n, (2)\nthen let n\n(1)\nd = n\n(1)\nd \u2212 1.\nWe have described the dynamics purely in terms of changes in n(1), the changes in the\nnumber of branches in each deme is given by the reverse of the dynamics of the backward\nprocess. These dynamics come from the different possible events in the coalescent process\nthat would affect n(1). For (i) this is a coalescent event to branch of allele 1; for (ii) a\nmigration of an allele 1 branch from population i to d; for (iii) a mutation of an allele 2\nbranch to allele 1, or vice-versa; for (iv) a selection event at which an allele 1 branch is\nnon-ancestral (which occurs unless both incoming and continuing branches have allele 2);\nand for (v) a selection event at which both non-ancestral branches have allele 1, or only\none has. (See Appendix A for the calculation of the probabilities in this case).\nWe can now use CFTP to simulate a sample from the stationary distribution of the pop-\nulation. The dynamics specified above satisfy a monotonicity condition (see Appendix\nB) if 2\u03c321 \u2264 \u03c3 + \u03c311 + \u03c322. (This can always be achieved by, if necessary, choosing\n\u03c3 > max{\u03c311, \u03c312, \u03c322}; for example if \u03c311 = \u03c322 = 0 as in heterozygote advantage then\nwe choose \u03c3 = 2\u03c312.) The partial ordering of this monotonicity is that (n1, . . . , nD) \u2265\n(n\u20321, . . . , n\n\u2032\nD) if and only if nd \u2265 n\n\u2032\nd for d = 1 . . . , D.\nThus the monotone CFTP algorithm described above can be applied, whereby to check\ncoupling we need only run the process forward in time from two values of the state: n(1) =\n(n1, . . . , nD), all branches in all demes carry allele 1, and n\n(1) = (0, . . . , 0), no branches in\nany deme carry allele 1. If we obtain the same sample from each of these initial conditions,\nthen that sample is drawn from the population at stationarity. If not we have to simulate\nthe backward process further into the past and repeat until coupling occurs.\nPrograms implementing CFTP for both single-population variable population size and for\nmultiple-deme constant-population size models were written in a combination of R and C.\nThese are available from www.maths.ac.uk\/\u223cfearnhea.\nVerifying the CFTP Results\n9\nTo check the validity of the programs implementing this monotone CFTP algorithm we\nran the programs under two special cases. Firstly we considered the neutral case, and\ncompared the results of our program with those obtained by the program ms (Hudson,\n2002). Note that this program defines time in units of N0 generations, rather than the 2N0\nused here. It assumes an infinite sites mutation model - this output can be converted into a\n2-allele model with \u03bd = (0.5, 0.5) by (i) setting the mutation rate it \u03b8\/2, and (ii) assuming\neach mutation changes the allele of the chromosome so that the allele of a chromosome is\ndetermined by whether it has an odd or an even number of mutations. For the constant\npopulation size and a single panmictic population (D = 1) we compared results with those\nbased on simulating from the known stationary distribution of the population frequency of\nallele 1 using rejection sampling (see Donnelly et al., 2001).\n3 Results\nSingle-Population Model\nFirst we used the CFTP algorithm to simulated from a series of single population models.\nThere are many demographic models that have been suggested or inferred for human or\nother populations (e.g. Wakeley et al., 2001; Wall et al., 2002; Marth et al., 2004; Schaffner\net al., 2005). We considered four different scenarios for the variation in population size,\nand four different selection models. In each case we set N0 = 10, 000 diploid individuals,\n\u03b8 = 1 and \u03bd = (0.9, 0.1) (based loosely on appropriate mutation models for disease genes;\nsee Pritchard, 2001). The four population size scenarios are:\nConstant A constant population size.\nGrowth An exponentially growing population with \u03bb(t) = exp(\u22120.7t) (based on an in-\nferred model for beta-globin, see Harding et al., 1997).\nBottleneck A population bottleneck from t = 0.15 to t = 0.175. During the bottleneck\nthe effective population size is 1,000, and prior to it it is 5,000. (based on a model from\nMarth et al., 2004).\nComplex A more complicated scenario based loosely on the population-size of a non-\nAfrican population in the model of Schaffner et al. (2005). It includes recent exponential\ngrowth and a bottleneck.\n10\n0.0 0.2 0.4 0.6 0.8 1.0\n0.\n0\n0.\n2\n0.\n4\n0.\n6\n0.\n8\n1.\n0\nConstant\nTime (2N_0 generations)\nla\nm\nbd\na(t\n)\n0.0 0.2 0.4 0.6 0.8 1.0\n0.\n0\n0.\n2\n0.\n4\n0.\n6\n0.\n8\n1.\n0\nGrowth\nTime (2N_0 generations)\nla\nm\nbd\na(t\n)\n0.0 0.2 0.4 0.6 0.8 1.0\n0.\n0\n0.\n2\n0.\n4\n0.\n6\n0.\n8\n1.\n0\nBottleneck\nTime (2N_0 generations)\nla\nm\nbd\na(t\n)\n0.0 0.2 0.4 0.6 0.8 1.0\n0\n2\n4\n6\n8\n10\nComplex\nTime (2N_0 generations)\nla\nm\nbd\na(t\n)\nFigure 2: Plots of \u03bb(t) = N(t)N0 for the four population-size scenarios.(Note the diffent\nscale for the Complex scenario.)\nPlots of \u03bb(t) = N(t)\/N0 for each of these models are given in Figure 2\nThe selection models are defined in terms of the selection rates \u03c3\u2217 = (\u03c3\u221711, \u03c3\n\u2217\n12, \u03c3\n\u2217\n22). Our four\nselection models are (i) Neutral \u03c3\u2217 = (0, 0, 0); (ii) Genic \u03c3\u2217 = (0, 5, 10); (iii) Heterozygote\nadvantage \u03c3\u2217 = (0, 10, 0); and (iv) Heterozygote overdominance \u03c3\u2217 = (0, 20, 10). For each\ncombination of population size scenario and selection model we simulated 10,000 samples.\nThe CPU cost varied across the 16 pairs we considered. In the constant population-size\ncase, on a 3.4GHz Laptop, it took 0.3s, 1s, 15s and 25s to simulate 1,000 samples for the\nfour selection models respectively. CPU times were reduced by around a factor of 2 for\nthe Growth and Bottleneck scenarios, and were increased by around a factor of 1.5 for the\nComplex scenario.\nHistograms of the frequency of allele 1 in a sample of size 50 (conditional on the allele\nsegregating) are given in Figure 3. These histograms agree with other simulation results\nfor the cases which include constant population size (see Verifying the CFTP Results).\nThe different population size scenarios have little effect on the frequency spectrum in the\nneutral case, but quite a noticeable effect for each of other selection scenarios. The effect is\n11\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n10\nConstant\nN\neu\ntra\nl\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n10\nGrowth\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n10\n0.\n20\nBottleneck\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n10\n0.\n20\nComplex\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n04\n0.\n08\nG\nen\nic\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n06\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n06\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n06\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n03\nH\net\n A\ndv\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n06\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n06\n0.\n12\n1 6 11 17 23 29 35 41 47\n0.\n00\n0\n0.\n02\n0\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n02\n0.\n04\nO\nve\nr D\nom\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n02\n0.\n04\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n02\n1 6 11 17 23 29 35 41 47\n0.\n00\n0\n0.\n02\n0\nFigure 3: Histograms of the frequency of allele 1 in a sample of size 50 (conditional on the\nallele segregating) for each pair of variable population size scenario and selection model.\nSee text for full details of the models.\n12\nmost pronounced for the Heterozygote Advantage case where the Growth and Bottleneck\nscenarios have substantially reduced any effect of selection.\nTwo Deme Model\nWe now consider a model based on two demes each containing a constant-sized panmictic\npopulations with migration between the demes. For simplicity we assume each deme has\nthe same population size, and idential migration rate from deme 1 to deme 2 and vice\nversa. We assume a total sample of size 100, with 50 chromosomes sampled from each\ndeme. We assume \u03bd = (0.5, 0.5) and present results for \u03b8 = 0.1. We obtain very similar\nresults for smaller values of \u03b8 except that the probability of the allele segregating in the\npopulation is reduced.\nWe present results for four selection models and four migration rates. Again we summarise\nthe selection models in terms of \u03c3\u2217 = (\u03c3\u221711, \u03c3\n\u2217\n12, \u03c3\n\u2217\n22). Our four selection models are (i)\nNeutral \u03c3\u2217 = (0, 0, 0); (ii) Genic \u03c3\u2217 = (0, 5, 10); (iii) Heterozygote advantage \u03c3\u2217 = (0, 10, 0);\nand (iv) Recessive \u03c3\u2217 = (0, 10, 10). The four migration rates (the values of M12 = M21)\nare 10, 2, 0.5 and 0.1.\nWe simulated 10,000 samples for each of the 16 combinations of selection model and migra-\ntion rate. We verified the results for the neutral model with other simulation methods (see\nVerifying the CFTP Results). The CPU cost of the simulation varied little with migration,\nand was approximately 0.4s, 0.7s, 10s and 4s per 1,000 samples for the four selection mod-\nels respectively (CPU times for a 3.4GHz Laptop). The frequency spectrum for samples\nof size 50 within a single deme, conditional on the allele segregating are shown in Figure\n4. The amount of migration appears to have little effect except in the case of heterozygote\nadvantage, when smaller migration rates appear to reduce the effect of selection.\nWe also studied the effect of selection and the degree of divergence in gene frequency be-\ntween the demes. Table 1 gives the mean Fst values for samples under a SNP ascertainment\nmodel which requires 2 randomly chosen chromosomes (across both demes) to segregate.\nIf the observed frequency of type 1 alleles in the demes were p1 and p2 respectively, and\np = (p1 +p2)\/2, then the Fst value for that sample was (p1\u2212p)\n2\/(p(1\u2212p)) (see e.g Section\n2.3 of Nicholson et al., 2002). The weight given to a sample is proportional to p(1 \u2212 p),\nand gives more importance to samples whose minor allele frequency is close to 0.5.\nAs noted by Hughes et al. (2005), the effect of selection is to reduce the amount of variation\nin allele frequencies, and hence Fst values, across demes. The effect is most pronounced\nas migration rates are decreased. (Measuring the variation in allele frequencies using the\nd-statistic of Nei (1987) produced similar results.)\n13\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n04\n0.\n08\nM=10\nN\neu\ntra\nl\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n04\n0.\n08\nM=2\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n04\n0.\n08\nM=0.5\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n06\nM=0.1\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n20\nG\nen\nic\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n15\n0.\n30\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n15\n0.\n30\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n15\n0.\n30\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n02\nH\net\n A\ndv\n1 6 11 17 23 29 35 41 47\n0.\n00\n0\n0.\n02\n0\n1 6 11 17 23 29 35 41 47\n0.\n00\n0\n0.\n01\n5\n1 6 11 17 23 29 35 41 47\n0.\n00\n0\n0.\n01\n5\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n15\nR\nec\nes\nsi\nve\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n15\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n15\n1 6 11 17 23 29 35 41 47\n0.\n00\n0.\n15\nFigure 4: Histograms of the frequency of allele 1 in a sample of size 50 from a single deme\n(conditional on the allele segregating) for each pair of migration rate and selection model.\nSee text for full details of the models.\nM = 10 M = 5 M = 0.5 M = 0.1\nNeutral 0.035 0.123 0.326 0.650\nGenic 0.031 0.070 0.127 0.218\nHet Adv 0.031 0.080 0.159 0.295\nRecessive 0.033 0.083 0.149 0.199\nTable 1: Mean Fst values (based on 10,000 samples) under a 2-deme model for each\ncombination of selection model and migration rate (M). A weighted mean was calculated\nwith the Fst value from each sample being weighted by the probability that 2 randomly\nchosen chromosomes carry different alleles. See text for full details of the models.\n14\nM = 10 M = 5 M = 0.5 M = 0.1\nGenic 0.036 0.122 0.367 0.706\nHet Adv 0.034 0.110 0.253 0.439\nRecessive 0.033 0.115 0.330 0.654\nTable 2: Mean Fst values (based on 10,000 samples) under a 2-deme model with different\nselection regimes within each deme. We assumed neutrality within deme 1, and either the\ngenic, heterozygote advantage or recessive selection model for deme 2. Results are given\nfor different migration rates (M). A weighted mean was calculated with the Fst value from\neach sample being weighted by the probability that 2 randomly chosen chromosomes carry\ndifferent alleles. See text for full details of the models.\nWe further tested the effect of different selection regimes within the two demes. For sim-\nplicity we assumed neutrality within deme 1, and the three selection models above within\ndeme 2. The mean Fst values in this case are given in Table 2. As expected Fst values\nincreased as compared to the case of the same selection regime within each population,\nthough only in the genic selection case are Fst values consistently greater than in the\ncompletely neutral case.\nStepping Stone Model\nWe now consider a linear (circular) stepping stone model . We assume 10 ordered demes,\neach of equal population size. Migration events are possible between neighbouring demes,\nwith Mi,i+1 = Mi+1,i = 1 for i = 1, . . . , 9 and M1,10 = M10,1 = 1. We consider the same\nmutation model and each of the four selection models used in the 2 deme case, and simulate\nsamples of size 100, with 50 chromosomes sampled from deme 1, and 50 from deme 1 + c\nfor c = 1, 2, 3, and 4. We are interested in the degree of correlation in allele frequencies\nfor differing degrees of physical separation of the demes (c) and differing selection models.\nAgain we simulated 10,000 samples for each combination of selection model and c. CPU\ncosts were affected only slightly by c and were 0.5s, 1,4s, 40s and 20s per 1,000 samples\nfor the neutral, genic, heterozygous advantage, and recessive selection models respectively\n(on a 3.4GHz Laptop). We calculated Fst values in the same way as for the 2 deme case\n(above), once again under a SNP ascertainment scheme that requires two randomly chosen\nchromosomes from our sample of size 100 to be carrying different alleles.\nResults are given in Table 3. Again the effect of selection is to reduce the amount of\nvariation in allele frequencies between demes. Most strikingly, for these selection models\n15\nc = 1 c = 2 c = 3 c = 4\nNeutral 0.19 0.27 0.32 0.34\nGenic 0.09 0.10 0.10 0.10\nHet Adv 0.09 0.11 0.11 0.12\nRecessive 0.11 0.12 0.13 0.14\nTable 3: Mean Fst values (based on 10,000 samples) under a stepping-stone model for each\ncombination of selection model and spatial separation of the two demes (c). A weighted\nmean was calculated with the Fst value from each sample being weighted by the probability\nthat 2 randomly chosen chromosomes carry different alleles. See text for full details of the\nmodels.\nc = 1 c = 2 c = 3 c = 4\n\u03c3g = 1 0.16 0.22 0.23 0.25\n\u03c3g = 2 0.13 0.17 0.19 0.17\n\u03c3g = 3 0.11 0.13 0.14 0.14\n\u03c3g = 4 0.10 0.11 0.12 0.11\nTable 4: Mean Fst values (based on 10,000 samples) under a stepping-stone model for\ngenic selection and different spatial separation of the two demes (c). A weighted mean was\ncalculated with the Fst value from each sample being weighted by the probability that 2\nrandomly chosen chromosomes carry different alleles. See text for full details of the models.\nthe amount of variation in allele frequencies depends little on the spatial separation of the\ndemes, which is not the case for the neutral case. We further investigated this effect by\nsimulating samples under the genic model for a range of smaller selection values; \u03c3g = 1,\n2, 3 and 4 (see Table 4). The effect that Fst values depend little on spatial separation is\nnoticeable for \u03c3g \u2265 2.\n4 Discussion\nWe have presented a method for simulating samples from the stationary distribution of a\nclass of non-neutral population genetic models. The method is simple compared to other\napproaches based on CFTP (Fearnhead, 2001) due to the monotonicity inherent in the\n16\nproblems we consider. Thus simulating samples only requires (i) to simulate the number of\nbranches within the ancestral selection graph back in time; and (ii) to simulate the number\nof these branches (within each deme) that carry allele 1 forward in time for two initial\nconfigurations: all branches initially carrying allele 1 and all branches initially carrying\nallele 2. The resulting algorithm has been shown to be computationally efficient, and\nenables simulation of a large number of samples from complex selection and demographic\nmodels within practicable CPU time. The main limitation on the simulation algorithm is\nthe mutation rate \u03b8, with the CPU cost appearing to increase proportional 1\/\u03b8 for small\ntheta. Thus simulation for very small values of the mutation rate can be prohibitive.\nThe monotonicity characteristic of our models occurs because we consider only a single\nselective locus which carries two different alleles. For more general models, monotonicity\nwill not necesarily apply, but simulating unordered samples as here should still be easier\nand more efficient than simulating ordered samples as in Fearnhead (2001).\nThe examples we considered either assumed a single population and variable population\nsize, or constant population size and multiple demes. There are alternative approaches for\nanalysing and simulating under the former class of models: in some cases direct simulation\nis possible by simulating the ancestral selection graph back in time until there is a constant\npopulation size and then simulating the alleles on the branches at that time from the\nknown stationary distribution of the constant population size model. Alternatively there\nis recent work by Evans et al. (2006) which calculates the frequency spectrum under variable\npopulation size models and an infinite sites mutation model, and the method used with\nSelSim (Spencer and Coop, 2004) could easily be adapted to this situation.\nHowever, simulating samples from non-neutral models with multiple demes is much more\nchallenging, and we know of no other current coalescent-based simulation methods in this\ncase. Some methods exist for special cases, for example diffusion approximations for the\nisland model in the limit as the number of demes tends to infinity (Cherry and Wakeley,\n2003; Cherry, 2003).\nAcknowledgements Motivation for this work came from the ICMS workshop on Math-\nematical Population Genetics, March 2006. This research was supported by Engineering\nand Physical Sciences Research grant number C531558.\nAppendix A: Diploid Selection Dynamics\nFix a deme and let n be the number of branches located in that deme and n(1) the number\nwhich carry allele 1. The dynamics at a diploid selection event are as follows (see Neuhauser\nand Krone, 1997): (i) choose 3 branches at random, call the first the incoming branch, the\n17\nsecong the continuing branch and the third the checking branch; (ii) denote by ij the\ngenotype given be the incoming and checking branch; and (iii) with probability \u03c3ij\/\u03c3 the\nincoming branch is parental, otherwise the continuing branch is.\nFirstly consider the probability of the non-ancestral branches at a diploid selection event\nboth carrying allele 1. This corresponds to the first condition on u given by (1). This\noccurs if either (a) all three branches chosen in (i) carry allele 1, or (b) if two of these\nbranches carry allele 1 and they are non-ancestral. The probability of (a) is n(1)(n(1) \u2212\n1)(n(1) \u2212 2)\/(n(n\u2212 1)(n\u2212 2)). The probabilitiy of (b) is\n3n(1)(n(1) \u2212 1)(n\u2212 n(1))\nn(n\u2212 1)(n\u2212 2)\n(\n\u03c312\n3\u03c3\n+\n\u03c3 \u2212 \u03c311\n3\u03c3\n)\n,\nwhere the first term is the probability of choosing 2 branches carrying allele 1 and one\ncarrying allele 2; the second the term is the probability of the branch carrying allele 2\nbeing the incoming branch and being ancestral; and the final term is the probability of the\nbranch carrying allele 2 being the continuing branch and being ancestral.\nCombining these probabilities gives the expression on the right-hand side of (1).\nThe right-hand side of (2) is one minus the probability of the two non-ancestral branches\ncarrying allele 2, and is calculated in an identical manner. The probability of u satisfying\n(2) but not (1) is thus the required probability of the precisely one non-ancestral branches\ncarrying allele 1.\nAppendix B: Monotonicity\nFor notational simplicity we will drop the (1) superscipt for the state. Consider two values\nfor the state n and n\u2032 which satisfy n \u2265 n\u2032. To demonstrate monotonicity we need to show\nthat for any possible event and value of u this ordering of the states is preserved.\nMonotonicity at coalescence, mutation and genic selection events hold trivially. Assume\none of these events occurs to a branch in deme d. Either nd = n\n\u2032\nd in which case the dynamics\nat this event are identical for both states; or nd \u2265 n\n\u2032\nd + 1 in which case the ordering is\npreserved as the transition changes the nd and n\n\u2032\nd values by either 0 or 1.\nMonotonicity also follows for migration events. Consider a migration from deme i to deme\nd. We need only consider ni 6= n\n\u2032\ni, as otherwise the dynamics at this event are identical for\nboth states. However in this case the ordering is preserved in deme i by the same argument\nas above; and is also preserved in deme d as nd \u2265 n\n\u2032\nd and the dynamics mean that whenever\nn\u2032d increases by one then so does nd.\nFinally consider diploid selection in deme d. By the same arguments as above monotonicity\ntrivially holds if nd = n\n\u2032\nd or nd \u2265 n\n\u2032\nd + 2, so we focus on nd = n\n\u2032\nd + 1. The key point is to\n18\ncheck that it is never possible for n\u2032d to be unchanged at this event at the same time as nd\nbeing decreased by 2. Again for ease of exposition, we slightly change notation and denote\nthe number of branches in deme d by n. For such a transition to occur we would need\nu <\nnd(nd \u2212 1)(nd \u2212 2 + (\u03c3 \u2212 \u03c311 + \u03c312)(n\u2212 nd)\/\u03c3)\nn(n\u2212 1)(n\u2212 2)\n, (3)\nfor the nd to be decreased by 2 (see Equation 1) and\nu > 1\u2212\n(n\u2212 nd + 1)(n\u2212 nd)(n\u2212 nd \u2212 1 + (\u03c3 \u2212 \u03c322 + \u03c312)(nd \u2212 1)\/\u03c3)\nn(n\u2212 1)(n\u2212 2)\n, (4)\nfor n\u2032d to be unchanged (using Equation 2 and n\n\u2032\nd = nd\u22121). Now let a = (\u03c3\u2212\u03c311+\u03c312)\/(3\u03c3)\nand b = (\u03c3\u2212\u03c322 +\u03c312)\/(3\u03c3). Inequalities (3) and (4) can simultaneously hold for the same\nu if and only if\nnd(nd \u2212 1)(nd \u2212 2 + 3a(n\u2212 nd))\nn(n\u2212 1)(n\u2212 2)\n> 1\u2212\n(n\u2212 nd + 1)(n\u2212 nd)(n\u2212 nd \u2212 1 + 3b(nd \u2212 1))\nn(n\u2212 1)(n\u2212 2)\n.\nThus for monotonicity we need to show that this cannot occur, and thus that for all n and\nnd\nn(n\u2212 1)(n\u2212 2) \u2265 nd(nd \u2212 1)(nd \u2212 2) + 3nd(nd \u2212 1)(n\u2212 nd)a+\n(n\u2212 nd + 1)(n\u2212 nd)(n\u2212 nd \u2212 1) + 3(n\u2212 nd + 1)(n\u2212 nd)(nd \u2212 1)b\nNow consider the right hand side; this can be re-written as\nnd(nd \u2212 1)(nd \u2212 2) + 3nd(nd \u2212 1)(n\u2212 nd)\u2212 3nd(nd \u2212 1)(n\u2212 nd)(1\u2212 a)+\n(n\u2212 nd)(n\u2212 nd \u2212 1)(n\u2212 nd \u2212 2) + 3(n\u2212 nd)(n\u2212 nd \u2212 1) + 3(n\u2212 nd)(n\u2212 nd \u2212 1)(nd) +\n3(n\u2212 nd)(3nd \u2212 n\u2212 1)\u2212 3(n\u2212 nd + 1)(n\u2212 nd)(nd \u2212 1)(1\u2212 b)\nNow the first, second, fourth and sixth terms of this expression sum to n(n\u2212 1)(n\u2212 2), so\nwe get that the inequality we required simplifies to\n0 \u2265 \u22123nd(nd \u2212 1)(n\u2212 nd)(1\u2212 a) + 3(n\u2212 nd)(n\u2212 nd \u2212 1)+\n3(n\u2212 nd)(3nd \u2212 n\u2212 1)\u2212 3(n\u2212 nd + 1)(n\u2212 nd)(nd \u2212 1)(1\u2212 b)\n= 3(n\u2212 nd)((n\u2212 nd \u2212 1 + 3nd \u2212 n\u2212 1)\u2212 (1\u2212 a)nd(nd \u2212 1)\u2212 (1\u2212 b)(n\u2212 nd + 1)(nd \u2212 1))\n= 3(n\u2212 nd)(nd \u2212 1)[2\u2212 (1\u2212 a)nd \u2212 (1\u2212 b)(n\u2212 nd + 1)]\n19\nNow this inequality trivially holds for nd = 1 and for n = nd. For larger values of nd and\nn\u2212nd the term in the square brackets is decreasing with both nd and n\u2212nd (as both a < 1\nand b < 1). So we need only show that the inequality holds for nd = 2 and n\u2212nd = 1.The\nsquare bracket term in this case is 2(a + b \u2212 1); and the inequality a + b \u2212 1 < 0 holds if\nand only if 2\u03c321 \u2264 \u03c3 + \u03c311 + \u03c322.\nReferences\nCherry, J. L. (2003). Selection in a subdivided population with dominance or local fre-\nquency dependence. Genetics 163, 1511\u20131518.\nCherry, J. L. and Wakeley, J. (2003). A diffusion approximation for selection and drift in\na subdivided population. Genetics 163, 421\u2013428.\nCoop, G. and Griffiths, R. C. (2004). Ancestral inference on gene trees under selection.\nTheoretical Population Biology 66, 219\u2013232.\nDonnelly, P. and Kurtz, T. (1999). Genealogical processes for Fleming-Viot models with\nselection and recombination. Annals of Applied Probability 9, 1091\u20131148.\nDonnelly, P. and Tavare\u00b4, S. (1995). Coalescents and genealogical structure under neutrality.\nAnnual Review of Genetics 29, 401\u2013421.\nDonnelly, P., Nordborg, M. and Joyce, P. (2001). Likelihoods and simulation methods for\na class of non-neutral population genetics models. Genetics 159, 853\u2013867.\nEvans, S. N., Shvets, Y. and Slatkin, M. (2006). Non-equilibrium theory of\nthe allele frequency spectrum. Theoretical Population Biology , To appear-\nDoi:10.1016\/j.tpb.2006.06.005.\nFearnhead, P. (2001). Perfect simulation from population genetic models with selection.\nTheoretical Population Biology 59, 263\u2013279.\nFearnhead, P. (2006). The stationary distribution of allele frequencies when selection acts at\nunlinked loci. Theoretical Population Biology , To AppearDoi:10.1016\/j.tpb.2006.02.001.\n20\nFearnhead, P. and Meligkotsidou, L. (2004). Exact filtering for partially-observed\ncontinuous-time Markov models. Journal of the Royal Statistical Society, series B 66,\n771\u2013789.\nHarding, R. M., Fullerton, S. M., Griffiths, R. C., Bond, J., Cox, M. J., Schneider, J. A.,\nMoulin, D. S. and Clegg, J. B. (1997). Archaic African and Asian lineages in the genetic\nancestry of modern humans. American Journal of Human Genetics 60, 772\u2013789.\nHudson, R. R. (1990). Gene genealogies and the coalescent process. In: Oxford Surveys in\nEvolutionary Biology (eds. D. Futuyma and J. Antonovics), volume 7, Oxford University\nPress, New York, 1\u201344.\nHudson, R. R. (2002). Generating samples under a Wright-Fisher neutral model of genetic\nvariation. Bioinformatics 18, 337\u2013338.\nHughes, A. L., Packer, B., Welch, R., Bergen, A. W., Chanock, S. J. and Yeager, M. (2005).\nEffects of natural selection on interpopulation divergence at polymorphic sites in human\nprotein-coding loci. Genetics 170, 1181\u20131187.\nJoyce, P. and Genz, A. (2006). Efficient simulation methods for a class of nonneutral\npopulation genetics models. To appear in Theoretical Population Biology .\nKendall, W. S. (2005). Notes on perfect simulation. In: Markov Chain Monte Carlo: In-\nnovations and Applications (eds. W. S. Kendall, F. Liang and J. Wang), volume 7 of\nLecture Note Series, Instiute for Mathematical Science, National University of Singa-\npore, 93\u2013146.\nKingman, J. F. C. (1982). The coalescent. Stochastic Processes and their Applications 13,\n235\u2013248.\nKrone, S. M. and Neuhauser, C. (1997). Ancestral processes with selection. Theoretical\nPopulation Biology 51, 210\u2013237.\nMarth, G. T., E Czabarka, J. M. and Sherry, S. T. (2004). The allele frequency spectrum\nin genome-wide human variation data reveals signals of differential demographic history\nin three large world populations. Genetics 166, 351\u2013372.\nNei, M. (1987). Molecular Evolutionary Genetics . Columbia University Press, New York.\n21\nNeuhauser, C. and Krone, S. M. (1997). The genealogy of samples in models with selection.\nGenetics 145, 519\u2013534.\nNicholson, G., Smith, A. V., Jo\u00b4nsson, F., Gu\u00b4stafsson, O., Stefa\u00b4nsson, K. and Donnelly,\nP. (2002). Assessing population differentiation and isolation from single-nucleotide poly-\nmorphism data. Journal of the Royal Statistical Society Series B 64, 695\u2013715.\nNordborg, M. (2001). Coalescent theory. In: Handbook of Statistical Genetics , John Wiley\nand Sons, England, 179\u2013212.\nNordborg, M. and Innan, H. (2003). The genealogy of sequences containing multiple sites\nsubject to strong selection in a subdivided population. Genetics 163, 1201\u20131213.\nPritchard, J. K. (2001). Are rare variants responsible for susceptibility to complex diseases?\nAmerican Journal of Human Genetics 69, 124\u2013137.\nPropp, J. G. and Wilson, D. B. (1996). Exact sampling with coupled Markov chains and\napplications to statistical mechanics. Random Structures and Algorithms 9, 223\u2013252.\nPrzeworski, M. (2003). Estimating the time since the fixation of a beneficial allele. Genetics\n164, 1667\u20131676.\nSchaffner, S. F., Foo, C., Gabriel, S., Reich, D., Daly, M. J. and Altshuler, D. (2005). Cal-\nibrating a coalescent simulation of human genome sequence variation. Genome Research\n15, 1576\u20131583.\nSlade, P. F. (2000). Simulation of selected genealogies. Theoretical Population Biology 57,\n35\u201349.\nSpencer, G. C. A. and Coop, G. (2004). SelSim: a program to simulate population genetic\ndata with natural selection and recombination. Bioinformatics 20, 3673\u20133675.\nStephens, M. and Donnelly, P. (2003). A comparison of Bayesian methods for haplotype\nreconstruction from population genotype data. American Journal of Human Genetics\n73, 1162\u20131169.\nWakeley, J., Nielsen, R., Liu-Cordero, S. N. and Ardlie, K. (2001). The discovery of Single-\nNucleotide Polymorphisms \u2013 and inferences about human demographic history. American\nJournal of Human Genetics 69, 1332\u20131347.\n22\nWall, J. D., Andolfatto, P. and Przeworski, M. (2002). Testing models of selection and\ndemography in Drosophila simulans. Genetics 162, 203\u2013216.\n23\n"}