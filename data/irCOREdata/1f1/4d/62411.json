{"doi":"10.1016\/j.cageo.2008.10.013","coreId":"62411","oai":"oai:nora.nerc.ac.uk:4489","identifiers":["oai:nora.nerc.ac.uk:4489","10.1016\/j.cageo.2008.10.013"],"title":"An R Script for Visualising and Analysing Fluorescence Excitation\u2013Emission Matrices (EEMs)","authors":["Lapworth, Daniel Joseph","Kinniburgh, David"],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2009","abstract":"Fluorescence excitation\u2013emission matrix (EEM) spectroscopy is an important technique for investigating organic material and produces a complex output that often requires further processing for useful analysis. This computer note outlines a tool for producing a range of plots of fluorescence EEM data in the open\u2013source statistical package R. A script has been written that allows the user to input data from Excel worksheets (CSV files) and process multiple input data files. The R script will then produce the plots and summary statistics, in the form of a CSV table, and write the output files to a user specified folder. Plot types include filled contour plots and 3D wireframe perspective plots for whole EEMs, filled contour plots for selected regions within an EEM and plots for specified slices across the EEM. This script provides a free tool to enable the user to rapidly visualise EEMs and produce tailored EEM plots and slices through EEMs of publication quality","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/62411.pdf","fullTextIdentifier":"http:\/\/nora.nerc.ac.uk\/4489\/1\/NoteCG.pdf","pdfHashValue":"51bff5654579777062f1fc04c9120eabdfe5b46f","publisher":"Elsevier","rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:nora.nerc.ac.uk:4489<\/identifier><datestamp>\n      2012-11-22T11:51:44Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      7375626A656374733D5338<\/setSpec><setSpec>\n      7375626A656374733D5339<\/setSpec><setSpec>\n      7375626A656374733D533137<\/setSpec><setSpec>\n      7375626A656374733D5337<\/setSpec><setSpec>\n      74797065733D61727469636C65<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:relation>\n    \n      \n        http:\/\/nora.nerc.ac.uk\/id\/eprint\/4489\/<\/dc:relation><dc:title>\n        An R Script for Visualising and Analysing Fluorescence Excitation\u2013Emission Matrices (EEMs)<\/dc:title><dc:creator>\n        Lapworth, Daniel Joseph<\/dc:creator><dc:creator>\n        Kinniburgh, David<\/dc:creator><dc:subject>\n        Computer Science<\/dc:subject><dc:subject>\n        Data and Information<\/dc:subject><dc:subject>\n        Hydrology<\/dc:subject><dc:subject>\n        Chemistry<\/dc:subject><dc:description>\n        Fluorescence excitation\u2013emission matrix (EEM) spectroscopy is an important technique for investigating organic material and produces a complex output that often requires further processing for useful analysis. This computer note outlines a tool for producing a range of plots of fluorescence EEM data in the open\u2013source statistical package R. A script has been written that allows the user to input data from Excel worksheets (CSV files) and process multiple input data files. The R script will then produce the plots and summary statistics, in the form of a CSV table, and write the output files to a user specified folder. Plot types include filled contour plots and 3D wireframe perspective plots for whole EEMs, filled contour plots for selected regions within an EEM and plots for specified slices across the EEM. This script provides a free tool to enable the user to rapidly visualise EEMs and produce tailored EEM plots and slices through EEMs of publication quality.<\/dc:description><dc:publisher>\n        Elsevier<\/dc:publisher><dc:date>\n        2009<\/dc:date><dc:type>\n        Publication - Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:format>\n        text<\/dc:format><dc:language>\n        en<\/dc:language><dc:identifier>\n        http:\/\/nora.nerc.ac.uk\/id\/eprint\/4489\/1\/NoteCG.pdf<\/dc:identifier><dc:identifier>\n         \n\n  Lapworth, Daniel Joseph; Kinniburgh, David.  2009  An R Script for Visualising and Analysing Fluorescence Excitation\u2013Emission Matrices (EEMs).   Computers and Geosciences, 35 (10). 2160-2163.  https:\/\/doi.org\/10.1016\/j.cageo.2008.10.013 <https:\/\/doi.org\/10.1016\/j.cageo.2008.10.013>     \n <\/dc:identifier><dc:relation>\n        http:\/\/www.sciencedirect.com\/science\/journal\/00983004<\/dc:relation><dc:relation>\n        10.1016\/j.cageo.2008.10.013<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/nora.nerc.ac.uk\/id\/eprint\/4489\/","http:\/\/www.sciencedirect.com\/science\/journal\/00983004","10.1016\/j.cageo.2008.10.013"],"year":2009,"topics":["Computer Science","Data and Information","Hydrology","Chemistry"],"subject":["Publication - Article","PeerReviewed"],"fullText":" An R Script for Visualising and Analysing Fluorescence \nExcitation\u2013Emission Matrices (EEMs) \n \nDan J. Lapworth* and David G. Kinniburgh \n \nBritish Geological Survey, Maclean building, Crowmarsh Gifford, Wallingford, \nOxon, OX10 8BB \ne-mail: djla@bgs.ac.uk \n* Corresponding author \n \nKeywords: Fluorescence spectroscopy, excitation-emission matrices, 3D visualisation \n \nIntroduction \nFluorescence spectroscopy has been used for characterising the composition and \nsources of dissolved organic matter (DOM) in many different environments and is an \nactive area of research (Baker and Lamont-Black 2001, Hudson et al. 2008, Hall et al. \n2005, Jones et al. 2002). Natural organic matter (NOM) is derived from the decay of \norganic material from both plant, animal and microbial sources and a significant \nproportion of NOM fluoresces (Senesi, 1993). Due to rapid technological advances in \nrecent years modern fluorescence instruments can now characterise the excitation\u2013\nemission properties of a sample at multiple wavelengths very rapidly (typically< 5 \nminutes) and are able to produce matrices which represent the three dimensional \nfluorescence landscape of a particular sample. Peaks in fluorescence intensity are \nrelated to the concentrations of a particular fluorophores (e.g. fulvic\/humic-like \ncompounds, tryptophan and tyrosine) and the method is able to detect low \nconcentrations of these compounds in environmental samples.    \nAs well as simply displaying results from excitation\u2013emission matrices (EEMs) \nvisualising the EEM data is also the first step in carrying out any sort of detailed data \nanalysis or interpretations using EEMs. For example prior to carrying out statistical \nanalysis on samples e.g. parallel factor analysis (Bro 1997, Bro et al. 2002, Stedmon \net al. 2003) the first step in the process is to visualise the matrices to assess if it is \nworth carrying out further analysis, i.e. to isolate and possibly remove obvious \noutliers or erroneous EEMs from the modelling process.  \nThree dimensional plots are used in many applications, common examples include \nmapping landscape topography, thermal imaging and NMR imaging (Fairley and \nNicholson 2006, van Beek 2007). Many different commercial statistical and graphics \npackages are available to plot three dimensional data (e.g. Matlab, S-plus, Graphis) as \nwell as freeware applications (e.g. openGL and R). However, in many cases \nconsiderable time and effort is required by the user to understand the programming \nlanguage of the application in order to implement a particular application, and the \ninitial cost of the application may also be prohibitive.  \nR is an open source statistical and graphics system that is a dialect of the S language, \nthe basis of the commercial S-PLUS system (Maindonald and Braun 2003). It is a \nfunction based language that has an extensive and rapidly growing library of packages \n(Ihaka and Gentleman, 1996, R Development Core Team, 2008).   \nThis computer note outlines a tool for producing a range of plots of fluorescence EEM \ndata in the open\u2013source statistical package R. A script has been written that allows the \nuser to input data from Excel worksheets (CSV files) and process multiple input data \nfiles. The R script will then produce the plots and summary statistics, in the form of a \nCSV table, and write the output files to a user specified folder. Plot types include \nfilled contour plots and 3D wireframe perspective plots for whole EEMs, filled \ncontour plots for selected regions within an EEM and plots for specified slices across \nthe EEM. This script provides a free tool to enable the user to rapidly visualise EEMs \nand produce tailored EEM plots and slices through EEMs of publication quality. \nAn R script for Plotting Fluorescence Data \nThe R script presented in this paper is designed to read in and process CSV files of \nEEMs configured as a matrix. For the generic script presented in this paper the default \nspecification for the data input file is as follows: excitation wavelengths n= 40 (200\u2013\n400nm with 5nm interval, columns in CSV file), emission wavelenghts n= 111 (200\u2013\n500 nm with 2 nm interval, rows in CSV file), intensity range is set as -10\u20131000 (a.u). \nFigure 1 shows the format of the sample file that is read into R as a CSV file.  R needs \nto be installed on the computer, and this can be done by downloading the latest \nversion from the Comprehensive R Archive Network (CRAN \u2013 see section on \nsoftware availability). Figure 2 shows the file structure that is required to run the \nscript. Prior to running the script the EEM CSV files are saved into the data folder. \nThe script enables multiple files to be processes at the same time. As a default the plot \nfile names and titles on plots are the same as the original data file names in the data \nfolder. While this is the default setup it is relatively simple to modify the R script to \nbe able to read in files from other instruments and customise where the data files are \nread from and written to. The R script enables the user to have full control of the \nplotting region e.g. the title, axis and colours can all be modified by the user to suit \ndifferent tastes. A range of 3D plotting functions are produced, filled contour plots \nand wireframe plots of the whole EEM and filled contour plots of selected regions \nwithin the EEM. Slices through the EEM are also produced at selected excitation and \nemission wavelengths, these and the other plot options can also be easily modified by \nthe user. The script also writes results (mean, min, max, \u03a3 intensity and standard \ndeviation) extracted from selected regions within the EEM to a CSV file called \n\u201cSummary_Results.csv\u201d in the results folder. The user is provided with an R script, a \ndetailed tutorial on how to set up and run the R script, and some demonstration \nsample files to familiarise the user with the tool.  \nA script is also available that will read in and process CSV files that are produced \ndirectly from the Varian Cary Eclipse Fluorescence Spectrometer\u2122, the only \ndifference being the script first manipulates the data produced by the instrument into \nthe matrix format shown in Figure 2. It is relatively simple to modify the script \npresented in this paper to process non-standard fluorescence data which is not \nconfigured in a matrix. \nUser interface \nOnce R is installed and started the script is loaded into the R editor window by \nbrowsing to the R script in the R graphical user interface GUI: file, open script and \nbrowse to where the script was saved. Set \u2018history\u2019 in the graphics window to \n\u2018Recording\u2019 in the GUI this will record the plots generated in the graphics window \nand enable the user to page up and down to view all the plots. Once the script is \nloaded it is run by using the following commands, Ctrl A then Ctrl R from the editor \nwindow. Plots are automatically generated in the graphics window. Plots can be \nwritten to file from the GUI: file, save as, and choosing the output format (metafile, \npostscript, pdf, png, bmp, TIFF or jpeg). For details on how to write plots directly to \nfile, change the selected plot zone and select your own 2D slices of the EEM (see the \ntutorial supplied with the script).  \nExample Application \nThe data used for this demonstration is an EEM scan of a shallow groundwater \nsample from the Permo-Triassic Sandstone in the UK (Lapworth et al. 2008). Figure \n3a shows the whole EEM as a filled contour plot and 3b as a wireframe plot. Figure \n3c shows cross-sections through the fulvic-acid like region of the EEM (Excitation \nwavelength = 330 nm). The peak on the left hand side of plot Figure 3c is the Raman \nline. Figure 3d shows a zoomed in plot of the tryptophan-like region (Ex250\u2013300 nm, \nEm300\u2013370 nm). These were all generated from the default script using the \ndemonstration sample file supplied with the R script. Ultrapure water (ASTM type I \nreagent grade water, including a UV cracker) was used for the blank sample and to \nclean the quartz cell between samples. All EEM plots have had the linear features of \nthe Rayleigh-Tyndall and Raman lines removed. Blank subtraction is able to remove \nmost of the linear features of the water Raman line and the Rayleigh-Tyndall lines \nwere masked out by multiplying the sample matrix with a mask matrix containing \nvalues of 0 and 1. The mask matrix was developed by delineating the regions affected \nby the Rayleigh-Tyndall lines in the blank and samples and assigning them a value of \n0, other regions of interest were assigned a value of 1. The blank and mask files are \nsupplied with the demonstration files and the R script.  \nOne possible future application of this script would be to allow rapid data analysis of \nfluorescence results from in-situ monitoring systems for waste water treatment \nprocesses. With only relatively small developments the script could rapidly extract \nand display results as a time series allowing the operators to monitor the performance \nof the treatment process by using fluorescence as a water quality indicator e.g. a proxy \nfor biological oxygen demand (BOD) (Hudson., 2008). \nConclusions \nThis paper has demonstrated the use of open-source software to visualise and analyse \nraw 3D EEM data. The R package is quick and easy to install, and the R script is able \nto rapidly help the user assess fluorescence results and produce outputs of publication \nquality. The outputs can be tailored to the users requirements, and either visualised in \nthe GUI or written directly to file for future use.  \nSoftware Availability \nThe latest version of R is available free of charge from the CRAN (http:\/\/www.r-\nproject.org\/) and the R script for visualising EEMs (PLOTEEM.R or the equivalent \nscript that will process Varian CSV files), tutorial and example data files are available \nfree upon request by contacting djla@bgs.ac.uk. \nAcknowledgments \nThe authors would like to thank the helpful review and comments from D.C.Gooddy, \nand thank P. S. Naden and G.H. Old for the use of the spectrometer. This paper is \npublished with the permission of the Executive Director, British Geological Survey \n(NERC). The manuscript was improved by comments from the two journal reviewers. \nReferences  \nBro, R. 1997. PARAFAC, tutorial and applications. Chemometrics and Intelligent \nLaboratory Systems 38 149\u2013171.  \nBro, R., Sidiropoulos, N., Smilde, A. 2002. Maximum likelihood fitting using \nordinary least squares algorithms. Journal of Chemometrics 16 387-400. \nBaker, A., Lamont-Black, J. 2001. Fluorescence of Dissolved Organic Matter as a \nNatural Tracer of Ground Water. Ground Water 39 (5), 745\u2013750. \nvan Beek, J.D, 2007. matNMR: A flexible toolbox for processing, analyzing and \nvisualizing magnetic resonance data in Matlab\u00ae. Journal of  Magnetic \nResonance 187 (1), 19\u201326. \nCRAN, Comprehensive R Archive Network, http:\/\/cran.r-project.org\/. \nFairley, J.P., Nicholson, K.N. 2006. Imaging lateral groundwater flow in the shallow \nsubsurface using stochastic temperature fields. Journal of Hydrology 321 (1\/4), \n276\u2013285. \nHall, G.J., Clow, K.E., Kenny, J.E. 2005. Estuarial fingerprinting through \nmultidimensional fluorescence and multivariate analysis. Environment Science \nand Technology 39 (19), 7560\u20137567. \nHudson, N., Baker, A., Ward, D., Reynolds, D.M., Brunsdon C., Carliell-Marquet, C, \nBrowning, S. 2008. Can fluorescence spectrometry be used as a surrogate for \nthe Biochemical Oxygen Demand (BOD) test in water quality assessment? An \nexample from South West England. Science of the Total Environment, 391 (1), \n149\u2013158. \nIhaka, R., Gentleman, R., 1996. R: A language for data analysis and graphics. Journal \nof Computational and Graphical Statistics, 5 (3), 229-235. \nJones, D.L., Owen, A G., Farrar, J F. 2002. Simple method to enable high resolution \ndetermination of total free amino acids in soil solutions and soil extracts. Soil \nBiology & Biogeochemistry, 34 (12), 1893\u20131902. \nLapworth, D.J., Gooddy, D C., Butcher, A., Morris, B. 2008. Tracing groundwater \nflow and sources of organic carbon in sandstone aquifers using fluorescence \nproperties of dissolved organic matter (DOM). Applied Geochemistry, \ndoi:10.1016\/j.apgeochem.2008.07.011. \nMaindonald, J., and Braun, J. 2003. Data analysis and graphics using R \u2013 an example \nbased approach. Cambridge University Press, pp 360. \nR Development Core Team. 2008. The R foundation for statistical computing, Vienna \nUniversity of Technology, Vienna, Austria. \nSenesi, N. 1993. In: Organic substances in soil and water: natural constituents and \ntheir influences on contaminant behaviour; Bech, A.J., Jones, K.C., Hayes, \nM.B.H., Mingelgrin, U., Eds.; The Royal Society of Chemistry: Cambridge, p \n74. \n \nStedmon, C.A., Markager, S., Bro, R. 2003. Tracing dissolved organic matter in \naquatic environments using a new approach to fluorescence spectroscopy. \nMarine Chemistry 82 (3\/4), 239\u2013254. \n \nFigures \n \nFigure 1. Matrix of intensity for R script \n \nFigure 2. Default file structure that is needed to run R script \n \nFigure 3. EEM plots produced: a) filled contour plot of whole EEM, b) perspective \nplot of whole EEM, c) cross section through EEM at Ex330 nm, d) zoomed in plot of \ntryptophan-like region of EEM. \n"}