{"doi":"10.1103\/PhysRevB.73.155114","coreId":"66456","oai":"oai:dro.dur.ac.uk.OAI2:1404","identifiers":["oai:dro.dur.ac.uk.OAI2:1404","10.1103\/PhysRevB.73.155114"],"title":"Variational density-functional perturbation theory for dielectrics and lattice dynamics.","authors":["Refson, K.","Tulip, P. R.","Clark, S. J."],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2006-04","abstract":"The application of variational density functional perturbation theory (DFPT) to lattice dynamics and dielectric properties is discussed within the plane-wave pseudopotential formalism. We derive a method to calculate the linear response of the exchange-correlation potential in the GGA at arbitrary wavevector. We introduce an efficient self-consistent solver based on all-bands conjugate-gradient minimization of the second order energy, and compare the performance of preconditioning schemes. Lattice-dynamical and electronic structure consequences of space-group symmetry are described, particularly their use in reducing the computational effort required. We discuss the implementation in the CASTEP DFT modeling code, and how DFPT calculations may be efficiently performed on parallel computers. We present results on the lattice dynamics and dielectric properties of -quartz, the hydrogen bonded crystal NaHF2 and the liquid-crystal-forming molecule 5CB. Excellent agreement is found between theory and experiment within the GGA","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/66456.pdf","fullTextIdentifier":"http:\/\/dro.dur.ac.uk\/1404\/1\/1404.pdf","pdfHashValue":"0f458491862dbb300fc0f4a646c74afb3eaea8d0","publisher":"American Physical Society","rawRecordXml":"<record><header><identifier>\n  \n    \n      oai:dro.dur.ac.uk.OAI2:1404<\/identifier><datestamp>\n      2010-09-20T15:01:42Z<\/datestamp><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:title>\n    \n      \n        Variational density-functional perturbation theory for dielectrics and lattice dynamics.<\/dc:title><dc:creator>\n        Refson, K.<\/dc:creator><dc:creator>\n        Tulip, P. R.<\/dc:creator><dc:creator>\n        Clark, S. J.<\/dc:creator><dc:description>\n        The application of variational density functional perturbation theory (DFPT) to lattice dynamics and dielectric properties is discussed within the plane-wave pseudopotential formalism. We derive a method to calculate the linear response of the exchange-correlation potential in the GGA at arbitrary wavevector. We introduce an efficient self-consistent solver based on all-bands conjugate-gradient minimization of the second order energy, and compare the performance of preconditioning schemes. Lattice-dynamical and electronic structure consequences of space-group symmetry are described, particularly their use in reducing the computational effort required. We discuss the implementation in the CASTEP DFT modeling code, and how DFPT calculations may be efficiently performed on parallel computers. We present results on the lattice dynamics and dielectric properties of -quartz, the hydrogen bonded crystal NaHF2 and the liquid-crystal-forming molecule 5CB. Excellent agreement is found between theory and experiment within the GGA.<\/dc:description><dc:subject>\n        Generalized gradient approximation<\/dc:subject><dc:subject>\n         Alpha-quartz<\/dc:subject><dc:subject>\n         Symmetry properties<\/dc:subject><dc:subject>\n         Effective charges<\/dc:subject><dc:subject>\n         Normal vibrations<\/dc:subject><dc:subject>\n         Basis-set<\/dc:subject><dc:subject>\n         Solids<\/dc:subject><dc:subject>\n         Crystal<\/dc:subject><dc:subject>\n         Energy<\/dc:subject><dc:subject>\n         Simulation.<\/dc:subject><dc:publisher>\n        American Physical Society<\/dc:publisher><dc:source>\n        Physical review B, 2006, Vol.73(4-8), pp.155114 [Peer Reviewed Journal]<\/dc:source><dc:date>\n        2006-04<\/dc:date><dc:type>\n        Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:identifier>\n        dro:1404<\/dc:identifier><dc:identifier>\n        issn:1098-0121<\/dc:identifier><dc:identifier>\n        issn: 1550-235X<\/dc:identifier><dc:identifier>\n        doi:10.1103\/PhysRevB.73.155114<\/dc:identifier><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/1404\/<\/dc:identifier><dc:identifier>\n        http:\/\/dx.doi.org\/10.1103\/PhysRevB.73.155114<\/dc:identifier><dc:format>\n        application\/pdf<\/dc:format><dc:identifier>\n        http:\/\/dro.dur.ac.uk\/1404\/1\/1404.pdf<\/dc:identifier><dc:rights>\n        \u00a9 2006 by The American Physical Society. All rights reserved. <\/dc:rights><dc:accessRights>\n        info:en-repo\/semantics\/openAccess<\/dc:accessRights><\/oai_dc:dc><\/metadata><\/record>","journals":[{"title":null,"identifiers":["issn:1098-0121"," 1550-235x","1098-0121","issn: 1550-235X"]}],"language":{"code":"en","id":9,"name":"English"},"relations":[],"year":2006,"topics":["Generalized gradient approximation","Alpha-quartz","Symmetry properties","Effective charges","Normal vibrations","Basis-set","Solids","Crystal","Energy","Simulation."],"subject":["Article","PeerReviewed"],"fullText":"Durham Research Online\nDeposited in DRO:\n20 September 2010\nVersion of attached file:\nPublished Version\nPeer-review status of attached file:\nPeer-reviewed\nCitation for published item:\nRefson, K. and Tulip, P. R. and Clark, S. J. (2006) \u2019Variational density-functional perturbation theory for\ndielectrics and lattice dynamics.\u2019, Physical review B., 73 (4-8). p. 155114.\nFurther information on publisher\u2019s website:\nhttp:\/\/dx.doi.org\/10.1103\/PhysRevB.73.155114\nPublisher\u2019s copyright statement:\n2006 by The American Physical Society. All rights reserved.\nAdditional information:\nUse policy\nThe full-text may be used and\/or reproduced, and given to third parties in any format or medium, without prior permission or charge, for\npersonal research or study, educational, or not-for-profit purposes provided that:\n\u2022 a full bibliographic reference is made to the original source\n\u2022 a link is made to the metadata record in DRO\n\u2022 the full-text is not changed in any way\nThe full-text must not be sold in any format or medium without the formal permission of the copyright holders.\nPlease consult the full DRO policy for further details.\nDurham University Library, Stockton Road, Durham DH1 3LY, United Kingdom\nTel : +44 (0)191 334 3042 \u2014 Fax : +44 (0)191 334 2971\nhttp:\/\/dro.dur.ac.uk\nVariational density-functional perturbation theory for dielectrics and lattice dynamics\nKeith Refson*\nRutherford Appleton Laboratory, Chilton, Didcot, Oxfordshire OX11 0QX, United Kingdom\nPaul R. Tulip\u2020 and Stewart J. Clark\u2021\nDepartment of Physics, The University of Durham, Science Laboratories, South Road, Durham DH1 3LE, United Kingdom\n\u0001Received 4 October 2005; revised manuscript received 2 December 2005; published 19 April 2006\u0002\nThe application of variational density functional perturbation theory \u0001DFPT\u0002 to lattice dynamics and dielec-\ntric properties is discussed within the plane-wave pseudopotential formalism. We derive a method to calculate\nthe linear response of the exchange-correlation potential in the GGA at arbitrary wavevector. We introduce an\nefficient self-consistent solver based on all-bands conjugate-gradient minimization of the second order energy,\nand compare the performance of preconditioning schemes. Lattice-dynamical and electronic structure conse-\nquences of space-group symmetry are described, particularly their use in reducing the computational effort\nrequired. We discuss the implementation in the CASTEP DFT modeling code, and how DFPT calculations may\nbe efficiently performed on parallel computers. We present results on the lattice dynamics and dielectric\nproperties of \u0001-quartz, the hydrogen bonded crystal NaHF2 and the liquid-crystal-forming molecule 5CB.\nExcellent agreement is found between theory and experiment within the GGA.\nDOI: 10.1103\/PhysRevB.73.155114 PACS number\u0001s\u0002: 71.10.\u0002w, 63.20.\u0002e\nI. INTRODUCTION\nDensity-functional theory1,2 \u0001DFT\u0002 has become the most\ncommonly used methodology of calculating accurately the\nphysical properties of a vast range of materials. Density-\nfunctional perturbation theory3,4 \u0001DFPT\u0002 extends the scope\nof the DFT Hamiltonian to allow the ab initio calculation of\nlattice dynamics and response to external electromagnetic\nfields. First-order DFPT yields the linear response of the\nKohn-Sham orbitals with respect to the external perturbation\nand the second-order response of the energy by virtue of the\nso-called \u201c2n+1 theorem.\u201d5\nMany experimentally determined quantities are \u0001often\nsecond-order\u0002 responses of the total energy of the system\nwith respect to some perturbation. For example, derivatives\nof energy with respect to atomic position give vibrational\nfrequencies, derivatives with respect to applied electric field\ngive molecular polarizability or dielectric permittivities, and\nmagnetic fields lead to nuclear magnetic resonance chemical\nshifts and magnetic susceptibilities. It is sometimes possible\nto calculate a response using a finite-difference approach to\nobtain the necessary derivatives. However this method fails\nwhen trying to compute the response to an incommensurate\nphonon wave vector or a finite electric field in a periodic\nsolid. Obtaining these responses motivated the developments\nin DFPT which is able to treat an incommensurate perturba-\ntion using only a primitive-cell calculation and the response\nto an infinitesimal electric field. Combined, these perturba-\ntions contain all of the physics necessary for a complete ab\ninitio treatment of lattice dynamics in the harmonic approxi-\nmation including the effect of long-range electric fields\nwhich couple with longitudinal phonon modes giving rise to\nthe well-known phenomenon of LO-TO splitting.\nSignificant advances in the formalism of DFPT were\nmade by Baroni and co-workers3,4 and Gonze.5\u20137 The devel-\nopments introduced in those seminal papers showed that\nthese responses, leading to important physical quantities, can\nbe calculated as accurately as the DFT ground-state proper-\nties which have become so familiar in recent years. Notable\nexamples include the calculation of macroscopic dielectric\nconstants in semiconductors such as silicon,8 phonon\nspectra,4 Raman scattering,9 and nuclear magnetic resonance\nchemical shift tensors.10,11\nThe variational formulation of DFPT due to Gonze5 is\nparticularly elegant. It is based upon the 2n+1 theorem\nwhich states that the \u00012n+1\u0002th-order response of the energy\nmay be calculated using only the nth-order response of the\nKohn-Sham orbitals. It can be deduced that even-order de-\nrivatives obey a stationary principle, or for diagonal terms a\nminimum principle. This allows the method to be formulated\nas a problem of minimization with respect to the basis-set\ncoefficients which may be solved using efficient algorithms\nsuch as conjugate gradients. The variational formalism has\nthe inherent advantage that it is intrinsically self-consistent\nand does not require a separate self-consistency cycle. Fur-\nther, the computational cost is comparable to that of a single-\npoint energy self-consistent calculation, although there are\nfurther implications when symmetry is considered.\nWe have implemented DFPT for lattice dynamics and\nelectric field responses using the plane-wave pseudopotential\nformalism within the CASTEP code.12,13 In this paper we will\ndescribe developments of the theory and implementation of\nDFPT. In particular we give the formalism to compute the\nfirst-order exchange-correlation potential in the generalized\ngradient approximation \u0001GGA\u0002 for incommensurate pertur-\nbations in a fast Fourier transform\u2013\u0001FFT\u0002 grid consistent\nmanner. We present an efficient all-bands preconditioned\nconjugate-gradient solver for the self-consistent variational\nminimization of the second-order energy. We discuss the use\nof space group symmetry to optimize the number of self-\nconsistent calculations needed to obtain the full dynamical\nmatrix of lattice dynamics and the implementation on a mas-\nsively parallel supercomputer. Finally we will present some\nresults of DFPT applied to lattice dynamical and dielectric\nPHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n1098-0121\/2006\/73\u000115\u0002\/155114\u000112\u0002\/$23.00 \u00a92006 The American Physical Society155114-1\nproblems. We also benchmark against previous calculations\n\u0001where results are available\u0002 to demonstrate the consistency\nof our implementation and methods.\nII. FUNDAMENTALS\nThe theory of DFPT is discussed in detail in the review by\nBaroni et al.4 Our implementation is based on the variational\nscheme of Gonze6,7 and we use the same notation. The\nground-state energy of the system is expanded in a perturba-\ntion series in the parameter \u0003 which, for example, could be\nan atomic perturbation described by some wave vector q, or\nan external field\nE = \u00030E\u00010\u0002 + \u00031E\u00011\u0002 + \u00032E\u00012\u0002 + \u00af , \u00011\u0002\nand similarly, so are the Kohn-Sham orbitals,\n\u0004k\ni\n= \u00030\u0004i,k\n\u00010\u0002 + \u00031\u0004i,k\n\u00011\u0002 + \u00032\u0004i,k\n\u00012\u0002 + \u00af , \u00012\u0002\nand likewise for the density.\nThe diagonal elements of the dynamical matrix of lattice\ndynamics are given by E\nel,\u2212q,q\n\u00012\u0002\nwhich is the second-order en-\nergy given by an atomic perturbation described by an arbi-\ntrary wave vector q. Our variational expression for this is\nmodified from that given by Gonze and Lee6 in order to\ndescribe a first-order exchange-correlation \u0001XC\u0002 potential\nwhen the functional depends on the gradient of the density in\nthe GGA; namely,\nEel,\u2212q,q\n\u00012\u0002 \u0003u\u00010\u0002;u\u00011\u0002\u0004 =\n\u00050\n\u00012\u0006\u00023\u0005BZ \u0006m\nocc\ns\u0007\bumk,q\n\u00011\u0002 \tHk+q,k+q\n\u00010\u0002\n\u2212 \u0007mk\n\u00010\u0002\tumk,q\n\u00011\u0002 \n + \bumk,q\n\u00011\u0002 \tvsep,k+q,k\n\u00011\u0002 \tumk\n\u00010\u0002\n\n+ \bumk\n\u00010\u0002\tvsep,k,k+q\n\u00011\u0002 \tumk,q\n\u00011\u0002 \n + \bumk\n\u00010\u0002\tvsep,k,k\n\u00012\u0002 \tumk\n\u00010\u0002\n\u000bdk\n+\n1\n2\u0005\u00050 \u0003\u0007n\u00afq\u00011\u0002\u0001r\u0002\u000b*\u0007v\u00af loc,q\u00011\u0002 \u0001r\u0002 + v\u00afXC0,q\u00011\u0002 \u0001r\u0002\u000b + \u0007n\u00afq\u00011\u0002\u0001r\u0002\u000b\u0007v\u00af loc,q\u00011\u0002 \u0001r\u0002 + v\u00afXC0,q\u00011\u0002 \u0001r\u0002\u000b*\u0004dr\n+\n1\n2\u0005\u00050 \u0007v\u00afXC,q\u00011\u0002 \u0001r\u0002 + v\u00afH,q\u00011\u0002 \u0001r\u0002\u000b*n\u00afq\u00011\u0002\u0001r\u0002dr + \u0005\u00050 n\u00010\u0002\u0001r\u0002v\u00af loc\u00012\u0002\u0001r\u0002dr +\n1\n2\n\fd2EH XC\nd\u0003 d\u0003*\n\f\nn\u00010\u0002\n, \u00013\u0002\nwhere the symbols are defined in Ref. 6. A numeric super-\nscript \u0001n\u0002 denotes the nth-order response of the correspond-\ning ground-state quantity. Alternatively superscripts \b\u0001 and\n\t\n,\u0001 denote first-order electric field and atomic displacement\nperturbed quantities of Cartesian direction \u0001 and atom num-\nber \n. The overbar in the first-order charge densities and\npotentials denotes that each is a complex, phase-factorized\ncell-periodic quantity which may be stored on the usual FFT\ngrid for the primitive cell. The first-order charge density is\ngiven by the expression\nn\u00af\u00011\u0002\u0001r\u0002 =\n2\n\u00012\u0006\u00023\u0005BZ \u0006m\nocc\nsumk\n\u00010\u0002*\u0001r\u0002umk,q\n\u00011\u0002 \u0001r\u0002dk . \u00014\u0002\nEquation \u00013\u0002 is valid in the case of GGA XC functionals,\nwhich Eq. \u000115\u0002 of Ref. 7 is not. E\nel,\u2212q,q\n\u00012\u0002 \u0003u\u00010\u0002 ;u\u00011\u0002\u0004 is mini-\nmized with respect to the first-order response orbitals under\nthe orthogonality constraint\n\bumk+q\n\u00010\u0002 \tunk,q\n\u00011\u0002 \n = 0 \u00015\u0002\nin the parallel transport gauge.\nIn our implementation, we use a real-space integration to\nevaluate the Hartree contribution. Though this might appear\nless efficient than the reciprocal-space sum of Ref. 7 the\nenergy is most efficiently computed by summing all the first-\norder potentials\nv\u00af tot,q\n\u00011\u0002 \u0001r\u0002 = v\u00afXC,q\n\u00011\u0002 \u0001r\u0002 + v\u00afH,q\n\u00011\u0002 \u0001r\u0002 + v\u00af loc,q\n\u00011\u0002 \u0001r\u0002 \u00016\u0002\nwhereupon only a single integral of a first-order local poten-\ntial multiplied by a density is required in the evaluation of\nEq. \u00013\u0002.\nA similar modification yields the expression for the\nsecond-order energy with respect to electric field perturba-\ntions also valid for GGA functionals,\nEel\n\b\u0001\n*\n\b\u0001\u0007u\u00010\u0002;u\b\u0001\u000b =\n\u00050\n\u00012\u0006\u00023\u0005BZ \u0006m\nocc\ns\u0007\bumk\n\b\u0001 \tHk,k\n\u00010\u0002\n\u2212 \u0007mk\n\u00010\u0002\tumk\n\b\u0001 \n\n+ \bumk\n\b\u0001 \tiumk\nk\u0001 \n + \biumk\nk\u0001 \tumk\n\b\u0001 \n\u000bdk\n+\n1\n2\u0005\u00050 \u0007vXC\b\u0001 \u0001r\u0002 + vH,q\b\u0001 \u0001r\u0002\u000b*n\b\u0001\u0001r\u0002dr . \u00017\u0002\nEvaluation of the second-order energies due to either an\natomic position or electric field perturbation is the first step\nin obtaining phonon frequencies or bulk polarizabilities.\nThese expressions give the diagonal terms of a dynamical\nmatrix or polarizability tensor. Though the nonvariational ex-\npressions for off-diagonal terms are simple in principle, in\npractice the different symmetries of the perturbations and\nconsequently different irreducible wedges complicates the\nBrillouin-zone integration. This will be discussed in Sec. VI.\nREFSON, TULIP, AND CLARK PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-2\nThe mixing of two perturbations is not constrained to two\nperturbations of the same type. For example the Born effec-\ntive charges may be obtained by a mixed atomic displace-\nment and electric field perturbation.\nIII. FIRST-ORDER XC POTENTIAL IN THE GGA\nThe treatment of the exchange-correlation term is rela-\ntively straightforward in the case of the local density ap-\nproximation \u0001LDA\u0002, but more complicated for the GGAs.\nHere we describe a general method for incorporating a GGA\nwithin the linear response formalism.\nEquations \u00013\u0002 and \u00017\u0002 and their corresponding gradients\nrequire the evaluation of the first-order exchange-correlation\npotential,\nv\u00afXC,q\n\u00011\u0002 \u0001r\u0002 =\u0005\f \u000b2\bXC\n\u000bn\u0001r\u0002\u000bn\u0001r\u0001\u0002\n\f\nn\u00010\u0002\u0001r\u0002\ne\u2212iq\u00b7\u0001r\u2212r\u0001\u0002n\u00afq\n\u00011\u0002\u0001r\u0001\u0002dr\u0001, \u00018\u0002\nwhere the quantities with overbars are, as usual, phase fac-\ntorized and cell periodic. In the case of the LDA this simpli-\nfies to\nv\u00afXC;LDA\n\u00011\u0002 \u0001r\u0002 =\fdvXCdn \fn\u00010\u0002\u0001r\u0002n\u00afq\u00011\u0002\u0001r\u0002 ,\nwhere the derivative is straightforward to evaluate analyti-\ncally. However, the second functional derivative of GGA\nfunctionals is nondiagonal and the integral in Eq. \u00018\u0002 does\nnot disappear. Putrino et al.10 pointed out that evaluating the\nsecond functional derivative was both analytically cumber-\nsome and numerically unstable. They suggested that vXC\n\u00011\u0002\ncould be calculated using a finite-difference derivative of the\nXC potential, but that method is not applicable to incommen-\nsurate perturbations where vXC\n\u00011\u0002 is not simply the derivative of\nvXC with respect to the perturbation.\nFavot and Dal Corso14 presented a formula where vXC\n\u00011\u0002 is\ngiven not as the analytical functional derivative of the GGA\nformula but as a FFT grid-consistent derivative at finite cut-\noff. However, they did not show how to treat incommensu-\nrate perturbations. A very similar formula was presented by\nEgli and Billeter.15\nOur method for calculating v\u00afXC,q\n\u00011\u0002 \u0001r\u0002 begins from the work\nof White and Bird16 who noted that the true analytic\nexchange-correlation potential has Fourier components of\ntoo high spatial frequency to be representable on the usual\nFFT grid of a plane-wave basis set. They introduced an ap-\nproximate XC potential defined only on grid points R,\nvXC\u0001R\u0002 =\n\u0001fXC\n\u0001n\u0001R\u0002\n+ \u0006\nR\u0001\n\u0001fXC\n\u0001 \u0002 n\u0001R\u0001\u0002\n\u00b7\nd \u0002 n\u0001R\u0001\u0002\ndn\u0001R\u0002\n\u00019\u0002\nwhere fXC\u0001n ,\u0002n\u0002 is the particular GGA kernel. For nota-\ntional convenience we define\nfnn =\n\u00012fXC\n\u0001n\u0001R\u0002\u0001n\u0001R\u0002\n, fng =\n\u00012fXC\n\u0001n\u0001R\u0002\u0001 \u0002 n\u0001R\u0002\n,\nfgn =\n\u00012fXC\n\u0001 \u0002 n\u0001R\u0002\u0001n\u0001R\u0002\n, fgg =\n\u00012fXC\n\u0001 \u0002 n\u0001R\u0002\u0001 \u0002 n\u0001R\u0002\n, \u000110\u0002\nand corresponding quantities fnn\u0001 , fng\u0001 , fgn\u0001 , and fgg\u0001 which are\nevaluated at R\u0001 instead of R.\nTaking a variation of Eq. \u00019\u0002 with respect to n\u0001R\u0002 and\n\u0002n\u0001R\u0002, treating them as independent variables, and noting\nthat \u000b\u0002n\u0001R\u0002=\u0002\u000bn\u0001R\u0002 for a periodic density n\u0001R\u0002 yields\n\u000bvXC = fnn\u000bn\u0001R\u0002 + fgn \u00b7 \u000b \u0002 n\u0001R\u0002 + \u0006\nR\u0001\n\r fng\u0001 \u00b7 d \u0002 n\u0001R\u0001\u0002dn\u0001R\u0002 \u000bn\u0001R\u0001\u0002 + fgg\u0001 \u00b7 d \u0002 n\u0001R\u0001\u0002dn\u0001R\u0002 \u00b7 \u000b \u0002 n\u0001R\u0001\u0002\u000e\n= fnn\u000bn\u0001R\u0002 + fgn \u00b7 \u000b \u0002 n\u0001R\u0002 \u2212\n1\nN\u0006R\u0001\n\u0006\nG\niGeiG\u0001R\u2212R\u0001\u0002\u0007fng\u0001 \u000bn\u0001R\u0001\u0002 + fgg\u0001 \u000b \u0002 n\u0001R\u0001\u0002\u000b\n= fnn\u000bn\u0001R\u0002 + fgn \u00b7 \u000b \u0002 n\u0001R\u0002 \u2212 \u0002 \u00b7 \u0007fng\u0001 \u000bn\u0001R\u0002 + fgg\u0001 \u00b7 \u000b \u0002 n\u0001R\u0002\u000b , \u000111\u0002\nwhere both steps use the identity that on the periodic grid\n\u0002n\u0001R\u0002 =\n1\nN\u0006G \u0006R\u0001\niGn\u0001R\u0001\u0002eiG\u00b7\u0001R\u0001\u2212R\u0002. \u000112\u0002\nWe identify \u000bn\u0001R\u0002 above with n\u00011\u0002\u0001r\u0002 in the DFPT formal-\nism and \u000bvXC with v\u00011\u0002\u0001r\u0002, which are incommensurate with\nthe primitive cell. To represent densities and potentials on the\nperiodic FFT grid we work with the complex, periodic \u0001i.e.,\nBloch-function-like\u0002 quantities n\u00af\u00011\u0002\u0001R\u0002 and v\u00af \u00011\u0002\u0001R\u0002 given by,\nn\u00011\u0002\u0001R\u0002 = exp\u0001iq \u00b7 R\u0002n\u00af\u00011\u0002\u0001R\u0002 . \u000113\u0002\nApplying the chain rule to Eq. \u000113\u0002 gives\n\u0002n\u00011\u0002\u0001R\u0002 = exp\u0001iq \u00b7 R\u0002\u0007iqn\u00af\u00011\u0002\u0001R\u0002 + \u0002n\u00af\u00011\u0002\u0001R\u0002\u000b . \u000114\u0002\nSubstituting Eqs. \u000113\u0002 and \u000114\u0002 into Eq. \u000111\u0002 and expanding\nthe contents of the square brackets gives\nv\u00011\u0002\u0001R\u0002 = exp\u0001iq \u00b7 R\u0002\u0007fnnn\u00af\u00011\u0002\u0001R\u0002 + iq \u00b7 fgnn\u00af\u00011\u0002\u0001R\u0002\n+ fgn \u00b7 \u0002n\u00af\u00011\u0002\u0001R\u0002\u000b \u2212 exp\u0001iq \u00b7 R\u0002\n\f\u0001iq + \u0002\u0002 \u00b7 \u0007fngn\u00af\u00011\u0002\u0001R\u0002 + iqfggn\u00af\u00011\u0002\u0001R\u0002\n+ fgg \u0002 n\u00af\u00011\u0002\u0001R\u0002\u000b . \u000115\u0002\nVARIATIONAL DENSITY-FUNCTIONAL PERTURBATION\u00bc PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-3\nDefining v\u00af \u00011\u0002\u0001R\u0002 by v\u00011\u0002\u0001R\u0002=exp\u0001iq \u00b7R\u0002v\u00af \u00011\u0002\u0001R\u0002 the incom-\nmensurate phase factor is eliminated to yield\nv\u00af \u00011\u0002\u0001R\u0002 = \u0007fnnn\u00af\u00011\u0002\u0001R\u0002 + fgn \u00b7 \u0001iq + \u0002\u0002n\u00af\u00011\u0002\u0001R\u0002\u000b\n\u2212 \u0001iq + \u0002\u0002 \u00b7 \u0007fngn\u00af\u00011\u0002\u0001R\u0002 + fgg \u00b7 \u0001iq + \u0002\u0002n\u00af\u00011\u0002\u0001R\u0002\u000b ,\n\u000116\u0002\nwhere all density and potential terms are cell periodic, com-\nmensurate, complex quantities, which have a straightforward\nrepresentation on the computational FFT grid.\nThe desired XC potential v\u00af \u00011\u0002\u0001R\u0002 may be evaluated on the\nFFT grid by first computing \u0002n\u00af\u00011\u0002\u0001R\u0002 \u0001four FFTs\u0002 and then\napplying Eq. \u000116\u0002 \u0001another four FFTs\u0002. Equation \u000110\u0002 require\nthe derivatives of the GGA kernel fXC\u0001n , \t\u0002n\u0001R\u0002\t\u0002 with re-\nspect to \u0002n\u0001R\u0002. These are re-expressed as\nfgn =\n\u0002n\u0001R\u0002\n\t\u0002n\u0001R\u0002\t\n\u0001fXC\n\u0001\t\u0002n\u0001R\u0002\t\u0001n\u0001R\u0002\n, \u000117\u0002\nfgg = \r 1\t\u0002n\u0001R\u0002\t \u2212 \u0002n\u0001R\u0002 \u0002 n\u0001R\u0002\t\u0002n\u0001R\u0002\t3 \u000e \u0001fXC\u0001\t\u0002n\u0001R\u0002\t\n+\n\u0002n\u0001R\u0002 \u0002 n\u0001R\u0002\n\t\u0002n\u0001R\u0002\t2\n\u0001fXC\n\u0001\t\u0002n\u0001R\u0002\t\u0001\t\u0002n\u0001R\u0002\t\n, \u000118\u0002\nwhere the last expression is interpreted as a tensor dyad\nproduct. The derivatives of fXC on the right-hand side of the\nabove expressions are easily evaluated either analytically15\nor numerically. We use a central-difference numerical differ-\nentiation of the chosen GGA kernel. Thus we can evaluate\nthe first-order XC potential at an incommensurate wave vec-\ntor while representing all quantities as Bloch-factorized, pe-\nriodic functions which can be mapped onto the computa-\ntional FFT grid.\nIV. COMPUTATIONAL METHODS\nA. All-bands conjugate-gradient solver\nThe central problem is to find a set of first-order orbitals\nwhich minimize the second-order energies of Eqs. \u00013\u0002 and \u00017\u0002\nsubject to the orthogonality condition. The prerequisite is a\nset of zeroth-order orbitals u\nmk\n\u00010\u0002\nand u\nmk+q\n\u00010\u0002\n. For an incommen-\nsurate perturbation with wave vector q the zeroth-order or-\nbitals at k+q are required. The approach of Gonze6,7 is to\nmake use of the orbitals computed during the ground-state\nself-consistent procedure which are available on the\nMonkhorst-Pack grid. This limits the choice of phonon wave\nvector q to the difference between any pair of the\nMonkhorst-Pack k points. We use a more general approach\nwhich is to compute a set of u\nmk+q\n\u00010\u0002\nusing a non-self-\nconsistent band structure calculation in the self-consistent\nKohn-Sham potential of the ground state. With this ap-\nproach, any q vector is allowed. Further to this, we make use\nof the point group symmetry of the orbitals to reduce the\ncomputational cost which we describe in detail, below.\nWe obtain the first-order orbitals using a preconditioned\nconjugate-gradient minimizer. Our method varies the coeffi-\ncients of all bands simultaneously using a method similar to\na ground-state search.17 This method uses more memory than\na band-by-band approach to store the gradients; however, the\ncomputational time is considerably lower because only one\nevaluation of the first-order density and potentials is required\nper conjugate-gradient cycle. Construction of the first-order\ndensity is an expensive operation involving many applica-\ntions of a fast Fourier transform. In a band-by-band approach\nthe computation of the first-order density may be optimized\nby incremental updates for each band but the nonlinear first-\norder XC potential cannot.\nWe obtain a total gradient vector from Eq. \u00013\u0002 of the form\n\rm,k\ni\n= \u2212 Pc\u0007\u0001H\u00010\u0002 \u2212 \u0007m,k\u0002\tumk\n\u00011\u0002\n + H\u00011\u0002\tumk\n\u00010\u0002\n\u000b , \u000119\u0002\nwhere H\u00011\u0002 is the total self-consistent first-order perturbation\nHamiltonian, Pc is the projection orthogonal to the occupied\nstates, and i is an iteration count. This is a vector in the\nproduct space of basis-set coefficients \u0001G vector\u0002, bands m,\nand k points in the irreducible BZ. The preconditioning ma-\ntrix multiplies this total gradient\n\u000ei = PcK\ri \u000120\u0002\nand the conjugate direction is formed as\n\u000fm,k\ni\n= \u000em,k\ni + \u0010i\u000fm,k\ni\u22121\n, \u000121\u0002\nwhere \u0010i is given by the Fletcher-Reeves formula18\n\u0010i =\n\u0006\nm,k\n\b\u000em,k\ni \t\u000fm,k\ni \n\n\u0006\nm,k\n\b\u000em,k\ni\u22121 \t\u000fm,k\ni\u22121 \n\n. \u000122\u0002\nThe second-order energy is minimized along this direction\nusing a quadratic line minimizer. The step size is determined\nusing the initial gradient and value of the energy and a sec-\nond evaluation of the energy at a trial point. A full line search\nis unnecessary because Eq. \u00013\u0002 is a quadratic form in the\npresence of the orthogonality constraints. To obtain an accu-\nrate location of the quadratic minimum in a single step re-\nquires that the trial step is of similar numerical magnitude to\nthe final step. Our method chooses an initial guess for the\ntrial step based on the previous iteration and scales it if nec-\nessary.\nWithin the spirit of this all-bands approach, we precom-\npute and store the nonlocal terms\nvsep,k+q,k\n\u00011\u0002 \tumk\n\u00010\u0002\n \u000123\u0002\noutside the iterative procedure, thus further increasing the\nspeed of the minimizer. We find that storage of this quantity\nsaves approximately 20% of the CPU time.\nWe investigated a number of different preconditioning al-\ngorithms: that of Teter et al.19 \u0001TPA\u0002, the modification due to\nKresse and Furthm\u00fcller20 \u0001RTPA\u0002, and one due to Putrino et\nal.10 \u0001PSP\u0002 that was specifically designed for use in DFPT\napplications.\nAn example of the convergence rate of the second-order\nenergy for an atomic position perturbation minimized with\nthese preconditioners is shown in Fig. 1. First, by comparing\nFigs. 1\u0001a\u0002 and 1\u0001b\u0002, it can be seen that a conjugate-gradient\nalgorithm converges approximately twice as fast as a simpler\nREFSON, TULIP, AND CLARK PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-4\nsteepest-descent method. An iteration is defined as a minimi-\nzation in a single search direction so that each iteration takes\na comparable amount of time. In both cases the TPA and\nRTPA preconditioners converge the second-order energy at\napproximately the same rate. The best performing precondi-\ntioner was the original TPA variant, despite being intended\nfor a ground-state DFT search, and the PSP preconditioner\nshowed the worst performance despite being specifically de-\nsigned for DFPT calculations. However, the differences be-\ntween each are relatively small. Though inclusion of a pre-\nconditioner is obviously advantageous, the choice of which\nvariant should be a secondary consideration after use of con-\njugate gradients versus steepest descents.\nV. DYNAMICAL MATRIX SYMMETRY\nThe central task in any lattice dynamics calculation is the\nconstruction of the dynamical matrix. In the absence of sym-\nmetry \u0001other than the Hermitian character of the dynamical\nmatrix\u0002 this requires 3N perturbations and variational mini-\nmization using Eq. \u00013\u0002 and \u00019N2\u22123N\u0002 \/2 mixed perturbation\ncalculations if there are N atoms in the unit cell. This number\nmay be reduced by a large factor by exploiting the symmetry\nequivalence between elements of the dynamical matrix con-\nsequent on the space group symmetry of the crystal and the\nphonon wave vector q. For example, in the diamond struc-\nture containing two identical atoms per cell, only one varia-\ntional minimization is needed instead of 6 at q=0.\nThe theory of the application of symmetry to lattice dy-\nnamics was set out by Maradudin and Vosko21 and Warren22\nusing the irreducible multiplier representations of the space\ngroup. The dynamical matrix D\u0001\u0001\u0001\n\n\n\u0001\u0001q\u0002 is a 3N\f3N matrix\nwhere the indices \n and \n\u0001 refer to atoms and \u0001 and \u0001\u0001 refer\nto Cartesian directions and q is the phonon wave vector.\nThey showed that if q is invariant under the operation of a\nspace group symmetry operation \u0003S \tvS\u0004 with rotation matrix\nS and translation vector vS then the dynamical matrix trans-\nforms as\nD\u0001\u0001\u0001\n\n\n\u0001\u0001q\u0002 = T\u22121\u0001q;S\u0002D\u0001\u0001\u0001\n\n\n\u0001\u0001q\u0002T\u0001q;S\u0002 , \u000124\u0002\nwhere\nT\u0001q;S\u0002 = S\u0001\u0011\u000b\u201e\n,F0\u0001\n\u0001;S\u0002\u2026exp\u0007iq \u00b7 \u0001x\n \u2212 Sx\n\u0001\u0002\u000b \u000125\u0002\nis a matrix from the irreducible multiplier representation of\nthe group of q. Here F0\u0001\n\u0001 ;S\u0002 is the index of the atom re-\nlated to atom \n\u0001 by the symmetry operation \u0003S \tvS\u0004, x\n is the\ncoordinates of atom \n, and \u000b is the usual Kronecker delta\nsymbol. If one of the space group operations carries q\u2192\u2212q\n\u0001including but not limited to the case of an inversion\u0002 then\nthe time-reversal symmetry gives rise to additional invari-\nances \u0001detailed in Ref. 21\u0002.\nFrom a computational perspective the problem is to deter-\nmine a minimal subset of the elements of D\u0001\u0001\u0001\n\n\n\u0001\u0001q\u0002 and the\nrelationships between elements needed to construct the com-\nplete matrix. Our approach is similar to that of Worlton and\nWarren.23 A matrix Drand of the same dimensions as D\u0001\u0001\u0001\n\n\n\u0001\u0001q\u0002\nis constructed to be maximally random while satisfying all of\nthe invariances of the form of Eq. \u000124\u0002 and also Hermitian.\nThis is accomplished by the following algorithm. A Hermit-\nian matrix Drand\ninit is constructed using a pseudo-random-\nnumber generator, and Drand is generated by the formula\nDrand = \u0006\nj=1\ng\u0001q\u0002\nT\u22121\u0001q;S\u0002Drandinit T\u0001q;S\u0002 \u000126\u0002\nfrom which it is straightforward to demonstrate23 that Drand\nsatisfies Eq. \u000124\u0002 for all operations in the space group. A very\nsimilar procedure is subsequently applied to make Drand also\nsatisfy the time-reversal invariances.\nThe Drand generated by this procedure thus satisfies all of\nthe symmetries of the crystal but is otherwise random. The\ndesired relationships among elements of D\u0001\u0001\u0001\n\n\n\u0001\u0001q\u0002 are deter-\nmined from an analysis of those of Drand. These may take the\nform of elements equal to zero, elements that are equal in\nmagnitude and complex phase, elements that are equal in\nmagnitude but of opposite phase, and elements that are equal\nin magnitude but rotated or counter-rotated in phase. These\nconditions are satisfied to a high degree of numerical preci-\nFIG. 1. \u0001Color online\u0002 \u0001a\u0002 The second-order energy as a function\nof iteration number \u0001scaled to show equivalent computational ef-\nfort\u0002 for the steepest-decent \u0001SD\u0002 and conjugate-gradient \u0001CG\u0002\nmethods. \u0001b\u0002 The effect of various preconditioning schemes for both\nCD and SD methods. Note the change in the x axis from \u0001a\u0002.\nVARIATIONAL DENSITY-FUNCTIONAL PERTURBATION\u00bc PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-5\nsion and are easily identifiable from the values of Drand. To\nbe sure that a value of zero is not produced accidentally, the\ninitial random elements of Drand\ninit are biased away from zero.\nA further consequence of the symmetry is to fix the\nphases of some elements of the dynamical matrix, to either\nan absolute or a q-dependent value. Our analysis goes further\nthan that of Worlton and Warren23 in detecting symmetry-\ndetermined phases and relative phases of elements. This is\nachieved by repeating the analysis with a new initial Drand\ninit\ngenerated using an independent sequence of pseudo-random-\nnumbers. Those phases and phase relationships that are in\ncommon are marked as being symmetry determined.\nIn addition to the symmetry relationships so far discussed,\nit is possible in some structures with hexagonal and trigonal\nspace groups for linear relationships to exist among three or\nmore elements. The linear symmetry analysis is unable to\ndetect these relationships, and in such cases more than the\nirreducible minimum of variational DFPT calculations will\nbe performed.\nDuring the calculation of D\u0001\u0001\u0001\n\n\n\u0001\u0001q\u0002 the symmetry informa-\ntion is used as follows. Elements that are zero by symmetry\nare not calculated. On every calculation of a dynamical ma-\ntrix element of a given a value, all elements which have\nequal magnitude by symmetry are also set to the same value.\nThe symmetry-determined phase information is used to set\nthe phases of the related elements. After an element has been\nassigned to, it is marked as \u201calready computed\u201d and subse-\nquent iterations of the atom or direction loops omit any cal-\nculations if this flag is set for a particular element.\nA very similar analysis is performed to establish the sym-\nmetries of the set of Born effective charge tensors. These\nresemble those of the leading 3\f3 block diagonal of the\ndynamical matrix with the difference that there is no require-\nment for matrix symmetry.\nFinally the symmetry of the dielectric permittivity \u0001and\npolarizability\u0002 is that of a symmetric tensor. A simplified ver-\nsion of the algorithm used for the dynamical matrix is used\nto avoid unnecessary recomputation.\nVI. SYMMETRY AND BRILLOUIN-ZONE SAMPLING\nSpace group symmetry also plays an important role in the\nsampling of the electronic BZ for sums such as those in Eq.\n\u00013\u0002 and the first-order electron density nq\n\u00011\u0002\u0001r\u0002 constructed ac-\ncording to\nnq\n\u00011\u0002\u0001r\u0002 = \u0006\nS=1\nNS\nS\u0006\nk=1\nNk\nwk\u0006\nm\nocc\numk\n\u00010\u0002*\u0001r\u0002umk\n\u00011\u0002\u0001r\u0002 , \u000127\u0002\nwhere NS is the number of symmetry operations, Nk is the\nnumber of k points in the irreducible set, wk is weight ap-\nplied to k and m indexes the occupied bands. The set of k\npoints is usually derived from a Monkhorst-Pack grid24 and\nfolded to a symmetry irreducible set under the operations of\nthe group \u0003S\u0004, the subgroup of the space group under which\nthe perturbation is invariant. In the case of an atomic dis-\nplacement perturbation this is the group of q and \u0001, which is\nsmaller than the full space group. The irreducible set of k\npoints \u0003k\u0004 and weights \u0003wk\u0004 is in general larger than for the\nself-consistent-field calculation. In particular expression \u00013\u0002\nin not invariant under time-reversal symmetry and the set\nmust include both k and \u2212k unless 2q is zero or a reciprocal\nlattice vector.\nAs mentioned in Sec. IV A, the \u0003u\nmk\n\u00010\u0002\u0004 are constructed us-\ning a non-self-consistent \u201cband structure\u201d calculation using\nthe self-consistent ground-state density and potential. It is\npossible to economize on the number of these calculations by\nusing the symmetry relations among the set which arise be-\ncause of the higher symmetry of the unperturbed space\ngroup. In reciprocal space the wave function coefficients\ntransform under \u0003S \tvS\u0004 as\ncmSk\u0001SG\u0002 = exp\u0007\u2212 2\u0006iS \u00b7 \u0001k + G\u0002 \u00b7 vS\u000bcmk\u0001G\u0002 . \u000128\u0002\nThis is straightforward to implement if the FFT grid is\nmapped onto a three-dimensional array as it is in the serial or\nk point parallel case. When the grid is distributed across\nprocessors for G-vector parallelism, then interprocessor com-\nmunication is required since the coefficients on the left and\nright hand sides of Eq. \u000128\u0002 in general reside on different\nprocessors. In that case the grid is reconstructed by gathering\ncoefficients onto the master node, transforming according to\nEq. \u000128\u0002, and scattering to the new locations. This is done\none band at a time to limit the additional storage of a full\ngrid on a single processor.\nWhile the above procedure suffices for terms diagonal in\nthe perturbation, off-diagonal terms in the dynamical matrix\nand dielectric permittivity tensor must be evaluated using a\n\u201cmixed-perturbation\u201d formula such as Eq. \u000116\u0002 or \u000138\u0002 in\nRef. 7. This involves the first-order orbitals with respect to\njust one of the perturbations which have been evaluated on a\nk point set irreducible with respect to its symmetry. The\nother perturbation does not in general have the same symme-\ntry, and so the Brillouin-zone integral cannot be evaluated\nusing the same weighted sum as used to obtain the first-order\norbitals. Using Eq. \u000128\u0002 it is straightforward to show that\nFIG. 2. \u0001Color online\u0002 The phonon dispersion curve for \u0001-quartz\nis shown along several lines of high symmetry. Experimental results\nare shown by solid symbols.\nREFSON, TULIP, AND CLARK PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-6\n\u0006\nk=1\nfull BZ\n\bumk\n\u00010\u0002\tv\t\n\u0011\tumkq\n\t\u0001 \n\n=\n1\nNS\n\u0006\nS=1\nNS\n\u0006\nk=1\nNk\nwk exp\u0001\u2212 2\u0006iq \u00b7 vS\u0002\bumk\n\u00010\u0002\tv\t\n\u0001S\u0011\tumkq\n\t\u0001 \n ,\n\u000129\u0002\nwhere the sum on the right hand side is over the same irre-\nducible set used for the diagonal term and where the umkq\n\t\u0001 are\nalready available. Similar formulas hold for the other terms\nincluding the nonvariational contribution to the dynamical\nmatrix and the off-diagonal terms of the dielectric permittiv-\nity tensor.\nThe different symmetry and set of electronic k points in\nthe irreducible BZ means that some flexibility is required to\noptimize the performance when executing on a massively\nparallel supercomputer. Our implementation is able to dy-\nnamically choose an optimum strategy to distribute both k\npoints and G-vector components of the FFT grid for each\nperturbation. This enables efficient use of very large numbers\nof processors with good load balancing. Alternative schemes\nwhich distribute perturbations or q points among processors\nhave the disadvantage that the computation time varies con-\nsiderably due to the different numbers of k points in the\nirreducible BZ, making good load balancing hard to achieve.\nVII. APPLICATIONS\nA. Introduction\nApplications of DFPT have been presented in abundance\nelsewhere showing that it has become a highly successful\nTABLE I. Zone-center vibrational frequencies of \u0001-quartz \u0001in cm\u22121\u0002 compared with previous calculations\nand experiment. Previous plane-wave \u0001PW\u0002 and all-electron \u0001AE\u0002 results are from Refs. 35 and 36, respec-\ntively. Experimental results are extrapolated to the athermal limit as cited in results.\nMode PW LDAa AE LDAb PW LDAc AE PBEb PW GGAc Expt.d\nA1 238.9 261.6 216.5 220.8 91.7 219.0\n339.3 332.3 331.4 332.0 356.5 358.0\n461.7 482.1 446.6 451.8 432.2 469.0\n1061.2 1089.1 1102.5 1050.3 1116.1 1082.0\nA2 \u0001TO\u0002 341.4 326.3 336.2 326.3 387.5 361.3\n493.4 504.6 474.3 481.6 444.9 499.0\n762.4 791.1 780.2 764.6 783.1 778.0\n1056.5 1086.4 1097.5 1038.5 1103.7 1072.0\nA2 \u0001LO\u0002 365.7 351.3 360.0 350.2 398.8 385.0\n540.5 543.9 523.3 528.9 518.5 553.0\n784.7 816.8 796.1 778.2 784.8 791.0\n1218.3 1249.6 1256.4 1210.4 1274.5 1230.0\nE \u0001TO\u0002 133.3 143.4 125.1 128.8 110.0 133.0\n261.3 263.5 250.5 252.8 264.4 269.0\n377.6 376.9 369.5 372.4 392.2 393.5\n443.8 443.8 426.1 424.0 421.4 452.5\n690.8 721.7 696.1 681.5 679.6 698.0\n791.7 835.0 801.0 797.0 780.9 799.0\n1045.0 1070.3 1087.2 1030.8 1100.1 1066.0\n1128.1 1141.7 1159.8 1117.9 1198.9 1158.0\nE \u0001LO\u0002 133.4 143.7 125.1 128.8 110.1 133.0\n263.2 266.9 252.1 255.4 246.6 269.0\n389.2 389.1 379.2 380.4 395.3 402.0\n498.6 497.2 481.7 479.8 487.1 512.0\n694.5 726.5 699.1 685.2 679.9 701.0\n803.9 844.7 811.6 806.2 792.6 811.5\n1209.5 1234.7 1245.9 1201.4 1266.2 1227.0\n1123.9 1137.3 1156.8 1115.4 1198.4 1155.0\naReference 35.\nbReference 36.\ncThis work.\ndCorrected values from Ref. 35.\nVARIATIONAL DENSITY-FUNCTIONAL PERTURBATION\u00bc PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-7\naddition to the density-functional total-energy toolbox. In\nthis section, we describe a selection of results using the\nCASTEP DFPT code. First we demonstrate some results\nfor \u0001-quartz to show reliability, but also to illustrate the\nmethods described above, such as the directional dependence\nas q\u21920 of the nonanalytic behavior of phonon frequencies.\nSecond we explain the results of some DFPT calculations for\nthe ionic crystal NaHF2 which contains some surprising and\nnonintuitive results, such as an effective charge of +2e for a\nH ion. We also use this example to demonstrate that the\nchoice of XC functional is crucial in determining the dy-\nnamical properties of such a hydrogen-bonded material. Fi-\nnally we demonstrate the application to the polarizability\ntensor of an important molecular system, the prototypical\nliquid-crystal-forming molecule 5CB \u00014-4-pentyl-cyano-\nbiphenyl\u0002. Further applications of CASTEP DFPT may be\nfound in Refs. 25\u201327.\nB. \u0001-quartz\nThe low-temperature \u0001\u0001\u0002 phase of quartz is one of the\nmore complex crystals for which high-quality experimental\ndispersion curves are available. Its dielectric permittivity and\nBorn effective charges are strongly anisotropic giving it a\nrich behavior which has been the subject of an extensive\nliterature. It exhibits structural phase transitions in whose\nmechanism soft modes play an important role.28 It therefore\nmakes an excellent test case for our methods.\nWe have calculated an extensive set of phonon dispersion\ncurves for \u0001-quartz. Our calculations used the Perdew-\nBurke-Ernzerhof \u0001PBE\u0002 variant of the GGA exchange-corre-\nlation functional.29 The pseudopotentials were of the opti-\nmized norm-conserving variety,30,31 generated using the\nLDA, and gave very well-converged results at a cutoff en-\nergy of 600 eV. A 5\f5\f4 Monkhorst-Pack grid was used\nto compute the electronic Brillouin-zone integrals24 giving\nessentially converged results \u0001\tF\t\u00125 meV\/\u00c5 and \t\u0013\t\n\u001216 MPa\u0002. The phonon calculations were carried out at the\nzero-pressure optimized structure with resulting lattice pa-\nrameters of a=4.940 \u00c5 and c=5.413 \u00c5 and the results are\nplotted in Fig. 2 along with experimental results.32,33 The\nagreement with experiment is reasonable, but some of the\nbranches in the center of the frequency range are shifted to\nlower frequencies.\nA detailed comparison of zone-center frequencies using\nboth LDA and GGA with previous results is given in Table I.\nOur LDA results are in good agreement with earlier plane-\nwave calculations and with recent all-electron calculations.\nThe agreement is less good in the case of the PBE functional,\nwhere in particular the lowest A1 mode drops below the E\nmodes. Elsewhere in the spectrum discrepancies of up to\n60 cm\u22121 are present. This calculation is not directly compa-\nrable with all-electron GGA results because the LDA was\nused to generate the pseudopotentials. This approximation\nmakes some error, usually no greater than that due to the XC\nfunctional error, and in particular gives lattice parameters\nand bond lengths intermediate between LDA and consistent\nGGA values.34 However, quartz frequencies are highly sen-\nsitive to crystal geometry \u0001requiring tighter geometry conver-\ngence tolerances than usual to converge the result\u0002 due to the\nlow-frequency rigid unit modes.28 We suspect this to be the\norigin of the unusually large discrepancy observed in quartz.\nA definitive answer to this question will require careful test-\ning of the accuracy with GGA-generated pseudopotentials\nand is beyond the scope of the present work.\nWe have also computed the infrared \u0001ir\u0002 absorption spec-\ntrum of \u0001-quartz, which is shown in Fig. 3. The intensities\nwere computed using a spherical average approximation\nfrom the mode effective charges.\nThe Born effective charges and dielectric permittivity are\ngiven in Tables II and III. We find little significant difference\nin the values of the Born effective charges compared to ei-\nther our or previous LDA calculations.35 However, our GGA\nhigh-frequency permittivities are in excellent agreement with\nexperiment38 in contrast to LDA results which are 10%\nhigher. \u0001We have checked that the pseudopotential error in\nthese permittivities and Born effective charges is around the\nFIG. 3. The calculated ir absorption spectrum for \u0001-quartz is\nshown \u0001solid line\u0002 along with experimental results \u0001dashed line\u0002\n\u0001Ref. 37\u0002.\nTABLE II. The Born effective charge tensors of \u0001-quartz \u0001units\nof electronic charge\u0002.\nAtom GGA LDA\nO \u22121.34 0.55 0.40 \u22121.29 0.46 0.26\n0.57 \u22122.04 \u22120.81 0.51 \u22122.01 \u22120.76\n0.42 \u22120.79 \u22121.74 0.32 \u22120.71 \u22121.72\nSi 3.00 0.00 0.00 2.97 0.00 0.00\n0.00 3.76 0.13 0.00 3.64 0.30\n0.00 \u22120.15 3.48 0.00 \u22120.35 3.43\nTABLE III. Low- and optical-frequency dielectric permittivities\n\u0007r of \u0001-quartz. Experimental results are from Refs. 38 and 39.\nFrequency Direction GGA LDA Expt.\n\u0014=0 xx 4.427 4.803 4.42\nzz 4.632 5.029 4.60\n\u0014\u2192\u0015 xx 2.381 2.602 2.356\nzz 2.404 2.641 2.383\nREFSON, TULIP, AND CLARK PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-8\n1% level.\u0002 In Ref. 35 agreement between LDA values and\nexperiment was obtained only by upshifting the conduction\nband energies by 1.8 eV. A very similar decrease in the high-\nfrequency dielectric permittivity was found in a recent all-\nelectron calculation using Gaussian basis sets.36 Given that\nthe GGA does not correct the LDA underestimation of band\ngaps and that GGA dielectric permittivities for quartz are in\ngood agreement with experiment, the earlier conclusion that\nthe band-gap error is responsible for the overestimation of\npermittivities35 is not supported.\nTo illustrate the directionally dependent behavior, we\nhave determined the zone-center frequencies of \u0001-quartz as a\nfunction of the approach of q to the Brillouin-zone center. In\nFig. 4, we show the zone-center frequencies as q tends to\nzero from directions within the q= \u0001qx ,qy ,0\u0002 plane, where the\napproach angle is measure relative to the qx axis. As one can\nsee, for particular modes this has a pronounced effect, and in\nthe case of \u0001-quartz the frequency can vary by as much as 50\nwave numbers. This example highlights the need to always\nquote the direction with which q tends to zero when report-\ning the frequency of any LO mode.\nC. Sodium hydrogen fluoride\nSodium hydrogen fluoride \u0001NaHF2\u0002 is a strongly\nhydrogen-bonded ionic molecular crystal, which presents a\nchallenging test of our methods. The nature of the chemical\nbonds within the linear FHF\u2212 ion is unusual and generates\ninteresting crystal structure polymorphs and a rich phase\ndiagram.40 This molecular anion is highly polarizable with a\nsignificant anisotropy, which it is difficult to describe accu-\nrately using local basis-set methods.41 Finally we will show\nthat the LDA description of this system is grossly in error,\nbut that the GGA results are in excellent agreement with\nexperiment.\nCASTEP calculations were performed using optimized\nnorm-conserving pseudopotentials30,31 which gave well-\nconverged-results at a cutoff of 850 eV. For Na the semicore\n2s and 2p electrons were treated as valence states. Brillouin-\nzone integration was carried out using a 5\f5\f5 mesh ac-\ncording to the recipe of Monkhorst and Pack.24 The experi-\nmental zero-pressure crystal structure of NaHF2 is\nrhombohedral R3\u00afm. An initial geometry optimization was\nperformed to relax the structure yielding lattice constants of\na=3.538 \u00c5 and c=13.908 \u00c5 compared to experimental val-\nues a=3.474 \u00c5 and c=13.788 \u00c5.40 The H-F bond length was\n1.146 \u00c5 compared to 1.13 \u00c5.42 DFPT calculations were per-\nformed to compute the dynamical matrices which were di-\nagonalized to give vibrational spectra. Electric field DFPT\ncalculations yielded the the Born effective charges and di-\nelectric permittivity as well as the nonanalytic corrections to\nthe dynamical matrix at q=0. The phonon dispersion curves\nare plotted in Fig. 5, the Born effective charges are given in\nTable IV, and some selected zone-center frequencies are\ntabulated in Table V.\nThe most striking feature of the dispersion plot is the\nextraordinarily large LO-TO splitting observed in the\nhighest-frequency FHF\u2212 stretch mode of 1474 cm\u22121. This re-\nFIG. 4. The variation in zone-center frequencies for \u0001-quartz is\nshown as a function of the direction from which the center of the\nBrillouin zone is approached. In \u0001a\u0002 we show the variation in fre-\nquency for all modes, while in \u0001b\u0002 and \u0001c\u0002 we emphasize the effect\nby illustrating the change in two particular modes.\nFIG. 5. \u0001Color online\u0002 Phonon dispersion of NaHF2. The hex-\nagonal setting and its labeling scheme are assumed here.\nTABLE IV. The Born effective charges of NaHF2.\nDirection H F Na\nxx \/yy 0.337 \u22120.686 1.057\nzz 2.017 \u22121.510 1.044\nVARIATIONAL DENSITY-FUNCTIONAL PERTURBATION\u00bc PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-9\nsults from a coupling of the internal FHF\u2212 anion mode to the\ncrystal\u2019s electrostatic field. The anomalous magnitude is in\npart a consequence of the very high Born charges which give\nrise to a large electric dipole in the distorted ion. This also\naccounts for the anomalously large dispersion of this mode\nin the \u0001hexagonal\u0002 basal plane; internal modes ordinarily ex-\nhibit very small dispersion.\nThe Zeff of over +2 on a hydrogen atom along the molecu-\nlar axis at first seems paradoxical, as it would appear to\nimply that displacing the proton moves more charge than\nsurrounds it. In fact this is easily explained. Figure 6\u0001a\u0002\nshows an isosurface of the first-order charge density associ-\nated with a displacement of the proton perpendicular and\nparallel to the molecular axis. It can be seen that the bulk of\nthe charge which moves upon proton displacement actually\nbelongs to the fluorine atoms. Also shown in Fig. 6\u0001b\u0002 is the\nfirst-order charge density response to an applied electric\nfield.\nA final point which merits a remark here is the very large\nerror in the phonon dispersion made by the LDA in a similar\ncalculation. Although the lattice parameters are only slightly\nchanged, showing the usual LDA underestimation \u0001a\n=3.345 \u00c5, c=13.656 \u00c5\u0002 the highest branch is increased in\nfrequency to a range of 1718\u20132306 cm\u22121 compared to\n1473\u20132111 cm\u22121 using the PBE GGA. This is not simply a\nconsequence of a grossly underestimated bond length as ob-\nserved in other hydrogen-bonded systems; in this case the\nH-F bond length is shortened by only 0.6% to 1.140 \u00c5.\nD. \u201e4\u22124\u0001\u2026-pentyl-cyano-biphenyl (5CB)\nThe 5CB molecule is the smallest that forms a liquid-\ncrystal phase and as such has been the subject of many com-\nputational studies.45 In studies of the liquid crystal phases it\nis found that small changes in the molecular structure and\nelectronic properties strongly influence the macroscopic\nproperties of the liquid crystal. As such, accurate knowledge\nof molecular properties is essential to understanding the be-\nhavior of the bulk material. For example, 5CB has a large\nmolecular dipole moment of 6.55 D mainly due to the polar\ncyano group accepting electrons from \u0006 orbitals of the phe-\nnyl groups. This will create a significant internal electric field\nif the molecules are aligned as in a nematic phase, and will\ntend to polarize 5CB molecules, making the molecular po-\nlarizability an important influence on the liquid crystal struc-\nture.\nPrevious work on 5CB has used a finite-field, finite-\ndifference approach to calculate the polarizability tensor.45\nThat approach can be problematic; in particular Zener break-\ndown will eventually occur for the elongated cells necessary\nto model longer molecules than this. A DFPT approach is\nalso more effective for periodic crystals which can require\nextremely large supercells to converge a finite-difference cal-\nculation.\nOur calculation was performed using norm-conserving\npseudopotentials as before and a plane-wave cutoff of\n800 eV. The PBE GGA functional was used to describe the\nXC interactions and a geometry optimization was performed\nto relax the molecular structure. For this molecular case a\nsingle k point at \u00010,0,0\u0002 was used to sample the BZ of the\nTABLE V. Selected zone-center frequencies in units of cm\u22121 of\nNaHF2 are shown and compared to experimental results, where\navailable. ir frequencies are from Ref. 43, Raman data from Ref. 40,\nand inelastic neutron scattering \u0001INS\u0002 frequencies from Ref. 44.\nDFPT\n\u0001\u0016\u2192K\u0002\nDFPT\n\u0001\u0016\u2192A\u0002 Raman ir INS\n146.6 146.6 144.5 158\n184.3 146.6\n204.4 204.4 212\n646.0 646.0 630.3 635\n1201.0 1201.0 1202\n1235.2 1201.0 1234\n1473.9 2111.2 1550 1413\nFIG. 6. \u0001Color online\u0002 Isosurfaces of the first-order charge den-\nsity in NaHF2 shown for \u0001a\u0002 an atomic perturbation associated with\nthe H atom moving and \u0001b\u0002 the response to an applied electric field.\nThe light \u0001green\u0002 isosurfaces represent motion or field parallel to the\nmolecular axis and the dark \u0001blue\u0002 perpendicular.\nREFSON, TULIP, AND CLARK PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-10\nsupercell. The supercell had dimensions of 30\f15\f15 \u00c53.\nBoth lattice dynamical and electric field perturbations were\ncalculated in order to evaluate both electronic and ionic con-\ntributions to the polarizability. These are shown in Table VI.\nThe results agree well with previous finite-difference\ncalculations,45 although in the DFPT case given here, we are\nable to compare the difference that the ionic contributions\nmake. We find that the most significant difference between\nthe low- and high-frequency limits affect the transverse di-\nrections increasing the polarizability by approximately 10%.\nWe have also examined the effect that the electric field\nperturbation has on the molecule. In Fig. 7 we show the\nfirst-order charge density for an electric field perturbation\napplied along the length of the molecule. It is found that the\nresponse density is not localized at any particular site but\ndistributed over the entire molecule with a slightly larger\nresponse on the cyano group at the right hand end of the\nfigure.\nVIII. CONCLUSIONS\nIn this paper, we have described the implementation de-\ntails of the plane-wave density-functional methodologies not\ndescribed elsewhere; in particular the terms required for the\nGGA response potential for a general phonon wave vector\nand some symmetry considerations such as an algorithm for\nobtaining the symmetry of the dynamical matrix. We have\nalso compared steepest-descent and conjugate-gradient mini-\nmizers applied to the variational DFPT formalism and also\nthe effect of several preconditioners.\nThese methods have been applied to three test systems,\nnamely, \u0001-quartz, the hydrogen-bonded NaHF2 crystal, and\nthe liquid-crystal-forming molecule 5CB. It was found that\nthe results obtained are in excellent agreement with both ex-\nperimental and other theoretical results where available.\nACKNOWLEDGMENTS\nThe authors wish to thank the other members of the\nCASTEP Developers Group \u0001M. Segall, C. Pickard, P. Hasnip,\nM. Probert, and M. Payne\u0002 for their invaluable discussions\nthroughout the development and implementation of the work\npresented here. We also wish to acknowledge X. Gonze for\nhelpful technical advice. P.T. acknowledges EPSRC for fi-\nnancial support. Computer time was provided on the EPSRC\nHPCx and CSAR resources funded under the UKCP consor-\ntium Grant No. GR\/N02337\/01 and on CCLRCs e-Science\nfacility.\n*Electronic address: K.Refson@rl.ac.uk\n\u2020Present address: Department of Physics, University of Warwick,\nCoventry CV4 7AL, UK.\n\u2021Electronic address: s.j.clark@durham.ac.uk; http:\/\/cmt.dur.ac.uk\/\nsjc\n1 P. Hohenberg and W. Kohn, Phys. Rev. 136, B864 \u00011964\u0002.\n2 W. Kohn and L. J. Sham, Phys. Rev. 140, A1133 \u00011965\u0002.\n3 S. Baroni, P. Giannozzi, and A. Testa, Phys. Rev. Lett. 58, 1861\n\u00011987\u0002.\n4 S. Baroni, S. De Gironcoli, A. Dal Corso, and P. Giannozzi, Rev.\nMod. Phys. 73, 515 \u00012001\u0002.\n5 X. Gonze, Phys. Rev. A 52, 1096 \u00011995\u0002.\n6 X. Gonze, Phys. Rev. B 55, 10337 \u00011997\u0002.\n7 X. Gonze and C. Lee, Phys. Rev. B 55, 10355 \u00011997\u0002.\n8 S. Baroni and R. Resta, Phys. Rev. B 33, 7017 \u00011986\u0002.\n9 P. Giannozzi and S. Baroni, J. Chem. Phys. 100, 8537 \u00011994\u0002.\n10 A. Putrino, D. Sebastiani, and M. Parrinello, J. Chem. Phys. 113,\n7102 \u00012000\u0002.\n11 C. J. Pickard and F. Mauri, Phys. Rev. Lett. 91, 196401 \u00012003\u0002.\n12 S. J. Clark, M. D. Segall, C. J. Pickard, P. J. Hasnip, M. J. Prob-\nert, K. Refson, and M. C. Payne, Z. Kristallogr. 220, 567\n\u00012005\u0002.\n13 M. D. Segall, P. J. D. Lindan, M. J. Probert, C. J. Pickard, P. J.\nHasnip, S. J. Clark, and M. C. Payne, J. Phys.: Condens. Matter\n14, 2717 \u00012002\u0002.\n14 F. Favot and A. Dal Corso, Phys. Rev. B 60, 11427 \u00011999\u0002.\n15 D. Egli and S. R. Billeter, Phys. Rev. B 69, 115106 \u00012004\u0002.\n16 J. A. White and D. M. Bird, Phys. Rev. B 50, R4954 \u00011994\u0002.\n17 M. J. Gillan, J. Phys.: Condens. Matter 1, 689 \u00011989\u0002.\n18 R. Fletcher and C. M. Reeves, Comput. J. 7, 149 \u00011964\u0002.\n19 M. P. Teter, M. C. Payne, and D. C. Allan, Phys. Rev. B 40,\n12255 \u00011989\u0002.\n20 G. Kresse and J. Furthm\u00fcller, Phys. Rev. B 54, 11169 \u00011996\u0002.\n21 A. A. Maradudin and S. H. Vosko, Rev. Mod. Phys. 40, 1 \u00011968\u0002.\n22 J. L. Warren, Rev. Mod. Phys. 40, 38 \u00011968\u0002.\n23 T. G. Worlton and J. L. Warren, Comput. Phys. Commun. 3, 88\n\u00011972\u0002.\n24 H. J. Monkhorst and J. D. Pack, Phys. Rev. B 13, 5188 \u00011976\u0002.\n25 P. R. Tulip and S. J. Clark, J. Chem. Phys. 121, 5201 \u00012004\u0002.\n26 P. R. Tulip and S. J. Clark, Phys. Rev. B 71, 195117 \u00012005\u0002.\nTABLE VI. The low- and high-frequency polarizabilities \u0001in \u00c53\u0002\nof the 5CB molecule.\n\u0014\u2192\u0015 \u0014=0\nx y z x y z\n59.13 0.07 1.69 59.99 0.09 1.75\n0.07 29.16 0.39 0.09 31.69 0.25\n1.69 0.39 22.58 1.75 0.25 25.75 FIG. 7. \u0001Color online\u0002 In the figure, we show an isosurface ofthe first-order charge density with an electric field perturbation\nalong the length of the 5CB molecule. The light gray \u0001yellow\u0002\nshows electron enhancement and the dark gray \u0001blue\u0002 electron\ndepletion under application of the field.\nVARIATIONAL DENSITY-FUNCTIONAL PERTURBATION\u00bc PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-11\n27 M. A. Adams, K. Refson, and B. J. Gabrys, Phys. Chem. Chem.\nPhys. 7, 3685 \u00012005\u0002.\n28 F. S. Tautz, V. Heine, M. T. Dove, and X. Chen, Phys. Chem.\nMiner. 18, 326 \u00011991\u0002.\n29 J. P. Perdew, K. Burke, and M. Ernzerhof, Phys. Rev. Lett. 77,\n3865 \u00011996\u0002.\n30 M. H. Lee, Ph.D. thesis, Cambridge University, 1995.\n31 J. S. Lin, A. Qteish, M. C. Payne, and V. Heine, Phys. Rev. B 47,\n4174 \u00011993\u0002.\n32 H. G. B. Dorner and H. Rzany, J. Phys. C 13, 6607 \u00011980\u0002.\n33 D. Strauch and B. Dorner, J. Phys.: Condens. Matter 5, 6149\n\u00011993\u0002.\n34 M. Fuchs, M. Bockstedte, E. Pehlke, and M. Scheffler, Phys. Rev.\nB 57, 2134 \u00011998\u0002.\n35 X. Gonze, D. C. Allan, and M. P. Teter, Phys. Rev. Lett. 68, 3603\n\u00011992\u0002.\n36 C. M. Zicovich-Wilson, F. Pascale, C. Roetti, V. R. Saunders, R.\nOrlando, and R. Dovesi, J. Comput. Chem. 25, 1873 \u00012004\u0002.\n37 S. E. Stein, NIST Chemistry WebBook: NIST Standard Reference\nDatabase, National Institute of Standards and Technology,\nGaithersburg, MD, 2005, Vol. 69, http:\/\/webbook.nist.gov\n38 F. Gervais and B. Piriou, Phys. Rev. B 11, 3944 \u00011975\u0002.\n39 K. F. Young and H. P. R. Fresrickse, J. Phys. Chem. Ref. Data 2,\n313 \u00011973\u0002.\n40 A. G. Christy, J. Haines, and S. M. Clark, J. Phys.: Condens.\nMatter 4, 8131 \u00011992\u0002.\n41 C. L. Janssen, W. D. Allen, H. F. Schaeffer III, and J. M. Bow-\nmen, Chem. Phys. Lett. 131, 352 \u00011986\u0002.\n42 J. A. Ibers, J. Phys. \u0001France\u0002 25, 474 \u00011964\u0002.\n43 S. Hamann and M. Linton, Aust. J. Chem. 29, 479 \u00011976\u0002.\n44 P. C. H. Mitchell, S. F. Parker, A. J. Ramirez-Cuesta, and J.\nTompkinson, Vibrational Spectroscopy with Neutrons \u0001World\nScientific, Singapore, 2005\u0002, Chap. 4, pp. 168\u2013170.\n45 S. J. Clark, G. J. Ackland, and J. Crain, Europhys. Lett. 44, 578\n\u00011998\u0002.\nREFSON, TULIP, AND CLARK PHYSICAL REVIEW B 73, 155114 \u00012006\u0002\n155114-12\n"}