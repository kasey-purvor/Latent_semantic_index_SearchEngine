{"doi":"10.1111\/j.1747-6593.2007.00089.x","coreId":"62955","oai":"oai:nora.nerc.ac.uk:3203","identifiers":["oai:nora.nerc.ac.uk:3203","10.1111\/j.1747-6593.2007.00089.x"],"title":"Identification and correction of water velocity measurement errors associated with ultrasonic Doppler flow monitoring","authors":["Blake, J. R.","Packman, J. C."],"enrichments":{"references":[],"documentType":{"type":1}},"contributors":[],"datePublished":"2008","abstract":"Ultrasonic Doppler flow monitoring (UDFM) is used to measure water flow in pipes and channels. However, a lack of scattering particles and signal noise can cause velocity errors, particularly for smaller discharges and surface water (\u2018clean\u2019) flows. A post-processing methodology is presented that identifies and corrects these errors, maximising the value of existing data. Test criteria are used to identify errors. The error correction procedure defines depth-velocity relationships from cleaned \u2018training data\u2019 representing the range of flow conditions (including backed up) and uses these relationships to automatically replace erroneous velocities. UDFM velocity errors have been successfully identified and corrected in example applications. Routine use allows early identification of changes in instrument or site behaviour. The methodology is practical, consistent and updateable. This is a significant advancement on previous methods for correcting velocity errors, improving the applicability of UDFM","downloadUrl":"https:\/\/core.ac.uk\/download\/pdf\/62955.pdf","fullTextIdentifier":"http:\/\/nora.nerc.ac.uk\/3203\/1\/BlakePackmanWEJPP.pdf","pdfHashValue":"852c09e054c7fcd1f145a0cd94fbdcf8ff50bc25","publisher":null,"rawRecordXml":"<record><header><identifier>\n    \n    \n      oai:nora.nerc.ac.uk:3203<\/identifier><datestamp>\n      2017-01-17T10:32:45Z<\/datestamp><setSpec>\n      7374617475733D707562<\/setSpec><setSpec>\n      7375626A656374733D533137<\/setSpec><setSpec>\n      74797065733D61727469636C65<\/setSpec><\/header><metadata><oai_dc:dc xmlns:oai_dc=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/\" xmlns:dc=\"http:\/\/purl.org\/dc\/elements\/1.1\/\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" xsi:schemaLocation=\"http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc\/ http:\/\/www.openarchives.org\/OAI\/2.0\/oai_dc.xsd\" ><dc:relation>\n    \n      \n        http:\/\/nora.nerc.ac.uk\/id\/eprint\/3203\/<\/dc:relation><dc:title>\n        Identification and correction of water velocity measurement errors associated with ultrasonic Doppler flow monitoring<\/dc:title><dc:creator>\n        Blake, J. R.<\/dc:creator><dc:creator>\n        Packman, J. C.<\/dc:creator><dc:subject>\n        Hydrology<\/dc:subject><dc:description>\n        Ultrasonic Doppler flow monitoring (UDFM) is used to measure water flow in pipes and channels. However, a lack of scattering particles and signal noise can cause velocity errors, particularly for smaller discharges and surface water (\u2018clean\u2019) flows. A post-processing methodology is presented that identifies and corrects these errors, maximising the value of existing data. Test criteria are used to identify errors. The error correction procedure defines depth-velocity relationships from cleaned \u2018training data\u2019 representing the range of flow conditions (including backed up) and uses these relationships to automatically replace erroneous velocities. UDFM velocity errors have been successfully identified and corrected in example applications. Routine use allows early identification of changes in instrument or site behaviour. The methodology is practical, consistent and updateable. This is a significant advancement on previous methods for correcting velocity errors, improving the applicability of UDFM.<\/dc:description><dc:date>\n        2008<\/dc:date><dc:type>\n        Publication - Article<\/dc:type><dc:type>\n        PeerReviewed<\/dc:type><dc:format>\n        text<\/dc:format><dc:language>\n        en<\/dc:language><dc:identifier>\n        http:\/\/nora.nerc.ac.uk\/id\/eprint\/3203\/1\/BlakePackmanWEJPP.pdf<\/dc:identifier><dc:identifier>\n         \n\n  Blake, J. R.; Packman, J. C..  2008  Identification and correction of water velocity measurement errors associated with ultrasonic Doppler flow monitoring.   Water and Environment Journal, 22 (3). 155-167.  https:\/\/doi.org\/10.1111\/j.1747-6593.2007.00089.x <https:\/\/doi.org\/10.1111\/j.1747-6593.2007.00089.x>     \n <\/dc:identifier><dc:relation>\n        http:\/\/www3.interscience.wiley.com\/journal\/120126408\/abstract<\/dc:relation><dc:relation>\n        doi:10.1111\/j.1747-6593.2007.00089.x<\/dc:relation><\/oai_dc:dc><\/metadata><\/record>","journals":null,"language":{"code":"en","id":9,"name":"English"},"relations":["http:\/\/nora.nerc.ac.uk\/id\/eprint\/3203\/","http:\/\/www3.interscience.wiley.com\/journal\/120126408\/abstract","doi:10.1111\/j.1747-6593.2007.00089.x"],"year":2008,"topics":["Hydrology"],"subject":["Publication - Article","PeerReviewed"],"fullText":" \n \n \nArticle (refereed) \n \n \n \nBlake, J. R.; Packman, J. C.. 2008 Identification and correction of \nwater velocity measurement errors associated with ultrasonic \nDoppler flow monitoring. Water and Environment Journal, 22 (3). \n155-167. doi:10.1111\/j.1747-6593.2007.00089.x \n \n \n \n \nJournal compilation \u00a9 2008 CIWEM \n \nThis version available at http:\/\/nora.nerc.ac.uk\/3203\/  \n \n \nNERC has developed NORA to enable users to access research outputs \nwholly or partially funded by NERC. Copyright and other rights for material \non this site are retained by the authors and\/or other rights owners. Users \nshould read the terms and conditions of use of this material at \nhttp:\/\/nora.nerc.ac.uk\/policies.html#access  \n \n \nThis document is the author\u2019s final manuscript version of the \njournal article, incorporating any revisions agreed during the peer \nreview process. Some differences between this and the publisher\u2019s \nversion remain. You are advised to consult the publisher\u2019s version \nif you wish to cite from this article. \n \nhttp:\/\/www3.interscience.wiley.com\/journal\/118500923\/home \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \n \nContact CEH NORA team at  \nnora@ceh.ac.uk \nBlake, J. R. and Packman, J. C. (2007) \n1 \n \n \nIdentification and correction of water velocity measurement \nerrors associated with ultrasonic Doppler flow monitoring \n \n \nJ. R. Blake* and J. C. Packman \n \n \nCentre for Ecology & Hydrology, \nWallingford, Oxfordshire, UK \n \nAccepted for publication in Water and Environment Journal \n(doi: 10.1111\/j.1747-6593.2007.00089.x) \nChartered Institution of Water and Environmental Management \nBlackwell Publishing \n \n* Corresponding Author \nJ. R. Blake, Centre for Ecology & Hydrology, Maclean Building, Crowmarsh Gifford, \nWallingford, Oxfordshire, OX10 8BB, UK \nEmail: jarib@ceh.ac.uk \nPhone: +44 (0)1491 692432\nBlake, J. R. and Packman, J. C. (2007) \n2 \nAbstract \n \nUltrasonic Doppler flow monitoring (UDFM) is used to measure water flow in pipes \nand channels. However, a lack of scattering particles and signal noise can cause \nvelocity errors, particularly for smaller discharges and surface water (\u2018clean\u2019) flows. \nA post-processing methodology is presented that identifies and corrects these errors, \nmaximising the value of existing data. Test criteria are used to identify errors. The \nerror correction procedure defines depth-velocity relationships from cleaned \u2018training \ndata\u2019 representing the range of flow conditions (including backed up) and uses these \nrelationships to automatically replace erroneous velocities. UDFM velocity errors \nhave been successfully identified and corrected in example applications. Routine use \nallows early identification of changes in instrument or site behaviour. The \nmethodology is practical, consistent and updateable. This is a significant advancement \non previous methods for correcting velocity errors, improving the applicability of \nUDFM. \n \nKey words \n \nCorrection, Error, Flow, Hydrometry, Monitoring, River, Sewer, Velocity \n \nBlake, J. R. and Packman, J. C. (2007) \n3 \nIntroduction \n \nUltrasonic Doppler flow monitoring (UDFM) is a standard method for measuring \nwater flow in pipes and channels (WRc, 1987; BSI, 1992; Herschy, 1995; Unidata, \n2000; ADS, 2007). The instrumentation typically comprises of an ultrasonic Doppler \nvelocity meter and a depth measuring pressure transducer, both sealed in a \nstreamlined \u2018mouse\u2019 that is attached to the pipe invert or channel bed. The \u2018mouse\u2019 is \nconnected by cable to a control box that provides power, logging and download \nfunctions. The depth and velocity are usually logged at regular intervals, to be used in \nsubsequent velocity-area flow calculations. This research is based upon use of the \nUnidata Starflow instrument to measure flows in small (1-3 ha) surface water \ncatchments. However, the findings will be broadly applicable to other situations and \nalternative instruments. \nBSI (1992, p. 5) describes the operation of the UDFM velocity meter: \u2018The \nacoustic signal transmitted by the meter is reflected by air in suspension and \nparticulate matter and returned to the sensor at a different frequency (Doppler effect). \nThe shift in frequency between the signal transmitted and that received is proportional \nto the liquid velocity\u2019. Thus, successful velocity measurement requires such scattering \nparticles in the flow (e.g. Watt and Jefferies, 1996; Unidata, 2000). Each logged \nvelocity is an average of those velocities measured by the instrument during its \nsampling period (which is typically kept small to optimise battery consumption). In \nthis study the sampling period has been increased to 7 seconds (from 2) by using \nlarger capacity batteries and modifying the instrument firmware settings. Under very \nlow flow conditions, for example in smaller pipes and channels or when flow is \nbacked up by a downstream control, even with an increased sampling period there \nBlake, J. R. and Packman, J. C. (2007) \n4 \nmay still be too few scattering particles passing by the instrument to provide a reliable \naverage velocity statistic. This is especially true of \u2018clean\u2019 as opposed to foul water \nflows. In this case the Starflow records a default error velocity (either zero or a repeat \nof the last reliable value, depending on the instrument settings). Unidata (2000) state \nthat a default error velocity may also be recorded if there is: (i.) excessive noise in the \nsampled velocities (e.g. due to the varying field of the ultrasonic cone, multiple \nreflections, bias by large reflectors, stationary reflectors, bedload targets or surface \nripples); (ii.) poor signal strength; or (iii.) a water level below the minimum operating \ndepth for the velocity meter. Additionally, spurious high velocity readings can be \ncaused by signal noise at low actual velocities although a dynamic signal filter can \nreduce this effect (Unidata, 2000). \nThis research aims to identify and correct any default error velocities or \nspurious high velocities present in UDFM data, especially for low volume surface \nwater flows. A new post-processing methodology is described that maximises the \nvalue of existing UDFM depth-velocity data. Stage 1 identifies the water velocity \nmeasurement errors in a semi-automated manner. This is an evolution of WRc (1987) \nguidance to manually check time-series plots of raw velocity and depth for errors. \nStage 2 analyses training data to define the depth-velocity relationship at each site. \nThis is analogous to the derivation of stage-discharge rating curves (e.g. CEH, 2006; \nHydro-Logic, 2006). Stage 3 automatically replaces erroneous velocities with \ncorrected values using the depth-velocity relationship. The velocity correction may be \ncomplicated by hysteretic flow response (Packman and Hewitt, 2000), transitions \nbetween sub- and super- critical flow or shifts in the depth-velocity relationship. \nHowever, the corrected velocity should be closer to the actual velocity than the \nBlake, J. R. and Packman, J. C. (2007) \n5 \ndefault error value (zero or last recorded velocity), thereby improving the velocity-\narea flow calculation. \nRecent work by ADS (e.g. Enfinger and Kimbrough, 2004; Enfinger and \nStevens, 2006) uses regression methods to fit the Manning equation to depth-velocity \ndata. Our Stage 2 procedure is distinct from their methods as it makes no a priori \nassumption about the nature of the depth-velocity relationship. Indeed, it would not be \npossible to fit a Manning equation to some of the data presented below. Furthermore, \nthe ADS output scattergraphs with Manning curves are used to establish sewer \ncapacity and infer flow behaviour, whereas we use the derived depth-velocity \nrelationships to correct erroneous velocities. \nCurrent WRc (1987) guidance indicates that flow depths under 100 mm, or \nvelocities under 200 mm\/s, are too small for accurate measurement. Watt and Jefferies \n(1996) also note the inaccuracy of some UDFM devices at low velocities. However, \nsometimes such low flows are of interest, for example inter-event flows within \nsustainable drainage systems or stream baseflow. Furthermore, sites may need to be \nmonitored despite not having optimal flow characteristics. The procedures presented \nhere will therefore improve the applicability of UDFM. \n \nData processing methodology \n \nMonitoring site descriptions \nThe following sections make reference to two example monitoring sites: (i.) Site A is \nan ordinary watercourse box culvert (2.44 m wide by 0.62 m deep). The data is logged \nevery 2 minutes and the flow is unlikely to back up. (ii.) Site B is an oversized surface \nwater sewer pipe (diameter 900 mm) that also provides online flood storage. The data \nBlake, J. R. and Packman, J. C. (2007) \n6 \nis logged every minute and the flow occasionally backs up and surcharges due to a \ndownstream throttle. These sites are part of 14 UDFM locations run by CEH in the \nEPSRC Water Cycle Management for New Developments project (WaND, 2007). \n \nStage 1: Identification of UDFM velocity errors \nDevelopment of a data processing methodology for a particular site requires a \nsufficient length of depth-velocity data to represent the expected flow range. This is \nreferred to herein as the training data. Assuming that the depth-velocity relationship is \ntime invariant, more data will improve accuracy. The raw training data for Site A \ncovers a 12 month period (see Fig. 1). The raw training data for Site B covers a 17 \nmonth period (see Fig. 2). At first sight the scatter in these plots looks excessive, but \nthe large number of points (~260 000 Site A; ~740 000 Site B) masks a central \ntendency and systematic flow patterns. Example default error velocities have been \nmarked on these plots. Both datasets also exhibit spurious high velocities that are \ndelimited by the dashed lines and associated equations (velocity, v; depth, d). \nBlake, J. R. and Packman, J. C. (2007) \n7 \n0 50 100 150 200 250 300 350\nDepth (mm)\n0\n500\n1000\n1500\n2000\n2500\nVe\nlo\nci\nty\n \n(m\nm\n\/s\n)\nDefault zero velocity errors\nv \n=\n \n13\n.\n33\n3 d\nSpurious high\nvelocities\n \nFig. 1. Site A: Scatter plot of raw data showing typical errors. \n0 250 500 750 1000 1250 1500 1750 2000\nDepth (mm)\n0\n500\n1000\n1500\n2000\n2500\nVe\nlo\nci\nty\n \n(m\nm\n\/s\n)\nv = 10 d + 500\nSpurious\nhigh velocities\n0 50 100 150 200\n0\n500\n1000\n1500\n2000\n2500 v = 10 d + 500\nDefault repeat\nvelocity errors\nDefault zero velocity errors\n \nFig. 2. Site B: Scatter plot of raw data showing typical errors, with inset detail for low \ndepths. \nBlake, J. R. and Packman, J. C. (2007) \n8 \n \nHaving examined the raw training data, the following criteria can be used to identify \nUDFM velocity errors: \n \n1. Default repeat velocity errors: The logged velocity (except zero) is identical to the \nprevious logged velocity (given the 1 mm\/s velocity meter resolution and natural flow \nvariability, a valid repeat value is unlikely). \n2. Default zero velocity errors: The logged depth is greater than or equal to the \nminimum operating depth for the velocity meter but the logged velocity is zero. \n3. Spurious high velocities: The logged velocity exceeds subjectively defined limits. \nFor Site A: v > 13.333 d or v > 3000 mm\/s. For Site B: v > 10 d + 500 or v > \n2000 mm\/s. These limits balance the requirement to include valid data and the desire \nto exclude spurious velocities. \n4. Rapid velocity increase. The logged velocity has increased by 600 mm\/s or more \nover one record but the depth has not doubled. \n5. Lone velocity value. A seemingly valid velocity occurs in isolation from other valid \nreadings, i.e. there is no valid reading within \u00b1 40 minutes of the current reading. \n \nCriteria 1-4 have been coded in a Fortran 90 program (PROC_SF) which searches \nthrough downloaded data, identifies depth-velocity records that exhibit an error \ncondition, replaces the erroneous velocities with an error coding value (99999) and \nstores the screened data in a new file. Criteria 1 and 2 are automatically evaluated. It \nshould be noted that alternative UDFM instruments may be able to automatically flag \nerrors due to criteria 1 and 2, e.g. ADS (2007). Criteria 3 and 4 require user-input: \nPotential errors are displayed along with depth-velocity values for both the preceding \nBlake, J. R. and Packman, J. C. (2007) \n9 \nand subsequent two records. By considering the context the user can decide whether \nto flag the velocity as an error or not. Criterion 5 has been coded in a second program \n(REM_LONE_SF) that searches through the output from PROC_SF, re-codes errors \nand outputs the screened data to a second file. Running these programs for the \nexample sites results in 59 % of records being error coded at Site A, 31 % at Site B. \nThe large number of errors reflect the difficulties of monitoring \u2018clean\u2019 surface water \nflows in small catchments. The high error percentage for Site A is also due to a long \nperiod of low summer flows. \n \nStage 2: Analysis of cleaned training data to define depth-velocity relationships \nIt is now possible to clean the raw training data. Two programs are run sequentially: \n(i.) ERR_PROC_SF removes records that have an error coded velocity; and (ii.) \nDVZ_SF removes any remaining records that have zero velocity. These zero \nvelocities occur when the flow is below the minimum operating depth for the velocity \nmeter. Since the flow may not actually be zero, they must be excluded. \nBlake, J. R. and Packman, J. C. (2007) \n10 \n0 50 100 150 200 250 300 350\nDepth (mm)\n0\n500\n1000\n1500\n2000\n2500\nVe\nlo\nci\nty\n \n(m\nm\n\/s\n)\n \nFig. 3. Site A: Scatter plot of cleaned training data. \n0 250 500 750 1000 1250 1500 1750 2000\nDepth (mm)\n0\n500\n1000\n1500\n2000\n2500\nVe\nlo\nci\nty\n \n(m\nm\n\/s\n)\n0 50 100 150 200\n0\n500\n1000\n1500\n2000\n2500\n \nFig. 4. Site B: Scatter plot of cleaned training data, with inset detail for low depths. \n \nBlake, J. R. and Packman, J. C. (2007) \n11 \nThe cleaned training data (see Figs. 3 and 4) can now be analysed to define depth-\nvelocity relationships for use in the error correction. The Site A data (~101 000 \npoints) exhibits a strong positive depth-velocity relationship that can be linearized by \ntaking the logarithms of each variable (see Fig. 5). The velocity values have a \nrelatively normal distribution, whereas the depth values are somewhat negatively \nskewed. Following various trials, a \u2018robust MM\u2019 bivariate regression, with velocity as \nthe dependent variable, has been performed using S-PLUS 6.2 (Insightful Corp.). This \nwas selected in preference to traditional linear regression due to the occurrence of \nheteroscedasticity (varying spread of residuals) and data outliers. The resultant \nrelationship is: \n \n( ) ( )dLOGvLOG 3206.11727.0 +=  (1) \n \nThe proportion of variation in response explained by this model is 90.0 %. Both \ncoefficients are significant (P < 0.0000) and the residual standard error is \u00b1 0.07432. \nEq. (1) can be transformed into the power curve equation\u2026 \n \n3206.14883.1 dv =  (2) \n \nFig. 5 shows that certain areas of the depth-velocity training data are less well \nrepresented by this equation. Lower than expected velocities may be due to \nmeandering streamlines at lower depths, sensitivity to changing channel roughness or \nthe velocity signals from bedload targets. Conversely, changes between sub- and \nsuper- critical flow could affect higher velocities. Refinement of the depth-velocity \nrelationship to account for these deviations will be discussed later. \nBlake, J. R. and Packman, J. C. (2007) \n12 \n \n1.2 1.7 2.2 2.7\nLOG(Depth)\n1.0\n1.5\n2.0\n2.5\n3.0\n3.5\nLO\nG\n(V\ne\nlo\nci\nty\n)\nLOG(v) = 0.1727 + 1.3206 LOG(d)\nLower than expected velocities\nSupercritical flows\nSubcritical flows\n \nFig. 5. Site A: Plot of cleaned training data showing the regression relationship (solid \nline), deviations and the sub-\/super- critical flow boundary (dashed line). \n \nTo investigate scatter in the training data, the velocity time-series for a large event, \ncovering both the rising and falling flows, was smoothed using a three point centred \nmoving average (see Fig. 6). No persistent hysteresis loops are evident; rather the \nsmoothed data tends towards a single relationship. Thus, the scatter is assumed to be \ndue to noise, justifying the decision at this stage to use a single depth-velocity \nrelationship for both rising and falling flows. \nBlake, J. R. and Packman, J. C. (2007) \n13 \n1.4 1.6 1.8 2.0 2.2 2.4\nLOG(Depth)\n1.6\n2.1\n2.6\n3.1\nLO\nG\n(V\nel\noc\nity\n)\n \nFig. 6. Site A: Smoothed velocity time-series (line) for a large event, compared to \ndepth-velocity data (points). \n \nSite B exhibits a more complex depth-velocity relationship that becomes clearer on \nlogarithmic axes (compare Figs. 4 and 7). The plot has been classified into three \nzones. Zone 1 represents free flow with a strong positive depth-velocity relationship. \nZone 3 indicates that the system is backed up, due to the downstream throttle, and the \nvelocity is relatively unchanging with depth. Zone 2 covers the transition between \nthese two states. \nBlake, J. R. and Packman, J. C. (2007) \n14 \n10 100 1,000\nDepth (mm)\n10\n100\n1,000\nVe\nlo\nci\nty\n \n(m\nm\n\/s\n)\nZone 1 Supe\nrcriti\ncal\nZone 2\nExample\nscanning\ncurves\nSubc\nritica\nl\nZone 3\n \nFig. 7. Site B: Logarithmic plot of cleaned training data showing three zones \n(delineated by dash-dot thresholds lines), the predominant depth-velocity relationship \nin each zone (solid trend line(s)) and the sub-\/super- critical flow boundary (dashed \nline). \n \nThe Zone 1 data has been extracted from the cleaned training data by examining the \nindividual tracks between successive depth-velocity data pairs. Data points forming \ntracks that remained within the area perceived to be Zone 1 were retained, whilst data \npoints forming tracks that exited Zone 1 were excluded. Although somewhat \nsubjective, this is a useful approach given the data complexity. The Zone 1 data \n(~8000 points) was linearized by taking the logarithms of each variable. Both the \nvelocity and depth values possess a fairly normal distribution. As before, a \u2018robust \nMM\u2019 bivariate regression has been performed. The resultant Zone 1 trend equation is: \n \nBlake, J. R. and Packman, J. C. (2007) \n15 \n( ) ( )dLOGvLOG 7608.04733.1 +=  (3) \n \nThe proportion of variation in response explained by this model is 76.2 %. Both \ncoefficients are significant (P < 0.0000) and the residual standard error is \u00b1 0.07403. \nEq. (3) can be transformed into the power curve equation\u2026 \n \n7608.0737.29 dv =  (4) \n \nAs previously, some deviation from this relationship may be explained by the \ntransition between sub- and super- critical flows (as marked on Fig. 7). The \nrelationship between hydraulic radius and velocity was also investigated but this was \nno stronger because the Zone 1 flow depths are below half pipe, where the \nrelationship between depth and pipe hydraulic radius is reasonably linear. The \nspecified Zone 1 threshold line is parallel to the Zone 1 trend line and it delimits the \nZone 1 values. It was calculated by adding the largest negative residual (-0.2901) to \nthe intercept term in Eq. (3), then transforming this into a power curve equation\u2026 \n \n7608.0248.15 dv =  (5) \n \nThe Zone 3 depth invariant relationship was determined from the low velocity \nhistogram (Fig. 8). The backed up flow velocity has been approximated as the median \nvalue (34 mm\/s), whilst the Zone 3 threshold velocity is 52 mm\/s. \nBlake, J. R. and Packman, J. C. (2007) \n16 \n0 10 20 30 40 50 60 70 80 90 100\nVelocity (mm\/s)\n0\n500\n1000\n1500\n2000\nFr\ne\nqu\ne\nn\ncy\n34 mm\/s (median)\n52 mm\/s\n \nFig. 8. Site B: Histogram of low velocities from cleaned training data. \n \nHaving established thresholds for Zones 1 and 3, the Zone 2 depth-velocity \nrelationships were determined by examining the tracks between successive depth-\nvelocity data points. A hysteretic negative depth-velocity relationship was revealed, \nwhich varies in magnitude with increasing or decreasing depth. This has been \napproximated using two average rates: (i.) Zone 2 velocity loss rate, velocity \ndecreases by 8.0 mm\/s per unit depth increase; and (ii.) Zone 2 velocity gain rate, \nvelocity increases by 2.2 mm\/s per unit depth decrease. These linear rates plot as \ncurves on a logarithmic graph (hence the example scanning curves in Fig. 7). \n \nStage 3: Correction of UDFM velocity errors \nThe depth-velocity relationships defined in Stage 2 have been incorporated into \nINFILL_SF - a new program that automatically corrects UDFM velocity errors. This \nBlake, J. R. and Packman, J. C. (2007) \n17 \nprogram processes the Stage 1 output file, replacing any error coded velocities with \ncorrected values according to the site dependent rules. For Site A, the replacement \nvelocity is calculated using Eq. (2). For Site B, the process is more complex (see Fig. \n9) depending on the zones in which the previous record and next valid record (i.e. \nnon-error coded velocity) occur and whether the event ends (i.e. depth below \nminimum operating depth) before the next valid record occurs. The Zone 1 threshold \nis defined by Eq. (5) and the Zone 3 threshold is 52 mm\/s. The INFILL_SF program \nhas been run on the data for both sites (see Results). \nEventends\nbefore next\nvalid\nvelocity?\nY\nPrevious\nrecord in\nZone 1?\nStart\nY\nCalculate\nreplacement\nvelocity using\nEquation 4\nN\nN\nPrevious\nrecord in\nZone 2?\nY\nN\nDepth\nrising?\nY\nCalculate\nreplacement\nvelocity using\nZone 2 loss\nrate (8.0)\nN\nCalculate\nreplacement\nvelocity using\nZone 2 gain\nrate (2.2)\nN\nY\nSet\nreplacement\nvelocity to\nprevious\nvelocity\nSet replacement\nvelocity to Zone 3\nthrottled velocity\n(34 mm\/s)\nPrevious\n& next\nrecords in\nZone 1?\nY\nCalculate\nreplacement\nvelocity using\nEquation 4\nN\nN\nSet\nreplacement\nvelocity to\nZone 3\nthrottled\nvelocity (34\nmm\/s)\nDepth\nfalling?\nPrevious\n& next\nrecords in\nZone 3?\nY\nN\nY\nPrevious record\nin Zone 3 or\nZone 1, and\nnext in Zone 2?\nCalculate replacement velocity\nusing linear interpolation between\nprevious and next velocities\n \nFig. 9. Flowchart showing data correction process used in INFILL_SF for Site B. \nBlake, J. R. and Packman, J. C. (2007) \n18 \n \nUsing the data processing programs \nA training dataset (see Stage 2) has been used to develop the data processing \nprograms. Whilst this could encompass all data from a monitoring campaign, it can be \nbeneficial to use the first few sets of data for training and then use the defined \nrelationships for routine processing of each new dataset as it is acquired. Checking \nnew data against training data can reveal instrument faults (such as depth sensor zero-\ndrift, see Watt and Jefferies, 1996) or the need for updated depth-velocity \nrelationships (e.g. if sediment bedload is moving through a surface water sewer \nsystem). However, to avoid errors of extrapolation, velocity correction should not \nextend beyond the range of the training data (instead the training data and associated \nrelationships would need to be updated). The distinction between using the programs \nin training or routine mode is shown in Fig. 10. \nBlake, J. R. and Packman, J. C. (2007) \n19 \nStart\nPROC_SF\nIdentifyand code\nvelocity errors\nREM_LONE_SF\nIdentify and code lone\nvelocities as errors\nERR_PROC_SF\nRemove records with\nerror coded velocity\nDVZ_SF\nRemove records with\nzero velocity\nTRAINING\nStart\nPROC_SF\nIdentify and code\nvelocity errors\nREM_LONE_SF\nIdentify and code lone\nvelocities as errors\nERR_PROC_SF\nRemove records with\nerror coded velocity\nDVZ_SF\nRemove records with\nzero velocity\nROUTINE\nPerform visual\ncheck of time-series\nErrors\nremoved?\nY\nN\nNeed to update\nPROC_SF\nPlot new and\ntraining data on\ndepth-velocity\nscatter plot\nNew data within\ntraining range?\nYNNeed to update\nINFILL_SF\nINFILL_SF\nReplace error\ncoded velocities\nwith corrected\nvalues\nINFILL_SF\nReplace error\ncoded velocities\nwith corrected\nvalues\nUse depth-\nvelocity training\ndata to develop\nINFILL_SF\nrelationships\n \nFig. 10. Data processing program use in training and routine modes (dotted line shows \nuse of previous output). \n \nResults and Discussion \n \nCorrected velocity data \nThe data processing methodology has been used to identify and correct UDFM water \nvelocity errors at example sites A and B. Selected events are shown in Figs. 11 to 13. \nThey represent different flow conditions and show the \u2018worst case\u2019 number of \nBlake, J. R. and Packman, J. C. (2007) \n20 \nvelocity errors. In all of these, and subsequent figures, raw data is plotted as filled \nblocks, corrected as a solid line. \n0\n400\n800\n02\/04\/0600:00\n02\/04\/06 12:00\n03\/04\/06 00:00\n03\/04\/06 12:00\nVe\nloc\nity\n(m\nm\/\ns)\n0\n100\nDe\npth\n(m\nm)\nRaw Velocity\nDepth\nCorrected Velocity\n \nFig. 11. Site A: Time series of depth and velocity (raw & corrected). \n \nFig. 11 shows that the errors at Site A are predominantly of the \u2018default zero velocity\u2019 \ntype, as indicated by the unfilled areas mainly occurring between 02\/04\/06 18:00 and \n03\/04\/06 12:00. They are probably due to excessive noise in the sampled velocities. \nThis may be linked to surface ripples affecting the Doppler return. With 30 readings \nper hour, \u2018default repeat velocity\u2019 errors are hard to spot in this plot although the \nprogram finds and corrects them. The corrected velocity is clearly an improvement \nover the raw data; the replacement velocities seem reasonable given their context, but \nare less variable than the raw data because they are derived from the less variable \ndepth time series. \nBlake, J. R. and Packman, J. C. (2007) \n21 \n0\n250\n500\n750\n01\/12\/0512:00\n02\/12\/05 00:00\n02\/12\/05 12:00\n03\/12\/05 00:00\n03\/12\/05 12:00\n04\/12\/05 00:00\nVe\nloc\nity\n(m\nm\/\ns)\n0\n60\nDe\npth\n(m\nm)\nRaw Velocity\nDepth\nCorrected Velocity\n \nFig. 12. Site B: Time series of depth and velocity (raw & corrected) under normal \nflow conditions. \n \nFig. 12 shows that at Site B (the oversize pipe) the errors under normal flow \nconditions are predominantly of the \u2018default zero velocity\u2019 type, mainly occurring \nduring flow recessions. As for Site A, this is probably due to excessive noise. \nAdditional errors occur after 19:00 on 03\/12\/05 when the water level falls below the \ninstrument minimum operating depth (these cannot be corrected). With 60 readings \nper hour, \u2018default repeat velocity\u2019 errors are again hard to spot in this plot. The \ncorrected velocity time series shows an improvement on the raw data, with reasonable \nreplacement values. The improvement is not as strong as for Site A due to the weaker \ndepth-velocity relationship at Site B (see Stage 2). Thus, a step may occur between \nthe replacement and original velocities, which is an area for future improvement. \nBlake, J. R. and Packman, J. C. (2007) \n22 \n0\n200\n400\n29\/03\/0512:00\n30\/03\/05 00:00\n30\/03\/05 12:00\n31\/03\/05 00:00\n31\/03\/05 12:00\nVe\nloc\nity\n(m\nm\/\ns)\n0\n800\nDe\npth\n(m\nm)\nRaw Velocity\nDepth\nCorrected Velocity\n \nFig. 13. Site B: Time series of depth and velocity (raw & corrected) under backed up \nflow conditions. \n \nFig. 13 shows that at Site B the errors under backed up conditions are predominantly \nof the \u2018default repeat velocity\u2019 type (e.g. the constant raw velocities around 29\/03\/05 \n21:00). They indicate that few scattering particles are passing the sensor, presumably \ndue to low flow velocities and deposition. Some \u2018default zero velocity\u2019 errors also \noccur and are again probably due to excessive noise. The corrected velocity time \nseries shows a visual improvement on the raw data, but the replacement velocity for \nbacked up flow (34 mm\/s) may be somewhat high (compared to the valid raw data). \n \nDischarge calculation \nBoth the raw and corrected velocity data have been used to generate discharge time \nseries. The corrected discharge has been calculated using the corrected velocities, the \nraw depths and the known cross section geometry. Figs. 14 to 16 show the corrected \nBlake, J. R. and Packman, J. C. (2007) \n23 \ndischarge for the previously selected events, along with the raw discharge (calculated \nusing raw depths and raw velocities). Although beyond the scope of this paper, such \ndischarges should ideally be calibrated against manual flow gauging (e.g. WRc, 1987; \nVermeyen, 2000) before being used in any application. \n0\n100\n200\n300\n400\n500\n600\n700\n800\n31\/03\/0612:00\n01\/04\/06\n00:00\n01\/04\/06\n12:00\n02\/04\/06\n00:00\n02\/04\/06\n12:00\n03\/04\/06\n00:00\n03\/04\/06\n12:00\nD\nis\nch\nar\nge\n(L\/\ns)\nRaw\nCorrected\n \nFig. 14. Site A: Time series of discharge (raw & corrected). \n \nBlake, J. R. and Packman, J. C. (2007) \n24 \n0\n5\n10\n15\n01\/12\/0512:00\n02\/12\/05\n00:00\n02\/12\/05\n12:00\n03\/12\/05\n00:00\n03\/12\/05\n12:00\n04\/12\/05\n00:00\nD\nis\nch\nar\nge\n(L\/\ns)\nRaw\nCorrected\n \nFig. 15. Site B: Time series of discharge (raw & corrected). \n0\n5\n10\n15\n20\n29\/03\/05\n12:00\n30\/03\/05\n00:00\n30\/03\/05\n12:00\n31\/03\/05\n00:00\n31\/03\/05\n12:00\nD\nis\nch\nar\nge\n(L\/\ns)\nRaw\nCorrected\n \nFig. 16. Site B: Time series of discharge (raw & corrected). \n \nThese figures highlight the benefits of the new methodology. Gaps in the discharge \nseries, caused by \u2018default zero velocity\u2019 errors, have been filled and \u2018default repeat \nBlake, J. R. and Packman, J. C. (2007) \n25 \nvelocity\u2019 errors have been replaced, allowing improved runoff estimates. With semi-\nautomated error identification, fully automated error correction and site dependent \nrules, the new methodology can correct data consistently. Furthermore, all stages of \nthe methodology can be updated as necessary and re-run independently. This provides \na significant advantage over the less consistent methods suggested in WRc (1987) \nguidance, namely manual checking of raw velocity and depth time-series plots for \nerroneous data, and using manual lines drawn on flow-depth scattergraphs to obtain \nreplacement flow values. It should be noted that the estimates of corrected discharge \nunder backed up conditions (Fig. 16) may be somewhat high at times, due to the use \nof a fixed replacement velocity. \n \nEvaluation of methodology \nIn the preceding sections, the new methodology has been evaluated qualitatively. For \nexample, replacement velocities are noted as \u2018reasonable given their context\u2019 (the \ncontext being the preceding and subsequent values in the data). This approach has \nbeen necessary due to the inherent difficulties of quantitative evaluation. For example, \nwhilst the variation in response statistic aids in the assessment of alternative depth-\nvelocity relationships, it is less useful for evaluating the methodology itself. \nFurthermore, although confidence limits could be calculated for erroneous velocities \nreplaced using a regression calculation, they would not be possible for non-regression \nareas of the depth-velocity relationship (e.g. Zones 2 and 3 in Fig. 7). A quantitative \nevaluation could involve replacing a proportion of a known error free dataset with \nrealistically distributed erroneous velocities, then performing error identification and \ncorrection to produce a corrected dataset. This corrected dataset could be compared \nwith the original to quantify the match between corrected and actual velocities. \nBlake, J. R. and Packman, J. C. (2007) \n26 \nHowever, since velocity errors tend to occur during flow recession or backed up \nconditions, it has not been possible to obtain an error free dataset for these conditions. \nThus we have had to rely on a qualitative evaluation of the methodology. \n \nFuture directions \nFuture work could improve the depth-velocity relationships used in the velocity \ncorrection procedures. This might parallel recent developments in the derivation of \nstage-discharge ratings (e.g. Petersen-Overleir, 2006). Currently, the relationships \n(and their accuracy) are biased towards the more numerous lower depth-velocity \nreadings. An upgrade to multi-part regressions could improve representation of the \nsub- to super- critical flow transition (e.g. see Fig. 5), enabling the more accurate \ncorrection of the albeit infrequent errors at higher velocities. Following Enfinger and \nSchutzbach (2005), it might also be possible to explicitly account for the effects of \nvarying channel roughness. Error correction for backed up conditions (e.g. Zone 3 in \nFig. 7) might be improved with a variable depth-velocity relationship (rather than a \nfixed value). Since error correction is predominantly required on falling flows, it \nmight be improved by defining individual depth-velocity relationships for rising or \nfalling flows. Depth-velocity relationships that are non-stationary in time, e.g. for \nnatural channels or when a sediment pulse is moving slowly through a drainage \nsystem, will require time variant correction. \n \nConclusions \n \n(1) A new post-processing methodology has been presented that identifies and \ncorrects water velocity measurement errors associated with ultrasonic Doppler flow \nBlake, J. R. and Packman, J. C. (2007) \n27 \nmonitoring. The error identification is semi-automated against test criteria. The error \ncorrection procedure defines depth-velocity relationships from valid \u2018training data\u2019, \nthen uses these to automatically replace erroneous velocities given valid depth data. \nThe methodology is practical, consistent and updateable. It is a significant advance \nover previous UDFM data correction methods. The method maximises the value of \nexisting data, requiring no additional data collection. Used in \u2018routine\u2019 mode for \nongoing data collection campaigns, it can highlight changes in instrument or site \nbehaviour at the earliest opportunity. \n(2) The methodology has been applied to two example sites: a stream culvert and a \nsurface water drainage pipe. Gaps in the discharge series, caused by \u2018default zero \nvelocity\u2019 errors, have been filled and \u2018default repeat velocity\u2019 errors have been \nreplaced. This provides a qualitative improvement over direct use of the raw data. \n(3) The methodology improves the applicability of UDFM to smaller discharges, \nsurface water (\u2018clean\u2019) flows, backed up conditions and sub-optimal sites. \n(4) Future work could include refinement of the depth-velocity relationships, e.g. \naccounting for flow hysteresis and transitions between sub- and super- critical flow. \n \nAcknowledgements \n \nThe work presented in this paper has been developed under Water Cycle Management \nfor New Developments (WaND) and the project support from EPSRC and industrial \ncollaborators acknowledged. NERC provided additional support. We would like to \nthank: Tony Porter, Ian Gowing and Amanda Lloyd for fieldwork assistance; \nOxfordshire County Council, Bryant Homes and Thames Water for monitoring \npermissions; the anonymous reviewers for helpful comments. \nBlake, J. R. and Packman, J. C. (2007) \n28 \n \nReferences \n \nADS (2007) Flow Monitors and Communications [online]. ADS. \nhttp:\/\/www.adsenv.com\/default.aspx?id=21 [accessed 21 June 2007] \nBSI (1992) ISO\/TR 9824-1: Measurement of liquid flow in open channels. Part 11. \nFree surface flow in closed conduits. Part 11A. Methods of measurement. BSI. \nCEH (2006) HYDATA \u2013 Hydrological Database and Analysis software [online]. \nCEH. http:\/\/www.ceh.ac.uk\/products\/software\/CEHSoftware-HYDATA.htm \n[accessed 30 October 2006] \nEnfinger, K. L. & Kimbrough, H. R. (2004) Scattergraph Principles and Practice: A \nComparison of Various Applications of the Manning Equation. In Galleher Jr., \nJ. J. & Stift, M. T. (Eds.) Pipelines 2004: Pipeline Engineering and \nConstruction: What's on the Horizon? pp. 50. American Society of Civil \nEngineers, San Diego, California, USA. \nEnfinger, K. L. & Schutzbach, J. S. (2005) Scattergraph Principles and Practice: \nCamp's Varying Roughness Coefficient Applied to Regressive Methods. In \nVipulanandan, C. & Ortega, R. (Eds.) Pipelines 2005: Optimizing Pipeline \nDesign, Operations, and Maintenance in Today's Economy. pp. 72-83. \nAmerican Society of Civil Engineers, Houston, TX, USA. \nEnfinger, K. L. & Stevens, P. L. (2006) Scattergraph Principles and Practice: Tools \nand Techniques to Evaluate Sewer Capacity. In Atalah, A. & Tremblay, A. \n(Eds.) Pipelines 2006: Service to the Owner. pp. 16. American Society of \nCivil Engineers, Chicago, Illinois, USA. \nHerschy, R. W. (1995) Streamflow measurement, Second ed. E&FN Spon, London. \nHydro-Logic (2006) HYDROLOG4 [online]. Hydro-Logic. http:\/\/www.hydro-\nlogic.co.uk\/content\/view\/14\/50\/ [accessed 30 October 2006] \nPackman, J. C. & Hewitt, E. J. (2000) Urban runoff control in the developing world. \nAppendix A. Data processing procedures. Department for International \nDevelopment, UK. \nPetersen-Overleir, A. (2006) Modelling stage-discharge relationships affected by \nhysteresis using the Jones formula and nonlinear regression. Hydrological \nSciences Journal-Journal Des Sciences Hydrologiques, 51 (3), 365-388. \nUnidata (2000) STARFLOW Ultrasonic Doppler Instrument User's Manual, Unidata, \nAustralia. \nVermeyen, T. B. (2000) A Laboratory Evaluation of Unidata's Starflow Doppler \nFlowmeter and MGD Technologies Acoustic Doppler Flow Meter (ADFM) \n[online]. USBR. \nhttp:\/\/www.usbr.gov\/pmts\/hydraulics_lab\/tvermeyen\/starflow\/index.html \n[accessed 3 January 2007] \nWaND (2007) Water Cycle Management for New Developments [online]. WaND. \nhttp:\/\/www.wand.uk.net\/index.php [accessed 23 January 2007] \nWatt, I. A. & Jefferies, C. (1996) Portable sewage flow sensors - Their calibration and \naccuracy. Water Science and Technology, 33 (1), 127-137. \nWRc (1987) A Guide to Short Term Flow Surveys of Sewer Systems. Water Research \nCentre, Swindon. \n \nBlake, J. R. and Packman, J. C. (2007) \n29 \n \nWord count \n \n4060 (main text and figure captions) \n \nFigure Captions \n \nFig. 1. Site A: Scatter plot of raw data showing typical errors. \n \nFig. 2. Site B: Scatter plot of raw data showing typical errors, with inset detail for low \ndepths. \n \nFig. 3. Site A: Scatter plot of cleaned training data. \n \nFig. 4. Site B: Scatter plot of cleaned training data, with inset detail for low depths. \n \nFig. 5. Site A: Plot of cleaned training data showing the regression relationship (solid \nline), deviations and the sub-\/super- critical flow boundary (dashed line). \n \nFig. 6. Site A: Smoothed velocity time-series (line) for a large event, compared to \ndepth-velocity data (points). \n \nFig. 7. Site B: Logarithmic plot of cleaned training data showing three zones \n(delineated by dash-dot thresholds lines), the predominant depth-velocity relationship \nin each zone (solid trend line(s)) and the sub-\/super- critical flow boundary (dashed \nline). \nBlake, J. R. and Packman, J. C. (2007) \n30 \n \nFig. 8. Site B: Histogram of low velocities from cleaned training data. \n \nFig. 9. Flowchart showing data correction process used in INFILL_SF for Site B. \n \nFig. 10. Data processing program use in training and routine modes (dotted line shows \nuse of previous output). \n \nFig. 11. Site A: Time series of depth and velocity (raw & corrected). \n \nFig. 12. Site B: Time series of depth and velocity (raw & corrected) under normal \nflow conditions. \n \nFig. 13. Site B: Time series of depth and velocity (raw & corrected) under backed up \nflow conditions. \n \nFig. 14. Site A: Time series of discharge (raw & corrected). \n \nFig. 15. Site B: Time series of discharge (raw & corrected). \n \nFig. 16. Site B: Time series of discharge (raw & corrected). \n \n \n"}